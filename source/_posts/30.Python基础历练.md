---
title: python基础历练
date: 2026-01-16 16:10:43
description: 查看开源代码时学习到的一些python知识
cover: /covers/30.webp
tags:
    - 基础知识
categories:
    - 基础知识
---


### 元类

> 具体的项目实践可参考：[AgentScope](https://github.com/agentscope-ai/agentscope) 中的 src/agentscope/agent/_agent_meta.py文件

元类(Metaclass)是**用来"创建类"的类**

```python
# 类 ---> 对象

# 元类 ---> 类 ---> 对象
```

元类的作用，主要用于在"类创建阶段"做事情，常见用途：

1. 自动修改类：

- 自动给类添加属性
- 自动给方法打日志
- 统一规范(如方法必须以do_开头)

2. 注册/收集类：

- 子类自动注册到某个地方  ([AgentScope](https://github.com/agentscope-ai/agentscope) 就是用来做这个的)
- 常用于工厂模式、插件系统

最基本的元类结构

```python
class MyMeta(type):
    def __new__(mls, name, bases, attrs):
        print(f"创建类：{name})
        return super().__new__(mls, name, bases, attrs)
              
''' 参数说明
mls:元类本身
name: 类名
bases: 父类
attrs: 类属性字典 (注意也是包含函数的哦！)
'''
```



### with

> 这个在写mcp的资源管理的时候比较有用

任何能用于 `with` 的对象，都必须实现两个方法：

```python
__enter__()
__exit__(exc_type, exc_val, exc_tb)
```

等价执行过程:

```python
obj = EXPR
value = obj.__enter__()
try:
    BLOCK
finally:
    obj.__exit__(...)
```

举个例子是：自定义一个资源管理器

```python
class MyResource:
    def __enter__(self):
        print("申请资源")
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        print("释放资源")
        if exc_type:
            print("发生异常:", exc_type)
        return False  # False 表示异常继续往外抛

    
## 使用过程
with MyResource() as f:
    print("使用资源")
    
```



