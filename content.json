{"meta":{"title":"å¤§æ½˜å­çš„æ–‡å­—è§’è½","subtitle":"","description":"","author":"Pan","url":"https://flippy-bird.github.io","root":"/"},"pages":[{"title":"categories","date":"2025-11-26T05:54:56.000Z","updated":"2025-11-26T05:55:08.826Z","comments":true,"path":"categories/index.html","permalink":"https://flippy-bird.github.io/categories/index.html","excerpt":"","text":""},{"title":"","date":"2026-01-19T03:03:58.030Z","updated":"2026-01-19T03:03:58.030Z","comments":true,"path":"css/custom.css","permalink":"https://flippy-bird.github.io/css/custom.css","excerpt":"","text":"/* ä¼˜åŒ–é¦–é¡µé¡¶éƒ¨å›¾ç‰‡åŠ è½½ */ #page-header.full_page { /* ç¡®ä¿èƒŒæ™¯å›¾ç‰‡ç«‹å³æ˜¾ç¤º */ will-change: background-image; /* æ·»åŠ è¿‡æ¸¡æ•ˆæœï¼Œé¿å…é—ªçƒ */ transition: background-image 0.3s ease-in-out; /* ä¸´æ—¶ç¦ç”¨ fixed ä»¥è§£å†³æ¸²æŸ“é—®é¢˜ï¼Œå¦‚æœä¸éœ€è¦è§†å·®æ•ˆæœå¯ä»¥ä¿ç•™ */ /* background-attachment: scroll !important; */ } /* é¢„åŠ è½½å›¾ç‰‡çš„å ä½æ ·å¼ */ #page-header.full_page::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: inherit; background-size: inherit; background-position: inherit; background-repeat: inherit; opacity: 0; z-index: -1; pointer-events: none; }"},{"title":"tags","date":"2025-11-26T05:53:10.000Z","updated":"2025-11-26T12:54:36.650Z","comments":true,"path":"tags/index.html","permalink":"https://flippy-bird.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"35.å¤§æ¨¡å‹æ¨ç†éƒ¨ç½²","slug":"35-å¤§æ¨¡å‹æ¨ç†éƒ¨ç½²","date":"2026-01-26T02:17:21.000Z","updated":"2026-01-26T02:18:39.449Z","comments":true,"path":"2026/01/26/35-å¤§æ¨¡å‹æ¨ç†éƒ¨ç½²/","permalink":"https://flippy-bird.github.io/2026/01/26/35-%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%8E%A8%E7%90%86%E9%83%A8%E7%BD%B2/","excerpt":"","text":"å‚è€ƒèµ„æ–™ è¯»æ‡‚ AI Infraï¼Œçœ‹è¿™å…­ä¸ªå…³é”®è¯å°±å¤Ÿäº†","categories":[{"name":"æ¨ç†éƒ¨ç½²","slug":"æ¨ç†éƒ¨ç½²","permalink":"https://flippy-bird.github.io/categories/%E6%8E%A8%E7%90%86%E9%83%A8%E7%BD%B2/"}],"tags":[{"name":"inference","slug":"inference","permalink":"https://flippy-bird.github.io/tags/inference/"},{"name":"llm","slug":"llm","permalink":"https://flippy-bird.github.io/tags/llm/"}]},{"title":"34.æ¨¡å‹æ¨ç†åŸºæœ¬çŸ¥è¯†-tensorRT","slug":"34-æ¨¡å‹æ¨ç†åŸºæœ¬çŸ¥è¯†-tensorRT","date":"2026-01-26T02:14:09.000Z","updated":"2026-01-26T02:15:58.082Z","comments":true,"path":"2026/01/26/34-æ¨¡å‹æ¨ç†åŸºæœ¬çŸ¥è¯†-tensorRT/","permalink":"https://flippy-bird.github.io/2026/01/26/34-%E6%A8%A1%E5%9E%8B%E6%8E%A8%E7%90%86%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86-tensorRT/","excerpt":"","text":"TensorRTtensorRTæ‰€åšçš„ä¼˜åŒ–æ˜¯åŸºäºGPUè¿›è¡Œä¼˜åŒ–ï¼Œå½“ç„¶ä¹Ÿæ˜¯æ›´å–œæ¬¢é‚£ç§ä¸€å¤§å—ä¸€å¤§å—çš„çŸ©é˜µè¿ç®—ï¼Œå°½é‡ç›´é€šåˆ°åº•ã€‚å› æ­¤å¯¹äºé€šé“æ•°æ¯”è¾ƒå¤šçš„å·ç§¯å±‚å’Œåå·ç§¯å±‚ï¼Œä¼˜åŒ–åŠ›åº¦æ˜¯æ¯”è¾ƒå¤§çš„ï¼›å¦‚æœæ˜¯æ¯”è¾ƒç¹å¤šå¤æ‚çš„å„ç§ç»†å°opæ“ä½œ(ä¾‹å¦‚reshapeã€gatherã€splitç­‰)ï¼Œé‚£ä¹ˆTensorRTçš„ä¼˜åŒ–åŠ›åº¦å°±æ²¡æœ‰é‚£ä¹ˆå¤¸å¼ äº†ã€‚ ä¸ºäº†æ›´å……åˆ†åˆ©ç”¨GPUçš„ä¼˜åŠ¿ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡æ¨¡å‹çš„æ—¶å€™ï¼Œå¯ä»¥æ›´åŠ åå‘äºæ¨¡å‹çš„å¹¶è¡Œæ€§ï¼Œå› ä¸ºåŒæ ·çš„è®¡ç®—é‡ï¼Œâ€œå¤§è€Œæ•´â€çš„GPUè¿ç®—æ•ˆç‡è¿œè¶…â€œå°è€Œç¢â€çš„è¿ç®—ã€‚ tensorRTåšäº†å“ªäº›ï¼Ÿ é‡åŒ–ï¼šé‡åŒ–å³IN8é‡åŒ–æˆ–è€…FP16ä»¥åŠTF32ç­‰ä¸åŒäºå¸¸è§„FP32ç²¾åº¦çš„ä½¿ç”¨ï¼Œè¿™äº›ç²¾åº¦å¯ä»¥æ˜¾è‘—æå‡æ¨¡å‹æ‰§è¡Œé€Ÿåº¦å¹¶ä¸”ä¸ä¼šä¿æŒåŸå…ˆæ¨¡å‹çš„ç²¾åº¦ ç®—å­èåˆ(å±‚ä¸å¼ é‡èåˆ)ï¼šç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡èåˆä¸€äº›è®¡ç®—opæˆ–è€…å»æ‰ä¸€äº›å¤šä½™opæ¥å‡å°‘æ•°æ®æµé€šæ¬¡æ•°ä»¥åŠæ˜¾å­˜çš„é¢‘ç¹ä½¿ç”¨æ¥æé€Ÿ å†…æ ¸è‡ªåŠ¨è°ƒæ•´ï¼šæ ¹æ®ä¸åŒçš„æ˜¾å¡æ„æ¶ã€SMæ•°é‡ã€å†…æ ¸é¢‘ç‡ç­‰(ä¾‹å¦‚1080TIå’Œ2080TI)ï¼Œé€‰æ‹©ä¸åŒçš„ä¼˜åŒ–ç­–ç•¥ä»¥åŠè®¡ç®—æ–¹å¼ï¼Œå¯»æ‰¾æœ€åˆé€‚å½“å‰æ„æ¶çš„è®¡ç®—æ–¹å¼ åŠ¨æ€å¼ é‡æ˜¾å­˜ï¼šé€šè¿‡æ˜¾å­˜æ± å¤ç”¨ï¼Œä»…åœ¨è¿è¡Œé˜¶æ®µä¸ºå¼ é‡åˆ†é…å†…å­˜æ¥æé«˜å†…å­˜å¤ç”¨ç‡ï¼Œå‡å°‘å†…å­˜æ¶ˆè€—å¹¶é¿å…åˆ†é…å¼€é”€ä»¥å®ç°æ›´é«˜æ•ˆçš„æ‰§è¡Œæ•ˆç‡ã€‚ å¤šæµæ‰§è¡Œï¼šä½¿ç”¨CUDAä¸­çš„streamæŠ€æœ¯ï¼Œæœ€å¤§åŒ–å®ç°å¹¶è¡Œæ“ä½œ ç®€å•æ¥è¯´ï¼Œé’ˆå¯¹è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œä¾‹å¦‚çŸ©é˜µä¹˜æ³•å’Œå·ç§¯ç­‰æ“ä½œï¼ŒTensorRT å¯ä»¥é€šè¿‡ä¼˜åŒ–ç®—å­æå‡è®¡ç®—æ•ˆç‡ï¼Œå¯¹äºç¼“å­˜å¯†é›†å‹çš„ä»»åŠ¡ï¼ŒTensorRTå¯ä»¥é€šè¿‡ç®—å­èåˆçš„æ–¹å¼å‡å°‘ç¼“å­˜å’Œæ‹·è´çš„æ•°æ®é‡ä»¥æé«˜æ˜¾å­˜è®¿é—®çš„æ•ˆç‡ï¼ŒåŒæ—¶ï¼Œä¹Ÿå¯é€šè¿‡ä½¿ç”¨ä½ç²¾åº¦çš„æ•°æ®ç±»å‹å‡å°‘è®¡ç®—æ—¶é—´å’Œå†…å­˜çš„ä½¿ç”¨é‡ä»¥åŠ å¿«è¿è¡Œé€Ÿåº¦ã€‚ tensorRTæ”¯æŒFP32ã€FP16ã€TF32ã€INT8ç­‰å¸¸è§çš„æ•°æ®æ ¼å¼ï¼Œä¸‹é¢æ˜¯å„ç§ç²¾åº¦çš„åŒºåˆ«ï¼š TF32ï¼šç¬¬ä¸‰ä»£Tensor Coreæ”¯æŒçš„ä¸€ç§æ•°æ®ç±»å‹ï¼Œæ˜¯ä¸€ç§æˆªçŸ­çš„ Float32 æ•°æ®æ ¼å¼ï¼Œå°†FP32ä¸­23ä¸ªå°¾æ•°ä½æˆªçŸ­ä¸º10bitsï¼Œè€ŒæŒ‡æ•°ä½ä»ä¸º8bitsï¼Œæ€»é•¿åº¦ä¸º19(&#x3D;1+8 +10)ã€‚ä¿æŒäº†ä¸FP16åŒæ ·çš„ç²¾åº¦(å°¾æ•°ä½éƒ½æ˜¯ 10 ä½ï¼‰ï¼ŒåŒæ—¶è¿˜ä¿æŒäº†FP32çš„åŠ¨æ€èŒƒå›´æŒ‡æ•°ä½éƒ½æ˜¯8ä½)ï¼› æ¨¡å‹è½¬æ¢ä¸€èˆ¬è·¯å¾„æ˜¯ï¼špytorchæ¨¡å‹ â€”&gt; onnxæ¨¡å‹ â€”&gt; TensorRTæ¨¡å‹ pytorch æ¨¡å‹è½¬onnxæ¨¡å‹ 12345678910111213141516171819202122232425262728293031import torch.onnx# è½¬æ¢åONNXæ¨¡å‹çš„å­˜å‚¨è·¯å¾„onnx_model = &quot;model.onnx&quot;# éœ€è¦è½¬æ¢çš„Pytorchæ¨¡å‹torch_model = &quot;model.pth&quot; # åŠ è½½Pytorchæ¨¡å‹æƒé‡model = model.load_state_dict(torch.load(model))# å¯¼å‡ºæ¨¡å‹å‰ï¼Œè°ƒç”¨model.eval()model.eval()batch_size = 1 # éšæœºçš„å–å€¼ï¼Œå½“è®¾ç½®dynamic_axesåå½±å“ä¸å¤§# dummy_inputç†è§£ä¸ºä¸€ä¸ªè¾“å…¥çš„å®ä¾‹ï¼Œä»…æä¾›è¾“å…¥shapeã€typeç­‰ä¿¡æ¯ï¼Œæ— éœ€å…³å¿ƒæ•°å€¼dummy_input = torch.randn(batch_size, 3, 224, 224, dtype=torch.float16) # å¯¼å‡ºæ¨¡å‹torch.onnx.export(model, dummy_input, onnx_model, export_params=True, # æŒ‡å®šä¸ºTrueæˆ–é»˜è®¤, æ¨¡å‹å‚æ•°ä¹Ÿä¼šè¢«å¯¼å‡º # https://github.com/onnx/onnx/blob/main/docs/Operators.md # ç®—å­æ— æ³•æ”¯æŒæ—¶ï¼Œä¼šæç¤ºONNX export failed: Couldn&#x27;t export operator xxx opset_version=23, #ONNXç®—å­é›†çš„ç‰ˆæœ¬ï¼Œä¸torchç‰ˆæœ¬ç›¸å…³ do_constant_folding=True, #æ˜¯å¦æ‰§è¡Œå¸¸é‡æŠ˜å ä¼˜åŒ– #è¾“å…¥å‚æ•°åç§°ï¼Œå»ºè®®ä¸forwardå‡½æ•°ä¸­å®šä¹‰å‚æ•°ä¿æŒä¸€è‡´ input_names = [&#x27;input&#x27;], #è¾“å‡ºå¼ é‡çš„åç§°ï¼Œå»ºè®®ä¸torchæ¨¡å‹ä¸­å®šä¹‰å‚æ•°ä¿æŒä¸€è‡´ output_names = [&#x27;output&#x27;], # dynamic_axeså°†batch_sizeçš„ç»´åº¦æŒ‡å®šä¸ºåŠ¨æ€ # 0ä»£è¡¨ç¬¬0ç»´ä¸ºåŠ¨æ€è¾“å…¥ï¼Œbatch_sizeä¸ºå¯¹è¿™ä¸€ç»´åº¦çš„å‘½åï¼Œå¯æŒ‰éœ€ä¿®æ”¹ # inputä¸outputä¸ºinput_namesä¸output_namesä¸­å®šä¹‰çš„åç§° dynamic_axes=&#123;&#x27;input&#x27; : &#123;0 : &#x27;batch_size&#x27;&#125;, &#x27;output&#x27; : &#123;0 : &#x27;batch_size&#x27;&#125;&#125;) ä½¿ç”¨onnxruntimeéªŒè¯ä¸€ä¸‹onnxæ¨¡å‹ è¿™ä¸ªæ¨¡å‹éœ€è¦çš„è¾“å…¥æ˜¯ä¸‰ä¸ª 12345678910111213141516171819202122232425import onnximport numpy as npimport onnxruntime as rtimport cv2model_path = &#x27;/home/oldpan/code/models/Resnet34_3inputs_448x448_20200609.onnx&#x27;# éªŒè¯æ¨¡å‹åˆæ³•æ€§onnx_model = onnx.load(model_path)onnx.checker.check_model(onnx_model)# è¯»å…¥å›¾åƒå¹¶è°ƒæ•´ä¸ºè¾“å…¥ç»´åº¦image = cv2.imread(&quot;data/images/person.png&quot;)image = cv2.resize(image, (448,448))image = image.transpose(2,0,1)image = np.array(image)[np.newaxis, :, :, :].astype(np.float32)# è®¾ç½®æ¨¡å‹sessionä»¥åŠè¾“å…¥ä¿¡æ¯sess = rt.InferenceSession(model_path)input_name1 = sess.get_inputs()[0].nameinput_name2 = sess.get_inputs()[1].nameinput_name3 = sess.get_inputs()[2].nameoutput = sess.run(None, &#123;input_name1: image, input_name2: image, input_name3: image&#125;)print(output) æ ¡éªŒONNXå’ŒPytorchè¾“å‡ºç»“æœæ˜¯å¦ä¸€è‡´ 12345y = model(x)y_onnx = model_onnx(x)# check the output against PyTorchprint(torch.max(torch.abs(y - y_trt))) onnxæ¨¡å‹è½¬æ¢æˆTensorRTæ¨¡å‹ ç›´æ¥ä½¿ç”¨TensorRTåŒ…ä¸­çš„ â€¦&#x2F;bin&#x2F;trtexec è¿™ä¸ªå·¥å…·ï¼Œä»–çš„æºç æ˜¯ï¼šå·¥å…·æºç  TensorRTå®é™…å·¥ä½œæµç¨‹ å®é™…demoTODO éªŒè¯ ä½¿ç”¨PolygraphyæŸ¥çœ‹onnxä¸TRTæ¨¡å‹çš„è¾“å‡ºå·®å¼‚ï¼šå·¥å…·polygraphy å‚è€ƒèµ„æ–™ TensorRTè¯¦ç»†å…¥é—¨æŒ‡åŒ—ï¼Œå¦‚æœä½ è¿˜ä¸äº†è§£TensorRTï¼Œè¿‡æ¥çœ‹çœ‹å§ï¼ [åˆ©ç”¨ TensorRT å®ç°æ·±åº¦å­¦ä¹ æ¨¡å‹çš„æ„å»ºä¸åŠ é€Ÿ]","categories":[{"name":"æ¨ç†éƒ¨ç½²","slug":"æ¨ç†éƒ¨ç½²","permalink":"https://flippy-bird.github.io/categories/%E6%8E%A8%E7%90%86%E9%83%A8%E7%BD%B2/"}],"tags":[{"name":"inference","slug":"inference","permalink":"https://flippy-bird.github.io/tags/inference/"}]},{"title":"33.æ¨¡å‹æ¨ç†åŸºæœ¬çŸ¥è¯†-CUDA","slug":"33-æ¨¡å‹æ¨ç†åŸºæœ¬çŸ¥è¯†-CUDA","date":"2026-01-26T02:13:33.000Z","updated":"2026-01-26T02:15:35.334Z","comments":true,"path":"2026/01/26/33-æ¨¡å‹æ¨ç†åŸºæœ¬çŸ¥è¯†-CUDA/","permalink":"https://flippy-bird.github.io/2026/01/26/33-%E6%A8%A1%E5%9E%8B%E6%8E%A8%E7%90%86%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86-CUDA/","excerpt":"","text":"CUDAä¸­çš„ä¼˜åŒ–æ–¹æ³•1. çº¿ç¨‹æŸåˆ†åŒ– çº¿ç¨‹æŸè¢«æ‰§è¡Œçš„æ—¶å€™ä¼šè¢«åˆ†é…ç»™ç›¸åŒçš„æŒ‡ä»¤ï¼Œå¤„ç†å„è‡ªç§æœ‰çš„æ•°æ®ï¼›ä¸¾ä¸€ä¸ªåˆ†æ°´æœçš„ä¾‹å­ï¼Œæ¯æ¬¡åˆ†çš„æ°´æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä½ å¯ä»¥é€‰æ‹©åƒæˆ–è€…ä¸åƒï¼Œè¿™ä¸ªåƒå’Œä¸åƒå°±æ˜¯åˆ†æ”¯ï¼Œåœ¨CUDAä¸­æ”¯æŒCè¯­è¨€çš„æ§åˆ¶æµï¼Œæ¯”å¦‚ifâ€¦else, for ,while ç­‰ï¼ŒCUDAä¸­åŒæ ·æ”¯æŒï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªçº¿ç¨‹æŸä¸­çš„ä¸åŒçº¿ç¨‹åŒ…å«ä¸åŒçš„æ§åˆ¶æ¡ä»¶ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬æ‰§è¡Œåˆ°è¿™ä¸ªæ§åˆ¶æ¡ä»¶æ˜¯å°±ä¼šé¢ä¸´ä¸åŒçš„é€‰æ‹©ã€‚ è¿™é‡Œè¦è®²ä¸€ä¸‹CPUäº†ï¼Œå½“æˆ‘ä»¬çš„ç¨‹åºåŒ…å«å¤§é‡çš„åˆ†æ”¯åˆ¤æ–­æ—¶ï¼Œä»ç¨‹åºè§’åº¦æ¥è¯´ï¼Œç¨‹åºçš„é€»è¾‘æ˜¯å¾ˆå¤æ‚çš„ï¼Œå› ä¸ºä¸€ä¸ªåˆ†æ”¯å°±ä¼šæœ‰ä¸¤æ¡è·¯å¯ä»¥èµ°ï¼Œå¦‚æœæœ‰10ä¸ªåˆ†æ”¯ï¼Œé‚£ä¹ˆä¸€å…±æœ‰1024æ¡è·¯èµ°ï¼ŒCPUé‡‡ç”¨æµæ°´çº¿è¯ä½œä¸šï¼Œå¦‚æœæ¯æ¬¡ç­‰åˆ°åˆ†æ”¯æ‰§è¡Œå®Œå†æ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤ä¼šé€ æˆå¾ˆå¤§çš„å»¶è¿Ÿï¼Œæ‰€ä»¥ç°åœ¨å¤„ç†å™¨éƒ½é‡‡ç”¨åˆ†æ”¯é¢„æµ‹æŠ€æœ¯ï¼Œè€ŒCPUçš„è¿™é¡¹æŠ€æœ¯ç›¸å¯¹äºgpuæ¥è¯´é«˜çº§äº†ä¸æ­¢ä¸€ç‚¹ç‚¹ï¼Œè€Œè¿™ä¹Ÿæ˜¯GPUä¸CPUçš„ä¸åŒï¼Œè®¾è®¡åˆè¡·å°±æ˜¯ä¸ºäº†è§£å†³ä¸åŒçš„é—®é¢˜ã€‚ ä¾‹å¦‚å¯¹äºä¸‹é¢çš„ä¼ªä»£ç  12345678if (con)&#123; //do something&#125;else&#123; //do something&#125; å‡è®¾è¿™æ®µä»£ç æ˜¯æ ¸å‡½æ•°çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆå½“ä¸€ä¸ªçº¿ç¨‹æŸçš„32ä¸ªçº¿ç¨‹æ‰§è¡Œè¿™æ®µä»£ç çš„æ—¶å€™ï¼Œå¦‚æœå…¶ä¸­16ä¸ªæ‰§è¡Œifä¸­çš„ä»£ç æ®µï¼Œè€Œå¦å¤–16ä¸ªæ‰§è¡Œelseä¸­çš„ä»£ç å—ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹æŸä¸­çš„çº¿ç¨‹ï¼Œæ‰§è¡Œä¸åŒçš„æŒ‡ä»¤ï¼Œè¿™å«åšçº¿ç¨‹æŸçš„åˆ†åŒ–ã€‚ æˆ‘ä»¬çŸ¥é“åœ¨æ¯ä¸ªæŒ‡ä»¤å‘¨æœŸï¼Œçº¿ç¨‹æŸä¸­çš„æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œç›¸åŒçš„æŒ‡ä»¤ï¼Œä½†æ˜¯çº¿ç¨‹æŸåˆæ˜¯åˆ†åŒ–çš„ï¼Œæ‰€ä»¥è¿™ä¼¼ä¹æ˜¯ç›¸æ‚–çš„ï¼Œä½†æ˜¯äº‹å®ä¸Šè¿™ä¸¤ä¸ªå¯ä»¥ä¸çŸ›ç›¾ã€‚ è§£å†³çŸ›ç›¾çš„åŠæ³•å°±æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œæ‰€æœ‰çš„ifå’Œelseéƒ¨åˆ†ï¼Œå½“ä¸€éƒ¨åˆ†conæˆç«‹çš„æ—¶å€™ï¼Œæ‰§è¡Œifå—å†…çš„ä»£ç ï¼Œæœ‰ä¸€éƒ¨åˆ†çº¿ç¨‹conä¸æˆç«‹ï¼Œé‚£ä¹ˆä»–ä»¬æ€ä¹ˆåŠï¼Ÿç»§ç»­æ‰§è¡Œelseï¼Ÿä¸å¯èƒ½çš„ï¼Œå› ä¸ºåˆ†é…å‘½ä»¤çš„è°ƒåº¦å™¨å°±ä¸€ä¸ªï¼Œæ‰€ä»¥è¿™äº›conä¸æˆç«‹çš„çº¿ç¨‹ç­‰å¾…ï¼Œå°±åƒåˆ†æ°´æœï¼Œä½ ä¸çˆ±åƒï¼Œé‚£ä½ å°±åªèƒ½çœ‹ç€åˆ«äººåƒï¼Œç­‰å¤§å®¶éƒ½åƒå®Œäº†ï¼Œå†è¿›è¡Œä¸‹ä¸€è½®ï¼ˆä¹Ÿå°±æ˜¯ä¸‹ä¸€ä¸ªæŒ‡ä»¤ï¼‰çº¿ç¨‹æŸåˆ†åŒ–ä¼šäº§ç”Ÿä¸¥é‡çš„æ€§èƒ½ä¸‹é™ã€‚æ¡ä»¶åˆ†æ”¯è¶Šå¤šï¼Œå¹¶è¡Œæ€§å‰Šå¼±è¶Šä¸¥é‡ã€‚ æ³¨æ„çº¿ç¨‹æŸåˆ†åŒ–ç ”ç©¶çš„æ˜¯ä¸€ä¸ªçº¿ç¨‹æŸä¸­çš„çº¿ç¨‹ï¼Œä¸åŒçº¿ç¨‹æŸä¸­çš„åˆ†æ”¯äº’ä¸å½±å“ã€‚ åœ¨GPUä¸­æ‰§è¡Œçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š è§£å†³æ€è·¯æ˜¯é¿å…åŒä¸€ä¸ªçº¿ç¨‹æŸå†…çš„çº¿ç¨‹åˆ†åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®çº¿ç¨‹ç¼–å·æ¥è®¾è®¡åˆ†æ”¯æ˜¯å¯ä»¥çš„ ä¾‹å­å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233// åŸå§‹çš„ä¼šæœ‰çº¿ç¨‹æŸåˆ†åŒ–çš„ä»£ç  (å½“ç„¶ç¼–è¯‘å™¨å¯èƒ½å¸®æˆ‘åšä¼˜åŒ–)__global__ void mathKernel1(float *c)&#123; int tid = blockIdx.x * blockDim.x + threadIdx.x; float a = 0.0; float b = 0.0; if (tid % 2 == 0) &#123; a = 100.0f; &#125; else &#123; b = 200.0f; &#125; c[tid] = a + b;&#125;__global__ void mathkernel2(float *c)&#123; int tid = blockIdx.x * blockDim.x + threadIdx.x; float a = 0.0; float b = 0.0; if ((tid / warpsize) % 2 == 0) &#123; a = 100.0f; &#125; else &#123; b = 200.0f; &#125; c[tid] = a + b;&#125; 2. å±•å¼€å¾ªç¯","categories":[{"name":"æ¨ç†éƒ¨ç½²","slug":"æ¨ç†éƒ¨ç½²","permalink":"https://flippy-bird.github.io/categories/%E6%8E%A8%E7%90%86%E9%83%A8%E7%BD%B2/"}],"tags":[{"name":"inference","slug":"inference","permalink":"https://flippy-bird.github.io/tags/inference/"}]},{"title":"32.æ¨¡å‹æ¨ç†åŸºæœ¬çŸ¥è¯†-é‡åŒ–","slug":"32-æ¨¡å‹æ¨ç†åŸºæœ¬çŸ¥è¯†-é‡åŒ–","date":"2026-01-26T02:06:59.000Z","updated":"2026-01-26T02:16:36.794Z","comments":true,"path":"2026/01/26/32-æ¨¡å‹æ¨ç†åŸºæœ¬çŸ¥è¯†-é‡åŒ–/","permalink":"https://flippy-bird.github.io/2026/01/26/32-%E6%A8%A1%E5%9E%8B%E6%8E%A8%E7%90%86%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86-%E9%87%8F%E5%8C%96/","excerpt":"","text":"é‡åŒ–é‡åŒ–çš„ä»»åŠ¡é‡åŒ–æœ¬è´¨ä¸Šåªæ˜¯å¯¹æ•°å€¼èŒƒå›´çš„é‡æ–°è°ƒæ•´ï¼Œå¯ä»¥â€œç²—ç•¥â€çš„ç†è§£æ˜¯ä¸€ç§çº¿æ€§æ˜ å°„ã€‚ é‡åŒ–ä»»åŠ¡çš„æ€»ç»“ï¼š 1ã€é‡åŒ–æ˜ å°„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯å°†float-32æ˜ å°„åˆ°Intæ•°æ®ç±»å‹ï¼Œæ¯ä¸ªé—´éš”æ˜¯ç›¸ç­‰çš„è¿˜æ˜¯ä¸ç›¸ç­‰çš„ï¼Œè¿™é‡Œå°±æ˜¯å‡åŒ€é‡åŒ–(uniform quantization)å’Œéå‡åŒ€é‡åŒ–(non-uniform quantization)ï¼Œä¹Ÿå¯ä»¥å«ä½œçº¿æ€§é‡åŒ–å’Œéçº¿æ€§é‡åŒ– 2ã€å…³äºæ˜ å°„åˆ°æ•´æ•°æ˜¯æ•°å€¼èŒƒå›´æ˜¯æœ‰æ­£è´Ÿæ•°ï¼Œè¿˜æ˜¯éƒ½æ˜¯æ­£æ•°ï¼Œè¿™é‡Œå°±æ˜¯å¯¹ç§°é‡åŒ–(æœ‰æ­£è´Ÿæ•°)å’Œéå¯¹ç§°é‡åŒ–(å…¨æ˜¯æ­£æ•°)ï¼Œéå¯¹ç§°é‡åŒ–å°±æœ‰zero-pointï¼Œzero-pointçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨äºåšpaddingã€‚ 3ã€åŸç²¾åº¦å³æµ®float-32ï¼Œé‡åŒ–åˆ°ä»€ä¹ˆæ ·çš„æ•°æ®ç±»å‹ï¼Œè¿™é‡Œå°±æœ‰floatå’Œintï¼›åˆ°åº•è¦é€‰æ‹©é‡åŒ–åçš„æ˜¯å¤šå°‘ä¸ªbitï¼Œè¿™é‡Œå°±æœ‰1-bit(äºŒå€¼ç½‘ç»œ)ã€2-bit(ä¸‰å€¼ç½‘ç»œ)ã€3-bitã€4-bitã€5-bitã€6-bitã€7-bitã€8-bitï¼Œè¿™å‡ ç§é‡åŒ–åçš„æ•°å€¼ç±»å‹æ˜¯æ•´å‹ã€‚ 4ã€æ˜¯å›ºå®šæ‰€æœ‰ç½‘ç»œéƒ½æ˜¯ç›¸åŒçš„bit-widthï¼Œè¿˜æ˜¯ä¸åŒçš„ï¼Œè¿™é‡Œå°±æœ‰æ··åˆç²¾åº¦é‡åŒ–(Mixed precision) 5ã€æ˜¯ä»ä¸€ä¸ªå·²ç»è®­ç»ƒå¥½çš„æ¨¡å‹å†è¿›è¡Œé‡åŒ–ï¼Œè¿˜æ˜¯æœ‰fine tuneçš„è¿‡ç¨‹æˆ–è€…ç›´æ¥æ˜¯ä»å¤´å¼€å§‹è®­ç»ƒä¸€ä¸ªé‡åŒ–çš„æ¨¡å‹ï¼Œè¿™é‡Œå°±æœ‰Post-training quantization(åé‡åŒ–ï¼Œå³å°†å·²ç»è®­ç»ƒå®Œçš„æ¨¡å‹å‚æ•°è¿›è¡Œé‡åŒ–)ã€quantization-aware training(é‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼Œå³åœ¨ä»å¤´å¼€å§‹è®­ç»ƒä¸­åŠ å…¥é‡åŒ–)å’Œquantization-aware fine tune(åœ¨fine tuneè®­ç»ƒä¸­åŠ å…¥é‡åŒ–)ã€‚ é‡åŒ–çš„è¯¯å·®é‡åŒ–çš„è¯¯å·®æ¥è‡ªäºå“ªé‡Œï¼Ÿ ä»float-32åˆ°Intæ•°æ®ç±»å‹ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªroundçš„æ“ä½œï¼Œè¿™é‡Œè‚¯å®šä¼šæœ‰è¯¯å·®ï¼› æ¿€æ´»å‡½æ•°çš„æˆªæ–­ï¼› æº¢å‡ºæ—¶å€™çš„å¤„ç†ä¹Ÿæœ‰å¯èƒ½å¸¦æ¥è¯¯å·®ã€‚ å¤§æ¨¡å‹é‡åŒ–æ¨¡å‹é‡åŒ–çš„å¯¹è±¡ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š æƒé‡(weight)ï¼šweightçš„é‡åŒ–æ˜¯æœ€å¸¸è§„ä¹Ÿæ˜¯æœ€å¸¸è§çš„ã€‚é‡åŒ–weightå¯è¾¾åˆ°å‡å°‘æ¨¡å‹å¤§å°å†…å­˜å’Œå ç”¨ç©ºé—´ã€‚ æ¿€æ´»(activation)ï¼šå®é™…ä¸­activationå¾€å¾€æ˜¯å ç”¨å†…å­˜çš„å¤§å¤´ï¼Œå› æ­¤é‡åŒ–activationä¸ä»…å¯ä»¥å¤§å¤§å‡å°‘å†…å­˜å ç”¨ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œç»“åˆweightçš„é‡åŒ–å¯ä»¥å……åˆ†åˆ©ç”¨æ•´æ•°è®¡ç®—è·å¾—æ€§èƒ½æå‡ã€‚ KV cacheï¼šé‡åŒ–KVç¼“å­˜å¯¹äºæé«˜é•¿åºåˆ—ç”Ÿæˆçš„ååé‡è‡³å…³é‡è¦ã€‚ æŒ‰ç…§é‡åŒ–å‚æ•°så’Œzçš„å…±äº«èŒƒå›´,é‡åŒ–æ–¹æ³•å¯ä»¥åˆ†ä¸ºé€å±‚é‡åŒ–ã€é€é€šé“å’Œé€ç»„é‡åŒ– LLM.int8() https://arxiv.org/pdf/2208.07339 åŸç†ï¼šæ˜¯ä¸€ç§é‡‡ç”¨æ··åˆç²¾åº¦åˆ†è§£çš„é‡åŒ–æ–¹æ³•ã€‚è¯¥æ–¹æ¡ˆå…ˆåšäº†ä¸€ä¸ªçŸ©é˜µåˆ†è§£ï¼Œå¯¹ç»å¤§éƒ¨åˆ†æƒé‡å’Œæ¿€æ´»ç”¨8bité‡åŒ–ï¼ˆvector-wiseï¼‰ã€‚å¯¹ç¦»ç¾¤ç‰¹å¾çš„å‡ ä¸ªç»´åº¦ä¿ç•™16bitï¼Œå¯¹å…¶åšé«˜ç²¾åº¦çš„çŸ©é˜µä¹˜æ³•ã€‚ èƒŒæ™¯ä¿¡æ¯ï¼šä½œè€…å‘ç°æ¿€æ´»ä¸­å­˜åœ¨ä¸€äº›ç¦»ç¾¤å€¼ï¼Œå®ƒä»¬çš„ç»å¯¹å€¼æ˜æ˜¾æ›´å¤§ï¼›å¹¶ä¸”è¿™äº›ç¦»ç¾¤å€¼åˆ†å¸ƒåœ¨å°‘é‡çš„å‡ ä¸ªç‰¹å¾ä¸­ï¼Œç§°ä¸ºç¦»ç¾¤ç‰¹å¾ (Emergent Features)ã€‚è¿™äº›ç¦»ç¾¤ç‰¹å¾ä¼šå½±å“é‡åŒ–è¿‡ç¨‹ï¼Œå› æ­¤å…ˆå°†è¿™äº›å€¼æ‰¾å‡ºæ¥ï¼Œå¯¹äºéå¼‚å¸¸å€¼ï¼Œæ­£å¸¸int8é‡åŒ–ï¼Œ è¿™ç§æ–¹æ³•é‡åŒ–çš„æ€§èƒ½ä¸‹é™è¾ƒå°ï¼Œä½†æ˜¯è¿™ç§åˆ†ç¦»è®¡ç®—çš„æ–¹å¼æ‹–æ…¢äº†æ¨ç†é€Ÿåº¦ã€‚(å¯¹äºå°æ¨¡å‹ï¼Œé€Ÿåº¦å·®è·æ›´åŠ æ˜æ˜¾) ç›®å‰ï¼ŒLLM.int8() çš„å®ç°ä¸»è¦åœ¨ bitsandbytes åº“ï¼Œè¿™ä¸ªå·²ç»é›†æˆåˆ°äº†transformersåº“ä¸­ 4bité‡åŒ– 12345678910from transformers import BitsAndBytesConfignf4_config = BitsAndBytesConfig( load_in_4bit=True, bnb_4bit_quant_type=&quot;nf4&quot;, bnb_4bit_use_double_quant=True, bnb_4bit_compute_dtype=torch.bfloat16)model_nf4 = AutoModelForCausalLM.from_pretrained(model_id, quantization_config=nf4_config) GPTQä»…æƒé‡é‡åŒ–çš„æ–¹æ¡ˆ ä½¿ç”¨GPTQï¼š AutoGPTQ(ä¹Ÿé›†æˆåˆ°äº†transformersåº“ä¸­) SmoothQuantæ¿€æ´»å€¼æ¯”æƒé‡æ›´éš¾é‡åŒ–ï¼Œå› ä¸ºæƒé‡æ•°æ®åˆ†å¸ƒä¸€èˆ¬æ¯”è¾ƒå‡åŒ€ï¼Œè€Œæ¿€æ´»å¼‚å¸¸å€¼å¤šä¸”å¤§è®©æ¿€æ´»å€¼é‡åŒ–å˜å¾—æ›´è‰°éš¾ï¼Œä½†æ˜¯å¼‚å¸¸å€¼åªå­˜åœ¨å°‘æ•°é€šé“å†…ã€‚ å› æ­¤ï¼ŒSmoothQuantè¯ç”Ÿã€‚SmoothQuanté€šè¿‡å¹³æ»‘æ¿€æ´»å±‚å’Œæƒé‡åï¼Œå†ä½¿ç”¨per-tensoræˆ–per-tokené‡åŒ–ï¼Œå®ç°W8A8ã€‚ä¸å…¶ä»–é‡åŒ–æ–¹æ³•ç›¸æ¯”ï¼Œè¯¥æ–¹æ³•å¯ä»¥ä¿æŒè¾ƒé«˜çš„ç²¾åº¦ï¼ŒåŒæ—¶ï¼Œå…·æœ‰æ›´ä½çš„å»¶è¿Ÿã€‚ AWQèƒŒæ™¯ï¼šè¯¥æ–¹æ³•æºäºâ€œæƒé‡å¯¹äºLLMçš„æ€§èƒ½å¹¶ä¸åŒç­‰é‡è¦â€çš„è§‚å¯Ÿï¼Œå­˜åœ¨çº¦ï¼ˆ0.1%-1%ï¼‰æ˜¾è‘—æƒé‡å¯¹å¤§æ¨¡å‹æ€§èƒ½å½±å“å¤ªå¤§ï¼Œé€šè¿‡è·³è¿‡è¿™1%çš„æ˜¾è‘—æƒé‡ï¼ˆsalient weightï¼‰ä¸è¿›è¡Œé‡åŒ–ï¼Œå¯ä»¥å¤§å¤§å‡å°‘é‡åŒ–è¯¯å·®ã€‚ ç”Ÿæ€ï¼š AutoAWQã€vLLMã€ HuggingFace TGIã€LMDeployã€NVIDIA TensorRT-LLMã€FastChat å‡æœ‰å¯¹AWQçš„æ”¯æŒï¼Œtransformersåº“ä¹Ÿé›†æˆäº†AutoAWQ ç²¾åº¦é—®é¢˜ï¼šæ•°æ®ç±»å‹FP16ã€BFP16ã€ FP32 LLMå¤§æ¨¡å‹ä¹‹ç²¾åº¦é—®é¢˜ï¼ˆFP16ï¼ŒFP32ï¼ŒBF16ï¼‰è¯¦è§£ä¸å®è·µ 12345import numpy as npc = np.float16(2049)print(c)# è¾“å‡ºç»“æœæ˜¯ 2048.0 å‚è€ƒèµ„æ–™ æ·±åº¦å­¦ä¹ ä¸­çš„æ¨¡å‹é‡åŒ–å…¥é—¨ é‡åŒ– | æµ…è°ˆæ·±åº¦å­¦ä¹ æ¨¡å‹é‡åŒ– å¢™è£‚æ¨èçœ‹è¿™ä¸ªä¸“æ å°±è¶³å¤Ÿäº†ï¼ï¼ï¼ ç¥ç»ç½‘ç»œé‡åŒ–å…¥é—¨â€“åŸºæœ¬åŸç† é‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆQuantization-aware-trainingï¼‰æ¢ç´¢-ä»åŸç†åˆ°å®è·µ æ·±åº¦å­¦ä¹ æ¨¡å‹å‹ç¼©æ–¹æ³•ï¼ˆä¸‰ï¼‰ï¼šé‡åŒ– å›¾è§£æ¨¡å‹é‡åŒ–æŠ€æœ¯ï¼šA Visual Guide to Quantization","categories":[{"name":"æ¨ç†éƒ¨ç½²","slug":"æ¨ç†éƒ¨ç½²","permalink":"https://flippy-bird.github.io/categories/%E6%8E%A8%E7%90%86%E9%83%A8%E7%BD%B2/"}],"tags":[{"name":"inference","slug":"inference","permalink":"https://flippy-bird.github.io/tags/inference/"}]},{"title":"Agent Sandbox","slug":"31-Agent-Sandbox","date":"2026-01-22T07:32:57.000Z","updated":"2026-01-22T07:37:23.367Z","comments":true,"path":"2026/01/22/31-Agent-Sandbox/","permalink":"https://flippy-bird.github.io/2026/01/22/31-Agent-Sandbox/","excerpt":"","text":"å‚è€ƒèµ„æ–™ Agent æ²™ç®±çš„å°ç»“","categories":[],"tags":[{"name":"Agent","slug":"Agent","permalink":"https://flippy-bird.github.io/tags/Agent/"}]},{"title":"pythonåŸºç¡€å†ç»ƒ","slug":"30.PythonåŸºç¡€å†ç»ƒ","date":"2026-01-16T08:10:43.000Z","updated":"2026-01-23T09:52:26.597Z","comments":true,"path":"2026/01/16/30.PythonåŸºç¡€å†ç»ƒ/","permalink":"https://flippy-bird.github.io/2026/01/16/30.Python%E5%9F%BA%E7%A1%80%E5%8E%86%E7%BB%83/","excerpt":"","text":"å…ƒç±» å…·ä½“çš„é¡¹ç›®å®è·µå¯å‚è€ƒï¼šAgentScope ä¸­çš„ src&#x2F;agentscope&#x2F;agent&#x2F;_agent_meta.pyæ–‡ä»¶ å…ƒç±»(Metaclass)æ˜¯ç”¨æ¥â€åˆ›å»ºç±»â€çš„ç±» 123# ç±» ---&gt; å¯¹è±¡# å…ƒç±» ---&gt; ç±» ---&gt; å¯¹è±¡ å…ƒç±»çš„ä½œç”¨ï¼Œä¸»è¦ç”¨äºåœ¨â€ç±»åˆ›å»ºé˜¶æ®µâ€åšäº‹æƒ…ï¼Œå¸¸è§ç”¨é€”ï¼š è‡ªåŠ¨ä¿®æ”¹ç±»ï¼š è‡ªåŠ¨ç»™ç±»æ·»åŠ å±æ€§ è‡ªåŠ¨ç»™æ–¹æ³•æ‰“æ—¥å¿— ç»Ÿä¸€è§„èŒƒ(å¦‚æ–¹æ³•å¿…é¡»ä»¥do_å¼€å¤´) æ³¨å†Œ&#x2F;æ”¶é›†ç±»ï¼š å­ç±»è‡ªåŠ¨æ³¨å†Œåˆ°æŸä¸ªåœ°æ–¹ (AgentScope å°±æ˜¯ç”¨æ¥åšè¿™ä¸ªçš„) å¸¸ç”¨äºå·¥å‚æ¨¡å¼ã€æ’ä»¶ç³»ç»Ÿ æœ€åŸºæœ¬çš„å…ƒç±»ç»“æ„ 1234567891011class MyMeta(type): def __new__(mls, name, bases, attrs): print(f&quot;åˆ›å»ºç±»ï¼š&#123;name&#125;) return super().__new__(mls, name, bases, attrs) &#x27;&#x27;&#x27; å‚æ•°è¯´æ˜mls:å…ƒç±»æœ¬èº«name: ç±»åbases: çˆ¶ç±»attrs: ç±»å±æ€§å­—å…¸ (æ³¨æ„ä¹Ÿæ˜¯åŒ…å«å‡½æ•°çš„å“¦ï¼)&#x27;&#x27;&#x27; with è¿™ä¸ªåœ¨å†™mcpçš„èµ„æºç®¡ç†çš„æ—¶å€™æ¯”è¾ƒæœ‰ç”¨ ä»»ä½•èƒ½ç”¨äº with çš„å¯¹è±¡ï¼Œéƒ½å¿…é¡»å®ç°ä¸¤ä¸ªæ–¹æ³•ï¼š 12__enter__()__exit__(exc_type, exc_val, exc_tb) ç­‰ä»·æ‰§è¡Œè¿‡ç¨‹: 123456obj = EXPRvalue = obj.__enter__()try: BLOCKfinally: obj.__exit__(...) ä¸¾ä¸ªä¾‹å­æ˜¯ï¼šè‡ªå®šä¹‰ä¸€ä¸ªèµ„æºç®¡ç†å™¨ 12345678910111213141516class MyResource: def __enter__(self): print(&quot;ç”³è¯·èµ„æº&quot;) return self def __exit__(self, exc_type, exc_val, exc_tb): print(&quot;é‡Šæ”¾èµ„æº&quot;) if exc_type: print(&quot;å‘ç”Ÿå¼‚å¸¸:&quot;, exc_type) return False # False è¡¨ç¤ºå¼‚å¸¸ç»§ç»­å¾€å¤–æŠ› ## ä½¿ç”¨è¿‡ç¨‹with MyResource() as f: print(&quot;ä½¿ç”¨èµ„æº&quot;)","categories":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://flippy-bird.github.io/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}],"tags":[{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://flippy-bird.github.io/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"}]},{"title":"Vibe Coding ç›¸å…³","slug":"29-Vibe-Coding","date":"2026-01-14T08:10:43.000Z","updated":"2026-01-20T05:36:07.571Z","comments":true,"path":"2026/01/14/29-Vibe-Coding/","permalink":"https://flippy-bird.github.io/2026/01/14/29-Vibe-Coding/","excerpt":"","text":"Cursorä½¿ç”¨ å‚è€ƒcursorå®˜æ–¹æ–‡æ¡£ï¼šhttps://cursor.com/cn/docs è§„åˆ™è§„åˆ™çš„å·¥ä½œåŸç†ï¼šè§„åˆ™åœ¨æç¤ºçº§åˆ«æä¾›æŒä¹…ã€å¯é‡ç”¨çš„ä¸Šä¸‹æ–‡ã€‚åº”ç”¨åï¼Œè§„åˆ™å†…å®¹ä¼šè¢«åŠ å…¥åˆ°æ¨¡å‹ä¸Šä¸‹æ–‡çš„å¼€å¤´ã€‚è¿™ä¸º AI åœ¨ç”Ÿæˆä»£ç ã€ç†è§£ç¼–è¾‘æˆ–ååŠ©å¤„ç†å·¥ä½œæµæ—¶æä¾›ä¸€è‡´çš„æŒ‡å¯¼ã€‚ cursoræä¾›äº†å››ç§è§„åˆ™ï¼šé¡¹ç›®è§„åˆ™ã€ç”¨æˆ·è§„åˆ™ã€å›¢é˜Ÿè§„åˆ™ã€AGENTS.MD é¡¹ç›®è§„åˆ™é¡¹ç›®è§„åˆ™ä»¥ markdown æ–‡ä»¶å½¢å¼å­˜æ”¾åœ¨ .cursor/rules ä¸­ï¼Œå¹¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶ã€‚è§„åˆ™å¯ä»¥é€šè¿‡è·¯å¾„æ¨¡å¼é™å®šä½œç”¨èŒƒå›´ï¼Œä¸»è¦æœ‰ä»¥ä¸‹çš„ä½œç”¨ï¼š æ²‰æ·€ä¸ä½ ä»£ç åº“ç›¸å…³çš„é¢†åŸŸçŸ¥è¯† è‡ªåŠ¨åŒ–é¡¹ç›®ç‰¹å®šçš„å·¥ä½œæµæˆ–æ¨¡æ¿ ç»Ÿä¸€é£æ ¼æˆ–æ¶æ„å†³ç­– 12345.cursor/rules/ react-patterns.mdc # å¸¦å‰ç½®å…ƒæ•°æ®çš„è§„åˆ™(æè¿°ã€globs) api-guidelines.md # ç®€å• markdown è§„åˆ™ frontend/ # åœ¨æ–‡ä»¶å¤¹ä¸­ç»„ç»‡è§„åˆ™ components.md è€Œå¯¹äºæ¯ä¸ªmarkdownçš„å†…å®¹ï¼Œå¦‚ä¸‹ 123456---description: &quot;This rule provides standards for frontend components and API validation&quot;alwaysApply: false---...rest of the rule content ç”¨æˆ·è§„åˆ™åº”ç”¨äºå…¨å±€çš„ï¼Œå°†åœ¨æ‰€æœ‰é¡¹ç›®ä¸Šåº”ç”¨ï¼Œè¿™ä¸ªåœ¨settings â€“&gt; Rules é‡Œé¢ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­ï¼š å¯ä»¥çœ‹åˆ°ï¼Œå› ä¸ºæˆ‘è®¾ç½®äº†è¿™ä¸ªè§„åˆ™ï¼Œæˆ‘å’Œcursoräº¤äº’æ—¶(chatæ—¶å€™)ï¼Œè¿”å›ç»™æˆ‘çš„éƒ½æ˜¯ä¸­æ–‡å›å¤ï¼› AGENTS.MDAGENTS.md æ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰ agent æŒ‡ä»¤çš„ç®€å• markdown æ–‡ä»¶ã€‚å°†å®ƒæ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼Œä½œä¸º .cursor/rules çš„æ›¿ä»£é€‰é¡¹ï¼Œé€‚ç”¨äºç®€å•ç›´æ¥çš„ç”¨ä¾‹ã€‚AGENTS.md æ˜¯ä¸€ä¸ªæ²¡æœ‰å…ƒæ•°æ®æˆ–å¤æ‚é…ç½®çš„çº¯ markdown æ–‡ä»¶ã€‚å¯¹äºåªéœ€è¦ç®€å•ã€æ˜“è¯»æŒ‡ä»¤ï¼Œè€Œä¸æƒ³å¼•å…¥ç»“æ„åŒ–è§„åˆ™é¢å¤–è´Ÿæ‹…çš„é¡¹ç›®æ¥è¯´ï¼Œå®ƒæ˜¯ç†æƒ³é€‰æ‹©ã€‚ å®˜æ–¹çš„ä¸€ä¸ªç®€å•ä¾‹å­å¦‚ä¸‹ï¼š 123456789101112# Project Instructions## Code Style- Use TypeScript for all new files- Prefer functional components in React- Use snake_case for database columns## Architecture- Follow the repository pattern- Keep business logic in service layers å½“ç„¶ä¹Ÿæ˜¯æ”¯æŒåµŒå¥—çš„ 12345678project/ AGENTS.md # å…¨å±€æŒ‡ä»¤ frontend/ AGENTS.md # å‰ç«¯ä¸“ç”¨æŒ‡ä»¤ components/ AGENTS.md # ç»„ä»¶ä¸“ç”¨æŒ‡ä»¤ backend/ AGENTS.md # åç«¯ä¸“ç”¨æŒ‡ä»¤ skills æ”¯æŒæŠ€èƒ½ä½•æ—¶å·¥ä½œï¼ŸCursor å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨ä»æŠ€èƒ½ç›®å½•ä¸­å‘ç°æŠ€èƒ½ï¼Œå¹¶å°†å®ƒä»¬æä¾›ç»™ Agentã€‚Agent ä¼šæŸ¥çœ‹å¯ç”¨çš„æŠ€èƒ½ï¼Œå¹¶æ ¹æ®ä¸Šä¸‹æ–‡å†³å®šä½•æ—¶ä½¿ç”¨ã€‚ æŠ€èƒ½åŠ è½½ç›®å½• æ¯ä¸ªæŠ€èƒ½éƒ½åº”æ˜¯ä¸€ä¸ªåŒ…å« SKILL.md æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼š 1234.cursor/â””â”€â”€ skills/ â””â”€â”€ my-skill/ â””â”€â”€ SKILL.md å…³äºSKILL.mdçš„æ ¼å¼ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­,å½“ç„¶åœ¨my-skillæ–‡ä»¶å¤¹å¯ä»¥æ·»åŠ ä¸€äº›èµ„æºï¼Œè„šæœ¬ç­‰ç­‰æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªå¯ä»¥æŸ¥çœ‹claudeçš„æ ‡å‡†æ¥åˆ›å»ºè‡ªå·±çš„skills 12345678910111213141516171819---name: my-skilldescription: Short description of what this skill does and when to use it.---# My SkillDetailed instructions for the agent.## When to Use- Use this skill when...- This skill is helpful for...## Instructions- Step-by-step guidance for the agent- Domain-specific conventions- Best practices and patterns å‚è€ƒèµ„æ–™ è®¤çŸ¥é‡å»ºï¼šSpeckit ç”¨äº†ä¸‰ä¸ªæœˆï¼Œæˆ‘æ”¾å¼ƒäº†â€”â€”èµ°å‡ºå·¥å…·å¾ˆå¼ºä½†ç”¨ä¸å¥½çš„å›°å¢ƒ é¢è¯•é—® Vibe Codingï¼Ÿè¿™æ‰æ˜¯æ»¡åˆ†å›ç­” easy-vibe aicodeguide awesome-vibe-coding vibe-coding-cn","categories":[{"name":"å·¥å…·ä½¿ç”¨","slug":"å·¥å…·ä½¿ç”¨","permalink":"https://flippy-bird.github.io/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"}],"tags":[{"name":"vibe coding","slug":"vibe-coding","permalink":"https://flippy-bird.github.io/tags/vibe-coding/"}]},{"title":"å¤§æ¨¡å‹åŸºæœ¬çŸ¥è¯†","slug":"28.å¤§æ¨¡å‹åŸºæœ¬çŸ¥è¯†","date":"2025-12-30T13:01:18.000Z","updated":"2026-01-22T10:08:43.154Z","comments":true,"path":"2025/12/30/28.å¤§æ¨¡å‹åŸºæœ¬çŸ¥è¯†/","permalink":"https://flippy-bird.github.io/2025/12/30/28.%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86/","excerpt":"","text":"å‚è€ƒèµ„æ–™ æ•™ä½ ä»é›¶â€œæ‰‹æ“â€ä¸€ä¸ªå¤§æ¨¡å‹ï¼Œåˆ«å†åªä¼šè°ƒç”¨APIäº† ç®€å•çš„Agentic-RAGæµç¨‹ è½¬è¡Œå¤§æ¨¡å‹å·¥ç¨‹å¸ˆ â€”â€” ä¸“æ å¯¼èˆª 2025 LLM ç§‘æŠ€æ€»ç»“","categories":[],"tags":[{"name":"LLM","slug":"LLM","permalink":"https://flippy-bird.github.io/tags/LLM/"}]},{"title":"Agent","slug":"27.Agent","date":"2025-12-11T13:01:18.000Z","updated":"2026-01-27T03:39:18.753Z","comments":true,"path":"2025/12/11/27.Agent/","permalink":"https://flippy-bird.github.io/2025/12/11/27.Agent/","excerpt":"","text":"Youtu-LLM-2B (26.01.06) ä»“åº“åœ°å€ï¼šhttps://modelscope.cn/models/Tencent-YouTu-Research/Youtu-LLM-2B ç‰¹ç‚¹ï¼šç«¯ä¾§Agentæ¨¡å‹ï¼Œæ­¤å¤–åœ¨tokenizerè¿™ä¸€æ­¥ä¹Ÿè¿›è¡Œäº†ä¼˜åŒ–() çœ‹äº†ä¸€ä¸‹paperï¼Œpaperä¸­æåˆ°äº†æ•°æ®æ„å»ºçš„è¿‡ç¨‹ï¼Œä¸»è¦æŒ‰ç…§ä¸‹é¢çš„ç»“æ„å»æ„å»º èŒƒå¼â€“plan and solveé‡‡ç”¨çš„æ˜¯â€å…ˆè°‹ååŠ¨â€çš„ç­–ç•¥ï¼Œå…ˆè¿›è¡Œplanï¼Œç„¶åæ ¹æ®å…·ä½“çš„è®¡åˆ’è¿›è¡Œsolveï¼›å…·ä½“çš„åŸç†å›¾å¦‚ä¸‹ï¼š ä¸‹é¢ä¸¾ä¸€ä¸ªå…·ä½“çš„ä»£ç ä¾‹å­ planå¯¹äºplanéƒ¨åˆ†çš„å®ç°ï¼Œä¸»è¦è¿˜æ˜¯promptå·¥ç¨‹ ï¼ˆå®šä¹‰äº†è§’è‰²ï¼Œä»»åŠ¡ï¼Œè¾“å‡ºæ ¼å¼çš„è¦æ±‚ç­‰ï¼‰ 123456789101112PLANNING_PROMPT_TEMPLATE = &#x27;&#x27;&#x27;ä½ æ˜¯ä¸€ä¸ªé¡¶çº§çš„AIè§„åˆ’ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯å°†ç”¨æˆ·æå‡ºçš„å¤æ‚é—®é¢˜åˆ†è§£æˆä¸€ä¸ªç”±å¤šä¸ªç®€å•æ­¥éª¤ç»„æˆçš„è¡ŒåŠ¨è®¡åˆ’ã€‚è¯·ç¡®ä¿è®¡åˆ’ä¸­çš„æ¯ä¸ªæ­¥éª¤éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ã€å¯æ‰§è¡Œçš„å­ä»»åŠ¡ï¼Œå¹¶ä¸”ä¸¥æ ¼æŒ‰ç…§é€»è¾‘é¡ºåºæ’åˆ—ã€‚ä½ çš„è¾“å‡ºå¿…é¡»æ˜¯ä¸€ä¸ªPythonåˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªæè¿°å­ä»»åŠ¡çš„å­—ç¬¦ä¸²ã€‚é—®é¢˜: &#123;question&#125;è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å‡ºä½ çš„è®¡åˆ’,```pythonä¸```ä½œä¸ºå‰åç¼€æ˜¯å¿…è¦çš„:```python[&quot;æ­¥éª¤1&quot;, &quot;æ­¥éª¤2&quot;, &quot;æ­¥éª¤3&quot;, ...]```&#x27;&#x27;&#x27; planéƒ¨åˆ†çš„å®ç°ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233class Planner: def __init__(self, llm_client): self.llm_client = llm_client def plan(self, question: str) -&gt; list[str]: &quot;&quot;&quot; æ ¹æ®ç”¨æˆ·é—®é¢˜ç”Ÿæˆä¸€ä¸ªè¡ŒåŠ¨è®¡åˆ’ã€‚ &quot;&quot;&quot; prompt = PLANNER_PROMPT_TEMPLATE.format(question=question) # ä¸ºäº†ç”Ÿæˆè®¡åˆ’ï¼Œæˆ‘ä»¬æ„å»ºä¸€ä¸ªç®€å•çš„æ¶ˆæ¯åˆ—è¡¨ messages = [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt&#125;] print(&quot;--- æ­£åœ¨ç”Ÿæˆè®¡åˆ’ ---&quot;) # ä½¿ç”¨æµå¼è¾“å‡ºæ¥è·å–å®Œæ•´çš„è®¡åˆ’ response_text = self.llm_client.think(messages=messages) or &quot;&quot; print(f&quot;âœ… è®¡åˆ’å·²ç”Ÿæˆ:\\n&#123;response_text&#125;&quot;) # è§£æLLMè¾“å‡ºçš„åˆ—è¡¨å­—ç¬¦ä¸² try: # æ‰¾åˆ°```pythonå’Œ```ä¹‹é—´çš„å†…å®¹ plan_str = response_text.split(&quot;```python&quot;)[1].split(&quot;```&quot;)[0].strip() # ä½¿ç”¨ast.literal_evalæ¥å®‰å…¨åœ°æ‰§è¡Œå­—ç¬¦ä¸²ï¼Œå°†å…¶è½¬æ¢ä¸ºPythonåˆ—è¡¨ plan = ast.literal_eval(plan_str) return plan if isinstance(plan, list) else [] except (ValueError, SyntaxError, IndexError) as e: print(f&quot;âŒ è§£æè®¡åˆ’æ—¶å‡ºé”™: &#123;e&#125;&quot;) print(f&quot;åŸå§‹å“åº”: &#123;response_text&#125;&quot;) return [] except Exception as e: print(f&quot;âŒ è§£æè®¡åˆ’æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯: &#123;e&#125;&quot;) return [] solveè®¡åˆ’å¥½äº†ä¹‹å,éœ€è¦æŒ‰ç…§æ—¢å®šçš„è®¡åˆ’å»æ‰§è¡Œäº†ï¼Œè€Œå¯¹äºæ‰§è¡Œéƒ¨åˆ†ï¼Œæœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼šçŠ¶æ€ç®¡ç† åä¸€æ­¥çš„æ‰§è¡Œéœ€è¦ä¾èµ–å‰é¢æ­¥éª¤çš„ç»“æœç­‰ç­‰ï¼Œå› æ­¤éœ€è¦åšä¸€ä¸ªçŠ¶æ€çš„ç®¡ç†ã€‚ å¯¹äºæ‰§è¡Œå™¨ï¼Œæ˜¯åœ¨ç»™å®šä¸Šä¸‹æ–‡çš„åŸºç¡€ä¸Šï¼Œä¸“æ³¨å®Œæˆå½“å‰çš„è¿™ä¸€ä¸ªæ­¥éª¤ï¼Œå› æ­¤promptéƒ¨åˆ†éœ€è¦åŒ…å«ä¸‹é¢çš„å…³é”®ä¿¡æ¯ï¼š åŸå§‹é—®é¢˜ï¼šç¡®ä¿æ¨¡å‹å§‹ç»ˆäº†è§£æœ€ç»ˆç›®æ ‡ï¼› å®Œæ•´è®¡åˆ’ï¼šè®©æ¨¡å‹äº†è§£å½“å‰æ­¥éª¤åœ¨æ•´ä¸ªè®¡åˆ’ä¸­çš„ä½ç½®ï¼› å†å²æ­¥éª¤ä¸ç»“æœï¼šä¹‹å‰çš„ä¸Šä¸‹æ–‡ å½“å‰æ­¥éª¤ï¼šæ¨¡å‹éœ€è¦å…³æ³¨çš„å½“å‰ä»»åŠ¡ï¼š å› æ­¤æ‰§è¡Œå™¨çš„æç¤ºè¯å¦‚ä¸‹ï¼š 1234567891011121314151617181920EXECUTOR_PROMPT_TEMPLATE = &quot;&quot;&quot;ä½ æ˜¯ä¸€ä½é¡¶çº§çš„AIæ‰§è¡Œä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯ä¸¥æ ¼æŒ‰ç…§ç»™å®šçš„è®¡åˆ’ï¼Œä¸€æ­¥æ­¥åœ°è§£å†³é—®é¢˜ã€‚ä½ å°†æ”¶åˆ°åŸå§‹é—®é¢˜ã€å®Œæ•´çš„è®¡åˆ’ã€ä»¥åŠåˆ°ç›®å‰ä¸ºæ­¢å·²ç»å®Œæˆçš„æ­¥éª¤å’Œç»“æœã€‚è¯·ä½ ä¸“æ³¨äºè§£å†³â€œå½“å‰æ­¥éª¤â€ï¼Œå¹¶ä»…è¾“å‡ºè¯¥æ­¥éª¤çš„æœ€ç»ˆç­”æ¡ˆï¼Œä¸è¦è¾“å‡ºä»»ä½•é¢å¤–çš„è§£é‡Šæˆ–å¯¹è¯ã€‚# åŸå§‹é—®é¢˜:&#123;question&#125;# å®Œæ•´è®¡åˆ’:&#123;plan&#125;# å†å²æ­¥éª¤ä¸ç»“æœ:&#123;history&#125;# å½“å‰æ­¥éª¤:&#123;current_step&#125;è¯·ä»…è¾“å‡ºé’ˆå¯¹â€œå½“å‰æ­¥éª¤â€çš„å›ç­”:&quot;&quot;&quot; executoréƒ¨åˆ†çš„ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435class Executor: def __init__(self, llm_client): self.llm_client = llm_client def execute(self, question: str, plan: list[str]) -&gt; str: &quot;&quot;&quot; æ ¹æ®è®¡åˆ’ï¼Œé€æ­¥æ‰§è¡Œå¹¶è§£å†³é—®é¢˜ã€‚ &quot;&quot;&quot; history = &quot;&quot; # ç”¨äºå­˜å‚¨å†å²æ­¥éª¤å’Œç»“æœçš„å­—ç¬¦ä¸² print(&quot;\\n--- æ­£åœ¨æ‰§è¡Œè®¡åˆ’ ---&quot;) for i, step in enumerate(plan): print(f&quot;\\n-&gt; æ­£åœ¨æ‰§è¡Œæ­¥éª¤ &#123;i+1&#125;/&#123;len(plan)&#125;: &#123;step&#125;&quot;) prompt = EXECUTOR_PROMPT_TEMPLATE.format( question=question, plan=plan, history=history if history else &quot;æ— &quot;, # å¦‚æœæ˜¯ç¬¬ä¸€æ­¥ï¼Œåˆ™å†å²ä¸ºç©º current_step=step ) messages = [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt&#125;] response_text = self.llm_client.think(messages=messages) or &quot;&quot; # æ›´æ–°å†å²è®°å½•ï¼Œä¸ºä¸‹ä¸€æ­¥åšå‡†å¤‡ history += f&quot;æ­¥éª¤ &#123;i+1&#125;: &#123;step&#125;\\nç»“æœ: &#123;response_text&#125;\\n\\n&quot; print(f&quot;âœ… æ­¥éª¤ &#123;i+1&#125; å·²å®Œæˆï¼Œç»“æœ: &#123;response_text&#125;&quot;) # å¾ªç¯ç»“æŸåï¼Œæœ€åä¸€æ­¥çš„å“åº”å°±æ˜¯æœ€ç»ˆç­”æ¡ˆ final_answer = response_text return final_answer plan and solveå‰é¢æœ‰äº†planå’Œsolveçš„æ¨¡å—åï¼Œç°åœ¨å°†ä»–ä»¬æ•´åˆåˆ°ä¸€èµ·å°±å¯ä»¥äº†,å°±å¯ä»¥åˆæˆä¸€ä¸ªå®Œæ•´çš„agentäº† 123456789101112131415161718192021222324252627class PlanAndSolveAgent: def __init__(self, llm_client): &quot;&quot;&quot; åˆå§‹åŒ–æ™ºèƒ½ä½“ï¼ŒåŒæ—¶åˆ›å»ºè§„åˆ’å™¨å’Œæ‰§è¡Œå™¨å®ä¾‹ã€‚ &quot;&quot;&quot; self.llm_client = llm_client self.planner = Planner(self.llm_client) self.executor = Executor(self.llm_client) def run(self, question: str): &quot;&quot;&quot; è¿è¡Œæ™ºèƒ½ä½“çš„å®Œæ•´æµç¨‹:å…ˆè§„åˆ’ï¼Œåæ‰§è¡Œã€‚ &quot;&quot;&quot; print(f&quot;\\n--- å¼€å§‹å¤„ç†é—®é¢˜ ---\\né—®é¢˜: &#123;question&#125;&quot;) # 1. è°ƒç”¨è§„åˆ’å™¨ç”Ÿæˆè®¡åˆ’ plan = self.planner.plan(question) # æ£€æŸ¥è®¡åˆ’æ˜¯å¦æˆåŠŸç”Ÿæˆ if not plan: print(&quot;\\n--- ä»»åŠ¡ç»ˆæ­¢ --- \\næ— æ³•ç”Ÿæˆæœ‰æ•ˆçš„è¡ŒåŠ¨è®¡åˆ’ã€‚&quot;) return # 2. è°ƒç”¨æ‰§è¡Œå™¨æ‰§è¡Œè®¡åˆ’ final_answer = self.executor.execute(question, plan) print(f&quot;\\n--- ä»»åŠ¡å®Œæˆ ---\\næœ€ç»ˆç­”æ¡ˆ: &#123;final_answer&#125;&quot;) èŒƒå¼â€“ Reflection åçŸ¥åè§‰ï¼šæˆ‘åœ¨ç¿»è¯‘é¡¹ç›®ä¸Šçš„ä¸‰æ®µå¼ç¿»è¯‘ï¼Œå…¶å®å°±æ˜¯ä½¿ç”¨åˆ°äº†è¿™ç§èŒƒå¼Reflection å°±åƒäººç±»å¯¹äºä¸€ä¸ªé—®é¢˜çš„æ€è€ƒä¸€æ ·ï¼Œä¼šå…ˆç»™å‡ºä¸€ä¸ªåˆæ­¥çš„ç­”æ¡ˆï¼Œç„¶ååœ¨è¿™ä¸ªç­”æ¡ˆä¸Šè¿›è¡Œåæ€ï¼Œç„¶åè¿›è¡Œæ”¹è¿›ï¼›Reflectionçš„æ€æƒ³ä¹ŸåŸºäºæ­¤ï¼ŒReflectionçš„æ ¸å¿ƒæµç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºä¸€ä¸ªç®€æ´çš„ä¸‰æ­¥å¾ªç¯ï¼šæ‰§è¡Œ â€”&gt; åæ€ â€”&gt; ä¼˜åŒ– æ‰§è¡Œ (Execution)ï¼šé¦–å…ˆï¼Œæ™ºèƒ½ä½“ä½¿ç”¨æˆ‘ä»¬ç†Ÿæ‚‰çš„æ–¹æ³•ï¼ˆå¦‚ ReAct æˆ– Plan-and-Solveï¼‰å°è¯•å®Œæˆä»»åŠ¡ï¼Œç”Ÿæˆä¸€ä¸ªåˆæ­¥çš„è§£å†³æ–¹æ¡ˆæˆ–è¡ŒåŠ¨è½¨è¿¹ã€‚è¿™å¯ä»¥çœ‹ä½œæ˜¯â€œåˆç¨¿â€ã€‚ åæ€ (Reflection)ï¼šæ¥ç€ï¼Œæ™ºèƒ½ä½“è¿›å…¥åæ€é˜¶æ®µã€‚å®ƒä¼šè°ƒç”¨ä¸€ä¸ªç‹¬ç«‹çš„ã€æˆ–è€…å¸¦æœ‰ç‰¹æ®Šæç¤ºè¯çš„å¤§è¯­è¨€æ¨¡å‹å®ä¾‹ï¼Œæ¥æ‰®æ¼”ä¸€ä¸ªâ€œè¯„å®¡å‘˜â€çš„è§’è‰²ã€‚è¿™ä¸ªâ€œè¯„å®¡å‘˜â€ä¼šå®¡è§†ç¬¬ä¸€æ­¥ç”Ÿæˆçš„â€œåˆç¨¿â€ï¼Œå¹¶ä»å¤šä¸ªç»´åº¦è¿›è¡Œè¯„ä¼°ï¼Œä¾‹å¦‚ï¼š äº‹å®æ€§é”™è¯¯ï¼šæ˜¯å¦å­˜åœ¨ä¸å¸¸è¯†æˆ–å·²çŸ¥äº‹å®ç›¸æ‚–çš„å†…å®¹ï¼Ÿ é€»è¾‘æ¼æ´ï¼šæ¨ç†è¿‡ç¨‹æ˜¯å¦å­˜åœ¨ä¸è¿è´¯æˆ–çŸ›ç›¾ä¹‹å¤„ï¼Ÿ æ•ˆç‡é—®é¢˜ï¼šæ˜¯å¦æœ‰æ›´ç›´æ¥ã€æ›´ç®€æ´çš„è·¯å¾„æ¥å®Œæˆä»»åŠ¡ï¼Ÿ é—æ¼ä¿¡æ¯ï¼šæ˜¯å¦å¿½ç•¥äº†é—®é¢˜çš„æŸäº›å…³é”®çº¦æŸæˆ–æ–¹é¢ï¼Ÿ æ ¹æ®è¯„ä¼°ï¼Œå®ƒä¼šç”Ÿæˆä¸€æ®µç»“æ„åŒ–çš„åé¦ˆ (Feedback)ï¼ŒæŒ‡å‡ºå…·ä½“çš„é—®é¢˜æ‰€åœ¨å’Œæ”¹è¿›å»ºè®®ã€‚ ä¼˜åŒ– (Refinement)ï¼šæœ€åï¼Œæ™ºèƒ½ä½“å°†â€œåˆç¨¿â€å’Œâ€œåé¦ˆâ€ä½œä¸ºæ–°çš„ä¸Šä¸‹æ–‡ï¼Œå†æ¬¡è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹ï¼Œè¦æ±‚å®ƒæ ¹æ®åé¦ˆå†…å®¹å¯¹åˆç¨¿è¿›è¡Œä¿®æ­£ï¼Œç”Ÿæˆä¸€ä¸ªæ›´å®Œå–„çš„â€œä¿®è®¢ç¨¿â€ã€‚ è®°å¿†æ¨¡å—Reflection çš„æ ¸å¿ƒåœ¨äºè¿­ä»£ï¼Œè€Œè¿­ä»£çš„å‰ææ˜¯èƒ½å¤Ÿè®°ä½ä¹‹å‰çš„å°è¯•å’Œè·å¾—çš„åé¦ˆã€‚å› æ­¤ï¼Œä¸€ä¸ªâ€œçŸ­æœŸè®°å¿†â€æ¨¡å—æ˜¯å®ç°è¯¥èŒƒå¼çš„å¿…éœ€å“ã€‚è¿™ä¸ªè®°å¿†æ¨¡å—å°†è´Ÿè´£å­˜å‚¨æ¯ä¸€æ¬¡â€œæ‰§è¡Œ-åæ€â€å¾ªç¯çš„å®Œæ•´è½¨è¿¹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748from typing import List, Dict, Any, Optionalclass Memory: &quot;&quot;&quot; ä¸€ä¸ªç®€å•çš„çŸ­æœŸè®°å¿†æ¨¡å—ï¼Œç”¨äºå­˜å‚¨æ™ºèƒ½ä½“çš„è¡ŒåŠ¨ä¸åæ€è½¨è¿¹ã€‚ &quot;&quot;&quot; def __init__(self): &quot;&quot;&quot; åˆå§‹åŒ–ä¸€ä¸ªç©ºåˆ—è¡¨æ¥å­˜å‚¨æ‰€æœ‰è®°å½•ã€‚ &quot;&quot;&quot; self.records: List[Dict[str, Any]] = [] def add_record(self, record_type: str, content: str): &quot;&quot;&quot; å‘è®°å¿†ä¸­æ·»åŠ ä¸€æ¡æ–°è®°å½•ã€‚ å‚æ•°: - record_type (str): è®°å½•çš„ç±»å‹ (&#x27;execution&#x27; æˆ– &#x27;reflection&#x27;)ã€‚ - content (str): è®°å½•çš„å…·ä½“å†…å®¹ (ä¾‹å¦‚ï¼Œç”Ÿæˆçš„ä»£ç æˆ–åæ€çš„åé¦ˆ)ã€‚ &quot;&quot;&quot; record = &#123;&quot;type&quot;: record_type, &quot;content&quot;: content&#125; self.records.append(record) print(f&quot;ğŸ“ è®°å¿†å·²æ›´æ–°ï¼Œæ–°å¢ä¸€æ¡ &#x27;&#123;record_type&#125;&#x27; è®°å½•ã€‚&quot;) def get_trajectory(self) -&gt; str: &quot;&quot;&quot; å°†æ‰€æœ‰è®°å¿†è®°å½•æ ¼å¼åŒ–ä¸ºä¸€ä¸ªè¿è´¯çš„å­—ç¬¦ä¸²æ–‡æœ¬ï¼Œç”¨äºæ„å»ºæç¤ºè¯ã€‚ &quot;&quot;&quot; trajectory_parts = [] for record in self.records: if record[&#x27;type&#x27;] == &#x27;execution&#x27;: trajectory_parts.append(f&quot;--- ä¸Šä¸€è½®å°è¯• (ä»£ç ) ---\\n&#123;record[&#x27;content&#x27;]&#125;&quot;) elif record[&#x27;type&#x27;] == &#x27;reflection&#x27;: trajectory_parts.append(f&quot;--- è¯„å®¡å‘˜åé¦ˆ ---\\n&#123;record[&#x27;content&#x27;]&#125;&quot;) return &quot;\\n\\n&quot;.join(trajectory_parts) def get_last_execution(self) -&gt; Optional[str]: &quot;&quot;&quot; è·å–æœ€è¿‘ä¸€æ¬¡çš„æ‰§è¡Œç»“æœ (ä¾‹å¦‚ï¼Œæœ€æ–°ç”Ÿæˆçš„ä»£ç )ã€‚ å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› Noneã€‚ &quot;&quot;&quot; for record in reversed(self.records): if record[&#x27;type&#x27;] == &#x27;execution&#x27;: return record[&#x27;content&#x27;] return None åˆå§‹ã€åæ€ã€ä¼˜åŒ–çš„promptå‡è®¾æˆ‘ä»¬çš„åœºæ™¯æ˜¯å†™ä»£ç çš„åœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåˆå§‹çš„æ‰§è¡Œçš„æç¤ºè¯ 12345678INITIAL_PROMPT_TEMPLATE = &quot;&quot;&quot;ä½ æ˜¯ä¸€ä½èµ„æ·±çš„Pythonç¨‹åºå‘˜ã€‚è¯·æ ¹æ®ä»¥ä¸‹è¦æ±‚ï¼Œç¼–å†™ä¸€ä¸ªPythonå‡½æ•°ã€‚ä½ çš„ä»£ç å¿…é¡»åŒ…å«å®Œæ•´çš„å‡½æ•°ç­¾åã€æ–‡æ¡£å­—ç¬¦ä¸²ï¼Œå¹¶éµå¾ªPEP 8ç¼–ç è§„èŒƒã€‚è¦æ±‚: &#123;task&#125;è¯·ç›´æ¥è¾“å‡ºä»£ç ï¼Œä¸è¦åŒ…å«ä»»ä½•é¢å¤–çš„è§£é‡Šã€‚&quot;&quot;&quot; åæ€æç¤ºè¯ (Reflection Prompt) ï¼šè¿™ä¸ªæç¤ºè¯æ˜¯ Reflection æœºåˆ¶çš„çµé­‚ã€‚å®ƒæŒ‡ç¤ºæ¨¡å‹æ‰®æ¼”â€œä»£ç è¯„å®¡å‘˜â€çš„è§’è‰²ï¼Œå¯¹ä¸Šä¸€è½®ç”Ÿæˆçš„ä»£ç è¿›è¡Œæ‰¹åˆ¤æ€§åˆ†æï¼Œå¹¶æä¾›å…·ä½“çš„ã€å¯æ“ä½œçš„åé¦ˆã€‚ 12345678910111213141516171819REFLECT_PROMPT_TEMPLATE = &quot;&quot;&quot;ä½ æ˜¯ä¸€ä½æå…¶ä¸¥æ ¼çš„ä»£ç è¯„å®¡ä¸“å®¶å’Œèµ„æ·±ç®—æ³•å·¥ç¨‹å¸ˆï¼Œå¯¹ä»£ç çš„æ€§èƒ½æœ‰æè‡´çš„è¦æ±‚ã€‚ä½ çš„ä»»åŠ¡æ˜¯å®¡æŸ¥ä»¥ä¸‹Pythonä»£ç ï¼Œå¹¶ä¸“æ³¨äºæ‰¾å‡ºå…¶åœ¨&lt;strong&gt;ç®—æ³•æ•ˆç‡&lt;/strong&gt;ä¸Šçš„ä¸»è¦ç“¶é¢ˆã€‚# åŸå§‹ä»»åŠ¡:&#123;task&#125;# å¾…å®¡æŸ¥çš„ä»£ç :```python&#123;code&#125;```è¯·åˆ†æè¯¥ä»£ç çš„æ—¶é—´å¤æ‚åº¦ï¼Œå¹¶æ€è€ƒæ˜¯å¦å­˜åœ¨ä¸€ç§&lt;strong&gt;ç®—æ³•ä¸Šæ›´ä¼˜&lt;/strong&gt;çš„è§£å†³æ–¹æ¡ˆæ¥æ˜¾è‘—æå‡æ€§èƒ½ã€‚å¦‚æœå­˜åœ¨ï¼Œè¯·æ¸…æ™°åœ°æŒ‡å‡ºå½“å‰ç®—æ³•çš„ä¸è¶³ï¼Œå¹¶æå‡ºå…·ä½“çš„ã€å¯è¡Œçš„æ”¹è¿›ç®—æ³•å»ºè®®ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ç­›æ³•æ›¿ä»£è¯•é™¤æ³•ï¼‰ã€‚å¦‚æœä»£ç åœ¨ç®—æ³•å±‚é¢å·²ç»è¾¾åˆ°æœ€ä¼˜ï¼Œæ‰èƒ½å›ç­”â€œæ— éœ€æ”¹è¿›â€ã€‚è¯·ç›´æ¥è¾“å‡ºä½ çš„åé¦ˆï¼Œä¸è¦åŒ…å«ä»»ä½•é¢å¤–çš„è§£é‡Šã€‚&quot;&quot;&quot; ä¼˜åŒ–æç¤ºè¯ (Refinement Prompt) ï¼šå½“æ”¶åˆ°åé¦ˆåï¼Œè¿™ä¸ªæç¤ºè¯å°†å¼•å¯¼æ¨¡å‹æ ¹æ®åé¦ˆå†…å®¹ï¼Œå¯¹åŸæœ‰ä»£ç è¿›è¡Œä¿®æ­£å’Œä¼˜åŒ–ã€‚ 1234567891011121314151617REFINE_PROMPT_TEMPLATE = &quot;&quot;&quot;ä½ æ˜¯ä¸€ä½èµ„æ·±çš„Pythonç¨‹åºå‘˜ã€‚ä½ æ­£åœ¨æ ¹æ®ä¸€ä½ä»£ç è¯„å®¡ä¸“å®¶çš„åé¦ˆæ¥ä¼˜åŒ–ä½ çš„ä»£ç ã€‚# åŸå§‹ä»»åŠ¡:&#123;task&#125;# ä½ ä¸Šä¸€è½®å°è¯•çš„ä»£ç :&#123;last_code_attempt&#125;è¯„å®¡å‘˜çš„åé¦ˆï¼š&#123;feedback&#125;è¯·æ ¹æ®è¯„å®¡å‘˜çš„åé¦ˆï¼Œç”Ÿæˆä¸€ä¸ªä¼˜åŒ–åçš„æ–°ç‰ˆæœ¬ä»£ç ã€‚ä½ çš„ä»£ç å¿…é¡»åŒ…å«å®Œæ•´çš„å‡½æ•°ç­¾åã€æ–‡æ¡£å­—ç¬¦ä¸²ï¼Œå¹¶éµå¾ªPEP 8ç¼–ç è§„èŒƒã€‚è¯·ç›´æ¥è¾“å‡ºä¼˜åŒ–åçš„ä»£ç ï¼Œä¸è¦åŒ…å«ä»»ä½•é¢å¤–çš„è§£é‡Šã€‚&quot;&quot;&quot; æ•´åˆ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051class ReflectionAgent: def __init__(self, llm_client, max_iterations=3): self.llm_client = llm_client self.memory = Memory() self.max_iterations = max_iterations def run(self, task: str): print(f&quot;\\n--- å¼€å§‹å¤„ç†ä»»åŠ¡ ---\\nä»»åŠ¡: &#123;task&#125;&quot;) # --- 1. åˆå§‹æ‰§è¡Œ --- print(&quot;\\n--- æ­£åœ¨è¿›è¡Œåˆå§‹å°è¯• ---&quot;) initial_prompt = INITIAL_PROMPT_TEMPLATE.format(task=task) initial_code = self._get_llm_response(initial_prompt) self.memory.add_record(&quot;execution&quot;, initial_code) # --- 2. è¿­ä»£å¾ªç¯:åæ€ä¸ä¼˜åŒ– --- for i in range(self.max_iterations): print(f&quot;\\n--- ç¬¬ &#123;i+1&#125;/&#123;self.max_iterations&#125; è½®è¿­ä»£ ---&quot;) # a. åæ€ print(&quot;\\n-&gt; æ­£åœ¨è¿›è¡Œåæ€...&quot;) last_code = self.memory.get_last_execution() reflect_prompt = REFLECT_PROMPT_TEMPLATE.format(task=task, code=last_code) feedback = self._get_llm_response(reflect_prompt) self.memory.add_record(&quot;reflection&quot;, feedback) # b. æ£€æŸ¥æ˜¯å¦éœ€è¦åœæ­¢ if &quot;æ— éœ€æ”¹è¿›&quot; in feedback: print(&quot;\\nâœ… åæ€è®¤ä¸ºä»£ç å·²æ— éœ€æ”¹è¿›ï¼Œä»»åŠ¡å®Œæˆã€‚&quot;) break # c. ä¼˜åŒ– print(&quot;\\n-&gt; æ­£åœ¨è¿›è¡Œä¼˜åŒ–...&quot;) refine_prompt = REFINE_PROMPT_TEMPLATE.format( task=task, last_code_attempt=last_code, feedback=feedback ) refined_code = self._get_llm_response(refine_prompt) self.memory.add_record(&quot;execution&quot;, refined_code) final_code = self.memory.get_last_execution() print(f&quot;\\n--- ä»»åŠ¡å®Œæˆ ---\\næœ€ç»ˆç”Ÿæˆçš„ä»£ç :\\n```python\\n&#123;final_code&#125;\\n```&quot;) return final_code def _get_llm_response(self, prompt: str) -&gt; str: &quot;&quot;&quot;ä¸€ä¸ªè¾…åŠ©æ–¹æ³•ï¼Œç”¨äºè°ƒç”¨LLMå¹¶è·å–å®Œæ•´çš„æµå¼å“åº”ã€‚&quot;&quot;&quot; messages = [&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt&#125;] response_text = self.llm_client.think(messages=messages) or &quot;&quot; return response_text å­¦ä¹ èµ„æ–™åŸºç¡€ç†è®º https://github.com/datawhalechina/hello-agents https://github.com/huggingface/agents-course å…·ä½“å®è·µ https://github.com/NirDiamant/GenAI_Agents å‚è€ƒèµ„æ–™Multi-Agent Choosing the Right Multi-Agent Architecture å¼€æºé¡¹ç›® clawbot","categories":[],"tags":[{"name":"LLM","slug":"LLM","permalink":"https://flippy-bird.github.io/tags/LLM/"},{"name":"Agent","slug":"Agent","permalink":"https://flippy-bird.github.io/tags/Agent/"}]},{"title":"mobile-agent","slug":"mobile-agent","date":"2025-12-09T02:10:52.000Z","updated":"2026-01-20T02:48:03.982Z","comments":true,"path":"2025/12/09/mobile-agent/","permalink":"https://flippy-bird.github.io/2025/12/09/mobile-agent/","excerpt":"","text":"AgentCPM https://github.com/OpenBMB/AgentCPM å‚è€ƒèµ„æ–™ MobileAgent Open-AutoGLM A2UI - æ™ºèƒ½ä½“è‡ªåŠ¨ç”Ÿæˆ UI ç•Œé¢çš„å…¨æ–°åè®® MAI-UIï¼šé¢å‘çœŸå®ä¸–ç•Œçš„é€šç”¨ GUI æ™ºèƒ½ä½“ ä»åŸç†åˆ°å®è·µï¼Œ0åˆ°1å¿«é€Ÿæ­å»ºä¸€ä¸ªGUI Agent UI-TARS","categories":[],"tags":[{"name":"Agent","slug":"Agent","permalink":"https://flippy-bird.github.io/tags/Agent/"},{"name":"ç«¯ä¾§","slug":"ç«¯ä¾§","permalink":"https://flippy-bird.github.io/tags/%E7%AB%AF%E4%BE%A7/"}]},{"title":"Agentæ˜¯å¦‚ä½•åšPlançš„ï¼Ÿ","slug":"LLMçš„planè°ƒç ”","date":"2025-12-08T06:58:33.000Z","updated":"2026-01-16T10:40:28.949Z","comments":true,"path":"2025/12/08/LLMçš„planè°ƒç ”/","permalink":"https://flippy-bird.github.io/2025/12/08/LLM%E7%9A%84plan%E8%B0%83%E7%A0%94/","excerpt":"","text":"1. langchain&#x2F;langgraph å‚è€ƒèµ„æ–™ï¼š https://docs.langchain.com/oss/python/langchain/middleware/built-in#to-do-list langchainçš„æ€æƒ³æ˜¯é€šè¿‡middlewareçš„å½¢å¼æ¥æ·»åŠ plançš„èƒ½åŠ›ï¼Œå¯ä»¥å‚è€ƒæºç éƒ¨åˆ†ï¼šlangchain&#x2F;libs&#x2F;langchain_v1&#x2F;langchain&#x2F;agents&#x2F;middleware&#x2F;todo.py ï¼ˆ12æœˆ8æ—¥ï¼Œåç»­ä¸çŸ¥é“ä¼šä¸ä¼šå˜åŒ–ï¼‰å…¶æœ¬è´¨ä»ç„¶æ˜¯ä¸€ä¸ªå·¥å…·å‡½æ•°çš„è°ƒç”¨ï¼Œå†…éƒ¨çš„ä¸€ä¸ªå·¥å…·æ˜¯write_todos, ç›¸å…³çš„middlewareæ˜¯ TodoListMiddleware è¿™ä¸ªå·¥å…·çš„å…·ä½“å®šä¹‰æ˜¯ï¼šå…³äºwrite_todosè¿™ä¸ªå·¥å…·çš„æè¿°ï¼Œè¿™ä¸ªæè¿°å†™çš„å¾ˆé•¿ï¼Œå…·ä½“å¯ä»¥å»æºç æŸ¥çœ‹ï¼› 123456789@tool(description=WRITE_TODOS_TOOL_DESCRIPTION)def write_todos(todos: list[Todo], tool_call_id: Annotated[str, InjectedToolCallId]) -&gt; Command: &quot;&quot;&quot;Create and manage a structured task list for your current work session.&quot;&quot;&quot; return Command( update=&#123; &quot;todos&quot;: todos, &quot;messages&quot;: [ToolMessage(f&quot;Updated todo list to &#123;todos&#125;&quot;, tool_call_id=tool_call_id)], &#125; ) system promptæ˜¯ï¼š 12345678910111213WRITE_TODOS_SYSTEM_PROMPT = &quot;&quot;&quot;## `write_todos`You have access to the `write_todos` tool to help you manage and plan complex objectives.Use this tool for complex objectives to ensure that you are tracking each necessary step and giving the user visibility into your progress.This tool is very helpful for planning complex objectives, and for breaking down these larger complex objectives into smaller steps.It is critical that you mark todos as completed as soon as you are done with a step. Do not batch up multiple steps before marking them as completed.For simple objectives that only require a few steps, it is better to just complete the objective directly and NOT use this tool.Writing todos takes time and tokens, use it when it is helpful for managing complex many-step problems! But not for simple few-step requests.## Important To-Do List Usage Notes to Remember- The `write_todos` tool should never be called multiple times in parallel.- Don&#x27;t be afraid to revise the To-Do list as you go. New information may reveal new tasks that need to be done, or old tasks that are irrelevant.&quot;&quot;&quot; 2. Qwen code https://github.com/QwenLM/qwen-code é‡‡ç”¨çš„æ˜¯å†…ç½®å·¥å…·çš„æ–¹å¼æ¥å®ç°agentçš„planèƒ½åŠ›ï¼Œæºä»£ç éƒ¨åˆ†å¯å‚è€ƒï¼šqwen-code&#x2F;packages&#x2F;core&#x2F;src&#x2F;tools&#x2F;todoWrite.ts å…·ä½“çš„æä¾›äº†ä¸‹é¢çš„todoå·¥å…·ç±»ï¼š 12345678910class TodoWriteToolInvocation extends BaseToolInvocation&lt; TodoWriteParams, ToolResult&gt; &#123;&#125;// æš´éœ²ç»™å¤–é¢çš„todoå·¥å…·ç±»export class TodoWriteTool extends BaseDeclarativeTool&lt; TodoWriteParams, ToolResult&gt; &#123;&#125; å…³äºå·¥å…·çš„æè¿°ï¼Œæˆªå–ä¸€éƒ¨åˆ†promptå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829const todoWriteToolDescription = `Use this tool to create and manage a structured task list for your current coding session. This helps you track progress, organize complex tasks, and demonstrate thoroughness to the user.It also helps the user understand the progress of the task and overall progress of their requests.## When to Use This ToolUse this tool proactively in these scenarios:1. Complex multi-step tasks - When a task requires 3 or more distinct steps or actions2. Non-trivial and complex tasks - Tasks that require careful planning or multiple operations3. User explicitly requests todo list - When the user directly asks you to use the todo list4. User provides multiple tasks - When users provide a list of things to be done (numbered or comma-separated)5. After receiving new instructions - Immediately capture user requirements as todos6. When you start working on a task - Mark it as in_progress BEFORE beginning work. Ideally you should only have one todo as in_progress at a time7. After completing a task - Mark it as completed and add any new follow-up tasks discovered during implementation## When NOT to Use This ToolSkip using this tool when:1. There is only a single, straightforward task2. The task is trivial and tracking it provides no organizational benefit3. The task can be completed in less than 3 trivial steps4. The task is purely conversational or informationalNOTE that you should not use this tool if there is only one trivial task to do. In this case you are better off just doing the task directly.## Examples of When to Use the Todo List ...`; 3. gemini cliå’Œqwen code ç±»ä¼¼ï¼Œæºç éƒ¨åˆ†åœ¨ï¼šgemini-cli&#x2F;packages&#x2F;core&#x2F;src&#x2F;tools&#x2F;write-todos.ts 1234export class WriteTodosTool extends BaseDeclarativeTool&lt; WriteTodosToolParams, ToolResult&gt; &#123;&#125; å·¥å…·è¯´æ˜çš„promptæˆªå–å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930export const WRITE_TODOS_DESCRIPTION = `This tool can help you list out the current subtasks that are required to be completed for a given user request. The list of subtasks helps you keep track of the current task, organize complex queries and help ensure that you don&#x27;t miss any steps. With this list, the user can also see the current progress you are making in executing a given task.Depending on the task complexity, you should first divide a given task into subtasks and then use this tool to list out the subtasks that are required to be completed for a given user request.Each of the subtasks should be clear and distinct. Use this tool for complex queries that require multiple steps. If you find that the request is actually complex after you have started executing the user task, create a todo list and use it. If execution of the user task requires multiple steps, planning and generally is higher complexity than a simple Q&amp;A, use this tool.DO NOT use this tool for simple tasks that can be completed in less than 2 steps. If the user query is simple and straightforward, do not use the tool. If you can respond with an answer in a single turn then this tool is not required.## Task state definitions- pending: Work has not begun on a given subtask.- in_progress: Marked just prior to beginning work on a given subtask. You should only have one subtask as in_progress at a time.- completed: Subtask was successfully completed with no errors or issues. If the subtask required more steps to complete, update the todo list with the subtasks. All steps should be identified as completed only when they are completed.- cancelled: As you update the todo list, some tasks are not required anymore due to the dynamic nature of the task. In this case, mark the subtasks as cancelled.## Methodology for using this tool1. Use this todo list as soon as you receive a user request based on the complexity of the task.2. Keep track of every subtask that you update the list with.3. Mark a subtask as in_progress before you begin working on it. You should only have one subtask as in_progress at a time.4. Update the subtask list as you proceed in executing the task. The subtask list is not static and should reflect your progress and current plans, which may evolve as you acquire new information.5. Mark a subtask as completed when you have completed it.6. Mark a subtask as cancelled if the subtask is no longer needed.7. You must update the todo list as soon as you start, stop or cancel a subtask. Don&#x27;t batch or wait to update the todo list.## Examples of When to Use the Todo List ...`; 4. AgentScope https://github.com/agentscope-ai/agentscope ä¹Ÿæ˜¯é€šè¿‡å·¥å…·è°ƒç”¨çš„æ–¹å¼æ¥å®ç°çš„ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡æ¡£ AgentScopeæºç å­¦ä¹  5.cline https://github.com/cline/cline åº”è¯¥ä¹Ÿæ˜¯é€šè¿‡è°ƒç”¨çš„å·¥å…·çš„æ–¹å¼è®©Agentå…·å¤‡äº†plançš„èƒ½åŠ›ï¼Œç›¸å…³çš„æç¤ºè¯æºç æ˜¯ï¼šcline&#x2F;src&#x2F;core&#x2F;prompts&#x2F;system-prompt&#x2F;components&#x2F;task_progress.ts å¯¹åº”çš„promptå¦‚ä¸‹ï¼šå¯ä»¥çœ‹åˆ°ï¼Œ 12345678910111213141516171819202122232425const UPDATING_TASK_PROGRESS = `UPDATING TASK PROGRESSYou can track and communicate your progress on the overall task using the task_progress parameter supported by every tool call. Using task_progress ensures you remain on task, and stay focused on completing the user&#x27;s objective. This parameter can be used in any mode, and with any tool call.- When switching from PLAN MODE to ACT MODE, you must create a comprehensive todo list for the task using the task_progress parameter- Todo list updates should be done silently using the task_progress parameter - do not announce these updates to the user- Use standard Markdown checklist format: &quot;- [ ]&quot; for incomplete items and &quot;- [x]&quot; for completed items- Keep items focused on meaningful progress milestones rather than minor technical details. The checklist should not be so granular that minor implementation details clutter the progress tracking.- For simple tasks, short checklists with even a single item are acceptable. For complex tasks, avoid making the checklist too long or verbose.- If you are creating this checklist for the first time, and the tool use completes the first step in the checklist, make sure to mark it as completed in your task_progress parameter.- Provide the whole checklist of steps you intend to complete in the task, and keep the checkboxes updated as you make progress. It&#x27;s okay to rewrite this checklist as needed if it becomes invalid due to scope changes or new information.- If a checklist is being used, be sure to update it any time a step has been completed.- The system will automatically include todo list context in your prompts when appropriate - these reminders are important.Example:&lt;execute_command&gt;&lt;command&gt;npm install react&lt;/command&gt;&lt;requires_approval&gt;false&lt;/requires_approval&gt;&lt;task_progress&gt;- [x] Set up project structure- [x] Install dependencies- [ ] Create components- [ ] Test application&lt;/task_progress&gt;&lt;/execute_command&gt;` å¯¹äºVscodeä¸­ideéƒ¨åˆ†ï¼Œè²Œä¼¼æ˜¯é€šè¿‡ä¸€ä¸ªfocus chainæ¨¡å—æ¥å®ç°çš„ï¼Œå…·ä½“éƒ¨åˆ†å¯å‚è€ƒæºä»£ç æ–‡ä»¶ï¼š cline&#x2F;src&#x2F;core&#x2F;task&#x2F;focus-chain&#x2F; cline&#x2F;src&#x2F;shared&#x2F;tools.ts cline&#x2F;src&#x2F;shared&#x2F;tools.tsé‡Œé¢æ˜¯clineçš„é»˜è®¤å·¥å…·ï¼Œå…¶ä¸­ TODOæŒ‡å‘çš„æ˜¯focus_chain è¿™ä¸ªå·¥å…· 123456789101112131415161718192021222324252627export enum ClineDefaultTool &#123; ASK = &quot;ask_followup_question&quot;, ATTEMPT = &quot;attempt_completion&quot;, BASH = &quot;execute_command&quot;, FILE_EDIT = &quot;replace_in_file&quot;, FILE_READ = &quot;read_file&quot;, FILE_NEW = &quot;write_to_file&quot;, SEARCH = &quot;search_files&quot;, LIST_FILES = &quot;list_files&quot;, LIST_CODE_DEF = &quot;list_code_definition_names&quot;, BROWSER = &quot;browser_action&quot;, MCP_USE = &quot;use_mcp_tool&quot;, MCP_ACCESS = &quot;access_mcp_resource&quot;, MCP_DOCS = &quot;load_mcp_documentation&quot;, NEW_TASK = &quot;new_task&quot;, PLAN_MODE = &quot;plan_mode_respond&quot;, ACT_MODE = &quot;act_mode_respond&quot;, TODO = &quot;focus_chain&quot;, // è¿™ä¸ªåœ°æ–¹ï¼Œåº”è¯¥å°±æ˜¯clineé‡Œé¢ç”¨æ¥è§„åˆ’çš„å·¥å…·äº† WEB_FETCH = &quot;web_fetch&quot;, WEB_SEARCH = &quot;web_search&quot;, CONDENSE = &quot;condense&quot;, SUMMARIZE_TASK = &quot;summarize_task&quot;, REPORT_BUG = &quot;report_bug&quot;, NEW_RULE = &quot;new_rule&quot;, APPLY_PATCH = &quot;apply_patch&quot;, GENERATE_EXPLANATION = &quot;generate_explanation&quot;,&#125; å†æŒ‰ç…§cline&#x2F;src&#x2F;core é‡Œé¢çš„READMEçš„ç»“æ„è¯´æ˜ å·¥å…·ç±»ç›¸å…³çš„å®ç°åº”è¯¥æ˜¯åœ¨taskæ–‡ä»¶ç›®å½•ä¸‹ï¼Œå› æ­¤åœ¨taskç›®å½•ï¼Œå¯ä»¥æ‰¾åˆ°focus-chainè¿™ä¸ªæ–‡ä»¶å¤¹ åœ¨index.ts æ–‡ä»¶é‡Œé¢å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯é€šè¿‡FocusChainManager è¿™ä¸ªç±»æ¥å®ç°todo listçš„æ£€æŸ¥å’Œæ›´æ–°çš„ï¼›åœ¨prompts.tsè¿™ä¸ªæ–‡ä»¶å¤¹é‡Œé¢å¯ä»¥çœ‹åˆ°æ¶‰åŠåˆ°todo listæ“ä½œç›¸å…³çš„promptï¼Œä¸‹é¢å±•ç¤ºä¸€ä¸ªåˆå§‹åŒ–ä»»åŠ¡æ—¶çš„æç¤ºè¯ 12345678910111213141516171819202122232425262728// Prompt for initial list creationconst initial = `# task_progress CREATION REQUIRED - ACT MODE ACTIVATED**You&#x27;ve just switched from PLAN MODE to ACT MODE!**** IMMEDIATE ACTION REQUIRED:**1. Create a comprehensive todo list in your NEXT tool call2. Use the task_progress parameter to provide the list3. Format each item using markdown checklist syntax: - [ ] For tasks to be done - [x] For any tasks already completed**Your todo/task_progress list should include:** - All major implementation steps - Testing and validation tasks - Documentation updates if needed - Final verification steps**Example format:**\\ - [ ] Set up project structure - [ ] Implement core functionality - [ ] Add error handling - [ ] Write tests - [ ] Test implementation - [ ] Document changes**Remember:** Keeping the task_progress list updated helps track progress and ensures nothing is missed.` ä»ä½¿ç”¨ä¸Šæ¥çœ‹ï¼Œclineä¼¼ä¹ä¹Ÿæ˜¯ä½¿ç”¨çš„ReActæ¨¡å¼ï¼Œå½“ç„¶ï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›å˜åŒ–ï¼Œæ ¸å¿ƒé€»è¾‘æ˜¯åœ¨ cline&#x2F;src&#x2F;core&#x2F;task&#x2F;index.tsè¿™ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œé¢æœ‰ä¸€äº›å¾ªç¯,å¦‚ä¸‹é¢çš„initiateTaskLoopå‡½æ•°ï¼Œå¤§æ¦‚å¯ä»¥åˆ¤æ–­åº”è¯¥æ˜¯å­˜åœ¨ReActæ¨¡å¼çš„(ä»ä¸‹é¢è¿™ä¸ªå‡½æ•°çš„æ³¨é‡Šä¹Ÿå¯ä»¥çœ‹å‡ºæ¥)ï¼Œé€»è¾‘å¤ªé•¿ï¼Œåé¢æœ‰æ—¶é—´å¯ä»¥ä»”ç»†ç ”ç©¶ä¸€ä¸‹ï¼Œä¸»è¦çœ‹recursivelyMakeClineRequestsçš„é€»è¾‘ï¼› 1234567891011121314151617181920212223242526272829private async initiateTaskLoop(userContent: ClineContent[]): Promise&lt;void&gt; &#123; let nextUserContent = userContent let includeFileDetails = true while (!this.taskState.abort) &#123; const didEndLoop = await this.recursivelyMakeClineRequests(nextUserContent, includeFileDetails) includeFileDetails = false // we only need file details the first time // The way this agentic loop works is that cline will be given a task that he then calls tools to complete. unless there&#x27;s an attempt_completion call, we keep responding back to him with his tool&#x27;s responses until he either attempt_completion or does not use anymore tools. If he does not use anymore tools, we ask him to consider if he&#x27;s completed the task and then call attempt_completion, otherwise proceed with completing the task. //const totalCost = this.calculateApiCost(totalInputTokens, totalOutputTokens) if (didEndLoop) &#123; // For now a task never &#x27;completes&#x27;. This will only happen if the user hits max requests and denies resetting the count. //this.say(&quot;task_completed&quot;, `Task completed. Total API usage cost: $&#123;totalCost&#125;`) break &#125; else &#123; // this.say( // &quot;tool&quot;, // &quot;Cline responded with only text blocks but has not called attempt_completion yet. Forcing him to continue with task...&quot; // ) nextUserContent = [ &#123; type: &quot;text&quot;, text: formatResponse.noToolsUsed(this.useNativeToolCalls), &#125;, ] this.taskState.consecutiveMistakeCount++ &#125; &#125;&#125;","categories":[],"tags":[{"name":"Agent","slug":"Agent","permalink":"https://flippy-bird.github.io/tags/Agent/"},{"name":"plan","slug":"plan","permalink":"https://flippy-bird.github.io/tags/plan/"}]},{"title":"Mem0æºç å­¦ä¹ ","slug":"Mem0æºç å­¦ä¹ ","date":"2025-12-01T05:54:24.000Z","updated":"2026-01-19T02:53:37.029Z","comments":true,"path":"2025/12/01/Mem0æºç å­¦ä¹ /","permalink":"https://flippy-bird.github.io/2025/12/01/Mem0%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"https://github.com/mem0ai/mem0 1. é¡¹ç›®çš„æ ¸å¿ƒä»£ç ä»memory&#x2F;base.py é‡Œé¢çš„åŸºç±»å¯ä»¥çœ‹åˆ°ï¼Œè®°å¿†åŠŸèƒ½ä¸»è¦å®ç°äº†ä¸‹é¢çš„åŠŸèƒ½ 123456789101112131415class MemoryBase(ABC) @abstractmethod def get(self, memory_id): # æ ¹æ®idè·å–å¯¹åº”idçš„memory @abstractmethod def get_all(self): # åˆ—å‡ºæ‰€æœ‰çš„memory @abstractmethod def update(self, memory_id, data): # æ›´æ–°idçš„memory @abstractmethod def delete(self, memory_id): # åˆ é™¤idçš„memory @abstractmethod def history(self, memory_id): # Get the history of changes for a memory by ID. mem0çš„æ ¸å¿ƒå®ç°åœ¨memory&#x2F;main.py æ–‡ä»¶ä¸­ 123456class Memory(MemoryBase): # è¿™é‡Œé™¤äº†å®ç°ä¸Šé¢baseå®šä¹‰çš„åŸºæœ¬åŠŸèƒ½å¤–ï¼Œæœ‰ä¸€ä¸ªsearchçš„æ ¸å¿ƒåŠŸèƒ½å®ç° def search(self, query, ...): # è¿™é‡Œä¼šæ ¹æ®ç”¨æˆ·çš„queryå»å¯»æ‰¾æœ€ç›¸å…³çš„memory class AsyncMemory(MemoryBase): # å¼‚æ­¥çš„æ¥å£ä¸ç”¨å†ä½¿ç”¨å¦å¤–ä¸€ä¸ªåŸºç±»ï¼Œç›´æ¥ä½¿ç”¨äº†MemoryBaseï¼Œä½†æ˜¯åœ¨å®ç°æ—¶ä½¿ç”¨äº†å¼‚æ­¥ async def get(self, memory_id): 1.1 searchçœ‹searché‡Œé¢çš„å®ç°ï¼Œå°±æ˜¯æ ‡å‡†çš„RAGæµç¨‹ï¼Œembedding query, ç„¶åä»å‘é‡æ•°æ®åº“æˆ–è€…å›¾æ•°æ®åº“å¬å›ï¼Œåšä¸€ä¸ªReRanké‡æ’åº 123456789101112131415# æ˜¯é€šè¿‡ä¸‹é¢çš„å‡½æ•°æ¥å®ç°å‘é‡å¬å›çš„def _search_vector_store(self, query, filters, limit, threshold: Optional[float] = None): embeddings = self.embedding_model.embed(query, &quot;search&quot;) # è¿™ä¸€æ­¥å°±æ˜¯å‘é‡æ£€ç´¢äº† memories = self.vector_store.search(query=query, vectors=embeddings, limit=limit, filters=filters) ... def search(self, query, ...): ... with concurrent.futures.ThreadPoolExecutor() as executor: future_memories = executor.submit(self._search_vector_store, query, effective_filters, limit, threshold) ## è¿™é‡Œçš„self.graphå°±æ˜¯å›¾å…³ç³»åº“ future_graph_entities = (executor.submit(self.graph.search, query, effective_filters, limit) if self.enable_graph else None) å…³äºMemoryç±»ä¸­ä½¿ç”¨åˆ°çš„LLMï¼Œembedding, graph,rerankæ¨¡å‹ç­‰ç­‰éƒ½æ˜¯ä½¿ç”¨å·¥å‚æ¨¡å¼æ¥åˆå§‹åŒ–çš„ 12345678910111213141516171819202122class Memory(MemoryBase): self.embedding_model = EmbedderFactory.create( self.config.embedder.provider, self.config.embedder.config, self.config.vector_store.config, ) self.vector_store = VectorStoreFactory.create( self.config.vector_store.provider, self.config.vector_store.config ) self.llm = LlmFactory.create(self.config.llm.provider, self.config.llm.config) if config.reranker:mem0 æºç é˜…è¯»ï¼šä¸€ä¸ªå·¥ç¨‹åŒ–è®°å¿†ç³»ç»Ÿ self.reranker = RerankerFactory.create( config.reranker.provider, config.reranker.config ) if self.config.graph_store.config: provider = self.config.graph_store.provider self.graph = GraphStoreFactory.create(provider, self.config) self.enable_graph = True else: self.graph = None å·¥å‚å‡½æ•°é‡Œé¢å¯¹åº”çš„å°±æ˜¯å„ä¸ªå¯ä»¥æ”¯æŒçš„å®ç°ï¼Œè¿™ä¸ªå®ç°æ˜¯åœ¨ mem0&#x2F;utils&#x2F;factory.py æ–‡ä»¶ä¸­ï¼Œä¸‹é¢çš„æ˜¯å›¾å…³ç³»æ•°æ®åº“çš„æ”¯æŒä»£ç  12345678910111213141516171819202122class GraphStoreFactory: &quot;&quot;&quot; Factory for creating MemoryGraph instances for different graph store providers. Usage: GraphStoreFactory.create(provider_name, config) &quot;&quot;&quot; provider_to_class = &#123; &quot;memgraph&quot;: &quot;mem0.memory.memgraph_memory.MemoryGraph&quot;, &quot;neptune&quot;: &quot;mem0.graphs.neptune.neptunegraph.MemoryGraph&quot;, &quot;neptunedb&quot;: &quot;mem0.graphs.neptune.neptunedb.MemoryGraph&quot;, &quot;kuzu&quot;: &quot;mem0.memory.kuzu_memory.MemoryGraph&quot;, &quot;default&quot;: &quot;mem0.memory.graph_memory.MemoryGraph&quot;, &#125; @classmethod def create(cls, provider_name, config): class_type = cls.provider_to_class.get(provider_name, cls.provider_to_class[&quot;default&quot;]) try: GraphClass = load_class(class_type) except (ImportError, AttributeError) as e: raise ImportError(f&quot;Could not import MemoryGraph for provider &#x27;&#123;provider_name&#125;&#x27;: &#123;e&#125;&quot;) return GraphClass(config) å¯ä»¥çœ‹åˆ°mem0æ”¯æŒ4ä¸­å›¾å…³ç³»æ•°æ®åº“memgraphã€neptuneã€neptunedbã€kuzu(ä¸ºä»€ä¹ˆä¼šæ”¾åœ¨ä¸¤ä¸ªä¸åŒæ–‡ä»¶å¤¹ä¸‹é¢å‘¢ï¼Ÿè¿™ä¸ªæš‚æ—¶è¿˜æ²¡çœ‹æ˜ç™½)ï¼Œå…¶å®ƒçš„LLMï¼Œembeddingç­‰ç­‰ç±»ä¼¼ï¼› 1.2 addè¿™ä¸ªå‡½æ•°æ˜¯mem0çš„æ ¸å¿ƒ,ä¸»è¦é€šè¿‡ä¸¤ä¸ªå­å‡½æ•°æ¥å®ç° 1234567891011121314151617181920def add(self, messages, *, user_id: Optional[str] = None, agent_id: Optional[str] = None, run_id: Optional[str] = None, metadata: Optional[Dict[str, Any]] = None, infer: bool = True, memory_type: Optional[str] = None, prompt: Optional[str] = None,): with concurrent.futures.ThreadPoolExecutor() as executor: # å¤„ç†embeddingç›¸å…³çš„ future1 = executor.submit(self._add_to_vector_store, messages, processed_metadata, effective_filters, infer) # å›¾å…³ç³»æ•°æ®åº“ future2 = executor.submit(self._add_to_graph, messages, effective_filters) concurrent.futures.wait([future1, future2]) vector_store_result = future1.result() graph_result = future2.result() è€Œæ ¸å¿ƒä¸­çš„æ ¸å¿ƒæ˜¯_add_to_vector_store è¿™ä¸ªå‡½æ•° 1234567891011121314151617181920212223242526# å½“ infer ä¸ºfalseæ—¶ï¼Œæ˜¯å¸¸è§„çš„è®°å¿†å­˜å‚¨ï¼Œembedding,å…¥åº“ (ç›´æ¥å…¥åº“çš„æ¨¡å¼)def _add_to_vector_store(self, messages, metadata, filters, infer): # å½“infer ä¸ºtrueæ—¶ï¼Œå°†ä¼šä½¿ç”¨LLMåˆ†æå¯¹è¯å†…å®¹ï¼Œæå–æœ‰æ„ä¹‰çš„äº‹å®ï¼Œå¹¶æ™ºèƒ½åœ°å†³å®šå¦‚ä½•å¤„ç†è¿™äº›è®°å¿†ï¼ˆæ·»åŠ ã€æ›´æ–°ã€åˆ é™¤æˆ–ä¿æŒä¸å˜ï¼‰ ### è¿™é‡Œæ˜¯æå–å®ä½“å…³ç³»çš„é€»è¾‘ parsed_messages = parse_messages(messages) if self.config.custom_fact_extraction_prompt: system_prompt = self.config.custom_fact_extraction_prompt user_prompt = f&quot;Input:\\n&#123;parsed_messages&#125;&quot; else: # Determine if this should use agent memory extraction based on agent_id presence # and role types in messages is_agent_memory = self._should_use_agent_memory_extraction(messages, metadata) system_prompt, user_prompt = get_fact_retrieval_messages(parsed_messages, is_agent_memory) response = self.llm.generate_response( messages=[ &#123;&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: system_prompt&#125;, &#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: user_prompt&#125;, ], response_format=&#123;&quot;type&quot;: &quot;json_object&quot;&#125;, ) # æŠ½å–å®ä½“åï¼Œå¼€å§‹è¿›è¡Œåˆ¤æ–­ä¸‹ä¸€æ­¥å¯¹è®°å¿†è¿›è¡Œ å¢åˆ æ”¹æŸ¥çš„é€»è¾‘äº†ï¼Œä¹Ÿæ˜¯å€ŸåŠ©äº†å¤§æ¨¡å‹æ¥å®ç° # è¿™éƒ¨åˆ†å¤ªé•¿çœç•¥äº† å¯ä»¥è§‚å¯Ÿä¸€ä¸‹mem0ä¸­æŠ½å–ç”¨æˆ·æˆ–è€…Agent ç‰¹æ€§çš„æç¤ºè¯ (å¤ªé•¿ï¼Œåªå±•ç¤ºä¸€éƒ¨åˆ†ï¼Œå…·ä½“æ–‡ä»¶åœ¨ï¼šmem0&#x2F;configs&#x2F;prompts.py é‡Œé¢çš„USER_MEMORY_EXTRACTION_PROMPTå’ŒAGENT_MEMORY_EXTRACTION_PROMPT) é¦–å…ˆï¼ŒLLMä¸»è¦ä»»åŠ¡æ˜¯ï¼š 123456789101112131415161718AGENT_MEMORY_EXTRACTION_PROMPT = f&#x27;&#x27;&#x27;You are a Personal Information Organizer, specialized in accurately storing facts, user memories, and preferences. Your primary role is to extract relevant pieces of information from conversations and organize them into distinct, manageable facts. This allows for easy retrieval and personalization in future interactions. Below are the types of information you need to focus on and the detailed instructions on how to handle the input data.# [IMPORTANT]: GENERATE FACTS SOLELY BASED ON THE USER&#x27;S MESSAGES. DO NOT INCLUDE INFORMATION FROM ASSISTANT OR SYSTEM MESSAGES.# [IMPORTANT]: YOU WILL BE PENALIZED IF YOU INCLUDE INFORMATION FROM ASSISTANT OR SYSTEM MESSAGES.Types of Information to Remember:1. Store Personal Preferences: Keep track of likes, dislikes, and specific preferences in various categories such as food, products, activities, and entertainment.2. Maintain Important Personal Details: Remember significant personal information like names, relationships, and important dates.3. Track Plans and Intentions: Note upcoming events, trips, goals, and any plans the user has shared.4. Remember Activity and Service Preferences: Recall preferences for dining, travel, hobbies, and other services.5. Monitor Health and Wellness Preferences: Keep a record of dietary restrictions, fitness routines, and other wellness-related information.6. Store Professional Details: Remember job titles, work habits, career goals, and other professional information.7. Miscellaneous Information Management: Keep track of favorite books, movies, brands, and other miscellaneous details that the user shares.&#x27;&#x27;&#x27; å…·ä½“çš„few shotä¾‹å­å¦‚ä¸‹ï¼šç»™äº†ä¸€äº›æ­£ä¾‹å’Œåä¾‹(ä¸ç”¨æå–çš„ä¾‹å­) 12345678910111213141516171819202122AGENT_MEMORY_EXTRACTION_PROMPT = f&#x27;&#x27;&#x27;User: Hi.Assistant: Hello! I enjoy assisting you. How can I help today?Output: &#123;&#123;&quot;facts&quot; : []&#125;&#125;User: There are branches in trees.Assistant: That&#x27;s an interesting observation. I love discussing nature.Output: &#123;&#123;&quot;facts&quot; : []&#125;&#125;User: Hi, I am looking for a restaurant in San Francisco.Assistant: Sure, I can help with that. Any particular cuisine you&#x27;re interested in?Output: &#123;&#123;&quot;facts&quot; : [&quot;Looking for a restaurant in San Francisco&quot;]&#125;&#125;User: Yesterday, I had a meeting with John at 3pm. We discussed the new project.Assistant: Sounds like a productive meeting. I&#x27;m always eager to hear about new projects.Output: &#123;&#123;&quot;facts&quot; : [&quot;Had a meeting with John at 3pm and discussed the new project&quot;]&#125;&#125;User: Hi, my name is John. I am a software engineer.Assistant: Nice to meet you, John! My name is Alex and I admire software engineering. How can I help?Output: &#123;&#123;&quot;facts&quot; : [&quot;Name is John&quot;, &quot;Is a Software engineer&quot;]&#125;&#125;&#x27;&#x27;&#x27; ä¸çŸ¥é“è¿™ç§å†™æ³•ä¼šä¸ä¼šé™åˆ¶LLMè¾“å‡ºç”¨æˆ·ä¸æƒ³è¦çš„ï¼Œprompté‡Œé¢å­˜åœ¨ç±»ä¼¼ä¸‹é¢çš„å¥å­ï¼š 12# [IMPORTANT]: GENERATE FACTS SOLELY BASED ON THE USER&#x27;S MESSAGES. DO NOT INCLUDE INFORMATION FROM ASSISTANT OR SYSTEM MESSAGES.# [IMPORTANT]: YOU WILL BE PENALIZED IF YOU INCLUDE INFORMATION FROM ASSISTANT OR SYSTEM MESSAGES. è·å–åˆ°å“ªäº›ç”¨æˆ·çš„ä¹ æƒ¯æˆ–è€…å…¶å®ƒä¸€äº›ä¸ç”¨æˆ·ç›¸å…³ä¿¡æ¯ä¹‹åï¼Œç„¶åä½¿ç”¨embeddingåŒ¹é…ä»memoryä¸­å¬å›ä¸€äº›ä¸è¿™äº›ä¿¡æ¯ç›¸å…³çš„ä¿¡æ¯ï¼›å…·ä½“çš„ä»£ç å¦‚ä¸‹ï¼š 12345678910111213# new_retrieved_facts å³æ˜¯ä»è¿™æ¡æ¶ˆæ¯ä¸­è·å–åˆ°çš„ç”¨æˆ·åå¥½for new_mem in new_retrieved_facts: messages_embeddings = self.embedding_model.embed(new_mem, &quot;add&quot;) new_message_embeddings[new_mem] = messages_embeddings existing_memories = self.vector_store.search( query=new_mem, vectors=messages_embeddings, limit=5, filters=search_filters, ) for mem in existing_memories: retrieved_old_memory.append(&#123;&quot;id&quot;: mem.id, &quot;text&quot;: mem.payload.get(&quot;data&quot;, &quot;&quot;)&#125;) å›æº¯åˆ°ç›¸å…³çš„å†å²memoryä¹‹åï¼Œç„¶åä½¿ç”¨LLMç¡®å®šæ˜¯å¦æ·»åŠ æ–°çš„è®°å¿†ï¼Œè¿˜æ˜¯åˆ é™¤æ›´æ–°æ—§çš„è®°å¿†ï¼Œå…·ä½“çš„èŒè´£ç›¸å…³promptå¦‚ä¸‹ 12345678910111213DEFAULT_UPDATE_MEMORY_PROMPT = &quot;&quot;&quot;You are a smart memory manager which controls the memory of a system.You can perform four operations: (1) add into the memory, (2) update the memory, (3) delete from the memory, and (4) no change.Based on the above four operations, the memory will change.Compare newly retrieved facts with the existing memory. For each new fact, decide whether to:- ADD: Add it to the memory as a new element- UPDATE: Update an existing memory element- DELETE: Delete an existing memory element- NONE: Make no change (if the fact is already present or irrelevant)&quot;&quot;&quot; few shot çš„ä¾‹å­å¦‚ä¸‹ï¼šå±•ç¤ºçš„æ˜¯åˆ é™¤è¿™ä¸ªæ“ä½œçš„ä¾‹å­ï¼Œå®Œæ•´çš„å¯ä»¥çœ‹mem0&#x2F;configs&#x2F;prompts.py æ–‡ä»¶ä¸­çš„DEFAULT_UPDATE_MEMORY_PROMPT 12345678910111213141516171819202122232425262728293031323334353637DEFAULT_UPDATE_MEMORY_PROMPT = &quot;&quot;&quot;There are specific guidelines to select which operation to perform:3. **Delete**: If the retrieved facts contain information that contradicts the information present in the memory, then you have to delete it. Or if the direction is to delete the memory, then you have to delete it.Please note to return the IDs in the output from the input IDs only and do not generate any new ID.- **Example**: - Old Memory: [ &#123; &quot;id&quot; : &quot;0&quot;, &quot;text&quot; : &quot;Name is John&quot; &#125;, &#123; &quot;id&quot; : &quot;1&quot;, &quot;text&quot; : &quot;Loves cheese pizza&quot; &#125; ] - Retrieved facts: [&quot;Dislikes cheese pizza&quot;] - New Memory: &#123; &quot;memory&quot; : [ &#123; &quot;id&quot; : &quot;0&quot;, &quot;text&quot; : &quot;Name is John&quot;, &quot;event&quot; : &quot;NONE&quot; &#125;, &#123; &quot;id&quot; : &quot;1&quot;, &quot;text&quot; : &quot;Loves cheese pizza&quot;, &quot;event&quot; : &quot;DELETE&quot; &#125; ] &#125;&quot;&quot;&quot; 1.3 å…¶å®ƒmemory&#x2F;telemetry.py æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶çš„ä½œç”¨ç±»ä¼¼åŸ‹ç‚¹ï¼Œç”¨æ¥è®°å½•ç”¨æˆ·ä½¿ç”¨mem0çš„æ•°æ®æƒ…å†µï¼ˆåœ¨gemini cliï¼Œ qwen codeä¸­çœ‹åˆ°åŒæ ·çš„æ–‡ä»¶ï¼‰ å¯å‚è€ƒèµ„æ–™ mem0 æºç é˜…è¯»ï¼šä¸€ä¸ªå·¥ç¨‹åŒ–è®°å¿†ç³»ç»Ÿ","categories":[{"name":"Agentå¼€æºé¡¹ç›®å­¦ä¹ ","slug":"Agentå¼€æºé¡¹ç›®å­¦ä¹ ","permalink":"https://flippy-bird.github.io/categories/Agent%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Agent","slug":"Agent","permalink":"https://flippy-bird.github.io/tags/Agent/"},{"name":"memory","slug":"memory","permalink":"https://flippy-bird.github.io/tags/memory/"}]},{"title":"LLM memory","slug":"LLM-memory","date":"2025-12-01T05:47:10.000Z","updated":"2026-01-22T02:03:46.681Z","comments":true,"path":"2025/12/01/LLM-memory/","permalink":"https://flippy-bird.github.io/2025/12/01/LLM-memory/","excerpt":"","text":"å‚è€ƒèµ„æ–™ LLM memory evaluation EverMemos MemOS zep memu letta åŒ—å¤§å‡ºå“ï¼Œæœ€ç«ã€æœ€å…¨çš„Agentè®°å¿†ç»¼è¿°ï¼ï¼ ç›¸å…³å¾®ä¿¡å…¬ä¼—å·åœ°å€","categories":[],"tags":[{"name":"Agent","slug":"Agent","permalink":"https://flippy-bird.github.io/tags/Agent/"},{"name":"memory","slug":"memory","permalink":"https://flippy-bird.github.io/tags/memory/"}]},{"title":"LightRAG","slug":"LightRAG","date":"2025-11-28T07:06:12.000Z","updated":"2026-01-16T10:40:28.946Z","comments":true,"path":"2025/11/28/LightRAG/","permalink":"https://flippy-bird.github.io/2025/11/28/LightRAG/","excerpt":"","text":"1. èƒŒæ™¯å¾…è¯¦ç»†çœ‹å®Œå®Œæ•´è®ºæ–‡åè¡¥å……ï¼Œå¤§æ¦‚å°±æ˜¯GraphRagè™½ç„¶æ•ˆæœæ¯”è¾ƒå¥½ï¼Œä½†æ˜¯é€Ÿåº¦æ…¢ï¼Œå»ºç«‹å›¾çš„è¿‡ç¨‹ä¸­æ¶ˆè€—çš„tokenä¹Ÿå¾ˆå¤šï¼Œå› æ­¤æœ‰äº†LightRagï¼› 2. LightRAGçš„åŸç† æ·±åº¦è§£ææ¯”å¾®è½¯çš„GraphRAGç®€æ´å¾ˆå¤šçš„LightRAGï¼Œä¸€çœ‹å°±æ‡‚ å…ˆçœ‹äº†çŸ¥ä¹ä¸Šçš„ä¸€äº›è§£è¯»ï¼Œæ„Ÿè§‰å°±æ˜¯ç®€åŒ–ç‰ˆæœ¬çš„GraphRAGï¼Œåœ¨ç´¢å¼•é˜¶æ®µçš„å¤„ç†æ–¹å¼æ˜¯å·®ä¸å¤šçš„ï¼Œåªæ˜¯LightRAGå°†GraphRAGä¸­æ¯”è¾ƒæ…¢çš„éƒ¨åˆ†å»æ‰äº†(ç¤¾åŒºæŠ¥å‘Šéƒ¨åˆ†ï¼Œå› æ­¤ä¹Ÿå»æ‰äº†global search)ï¼Œæ•°æ®å¤„ç†æµç¨‹æ˜¯ï¼šå…ˆåˆ†å—ï¼Œç„¶åæå–å®ä½“å’Œå…³ç³»ï¼Œç„¶åå…¥åº“ï¼Œindexéƒ¨åˆ†çš„å·¥ä½œå°±å®Œæˆäº†ï¼› åœ¨æŸ¥è¯¢é˜¶æ®µï¼Œæä¾›äº†4ä¸­æ–¹å¼ï¼š æœ€åŸºæœ¬çš„å‘é‡ç›¸ä¼¼åº¦åŒ¹é… local search: æ ¹æ®ç”¨æˆ·çš„queryç”Ÿæˆä¸€äº›low-level çš„å…³é”®è¯ï¼Œç„¶åæ ¹æ®ç”Ÿæˆçš„å…³é”®è¯å»å»ºç«‹å¥½çš„å›¾è°±æŸ¥è¯¢ï¼› global search: æ ¹æ®ç”¨æˆ·çš„queryç”Ÿæˆä¸€äº›high-level çš„å…³é”®è¯ï¼Œç„¶åæ ¹æ®ç”Ÿæˆçš„å…³é”®è¯å»å»ºç«‹å¥½çš„å›¾è°±æŸ¥è¯¢ï¼› æ··åˆæœç´¢ï¼šlocal search + global search 3. æºç è§£æ TODO","categories":[{"name":"RAGæ¡†æ¶å­¦ä¹ ","slug":"RAGæ¡†æ¶å­¦ä¹ ","permalink":"https://flippy-bird.github.io/categories/RAG%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Rag","slug":"Rag","permalink":"https://flippy-bird.github.io/tags/Rag/"}]},{"title":"AgentScopeæºç å­¦ä¹ ","slug":"AgentScopeæºç å­¦ä¹ ","date":"2025-11-25T11:47:53.000Z","updated":"2026-01-23T03:37:21.475Z","comments":true,"path":"2025/11/25/AgentScopeæºç å­¦ä¹ /","permalink":"https://flippy-bird.github.io/2025/11/25/AgentScope%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"AgentScope (é˜¿é‡Œçš„) https://github.com/agentscope-ai/agentscope è®°å¿†é•¿æœŸè®°å¿†éƒ¨åˆ†ä½¿ç”¨äº†mem0è¿™ä¸ªå·¥å…·ï¼Œå½“ç„¶ï¼Œä»£ç é‡Œé¢ä¹Ÿæåˆ°äº†ï¼Œå¯ä»¥ä½¿ç”¨é˜¿é‡Œè‡ªå®¶çš„ReMeè¿™ä¸ªè®°å¿†æ¡†æ¶ï¼› åœ¨26å¹´1æœˆä»½çš„æ›´æ–°ä¸­ï¼Œæ·»åŠ äº†æ•°æ®åº“çš„æ”¯æŒ(ä½¿ç”¨Rediså’ŒSql)ï¼Œä½¿ç”¨Redisåº”è¯¥æ˜¯ä¿å­˜ä¸´æ—¶çš„å¯¹è¯å†å²ä¿¡æ¯ï¼ŒSqlæ˜¯ä¸ºäº†ä¿å­˜é•¿æœŸè®°å¿†ï¼› Agentè¿™ä¸€å—å„¿ä½¿ç”¨çš„æ˜¯åŸºæœ¬çš„Reactæ¨¡å¼ï¼Œè¾“å‡ºæœ€åçš„å›ç­”ï¼Œä¹Ÿæˆäº†ä¸€ä¸ªå·¥å…·ï¼›å¤šäº†ä¸€ä¸ª 1234567891011121314### AgentBase# åœ¨AgentBaseé‡Œé¢æœ‰ä¸€ä¸ªè™šå‡½æ•° replydef reply()### åœ¨ReactAgentBaseé‡Œé¢æœ‰åŸºæœ¬çš„Reactæ¡†æ¶def _reasoning() # è™šå‡½æ•°def _acting() # è™šå‡½æ•°### åœ¨ReactAgenté‡Œé¢def reply(): è¿™é‡Œå°±ç±»ä¼¼OpenManusé‡Œé¢çš„step()å‡½æ•°çš„ä½œç”¨äº†ï¼Œä»æºç æ¥çœ‹ï¼Œé€»è¾‘å®Œå…¨ä¸€æ · self._reasoning() ... self._acting() åœ¨Agenté‡Œé¢æœ‰ä¸€ä¸ªobserveï¼Œæ„Ÿè§‰æ˜¯ä¸ºäº†è§‚å¯Ÿåˆ°å¤–ç•Œä¿¡æ¯å‡†å¤‡çš„æ¥å£(ç”¨äºå¤šAgentä¹‹é—´çš„ä¿¡æ¯äº’åŠ¨) 1234567891011async def observe(self, msg: Msg | list[Msg] | None) -&gt; None: &quot;&quot;&quot;Receive the given message(s) without generating a reply. Args: msg (`Msg | list[Msg] | None`): The message(s) to be observed. &quot;&quot;&quot; raise NotImplementedError( f&quot;The observe function is not implemented in&quot; f&quot; &#123;self.__class__.__name__&#125; class.&quot;, ) å¤šAgentäº’åŠ¨åœ¨è¿™ä¸ªæ¡†æ¶é‡Œé¢ä½¿ç”¨çš„æ˜¯swarmæ¨¡å¼ï¼Œä¼¼ä¹æ¯”è¾ƒç®€å•ï¼Œæ¯ä¸ªagent observeå…¶å®ƒagentçš„è¾“å‡ºï¼Œæ·»åŠ åˆ°è‡ªå·±çš„è®°å¿†é‡Œé¢å»å°±å¥½äº† åœ¨src&#x2F;pipeline&#x2F;_msghub.pyæ–‡ä»¶å¤¹é‡Œé¢ ï¼ˆæˆ–è€…è§ç±»åæ—¶çš„è¯´æ˜ï¼‰ 123456789async def broadcast(self, msg: list[Msg] | Msg) -&gt; None: &quot;&quot;&quot;Broadcast the message to all participants. Args: msg (`list[Msg] | Msg`): Message(s) to be broadcast among all participants. &quot;&quot;&quot; for agent in self.participants: await agent.observe(msg) Interrupt(ä¸­æ–­ä»‹å…¥)è¿™ä¸ªå¥½åƒè¿˜ä¸é”™ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ï¼Œæ–‡æ¡£åœ¨https://doc.agentscope.io/tutorial/task_tool.html#interrupting-tool-executionï¼Œ å¯¹äºå·¥å…·æ‰§è¡Œçš„å–æ¶ˆï¼Œæ˜¯åˆ©ç”¨äº†asyncioçš„å–æ¶ˆæœºåˆ¶æ¥å®ç°çš„ å…·ä½“å®ç°çš„ä»£ç å¤§æ¦‚å¦‚ä¸‹ï¼š(ä»£ç è·¯å¾„ï¼šagentscope&#x2F;src&#x2F;agentscope&#x2F;agent&#x2F;_agent_base.py), é¦–å…ˆè¿™é‡Œçš„ self. _reply_taskè·å–åˆ°å½“å‰çš„ä»»åŠ¡ï¼Œç”¨äºåé¢çš„ä¸­æ–­å¤„ç†ï¼Œä»ä»£ç ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œself.replyé‡Œé¢å‘ç”Ÿäº†ä¸­æ–­ä¼šè§¦å‘ raise asyncio.CancellerErrorï¼Œç„¶åè¿™ä¸ªå‡½æ•°å»æ•è·ï¼Œç„¶ååœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢å»è§¦å‘æ‰§è¡Œhandle_interruptçš„ä»»åŠ¡ ï¼ˆè¿™ä¸ªå¯ä»¥åœ¨react_agenté‡Œé¢çš„reasoningå’Œactingæ­¥éª¤å¯ä»¥æ‰¾åˆ°ä¾‹å­ï¼‰ 1234567891011121314151617181920async def __call__(self, *args: Any, **kwargs: Any) -&gt; Msg: &quot;&quot;&quot;Call the reply function with the given arguments.&quot;&quot;&quot; self._reply_id = shortuuid.uuid() reply_msg: Msg | None = None try: self._reply_task = asyncio.current_task() reply_msg = await self.reply(*args, **kwargs) # The interruption is triggered by calling the interrupt method except asyncio.CancelledError: reply_msg = await self.handle_interrupt(*args, **kwargs) finally: # Broadcast the reply message to all subscribers if reply_msg: await self._broadcast_to_subscribers(reply_msg) self._reply_task = None return reply_msg å¦‚æœå­˜åœ¨å‘ç”Ÿäº†ä¸­æ–­ï¼Œä½¿ç”¨task.cancel()å‡½æ•°å–æ¶ˆä»»åŠ¡ 1234async def interrupt(self, msg: Msg | list[Msg] | None = None) -&gt; None: &quot;&quot;&quot;Interrupt the current reply process.&quot;&quot;&quot; if self._reply_task and not self._reply_task.done(): self._reply_task.cancel(msg) Hooksä½¿ç”¨äº†pythonå…ƒç¼–ç¨‹æ¥å®ç°ï¼Œåœ¨å…ƒç±»ä¸­æ·»åŠ ä¸€äº›wrapç±»æˆ–è€…å‡½æ•°ï¼Œä½¿å¾—åœ¨å‡½æ•°è°ƒç”¨å‰åä¼šæ‰§è¡Œä¸€æ®µæ³¨å…¥çš„ä»£ç ï¼Œå…¶å®ç°ä¸»è¦æ˜¯åœ¨&#x2F;src&#x2F;agentscope&#x2F;agent&#x2F;_agent_meta.pyè¿™ä¸ªæ–‡ä»¶çš„ _wrap_with_hooksè¿™ä¸ªå‡½æ•°, ä»ä¸‹é¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œä¾æ¬¡æ‰§è¡Œpre-hooks, åŸå…ˆçš„å‡½æ•°ï¼Œpost-hooks 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384def _wrap_with_hooks( original_func: Callable,) -&gt; Callable: &quot;&quot;&quot;A decorator to wrap the original async function with pre- and post-hooks Args: original_func (`Callable`): The original async function to be wrapped with hooks. &quot;&quot;&quot; func_name = original_func.__name__.replace(&quot;_&quot;, &quot;&quot;) @wraps(original_func) async def async_wrapper( self: AgentBase, *args: Any, **kwargs: Any, ) -&gt; Any: &quot;&quot;&quot;The wrapped function, which call the pre- and post-hooks before and after the original function.&quot;&quot;&quot; # Unify all positional and keyword arguments into a keyword arguments normalized_kwargs = _normalize_to_kwargs( original_func, self, *args, **kwargs, ) current_normalized_kwargs = normalized_kwargs # pre-hooks pre_hooks = list( getattr(self, f&quot;_instance_pre_&#123;func_name&#125;_hooks&quot;).values(), ) + list( getattr(self, f&quot;_class_pre_&#123;func_name&#125;_hooks&quot;).values(), ) for pre_hook in pre_hooks: modified_keywords = await _execute_async_or_sync_func( pre_hook, self, deepcopy(current_normalized_kwargs), ) if modified_keywords is not None: assert isinstance(modified_keywords, dict), ( f&quot;Pre-hook must return a dict of keyword arguments, rather&quot; f&quot; than &#123;type(modified_keywords)&#125; from hook &quot; f&quot;&#123;pre_hook.__name__&#125;&quot; ) current_normalized_kwargs = modified_keywords # original function # handle positional and keyword arguments specifically args = current_normalized_kwargs.get(&quot;args&quot;, []) kwargs = current_normalized_kwargs.get(&quot;kwargs&quot;, &#123;&#125;) others = &#123; k: v for k, v in current_normalized_kwargs.items() if k not in [&quot;args&quot;, &quot;kwargs&quot;] &#125; current_output = await original_func( self, *args, **others, **kwargs, ) # post_hooks post_hooks = list( getattr(self, f&quot;_instance_post_&#123;func_name&#125;_hooks&quot;).values(), ) + list( getattr(self, f&quot;_class_post_&#123;func_name&#125;_hooks&quot;).values(), ) for post_hook in post_hooks: modified_output = await _execute_async_or_sync_func( post_hook, self, deepcopy(current_normalized_kwargs), deepcopy(current_output), ) if modified_output is not None: current_output = modified_output return current_output return async_wrapper Agent Skillskillçš„æ€æƒ³æ˜¯åŠ¨æ€åŠ è½½propmtï¼Œä¿¡æ¯ï¼Œæˆ‘å…ˆè·‘äº†ä¸€ä¸ªagentscopeå®˜æ–¹çš„ä¾‹å­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå½“éœ€è¦è¯»å–skillæ›´å¤šçš„å†…å®¹æ—¶ï¼Œä½¿ç”¨æ¡†æ¶å†…ç½®çš„å·¥å…·view_text_fileè¯»å–SKILL.mdä¸­çš„å†…å®¹ï¼Œç„¶åä½¿ç”¨å†…ç½®çš„bashå·¥å…·execute_shell_commandæ¥æ‰§è¡Œç›¸åº”çš„è„šæœ¬ åˆ†æäº†SKILL.mdçš„å…¨éƒ¨å†…å®¹ä¹‹åï¼ŒæŒ‰ç…§SKILL.mdé‡Œé¢çš„è¯´æ˜æ¥è¿›è¡Œå·¥ä½œäº† å¯¹äºä»£ç çš„å®ç°æ–¹é¢æ¥çœ‹ï¼Œagentscopeåœ¨åŸå…ˆsystem promptåŸºç¡€ä¸Šæ‹¼æ¥äº†skillç›¸å…³çš„prompt src&#x2F;agentscope&#x2F;agent&#x2F;_react_agent.py æŠŠè¿™ä¸ªpromptåŠ è½½åˆ°ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡ä¹‹åï¼Œå°±ä¸éœ€è¦åšå…¶ä»–äº‹æƒ…äº†ï¼Œå› ä¸ºä¸Šé¢çš„promptä¹Ÿè¯´æ˜äº†ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨skillï¼Œé‚£ä¹ˆéœ€è¦åº”è¯¥éœ€è¦è°ƒç”¨ æŸ¥çœ‹å†…å®¹ç›¸å…³çš„å·¥å…·å»è¯»å–SKILL.mdçš„å†…å®¹ï¼Œç„¶åå†è¿›è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œäº†ã€‚è¿™ä¸ªå®ç°è¿˜æ˜¯è›®ç›´è§‚çš„ Plançš„å®ç°å®ç°äº†ä¸€äº›plançš„åŠŸèƒ½å‡½æ•°ï¼Œç„¶åè®©Agentå»è°ƒç”¨å’Œæ›´æ”¹å½“å‰çš„plan å…¶å®ƒå­—èŠ‚ä¹Ÿå‡ºäº†ä¸€ä¸ªç±»ä¼¼æ¡†æ¶ï¼šveadk-python","categories":[{"name":"Agentå¼€æºé¡¹ç›®å­¦ä¹ ","slug":"Agentå¼€æºé¡¹ç›®å­¦ä¹ ","permalink":"https://flippy-bird.github.io/categories/Agent%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Agent","slug":"Agent","permalink":"https://flippy-bird.github.io/tags/Agent/"}]},{"title":"smolagentsæºç å­¦ä¹ ","slug":"smolagentsæºç å­¦ä¹ ","date":"2025-11-25T08:43:25.000Z","updated":"2026-01-16T10:41:49.222Z","comments":true,"path":"2025/11/25/smolagentsæºç å­¦ä¹ /","permalink":"https://flippy-bird.github.io/2025/11/25/smolagents%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"https://github.com/huggingface/smolagents memory ç®¡ç†1234class AgentMemory: def __init__(self, system_prompt:str): self.system_prompt: SystemPromptStep = SystemPromptStep(system_prompt=system_prompt) self.steps: list[TaskStep | ActionStep | PlanningStep] = [] å°†LLMæ‰§è¡Œè¿‡ç¨‹çš„ä¿¡æ¯åˆ’åˆ†æˆäº†å››ä¸ªéƒ¨åˆ†(ä¸»è¦ï¼Œå…¶å®ƒ)ï¼š TaskStep: ä¸ç”¨æˆ·è¾“å…¥ç›¸å…³ (ç”¨æˆ·æé—®ï¼Œä¸Šä¼ å›¾ç‰‡ç­‰) SystemPromptStep: ç³»ç»Ÿçš„prompt PlanningStep: ä¸è§„åˆ’ç›¸å…³çš„è®°å¿† (æš‚æ—¶è¿˜æ²¡é‡åˆ°) ActionStepï¼šå½“å‰é€åˆ°LLMè¿›è¡Œæ‰§è¡Œçš„ä¿¡æ¯ å†å²ä¿¡æ¯çš„è·å– æ‰€ä»¥ä¸»è¦åœ¨äºä¸Šé¢æ¯ç§ç±»å‹è®°å¿†æ•°æ® to_messagesçš„å®ç° éœ€è¦æ³¨æ„çš„æ˜¯å‰åä¿¡æ¯çš„å®Œæ•´æ€§ 1234567891011121314151617181920212223# agents.py line:1256def _step_stream( self, memory_step: ActionStep ) -&gt; Generator[ChatMessageStreamDelta | ToolCall | ToolOutput | ActionOutput]: &quot;&quot;&quot; Perform one step in the ReAct framework: the agent thinks, acts, and observes the result. Yields ChatMessageStreamDelta during the run if streaming is enabled. At the end, yields either None if the step is not final, or the final answer. &quot;&quot;&quot; memory_messages = self.write_memory_to_messages() # agents.py line:758def write_memory_to_messages( self, summary_mode: bool = False, ) -&gt; list[ChatMessage]: &quot;&quot;&quot; Reads past llm_outputs, actions, and observations or errors from the memory into a series of messages that can be used as input to the LLM. Adds a number of keywords (such as PLAN, error, etc) to help the LLM. &quot;&quot;&quot; messages = self.memory.system_prompt.to_messages(summary_mode=summary_mode) for memory_step in self.memory.steps: messages.extend(memory_step.to_messages(summary_mode=summary_mode)) return messages è¾¹ç•Œå¤„ç†å½“è¶…è¿‡æœ€å¤§å°è¯•æ¬¡æ•°ï¼ˆé»˜è®¤æ˜¯20æ¬¡ï¼‰æ—¶ï¼Œæœ€åä¼šæ€»ç»“19æ­¥çš„stepï¼Œç„¶åç»™å‡ºä¸€ä¸ªæœ€ç»ˆç­”æ¡ˆ 12345678910111213141516# agent.py line:810def provide_final_answer(self, task: str) -&gt; ChatMessage: messages : è¿™é‡Œæœ‰ä¸€ä¸ªä¸“é—¨é’ˆå¯¹è¿™ç§æƒ…å†µçš„ç³»ç»Ÿprompt messages += self.write_memory_to_messages()[1:] messages : éœ€è¦ç»„è£…çš„post_messages try: chat_message: ChatMessage = self.model.generate(messages) return chat_message except Exception as e: return ChatMessage( role=MessageRole.ASSISTANT, content=[&#123;&quot;type&quot;: &quot;text&quot;, &quot;text&quot;: f&quot;Error in generating final LLM output: &#123;e&#125;&quot;&#125;], ) Agent: CodeAgent é¡¹ç›®çš„CodeAgentæ¨¡å¼ç®—æ˜¯è¿™ä¸ªé¡¹ç›®é‡Œé¢æ¯”è¾ƒæ–°é¢–çš„ä¸€ç§æ–¹å¼äº†ï¼Œè°ƒç”¨å·¥å…·çš„APIæ˜¯é€šè¿‡æ‰§è¡Œpythonä»£ç çš„æ–¹å¼æ¥æ‰§è¡Œçš„ï¼Œä½†æ˜¯æ„Ÿè§‰è§£æpythonçš„ASTé‚£éƒ¨åˆ†ï¼Œå°±æ„Ÿè§‰å¥½å¤æ‚-_-#ï¼Œæ²¡æœ‰FunctionCallçš„è¿™ç§æ–¹å¼ç®€æ´äº†ã€‚ æ¥æºäºExecutable Code Actions Elicit Better LLM Agentsï¼Œè¿™ç¯‡è®ºæ–‡ä¸»è¦çš„å‡ºå‘åŠ¨æœºæ˜¯å½“å‰LLM Agenté€šå¸¸é€šè¿‡ä»¥é¢„å®šä¹‰çš„æ ¼å¼ç”Ÿæˆ JSON æˆ–æ–‡æœ¬æ¥ç”ŸæˆActionï¼Œè¿™é€šå¸¸å—åˆ°çº¦æŸåŠ¨ä½œç©ºé—´ï¼ˆä¾‹å¦‚ï¼Œé¢„å®šä¹‰å·¥å…·çš„èŒƒå›´ï¼‰å’Œå—é™çµæ´»æ€§ï¼ˆä¾‹å¦‚ï¼Œæ— æ³•ç»„åˆå¤šä¸ªå·¥å…·ï¼‰çš„é™åˆ¶ã€‚ é“¾æ¥ï¼šhttps://zhuanlan.zhihu.com/p/16341067315","categories":[{"name":"Agentå¼€æºé¡¹ç›®å­¦ä¹ ","slug":"Agentå¼€æºé¡¹ç›®å­¦ä¹ ","permalink":"https://flippy-bird.github.io/categories/Agent%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Agent","slug":"Agent","permalink":"https://flippy-bird.github.io/tags/Agent/"}]},{"title":"MCP","slug":"mcpä»‹ç»","date":"2025-11-25T06:02:24.000Z","updated":"2026-01-16T10:40:28.948Z","comments":true,"path":"2025/11/25/mcpä»‹ç»/","permalink":"https://flippy-bird.github.io/2025/11/25/mcp%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"MCPè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šå›¾å³å¯ æœ‰MCPå’Œæ²¡æœ‰MCPçš„åŒºåˆ«ï¼Œæå‡äº†æ•ˆç‡ MCPçš„æ¶æ„å›¾ï¼šä¸»è¦æ˜¯ç”±Hostã€Clientå’ŒServerä¸‰éƒ¨åˆ†ç»„æˆ ä¸ªäººdemo mcp demo å‚è€ƒèµ„æ–™ MCP (Model Context Protocol)ï¼Œä¸€ç¯‡å°±å¤Ÿäº†ã€‚ python SDKçš„å®˜æ–¹æ–‡æ¡£ æµ‹è¯•MCPå·¥å…·æ¥å…¥ä½¿ç”¨çš„åœ°å€ï¼šé˜¿é‡ŒMCP","categories":[],"tags":[{"name":"Agent","slug":"Agent","permalink":"https://flippy-bird.github.io/tags/Agent/"},{"name":"MCP","slug":"MCP","permalink":"https://flippy-bird.github.io/tags/MCP/"}]},{"title":"å¤§æ¨¡å‹å…¥é—¨(ç»„å†…åˆ†äº«)","slug":"å¤§æ¨¡å‹å…¥é—¨-ç»„å†…åˆ†äº«","date":"2025-06-24T13:01:18.000Z","updated":"2026-01-16T10:40:28.949Z","comments":true,"path":"2025/06/24/å¤§æ¨¡å‹å…¥é—¨-ç»„å†…åˆ†äº«/","permalink":"https://flippy-bird.github.io/2025/06/24/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E5%85%A5%E9%97%A8-%E7%BB%84%E5%86%85%E5%88%86%E4%BA%AB/","excerpt":"","text":"èƒŒæ™¯ 2025å¹´å¼€å¹´ä»¥æ¥ï¼Œå¤§å®¶æˆ–å¤šæˆ–å°‘éƒ½å¬è¿‡ä¸‹é¢è¿™äº›è¯ï¼šdeepseekï¼Œ AIï¼Œ äººå·¥æ™ºèƒ½ï¼ŒAgentï¼Œå…·èº«æ™ºèƒ½ï¼› AIåˆ°åº•å‘å±•åˆ°å“ªä¸€æ­¥äº†ï¼Œåˆ©ç”¨AIå¯ä»¥åšå“ªäº›äº‹æƒ…ï¼Œæˆ–è€…ä½œä¸ºæŠ€æœ¯äººå‘˜ï¼Œæƒ³è¦ä½¿ç”¨AIåšä¸€äº›äº‹æƒ…ï¼Œåº”è¯¥å­¦ä¹ é‚£äº›ä¸œè¥¿ï¼Œè¿™ç¯‡å°†å’Œå¤§å®¶ä¸€èµ·æ¢è®¨ä¸‹ã€‚ å¤‡æ³¨å£°æ˜ï¼šè¯¥åˆ†äº«å®šä½è½»ç§‘æ™®å‘ï¼Œä¸ä¼šæ¶‰åŠå¤§æ¨¡å‹ç›¸å…³çš„åº•å±‚åŸç†ï¼Œæœ‰äº›ç»“è®ºå±äºä¸ªäººçš„ç†è§£å’Œæ„Ÿæ‚Ÿï¼Œå¦‚éœ€è¦æ·±å…¥äº¤æµï¼Œæ¬¢è¿å¤§å®¶å’Œæˆ‘æ·±å…¥æ¢è®¨ã€‚ å¤§æ¨¡å‹ç›¸å…³åº”ç”¨Prompt Engineer(æç¤ºè¯)Prompt å’’è¯­ â€”-&gt; æ¿€å‘LLMçš„æ½œèƒ½ 2023å¹´çš„æŸä¸€å¤©ï¼Œå½“ä½ å¼€å§‹å’ŒChatGptäº’åŠ¨çš„é‚£ä¸€åˆ»å¼€å§‹ï¼Œä½ å°±æ˜¯ä¸€ä¸ªPrompt Engineeräº†ï¼ å½“ä½ ä¸æ–­è¯•æ¢GPTï¼Œä½¿ç”¨å„ç§ç­–ç•¥ï¼Œåé—®ï¼Œè¯•æ¢ï¼Œä¸¾ä¸ªä¾‹å­ç­‰ç­‰(ä¸“ä¸šä¸€ç‚¹å°±æ˜¯few shot, zero-shot, cotç­‰ç­‰)ï¼Œæœ€ç»ˆå¾—åˆ°æ­£ç¡®ç­”æ¡ˆæ—¶ï¼Œä½ å…¶å®å·²ç»è·å¾—äº†ä¸€äº›prompt Engineerçš„è®­ç»ƒï¼Œåœ¨ä¸‹ä¸€æ¬¡çš„é—®ç­”ä¸­ï¼Œä½ å°±èƒ½æ›´å¿«æ›´å¥½åœ°å¾—åˆ°ä½ æƒ³è¦çš„ç­”æ¡ˆï¼› å½“ç„¶å•¦ï¼Œç°åœ¨å¤§æ¨¡å‹ä¹ŸæŒºå¤šçš„ï¼Œç¡®å®æœ‰ä¸€äº›æœ´ç´ çš„å’’è¯­æ¡†æ¶å¯ä»¥è®©æˆ‘ä»¬å¿«é€Ÿå¾—åˆ°æ›´å¥½äº†çš„å›ç­”ï¼Œä½ å¦‚æœæƒ³äº†è§£ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªè¯¾ç¨‹ (è¶…çˆ½ä¸­è‹±!) 2025å´æ©è¾¾æœ€å¥½çš„ã€æç¤ºè¯å·¥ç¨‹å¸ˆã€‘æ•™ç¨‹ï¼é™„è¯¾ä»¶ä»£ç  DeepLearning.AI_å¤§æ¨¡å‹_LLM_Prompt_å“”å“©å“”å“©_bilibili å½“ç„¶ï¼Œä¸Šé¢è¯´çš„å’’è¯­æ˜¯GPTå¯¹è¯å½¢å¼çš„ï¼Œæ–‡ç”Ÿå›¾ï¼Œæ–‡ç”Ÿè§†é¢‘ç­‰ç­‰AIGCçš„åº”ç”¨ï¼Œå’’è¯­å¯èƒ½éœ€è¦å¦å¤–ä¹ å¾—(ä½ èŠéº»å¼€é—¨å¯ä»¥å¼€è¿™ä¸ªé—¨ï¼Œå¦å¤–ä¸€ä¸ªé—¨å¯å°±ä¸è¡Œäº†å“¦) SFT(å¾®è°ƒ) å¤§æ¨¡å‹è®­ç»ƒçš„æ—¶å€™ä½¿ç”¨çš„æ˜¯å…¬å¼€çš„æ•°æ®é›†ï¼Œpromptå’’è¯­å¿µå¾—å†å¥½ï¼Œä¹Ÿæ²¡åŠæ³•ï¼Œå·§å¦‡éš¾ä¸ºæ— ç±³ä¹‹ç‚Šï¼Œå¯¹äºç‰¹å®šé¢†åŸŸçš„é—®é¢˜å¤§æ¨¡å‹ä¼šå‡ºç°å¹»è§‰(çå›ç­”) å¤§æ¨¡å‹çš„æ•ˆæœå‡ºç°ä¸€äº›é—®é¢˜ï¼Œéœ€è¦çº æ­£å¤§æ¨¡å‹çš„é”™è¯¯ æ”¹å˜å¤§æ¨¡å‹å›ç­”çš„é£æ ¼ç­‰ç­‰éœ€è¦å®šåˆ¶ï¼Œå°±éœ€è¦å¤§æ¨¡å‹å¾®è°ƒ å¦‚æœå¤§å®¶æƒ³è¦è¿›é˜¶åŠ¨æ‰‹å¾®è°ƒä¸€ä¸‹çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ¡†æ¶ï¼ŒæŒ‰ç…§æ ¼å¼å‡†å¤‡å¥½æ•°æ®å³å¯ï¼Œç„¶åä¸€é”®å¯åŠ¨ï¼Œä¸Šæœºå™¨å¼€å§‹ç‚¼ä¸¹å³å¯ï¼ ç›®å‰ä¸»æµçš„å¾®è°ƒæ¡†æ¶ï¼š https://github.com/hiyouga/LLaMA-Factory https://github.com/unslothai/unsloth https://github.com/modelscope/ms-swift RAGRAG &#x3D; LLM + å¤–ç½®æ•°æ®åº“ â€‹ å¤‡æ³¨ï¼šè¿™éƒ¨åˆ†å†™äº2025å¹´4æœˆ16æ—¥ ç”¨è¿‡GPTçš„åŒå­¦å¯èƒ½ä¼šäº†è§£åˆ°ï¼ŒGPTçš„çŸ¥è¯†å…·æœ‰æ—¶æ•ˆæ€§ï¼Œæ¯”å¦‚GPT-4å‘å¸ƒæ—¶é—´åœ¨2023å¹´ï¼Œé‚£ä¹ˆGPT-4ç»å¯¹æ— æ³•å¸®ä½ å›ç­”2024å¹´ä¹‹åçš„äº‹æƒ…ï¼›å†è€…ï¼Œä½ æœ‰ä¸€ä¸ªæœ¬åœ°çŸ¥è¯†åº“çš„æ—¶å€™ï¼Œä½ éœ€è¦å¤§æ¨¡å‹ç»“åˆè¿™ä¸ªçŸ¥è¯†åº“æ¥å›ç­”ä½ çš„é—®é¢˜æ—¶ï¼Œä½ å¯èƒ½å°±éœ€è¦RAGäº†ï¼› å³è¾¹ä¸¥æ ¼æ¥è¯´ä¸æ˜¯RAGçš„æµç¨‹ï¼Œä½†æ˜¯å¹¿ä¹‰æ¥è®²ï¼Œä¹Ÿç®—RAGï¼Œllmåœ¨å…¶ä¸­æ‰®æ¼”çš„æ˜¯å˜´æ›¿(æ€»ç»“)çš„ä½œç”¨ï¼›å·¦è¾¹è¿™ä¸ªå›¾æ˜¯æ ‡å‡†çš„RAGçš„æµç¨‹ï¼Œä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼šindex(å…¥åº“) å’Œ query(å‡ºåº“) å¦‚æœå¤§å®¶æƒ³è¦æ·±å…¥å­¦ä¹ è¿™ä¸€éƒ¨åˆ†çš„è¯ï¼Œä¸‹é¢æ˜¯ä¸€äº›å¯ä»¥è¿›é˜¶çš„éƒ¨åˆ†ï¼š å½“å‰ä¸¤ä¸ªä¸»æµçš„RAGæ­å»ºæ¡†æ¶(RAGä¼ä¸šçº§å¼€å‘)ï¼š langchainï¼šhttps://github.com/langchain-ai/langchain llamaindexï¼šhttps://github.com/run-llama/llama_index å¯ä»¥å­¦ä¹ çš„å¼€æºé¡¹ç›®ï¼š QAnything: https://github.com/netease-youdao/QAnything RAGflowï¼šhttps://github.com/infiniflow/ragflow/blob/main/README_zh.md å…³äºRAGçš„ä¼˜åŒ–ï¼šRAGæŠ€æœ¯ AgentAgent &#x3D; LLM + å¤–éƒ¨å·¥å…· ä¸Šé¢çš„RAGæ˜¯LLMå’Œå¤–éƒ¨çš„çŸ¥è¯†(æ–‡æ¡£ï¼Œå›¾ç‰‡ç­‰)æ‰“é€šäº†ä¸€æ¡é“¾è·¯ï¼Œç›¸å½“äºåœ¨æ•°æ®å±‚é¢å»ºç«‹äº†è”ç³»ï¼›ä½†æ˜¯ä¸å…·å¤‡æ•°æ®å¤„ç†çš„èƒ½åŠ›ï¼Œè€Œå¤„ç†æ•°æ®çš„èƒ½åŠ›ï¼Œä¸€èˆ¬æ˜¯APIæ˜¯é€šè¿‡APIçš„å½¢å¼æ¥å±•ç°çš„ï¼›**å› æ­¤å½“LLMèƒ½å¤Ÿä½¿ç”¨å¤–éƒ¨çš„ å·¥å…·(API), LLMçš„èƒ½åŠ›å°†å¾—åˆ°æå¤§çš„æ‰©å±• ï¼Œ**ä¸å¤šbbï¼Œå±•ç¤ºï¼ï¼ï¼ https://strudel.cc/ (ä¸‹é¢Agentä½¿ç”¨åˆ°çš„ä¸€ä¸ªéŸ³ä¹å·¥å…·) å¦‚æœæ²¡æœ‰è€å¿ƒçœ‹å®Œå‰é¢Agentæ‰§è¡Œæ­¥éª¤çš„è¯ï¼Œå¯ç›´æ¥æ‹‰åˆ°2ï¼š48ç§’ï¼Œç„¶åçœ‹åé¢çš„å³å¯ å¦‚æœç»™äº†LLMä¸€å°å¯ä»¥è¿è¡Œçš„ç”µè„‘(ç¯å¢ƒ)ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä»Šå¹´3æœˆä»½çˆ†ç«çš„AIæ™ºèƒ½ä½“ Manus ä¸ºä»€ä¹ˆè¦å«Agentå‘¢ï¼Œå¯ä»¥çœ‹ä¸‹é¢çš„å›¾(æ²¡æ‰¾åˆ°æ¯”è¾ƒå¥½çš„å›¾ï¼Œè‡ªå·±ç”»çš„ï¼Œè§è°…)ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·æ¯”ä½œbossï¼Œllmæ¯”ä½œå‘˜å·¥ï¼Œbosså‘å‡ºä¸€ä¸ªé—®é¢˜ä¹‹åï¼Œllmå»è§„åˆ’å¹¶å®Œæˆå·¥ä½œï¼Œllmæ˜¯å…·ä½“çš„æ‰§è¡Œè€…ï¼Œå› æ­¤å«åšä»£ç†,Agent æš‚æ—¶æ— æ³•åœ¨é£ä¹¦æ–‡æ¡£å¤–å±•ç¤ºæ­¤å†…å®¹ ç›®å‰æ™ºèƒ½Agentäº§å“è®¾è®¡ä¸€èˆ¬éƒ½æ˜¯æŒ‰ç…§ä¸Šé¢çš„æ€è·¯å»è¿›è¡Œçš„ï¼Œè§„åˆ’(Plan) + æ‰§è¡Œ(ReActæ¨¡å‹) Agenté€šè¿‡ä¸Šé¢çš„ç« èŠ‚ï¼Œå¯¹Agentè¿›è¡Œäº†ä¸€äº›åˆæ­¥çš„äº†è§£ï¼Œè¿™ä¸ªå°èŠ‚å°†é€šè¿‡ä»£ç è¿›ä¸€æ­¥çš„å¸¦å¤§å®¶äº†è§£Agentç›¸å…³çš„å†…å®¹ Agent æå®æ¯…è®²Agent ä»ä¸Šé¢çš„ä¸€äº›ä¾‹å­æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼Œå¯¹äºå®Œæˆä¸€ä¸ªäººç±»ç›®æ ‡è€Œè¨€ï¼ŒAgentéœ€è¦ä¸¤ä¸ªæ–¹é¢çš„èƒ½åŠ›ï¼Œç›®æ ‡æ‹†è§£çš„èƒ½åŠ›å’Œåˆ†å¸ƒæ‰§è¡Œçš„èƒ½åŠ›ï¼›å¯¹åº”çš„åè¯å³planå’Œfunction callï¼Œæœ‰äº†åˆ†æ­¥çš„ä»»åŠ¡ï¼Œä¹‹åï¼ŒLLM Agenté€æ­¥åˆ†æï¼Œè°ƒç”¨å·¥å…·æˆ–è€…è‡ªèº«å†…éƒ¨çŸ¥è¯†ï¼Œç„¶åå°†ç»“æœä¼ ç»™ä¸‹ä¸€æ­¥çš„ä»»åŠ¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é€šè¿‡ä¸Šé¢çš„æ–¹å¼ï¼Œå¯ä»¥æœ‰å“ªäº›è¿ç”¨å‘¢ï¼Ÿ ç”¨æ¨¡å‹è®­ç»ƒæ¨¡å‹ï¼š ä½¿ç”¨Agentä¸‹å›´æ£‹ï¼Œä½¿ç”¨ç”µè„‘ï¼Œæµè§ˆç½‘é¡µç­‰ç­‰ï¼ å½“ç„¶ä¸Šé¢çš„ä¾‹å­ä¹Ÿè¯´æ˜äº†ï¼Œå¤§æ¨¡å‹åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½å‡ºç°å¹»è§‰ï¼Œè¿™æœ‰å¯èƒ½å¯¼è‡´ä»»åŠ¡æ‰§è¡Œçš„å¤±è´¥ï¼Œæ¯”å¦‚ä¸Šé¢çš„deepseek æ”¹å˜äº†å›½é™…è±¡æ£‹çš„è§„åˆ™ï¼Œç„¶åèµ¢å¾—äº†AIå±Šçš„å›½é™…è±¡æ£‹æ¡‚å† ï¼å› æ­¤å¯¹äºå¤æ‚é—®é¢˜ï¼Œé€‰æ‹©å…¶å®ƒæ–¹æ³•æˆ–è®¸æ›´å¯é ã€‚è¿™é‡Œä¸å†å±•å¼€ã€‚ ä¸Šé¢éƒ½æåˆ°äº†å¤§æ¨¡å‹è¦å®ç°Agentï¼Œéœ€è¦å…·å¤‡å·¥å…·è°ƒç”¨çš„èƒ½åŠ›ï¼Œè¿™ä¸ªèƒ½åŠ›æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿçœ‹å›¾å¥½åƒæŒºç®€å•çš„ä¸€å¥è¯å°±è¯´å®Œäº†ï¼Œå…¶å®å®é™…å‘¢ï¼Œä¹ŸæŒºç®€å•çš„ã€‚ä¸‹é¢é€šè¿‡ä¸€ä¸ªFunction Callçš„ä¾‹å­æ¥ç®€å•è¯´æ˜ä¸€ä¸‹ã€‚ Function call è°ƒç”¨çš„å®ä¾‹ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889import randomfrom datetime import datetimeimport json# step 1: å®šä¹‰å·¥å…·def get_current_time(): current_datetime = datetime.now() formatted_time = current_datetime.strftime(&#x27;%Y-%m-%d %H:%M:%S&#x27;) return f&quot;å½“å‰æ—¶é—´ï¼š&#123;formatted_time&#125;ã€‚&quot;def add(arguments): a = arguments[&quot;num_1&quot;] b = arguments[&quot;num_2&quot;] return f&quot;è®¡ç®—çš„ç»“æœæ˜¯ï¼š&#123;a + b&#125;&quot;# step 2: åˆ›å»ºtoolsæ•°ç»„tools = [ &#123; &quot;type&quot;: &quot;function&quot;, &quot;function&quot;: &#123; &quot;name&quot;: &quot;get_current_time&quot;, &quot;description&quot;: &quot;å½“ä½ æƒ³çŸ¥é“ç°åœ¨çš„æ—¶é—´æ—¶éå¸¸æœ‰ç”¨ã€‚&quot;, &#125; &#125;,]tool_name = [tool[&quot;function&quot;][&quot;name&quot;] for tool in tools]# step 3ï¼šä½¿ç”¨å¤§æ¨¡å‹è°ƒç”¨å‡½æ•°from openai import OpenAIimport osclient = OpenAI( api_key=&quot;sk-389c222d8f304e6ba3bb10ad3589d340&quot;, base_url=&quot;https://dashscope.aliyuncs.com/compatible-mode/v1&quot;,)messages = [ &#123; &quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªå¾ˆæœ‰å¸®åŠ©çš„åŠ©æ‰‹ã€‚å¦‚æœç”¨æˆ·æé—®å…³äºæ—¶é—´çš„é—®é¢˜ï¼Œè¯·è°ƒç”¨â€˜get_current_timeâ€™å‡½æ•°ã€‚ è¯·ä»¥å‹å¥½çš„è¯­æ°”å›ç­”é—®é¢˜ã€‚&quot;&quot;&quot;, &#125;, &#123; &quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;ç°åœ¨æ˜¯å‡ ç‚¹ï¼Ÿ&quot; &#125;]def function_calling(): completion = client.chat.completions.create( model=&quot;qwen-max&quot;, messages=messages, tools=tools, ) res = completion.choices[0].message print(res.model_dump_json()) return completion# step4: è¿è¡Œå·¥å…·å‡½æ•°completion = function_calling()function_name = completion.choices[0].message.tool_calls[0].function.namearguments_string = completion.choices[0].message.tool_calls[0].function.arguments# ä½¿ç”¨jsonæ¨¡å—è§£æå‚æ•°å­—ç¬¦ä¸²arguments = json.loads(arguments_string)# åˆ›å»ºä¸€ä¸ªå‡½æ•°æ˜ å°„è¡¨function_mapper = &#123; &quot;get_current_time&quot;: get_current_time, &quot;add&quot;:add&#125;# è·å–å‡½æ•°å®ä½“function = function_mapper[function_name]# å¦‚æœå…¥å‚ä¸ºç©ºï¼Œåˆ™ç›´æ¥è°ƒç”¨å‡½æ•°if arguments == &#123;&#125;: function_output = function()# å¦åˆ™ï¼Œä¼ å…¥å‚æ•°åè°ƒç”¨å‡½æ•°else: function_output = function(arguments)# æ‰“å°å·¥å…·çš„è¾“å‡ºprint(f&quot;å·¥å…·å‡½æ•°è¾“å‡ºï¼š&#123;function_output&#125;\\n&quot;)## step5ï¼š å°†å·¥å…·è¾“å‡ºæ·»åŠ åˆ°messagesä¸­ï¼Œç»§ç»­è¿›è¡Œä¸‹é¢çš„æ­¥éª¤messages.append(completion.choices[0].message)messages.append(&#123;&quot;role&quot;: &quot;tool&quot;, &quot;content&quot;: function_output, &quot;tool_call_id&quot;: completion.choices[0].message.tool_calls[0].id&#125;)print(&quot;å·²æ·»åŠ tool message\\n&quot;)completion = function_calling() WorkFlow - ç¼–æ’çš„Agentä¸Šé¢æåˆ°ï¼Œå¯¹äºå¤æ‚ä»»åŠ¡ï¼Œå®Œå…¨è®©å¤§æ¨¡å‹å»è§„åˆ’ï¼Œå»è‡ªç”±æ¢ç´¢ï¼Œå¯èƒ½å‡ºç°å¾ˆå¤šä¸å¯é¢„çŸ¥çš„é—®é¢˜ï¼Œè¿™å¯¹äºä¸€äº›ç¡®å®šæ€§çš„ä»»åŠ¡æ¥è¯´ï¼Œæ˜¯å¾ˆè‡´å‘½çš„ï¼Œæ—¢ç„¶è¿™æ ·ï¼Œé‚£ä¹ˆå°±åˆ«è®©å¤§æ¨¡å‹é€èƒ½ï¼Œè„šè¸å®åœ°ï¼Œåªè§£å†³å…·ä½“çš„å•æ­¥é—®é¢˜ï¼Œè§„åˆ’é—®é¢˜è®©äººç±»æ¥å¹²å°±å¥½äº†ï¼Œè¿™å°±æ˜¯workflowï¼Œè¿™å°±æ˜¯æˆªæ­¢åˆ°2025å¹´4æœˆ20æ—¥æ¥æœ€ä¸»æµçš„Agent å®ç°æ–¹å¼ï¼› MCPä¸Šé¢æ˜¯é€šä¹‰åƒé—®çš„Function è°ƒç”¨æ–¹å¼ï¼Œä¸‹æ¬¡æˆ‘ä»¬å†æ·»åŠ ä¸€ä¸ªæ–°çš„å·¥å…·çš„æ—¶å€™ï¼Œæ˜¯ä¸æ˜¯åˆè¦é‡å¤å†™ä¸€ä¸‹è¿™ä¸ªæµç¨‹(å®šä¹‰å·¥å…·ï¼Œå®šä¹‰å·¥å…·æè¿°ï¼Œç„¶åä¼ ç»™å¤§æ¨¡å‹)ï¼Œ ä½†æ˜¯ç°åœ¨å¤§æ¨¡å‹è¿™ä¹ˆå¤šï¼Œå¤§æ¨¡å‹ä¹‹é—´çš„Function Callçš„æ–¹å¼å¯èƒ½ä¸ç›¸åŒï¼Œè¿™é‡Œå†™çš„å·¥å…·å‡½æ•°ï¼Œæ¢åˆ°GPT4ï¼Œå¯èƒ½å°±è¦ä¿®æ”¹ä»£ç ï¼Œè¿™æ ·å¾ˆä¸ç¬¦åˆç¨‹åºå‘˜çš„å¤ç”¨è§„åˆ™ï¼Œå› æ­¤æœ‰äº†MCP MCPå…¶å®è¿˜æ˜¯å¤§æ¨¡å‹é€‰æ‹©éœ€è¦è°ƒç”¨çš„å·¥å…·ï¼Œå› æ­¤MCPæœ¬è´¨è¿˜æ˜¯Function Callï¼Œ åªæ˜¯ç»Ÿä¸€äº†ä¸€ä¸ªæ ‡å‡†ä¹‹åï¼Œå¼€å‘è€…é€šè¿‡MCPåè®®å†™çš„Functionå¯ä»¥ç»™åˆ«äººå¤ç”¨äº† å¦‚æœæƒ³æ·±å…¥äº†è§£çš„è¯ï¼Œå¤§å®¶å¯ä»¥å¯¹ç…§ç€å®˜æ–¹ä»£ç å†™ä¸€éï¼Œå°±ä¼šå‘ç°äº†MCPè§£å†³çš„æ˜¯å“ªä¸€æ–¹é¢çš„é—®é¢˜äº†ï¼› A2Aï¼ŒANPç­‰ç­‰A2Aï¼šè°·æ­Œæå‡ºæ¥çš„ä¸€ç§ Agent å’Œ Agentç›¸äº’é€šä¿¡çš„åè®®ï¼Œ MCPåè®®ç»Ÿä¸€äº†å¤§æ¨¡å‹ä¸å¤–ç•Œå·¥å…·äº¤äº’çš„æ–¹å¼ï¼ŒA2Aæ˜¯Agentä¸Agenté—´çš„ï¼Œå¯ä»¥ç±»æ¯”æˆå…¬å¸é‡Œé¢éƒ¨é—¨ï¼Œæ¯ä¸ªéƒ¨é—¨æ‰¿æ‹…ä¸€éƒ¨åŠŸèƒ½(å¦‚å‰ç«¯ï¼Œåç«¯ï¼Œæ•°æ®ï¼Œç®—æ³•ï¼ŒHRï¼Œè´¢åŠ¡ï¼Œè¿ç»´ç­‰)ï¼Œç„¶åç›¸äº’åä½œï¼Œå…±åŒè¾¾æˆä¸€ä¸ªç›®æ ‡ï¼› ANPï¼šå›½å†…æå‡ºçš„ç±»ä¼¼äºA2Açš„ï¼Œç”¨äºAgent2Agentçš„åè®®ï¼Œç›®å‰æ˜¯æˆä¸ºäº’è”ç½‘ç•Œçš„http . . . . . æ— è®ºæ˜¯MCPï¼Œè¿˜æ˜¯A2Aï¼ŒæŠ‘æˆ–è€…æ˜¯å…¶å®ƒåè®®ï¼Œæˆ‘è§‰å¾—å½’æ ¹åˆ°åº•æ˜¯ä»Šå¹´è‡ªdeepseekä»¥æ¥ï¼Œ**å¤§æ¨¡å‹çš„èƒ½åŠ›å¾—åˆ°äº†è¾ƒå¤§çš„æå‡ï¼Œ**è¿™ä¸ªç”Ÿæ€æ‰æ…¢æ…¢ç«èµ·æ¥(2024å¹´å¼€å¹´ç«äº†ä¸€é˜µå°±æ²¡å£°éŸ³äº†ï¼Œå› ä¸ºAgentæœ‰ç‚¹äººå·¥æ™ºéšœçš„å‘³é“)ï¼Œè‡³äºAgentæœ‰å¤šæ™ºèƒ½ï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯è®©å­å¼¹é£ä¸€ä¼šå„¿ï¼Œä½†æ˜¯åœ¨å°çš„æ–¹é¢ï¼Œç¡®å®ä¼šå½±å“æˆ‘ä»¬çš„å·¥ä½œæ•ˆç‡ï¼›æ°å½“çš„ä½¿ç”¨llmæ¥ååŠ©æˆ‘ä»¬å·¥ä½œï¼Œèƒ½åšåˆ°äº‹åŠåŠŸå€ï¼› å¥½ç‰©æ¨èç¼–ç¨‹å·¥å…·ç±»ï¼š Cursor (ç›®å‰æœ€å¥½çš„AIä»£ç ç¼–è¾‘å™¨ï¼Œå°±æ˜¯æœ‰ç‚¹å°è´µï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯VScodeé€šä¹‰çµç æ’ä»¶æ›¿ä»£) Trae (å­—èŠ‚å‡ºå“ï¼Œ å›½äº§ç¬¬ä¸€ä¸ªæœ‰çŸ¥ååº¦çš„AIä»£ç ç¼–è¾‘å™¨(å½“ç„¶ï¼ŒæŠ•æµï¼Œå¹¿å‘ŠæŠ•å…¥å¾ˆå¤§)) å¼€å‘æ¡†æ¶ç±»:ï¼ˆè¿˜æ˜¯ä¸Šé¢é‚£ä¸¤ä¸ªï¼‰ langchainï¼šhttps://github.com/langchain-ai/langchain llamaindexï¼šhttps://github.com/run-llama/llama_index (ä¸ªäººå¸¸ç”¨è¿™ä¸ªï¼Œæ•™ç¨‹å¾ˆå‹å¥½ï¼Œ ä½†æ˜¯ç›®å‰langchainå‘å±•æ›´å¥½ä¸€äº›) é›¶ä»£ç ç±»å¤§æ¨¡å‹ç¼–æ’å·¥å…·(é€‚åˆAIè¡Œä¸šçš„æ‰€æœ‰äºº) æè¿‡comfyUIçš„åŒå­¦åº”è¯¥çŸ¥é“èŠ‚ç‚¹ç¼–è¾‘å·¥å…·çš„æ¦‚å¿µï¼Œè¿™ä¸ªå°±æ˜¯llmè¿™è¾¹çš„èŠ‚ç‚¹ç¼–è¾‘å·¥å…· dify : ä¼ä¸šçº§çš„ï¼Œç›®å‰å¤§å¤šæ•°å·¥å…·å¼€å‘AIæµç¨‹åº”ç”¨çš„é¦–é€‰ n8n ï¼šåŒä¸Šï¼Œä¼˜åŠ¿åœ¨é›†æˆäº†å¾ˆå¤šçš„å·¥å…· æ‰£å­ ï¼š å­—èŠ‚å‡ºå“ï¼Œå’Œdifyç±»ä¼¼ ä¸¾ä¸ªdifyçš„ä¾‹å­ï¼š æœ¬æ¥æƒ³æ¼”ç¤ºä¸€ä¸ªä½¿ç”¨difyæ­å»ºå°å½±çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿçš„demoï¼Œä½†æ˜¯è²Œä¼¼é£ä¹¦æ–‡æ¡£æƒé™æ¯”è¾ƒä¸¥æ ¼&#x3D;_&#x3D;#ï¼Œå› æ­¤è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹ï¼› ä»¥ç¿»è¯‘çš„ä»»åŠ¡ä¸¾ä¸ªä¾‹å­(ç›®å‰ä¸»æµç¿»è¯‘çš„æµç¨‹)ï¼šé€šè¿‡æ­ç§¯æœ¨çš„æ–¹å¼ï¼Œ20åˆ†é’Ÿ(2åˆ†é’Ÿæ­å»ºï¼Œ18åˆ†é’Ÿçš„æç¤ºè¯) å³å¯å¿«é€Ÿå®Œæˆä¸€ä¸ªä»»åŠ¡çš„æ­å»º å¦å¤–ï¼Œæ¯”è¾ƒå–œæ¬¢çš„ä¸€ä¸ªåŠŸèƒ½æ˜¯ä¸åŒæ¨¡å‹çš„å¯¹æ¯”ï¼Œæˆ‘è§‰å¾—åœ¨éªŒè¯é˜¶æ®µå¾ˆå®ç”¨ ç°åœºæ¼”ç¤ºAgentcline + MCP MCPå‘å±•å¾—å¦‚ç«å¦‚è¼ï¼Œå¼€æºç¤¾åŒºä¸Šä¹Ÿæœ‰å¾ˆå¤šå¥½ç©çš„MCPå·¥å…·äº†ï¼Œå¤§å®¶å¯ä»¥å°è¯•ä¸€ä¸‹ æƒ³ä¸€æƒ³ï¼šå¤§å®¶ç°åœ¨çœ‹åˆ°è¿™ä¸ªçƒ­ç‚¹ï¼Œå¤§å®¶è§‰å¾—æ˜¯é€šè¿‡ä»€ä¹ˆå®ç°çš„ï¼Ÿ difyima (å¥½ç”¨çš„ç»“åˆRAGçš„æ–‡æ¡£å·¥å…·)","categories":[],"tags":[{"name":"LLM","slug":"LLM","permalink":"https://flippy-bird.github.io/tags/LLM/"},{"name":"Agent","slug":"Agent","permalink":"https://flippy-bird.github.io/tags/Agent/"}]},{"title":"RAGä¼˜åŒ–","slug":"RAGä¼˜åŒ–","date":"2025-04-21T08:10:12.000Z","updated":"2026-01-16T10:40:28.950Z","comments":true,"path":"2025/04/21/RAGä¼˜åŒ–/","permalink":"https://flippy-bird.github.io/2025/04/21/RAG%E4%BC%98%E5%8C%96/","excerpt":"","text":"1. åŸºæœ¬çš„RAGæµç¨‹-Native RAG 2. RAGä¼˜åŒ–2.1 ä¼˜åŒ–chunkä¼ ç»Ÿçš„RAGåœ¨æ•°æ®åˆ†å—æ—¶é‡‡ç”¨çš„æ˜¯å›ºå®šåˆ†å—ï¼Œå› ä¸ºå¯èƒ½ä¼šç ´åæ®µè½çš„è¿ç»­æ€§ï¼Œå› æ­¤è¿™ä¸€æ–¹é¢å¯ä»¥æ”¹è¿› 2.1.1 æ‹¼æ¥æ–­è£‚çš„å— å°†å›ºå®šåˆ†å—çš„æ–­è£‚éƒ¨åˆ†æ‰¾åˆ°ï¼Œç„¶åæ‹¼æ¥èµ·æ¥ï¼› 123456789101112131415161718192021222324252627282930313233def compute_breakpoints(similarities, method=&quot;percentile&quot;, threshold=90): &quot;&quot;&quot; Computes chunking breakpoints based on similarity drops. Args: similarities (List[float]): List of similarity scores between sentences. method (str): &#x27;percentile&#x27;, &#x27;standard_deviation&#x27;, or &#x27;interquartile&#x27;. threshold (float): Threshold value (percentile for &#x27;percentile&#x27;, std devs for &#x27;standard_deviation&#x27;). Returns: List[int]: Indices where chunk splits should occur. &quot;&quot;&quot; # Determine the threshold value based on the selected method if method == &quot;percentile&quot;: # Calculate the Xth percentile of the similarity scores threshold_value = np.percentile(similarities, threshold) elif method == &quot;standard_deviation&quot;: # Calculate the mean and standard deviation of the similarity scores mean = np.mean(similarities) std_dev = np.std(similarities) # Set the threshold value to mean minus X standard deviations threshold_value = mean - (threshold * std_dev) elif method == &quot;interquartile&quot;: # Calculate the first and third quartiles (Q1 and Q3) q1, q3 = np.percentile(similarities, [25, 75]) # Set the threshold value using the IQR rule for outliers threshold_value = q1 - 1.5 * (q3 - q1) else: # Raise an error if an invalid method is provided raise ValueError(&quot;Invalid method. Choose &#x27;percentile&#x27;, &#x27;standard_deviation&#x27;, or &#x27;interquartile&#x27;.&quot;) # Identify indices where similarity drops below the threshold value return [i for i, sim in enumerate(similarities) if sim &lt; threshold_value] 2.1.2 ä½¿ç”¨ä¸åŒçš„åˆ†å—å¤§å° (ä¾‹å¦‚åŸæ¥æ˜¯256ï¼Œ ç°åœ¨è¯•ä¸€è¯•512ï¼Œ 1000ç­‰ç­‰)ï¼› 2.1.3 æ€»ç»“chunk chunk Embeddingä¹‹åç¼ºä¹è¯­ä¹‰ä¿¡æ¯ï¼Œåœ¨chunk Embeddingä¹‹å‰ ç»™æ¯ä¸€ä¸ªchunkæ·»åŠ ä¸€ä¸ªmeta data, ä¸€èˆ¬æ˜¯å¯¹è¿™æ®µtextçš„æ€»ç»“ï¼Œå¦‚æ ‡é¢˜ç­‰(å¯ä»¥ä½¿ç”¨LLMæ¥ååŠ©), åœ¨æŸ¥è¯¢æ—¶ï¼Œ ä½¿ç”¨çš„æ˜¯ä¸¤ä¸ªä¿¡æ¯ç›¸ä¼¼åº¦çš„å¹³å‡å€¼ ï¼ˆè¿™ä¸ªdemoï¼‰ 1234567891011121314151617181920212223242526272829303132333435system_prompt = &quot;Generate a concise and informative title for the given text.&quot;# **************************** step 2 *********************************chunks = [] # Initialize an empty list to store chunks# Iterate through the text with the specified chunk size and overlapfor i in range(0, len(text), n - overlap): chunk = text[i:i + n] # Extract a chunk of text header = generate_chunk_header(chunk) # Generate a header for the chunk using LLM chunks.append(&#123;&quot;header&quot;: header, &quot;text&quot;: chunk&#125;) # Append the header and chunk to the listreturn chunks # Return the list of chunks with headers# *************************** step 3 **********************************for chunk in tqdm(text_chunks, desc=&quot;Generating embeddings&quot;): # Create an embedding for the chunk&#x27;s text text_embedding = create_embeddings(chunk[&quot;text&quot;]) # Create an embedding for the chunk&#x27;s header header_embedding = create_embeddings(chunk[&quot;header&quot;]) # Append the chunk&#x27;s header, text, and their embeddings to the list embeddings.append(&#123;&quot;header&quot;: chunk[&quot;header&quot;], &quot;text&quot;: chunk[&quot;text&quot;], &quot;embedding&quot;: text_embedding, &quot;header_embedding&quot;: header_embedding&#125;) # ****************************** step 4**************************************# Iterate through each chunk to calculate similarity scoresfor chunk in chunks: # Compute cosine similarity between query embedding and chunk text embedding sim_text = cosine_similarity(np.array(query_embedding), np.array(chunk[&quot;embedding&quot;])) # Compute cosine similarity between query embedding and chunk header embedding sim_header = cosine_similarity(np.array(query_embedding), np.array(chunk[&quot;header_embedding&quot;])) # Calculate the average similarity score avg_similarity = (sim_text + sim_header) / 2 # Append the chunk and its average similarity score to the list similarities.append((chunk, avg_similarity)) 2.1.4 æé—®chunk åŒä¸Šï¼Œä¸è¿‡è¿™é‡Œæ”¹å˜äº†æ–¹å‘ï¼Œæ˜¯ä»chunkä¸­æå–é—®é¢˜ï¼Œè€Œä¸æ˜¯æ€»ç»“ï¼Œæ¢æ±¤ä¸æ¢è¯ï¼Œ æ³¨æ„è¿™é‡Œçš„æ˜¯ é—®é¢˜ + chunk text å‘é‡åŒ–ä¹‹åä¸€èµ· è¿›è¡Œæ£€ç´¢ï¼Œç„¶åæ‰¾å‡ºtop-k 1234567891011# Define the system prompt to guide the AI&#x27;s behaviorsystem_prompt = &quot;You are an expert at generating relevant questions from text. Create concise questions that can be answered using only the provided text. Focus on key information and concepts.&quot;# Define the user prompt with the text chunk and the number of questions to generateuser_prompt = f&quot;&quot;&quot;Based on the following text, generate &#123;num_questions&#125; different questions that can be answered using only this text:&#123;text_chunk&#125;Format your response as a numbered list of questions only, with no additional text.&quot;&quot;&quot; 2.1.5 æå–chunkï¼Œä¸é‡‡ç”¨å›ºå®šchunk size Proposition Chunking ä»…ä»…é‡‡ç”¨å›ºå®šåˆ†å—ï¼Œé—®é¢˜å¤ªå¤šï¼Œä¼šç ´åå¥å­çš„è¯­ä¹‰ï¼Œå¥å­ä¸å®Œæ•´æ—¶ä¼šäº§ç”Ÿæ­§ä¹‰ç­‰, å› æ­¤è¿™ç§æ–¹æ³•æ˜¯ä»æ¯ä¸ªchunkä¸­æå–æœ‰ç”¨çš„å…³é”®ä¿¡æ¯ä½œä¸ºæ–°çš„chunk (è¿™é‡Œä¹Ÿæ˜¯ä½¿ç”¨LLMæ¥åˆ†å¥çš„) ä¸»è¦æ˜¯ä¸¤æ­¥ï¼šåˆ†æ®µ ç„¶åè¯„ä¼°ç­›é€‰å‡ºæœ€ç¬¦åˆçš„ 123456789101112131415161718192021222324252627282930313233############### äº§ç”Ÿæ–°çš„chunk# System prompt to instruct the AI on how to generate propositionssystem_prompt = &quot;&quot;&quot;Please break down the following text into simple, self-contained propositions. Ensure that each proposition meets the following criteria:1. Express a Single Fact: Each proposition should state one specific fact or claim.2. Be Understandable Without Context: The proposition should be self-contained, meaning it can be understood without needing additional context.3. Use Full Names, Not Pronouns: Avoid pronouns or ambiguous references; use full entity names.4. Include Relevant Dates/Qualifiers: If applicable, include necessary dates, times, and qualifiers to make the fact precise.5. Contain One Subject-Predicate Relationship: Focus on a single subject and its corresponding action or attribute, without conjunctions or multiple clauses.Output ONLY the list of propositions without any additional text or explanations.&quot;&quot;&quot;# User prompt containing the text chunk to be converted into propositionsuser_prompt = f&quot;Text to convert into propositions:\\n\\n&#123;chunk[&#x27;text&#x27;]&#125;&quot;################# è¯„ä¼°æ–°chunkçš„è´¨é‡ (ç»“åˆåŸå§‹çš„chunk)# System prompt to instruct the AI on how to evaluate the propositionsystem_prompt = &quot;&quot;&quot;You are an expert at evaluating the quality of propositions extracted from text.Rate the given proposition on the following criteria (scale 1-10):- Accuracy: How well the proposition reflects information in the original text- Clarity: How easy it is to understand the proposition without additional context- Completeness: Whether the proposition includes necessary details (dates, qualifiers, etc.)- Conciseness: Whether the proposition is concise without losing important informationThe response must be in valid JSON format with numerical scores for each criterion:&#123;&quot;accuracy&quot;: X, &quot;clarity&quot;: X, &quot;completeness&quot;: X, &quot;conciseness&quot;: X&#125;&quot;&quot;&quot;# User prompt containing the proposition and the original textuser_prompt = f&quot;&quot;&quot;Proposition: &#123;proposition&#125; 2.2 ä¼˜åŒ–å¤„ç†è¿‡ç¨‹2.2.1 åˆ†å±‚RAGä¼ ç»Ÿçš„RAGå½“ textå¾ˆå¤§æ—¶ï¼Œchunkå°±å¾ˆå¤šï¼ŒåŒ¹é…chunkç¼ºä¹ä¸Šä¸‹æ–‡ï¼Œè€Œä¸”æ¯ä¸€ä¸ªchunkéƒ½åšç›¸ä¼¼åº¦è®¡ç®—ï¼Œè®¡ç®—é‡å¤§ï¼Œæ•ˆç‡ä½ï¼Œå› æ­¤åˆ†å±‚RAGçš„æ€æƒ³æ˜¯ï¼Œå…ˆå¯¹æ¯ä¸€é¡µåšä¸€ä¸ªæ€»ç»“ï¼Œå…ˆåœ¨æ€»ç»“ä¸­æ‰¾åˆ°ç›¸å…³ä¿¡æ¯ï¼Œç„¶åå†åœ¨å¯¹åº”çš„é¡µä¸­å»æ‰¾ç›¸å…³çš„è¯¦ç»†ä¿¡æ¯ 1234567############## æ€»ç»“çš„prompt# Define the system prompt to instruct the summarization modelsystem_prompt = &quot;&quot;&quot;You are an expert summarization system.Create a detailed summary of the provided text. Focus on capturing the main topics, key information, and important facts.Your summary should be comprehensive enough to understand what the page containsbut more concise than the original.&quot;&quot;&quot; 2.2.2 GraphRAGå¯å‚è€ƒï¼šGraphRAGå¿«é€Ÿå…¥é—¨ä¸åŸç†è¯¦è§£ å®ä½“æå– (Node, èŠ‚ç‚¹)ï¼šåˆ©ç”¨LLMè¿›è¡Œå®ä½“çš„æå–ï¼Œè¿™äº›å®ä½“é€šå¸¸æ˜¯æŒ‡æ–‡æ¡£ä¸­å‡ºç°çš„äººç‰©ã€åœ°ç‚¹ã€ç»„ç»‡ã€æ¦‚å¿µç­‰ä¿¡æ¯ã€‚ å…³ç³»æå–(Edageï¼Œ è¾¹)ï¼šå…³ç³»æŒ–æ˜æ˜¯ä»æ–‡æœ¬ä¸­è¯†åˆ«å‡ºå®ä½“ä¹‹é—´çš„ å…³ç³»ï¼Œä¾‹å¦‚ï¼šè°ä¸è°æœ‰å…³è”ã€æŸä¸ªå®ä½“ä¸å¦ä¸€ä¸ªå®ä½“ä¹‹é—´çš„å…³ç³»æ˜¯â€œå±äºâ€ã€â€œåˆä½œâ€ã€â€œå¯¹ç«‹â€ç­‰ã€‚ Community(ä¸­æ–‡ç¿»è¯‘æˆç¤¾åŒºï¼Œæ„Ÿè§‰çœŸçš„å¾ˆå¥‡æ€ªï¼Œç›´æ¥ä½¿ç”¨è‹±æ–‡å°±å¥½) æ„å»ºï¼š æ„Ÿè§‰æ˜¯ä¸ºäº†å°†ä¸åŒéƒ¨åˆ†çš„ä¿¡æ¯è”ç³»èµ·æ¥ é€šè¿‡ä½¿ç”¨ å›¾è°±èšç±»ç®—æ³•ï¼ˆå¦‚ Leiden ç®—æ³•ï¼‰ï¼ŒGraphRAG ä¼šå°†ä¸åŒçš„å®ä½“å’Œå…³ç³»åˆ†ç»„ï¼Œå½¢æˆå¤šä¸ª ç¤¾åŒºï¼ˆCommunityï¼‰ã€‚è¿™äº›ç¤¾åŒºæ˜¯æ ¹æ®å®ä½“ä¹‹é—´çš„ç›¸ä¼¼åº¦æˆ–å…³ç³»çš„å¯†åˆ‡ç¨‹åº¦è¿›è¡Œåˆ’åˆ†çš„ã€‚è¿™ç§åˆ†ç»„å¸®åŠ© GraphRAG æ›´å¥½åœ°ç†è§£ä¸åŒçŸ¥è¯†é¢†åŸŸçš„ç»“æ„ï¼Œ 2.2.3 KAGhttps://github.com/OpenSPG/KAG/blob/master/README_cn.md 2.3 åå¤„ç†ç”±äºå›ºå®šåˆ†å—ä¼šç ´åå¥å­çš„è¿ç»­æ€§ 2.3.1 å¢åŠ ç›¸é‚»ä¸Šä¸‹æ–‡ åœ¨æ£€ç´¢è¿™ä¸€æ­¥æ—¶ï¼Œå°†æ£€ç´¢åˆ°çš„ç›¸é‚»chunkä¹ŸåŒ…å«è¿›æ¥ä»¥å¢åŠ ä¸Šä¸‹æ–‡ï¼Œå‡å°‘ä¿¡æ¯çš„æŸå¤± 2.3.2 ReRank ReRank å°±æ˜¯è§‰å¾—é€šè¿‡è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦çš„æ–¹å¼å¾—åˆ°çš„ç›¸ä¼¼åº¦å…·æœ‰ä¸€å®šçš„å¯ä¿¡åº¦ï¼Œä½†æ˜¯ä¸é«˜ï¼Œå› æ­¤ä½¿ç”¨å…¶å®ƒæ–¹æ³•å¯¹å¾—åˆ°çš„top-kè¿›è¡Œé‡æ’åºï¼Œç„¶åé€‰æ‹©ç›¸å…³åº¦æœ€é«˜çš„å‡ ä¸ªç­”æ¡ˆ(ä¸€èˆ¬ä½¿ç”¨LLMæ¥å®ç°) 12345678910system_prompt = &quot;&quot;&quot;You are an expert at evaluating document relevance for search queries.Your task is to rate documents on a scale from 0 to 10 based on how well they answer the given query.Guidelines:- Score 0-2: Document is completely irrelevant- Score 3-5: Document has some relevant information but doesn&#x27;t directly answer the query- Score 6-8: Document is relevant and partially answers the query- Score 9-10: Document is highly relevant and directly answers the queryYou MUST respond with ONLY a single integer score between 0 and 10. Do not include ANY other text.&quot;&quot;&quot; ä¹Ÿå¯ä»¥ä½¿ç”¨å…³é”®è¯çš„æ–¹å¼ 1234567891011121314151617181920212223242526272829# Extract important keywords from the querykeywords = [word.lower() for word in query.split() if len(word) &gt; 3]scored_results = [] # Initialize a list to store scored resultsfor result in results: document_text = result[&quot;text&quot;].lower() # Convert document text to lowercase # Base score starts with vector similarity base_score = result[&quot;similarity&quot;] * 0.5 # Initialize keyword score keyword_score = 0 for keyword in keywords: if keyword in document_text: # Add points for each keyword found keyword_score += 0.1 # Add more points if keyword appears near the beginning first_position = document_text.find(keyword) if first_position &lt; len(document_text) / 4: # In the first quarter of the text keyword_score += 0.1 # Add points for keyword frequency frequency = document_text.count(keyword) keyword_score += min(0.05 * frequency, 0.2) # Cap at 0.2 # Calculate the final score by combining base score and keyword score final_score = base_score + keyword_score 2.3.3 å¢åŠ ä¸Šä¸‹æ–‡-v2 è®¡ç®—è¿ç»­chunk (åˆ†æ®µ)çš„æ€»ç›¸å…³æ€§ï¼Œç„¶åè¾“å‡º top-k ä¸ªåˆ†æ®µ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960def find_best_segments(chunk_values, max_segment_length=20, total_max_length=30, min_segment_value=0.2): &quot;&quot;&quot; Find the best segments using a variant of the maximum sum subarray algorithm. Args: chunk_values (List[float]): Values for each chunk max_segment_length (int): Maximum length of a single segment total_max_length (int): Maximum total length across all segments min_segment_value (float): Minimum value for a segment to be considered Returns: List[Tuple[int, int]]: List of (start, end) indices for best segments &quot;&quot;&quot; print(&quot;Finding optimal continuous text segments...&quot;) best_segments = [] segment_scores = [] total_included_chunks = 0 # Keep finding segments until we hit our limits while total_included_chunks &lt; total_max_length: best_score = min_segment_value # Minimum threshold for a segment best_segment = None # Try each possible starting position for start in range(len(chunk_values)): # Skip if this start position is already in a selected segment if any(start &gt;= s[0] and start &lt; s[1] for s in best_segments): continue # Try each possible segment length for length in range(1, min(max_segment_length, len(chunk_values) - start) + 1): end = start + length # Skip if end position is already in a selected segment if any(end &gt; s[0] and end &lt;= s[1] for s in best_segments): continue # Calculate segment value as sum of chunk values segment_value = sum(chunk_values[start:end]) # Update best segment if this one is better if segment_value &gt; best_score: best_score = segment_value best_segment = (start, end) # If we found a good segment, add it if best_segment: best_segments.append(best_segment) segment_scores.append(best_score) total_included_chunks += best_segment[1] - best_segment[0] print(f&quot;Found segment &#123;best_segment&#125; with score &#123;best_score:.4f&#125;&quot;) else: # No more good segments to find break # Sort segments by their starting position for readability best_segments = sorted(best_segments, key=lambda x: x[0]) return best_segments, segment_scores 2.3.4 ä½¿ç”¨LLMè¿‡æ»¤æ— æ•ˆä¿¡æ¯ ä½¿ç”¨LLMå¯¹top-kçš„chunk textè¿›è¡Œåˆ¤æ–­ï¼Œè¿‡æ»¤ï¼Œç„¶åå¸®åŠ©æˆ‘ä»¬ç­›é€‰å‡ºæœ€ç¬¦åˆçš„ä¿¡æ¯ï¼Œä¸‹é¢æ˜¯å®ç°çš„ä¸‰ç§æ–¹å¼ 123456789101112131415161718192021222324252627282930313233343536373839404142434445if compression_type == &quot;selective&quot;: system_prompt = &quot;&quot;&quot;You are an expert at information filtering. Your task is to analyze a document chunk and extract ONLY the sentences or paragraphs that are directly relevant to the user&#x27;s query. Remove all irrelevant content. Your output should: 1. ONLY include text that helps answer the query 2. Preserve the exact wording of relevant sentences (do not paraphrase) 3. Maintain the original order of the text 4. Include ALL relevant content, even if it seems redundant 5. EXCLUDE any text that isn&#x27;t relevant to the query Format your response as plain text with no additional comments.&quot;&quot;&quot;elif compression_type == &quot;summary&quot;: system_prompt = &quot;&quot;&quot;You are an expert at summarization. Your task is to create a concise summary of the provided chunk that focuses ONLY on information relevant to the user&#x27;s query. Your output should: 1. Be brief but comprehensive regarding query-relevant information 2. Focus exclusively on information related to the query 3. Omit irrelevant details 4. Be written in a neutral, factual tone Format your response as plain text with no additional comments.&quot;&quot;&quot;else: # extraction system_prompt = &quot;&quot;&quot;You are an expert at information extraction. Your task is to extract ONLY the exact sentences from the document chunk that contain information relevant to answering the user&#x27;s query. Your output should: 1. Include ONLY direct quotes of relevant sentences from the original text 2. Preserve the original wording (do not modify the text) 3. Include ONLY sentences that directly relate to the query 4. Separate extracted sentences with newlines 5. Do not add any commentary or additional text Format your response as plain text with no additional comments.&quot;&quot;&quot;# Define the user prompt with the query and document chunkuser_prompt = f&quot;&quot;&quot; Query: &#123;query&#125; Document Chunk: &#123;chunk&#125; Extract only the content relevant to answering this query.&quot;&quot;&quot; 2.3.5 ä¼˜åŒ–æ£€ç´¢ç­–ç•¥- Adaptive Retrievalæœ¬è´¨è¿˜æ˜¯queryçš„æ”¹å†™ RAGçš„æ•ˆæœå·®ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æ£€ç´¢çš„ç­–ç•¥æœ‰é—®é¢˜ï¼Œå¯¹äºæ‰€æœ‰çš„é—®é¢˜ï¼Œå…¨éƒ¨é‡‡ç”¨å‘é‡ç›¸ä¼¼åº¦åŒ¹é…ï¼Œå¯èƒ½ä¸å¤ªå¯¹ï¼Œå› æ­¤é’ˆå¯¹ä¸åŒçš„ç”¨æˆ·é—®é¢˜ï¼Œéœ€è¦é‡‡å–ä¸åŒçš„ç­–ç•¥ å¯¹æŸ¥è¯¢ç±»å‹è¿›è¡Œåˆ†ç±»: äº‹å®ã€åˆ†æã€è§‚ç‚¹æˆ–æƒ…å¢ƒ ï¼ˆä½¿ç”¨å¤§æ¨¡å‹æ¥è¿›è¡Œé€‰æ‹©ï¼‰ ç„¶å Query Transform ï¼ˆæ ¹æ®ä¸Šé¢çš„ç±»å‹è¿›è¡Œæ”¹å†™ï¼‰, ç„¶åå’Œä¹‹å‰ä¸€æ ·è¿›è¡Œç›¸ä¼¼åº¦è¿›è¡ŒåŒ¹é… 12345678910# Define the system prompt to guide the AI&#x27;s classificationsystem_prompt = &quot;&quot;&quot;You are an expert at classifying questions. Classify the given query into exactly one of these categories: - Factual: Queries seeking specific, verifiable information. - Analytical: Queries requiring comprehensive analysis or explanation. - Opinion: Queries about subjective matters or seeking diverse viewpoints. - Contextual: Queries that depend on user-specific context. Return ONLY the category name, without any explanation or additional text.&quot;&quot;&quot; query æ”¹å†™çš„éƒ¨åˆ† 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131##################### åŸºäºäº‹å® Factual system_prompt = &quot;&quot;&quot;You are an expert at enhancing search queries. Your task is to reformulate the given factual query to make it more precise and specific for information retrieval. Focus on key entities and their relationships. Provide ONLY the enhanced query without any explanation.&quot;&quot;&quot;user_prompt = f&quot;Enhance this factual query: &#123;query&#125;&quot;##################### åŸºäºäº‹å® Factual system_prompt = &quot;&quot;&quot;You are an expert at enhancing search queries. Your task is to reformulate the given factual query to make it more precise and specific for information retrieval. Focus on key entities and their relationships. Provide ONLY the enhanced query without any explanation.&quot;&quot;&quot;user_prompt = f&quot;Enhance this factual query: &#123;query&#125;&quot;### åŸºäºåˆ†æ Analytical # Define the system prompt to guide the AI in generating sub-questionssystem_prompt = &quot;&quot;&quot;You are an expert at breaking down complex questions.Generate sub-questions that explore different aspects of the main analytical query.These sub-questions should cover the breadth of the topic and help retrieve comprehensive information.Return a list of exactly 3 sub-questions, one per line.&quot;&quot;&quot;# Create the user prompt with the main queryuser_prompt = f&quot;Generate sub-questions for this analytical query: &#123;query&#125;&quot;################## åŸºäºåˆ†æ Analytical # Define the system prompt to guide the AI in generating sub-questionssystem_prompt = &quot;&quot;&quot;You are an expert at breaking down complex questions.Generate sub-questions that explore different aspects of the main analytical query.These sub-questions should cover the breadth of the topic and help retrieve comprehensive information.Return a list of exactly 3 sub-questions, one per line.&quot;&quot;&quot;# Create the user prompt with the main queryuser_prompt = f&quot;Generate sub-questions for this analytical query: &#123;query&#125;&quot;################## åŸºäºè§‚ç‚¹ Opinion Strategy # Define the system prompt to guide the AI in identifying different perspectivessystem_prompt = &quot;&quot;&quot;You are an expert at identifying different perspectives on a topic. For the given query about opinions or viewpoints, identify different perspectives that people might have on this topic. Return a list of exactly 3 different viewpoint angles, one per line.&quot;&quot;&quot;# Create the user prompt with the main queryuser_prompt = f&quot;Identify different perspectives on: &#123;query&#125;&quot;# Extract and clean the viewpointsviewpoints = response.choices[0].message.content.strip().split(&#x27;\\n&#x27;)viewpoints = [v.strip() for v in viewpoints if v.strip()]print(f&quot;Identified viewpoints: &#123;viewpoints&#125;&quot;)# Retrieve documents representing each viewpointall_results = []for viewpoint in viewpoints: # æ³¨æ„è¿™é‡Œçš„åšæ³• # Combine the main query with the viewpoint combined_query = f&quot;&#123;query&#125; &#123;viewpoint&#125;&quot; # Create embeddings for the combined query viewpoint_embedding = create_embeddings(combined_query) # Perform similarity search for the combined query results = vector_store.similarity_search(viewpoint_embedding, k=2) # Mark results with the viewpoint they represent for result in results: result[&quot;viewpoint&quot;] = viewpoint # Add the results to the list of all results all_results.extend(results) ################### åŸºäºæƒ…å¢ƒ Contextual Strategyif not user_context:system_prompt = &quot;&quot;&quot;You are an expert at understanding implied context in questions.For the given query, infer what contextual information might be relevant or implied but not explicitly stated. Focus on what background would help answering this query.Return a brief description of the implied context.&quot;&quot;&quot;user_prompt = f&quot;Infer the implied context in this query: &#123;query&#125;&quot;# Generate the inferred context using the LLMresponse = client.chat.completions.create( model=&quot;meta-llama/Llama-3.2-3B-Instruct&quot;, messages=[ &#123;&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: system_prompt&#125;, &#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: user_prompt&#125; ], temperature=0.1)# Extract and print the inferred contextuser_context = response.choices[0].message.content.strip()print(f&quot;Inferred context: &#123;user_context&#125;&quot;)# Reformulate the query to incorporate contextsystem_prompt = &quot;&quot;&quot;You are an expert at reformulating questions with context.Given a query and some contextual information, create a more specific query that incorporates the context to get more relevant information.Return ONLY the reformulated query without explanation.&quot;&quot;&quot;user_prompt = f&quot;&quot;&quot;Query: &#123;query&#125;Context: &#123;user_context&#125;Reformulate the query to incorporate this context:&quot;&quot;&quot;# Generate the contextualized query using the LLMresponse = client.chat.completions.create(model=&quot;meta-llama/Llama-3.2-3B-Instruct&quot;,messages=[ &#123;&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: system_prompt&#125;, &#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: user_prompt&#125;],temperature=0) 2.3.6 CRAGå¯¹æ£€ç´¢çš„æ–‡ä»¶è¿›è¡Œäº†ä¿®æ­£ æ ¡éªŒæ£€ç´¢å¾—åˆ°çš„æ–‡æ¡£ï¼Œå¦‚æœæ–‡æ¡£ç›¸å…³æ€§è¯„åˆ†æ¯”è¾ƒé«˜(ç›¸å…³æ€§åˆ†æ•°è¿˜æ˜¯ä½¿ç”¨LLM)ï¼Œé‚£ä¹ˆç»§ç»­åŸå…ˆçš„æ­¥éª¤å³å¯ï¼›å¦‚æœç›¸å…³æ€§è¯„åˆ†å¾ˆä½ï¼Œé‚£ä¹ˆé‡‡ç”¨å¤–éƒ¨çš„å·¥å…·(å¦‚æµè§ˆå™¨ç­‰)æ¥æœç´¢æ›´å¤šçš„èµ„æ–™ï¼Œç”¨ä»¥è¡¥å……ï¼›å¦‚æœç›¸å…³æ€§è¯„åˆ†åœ¨ä¸­é—´ï¼Œç»“åˆæ£€ç´¢æ–‡æœ¬å’Œæœç´¢æ–‡æœ¬ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677def crag_process(query, vector_store, k=3): print(f&quot;\\n=== Processing query with CRAG: &#123;query&#125; ===\\n&quot;) # Step 1: Create query embedding and retrieve documents print(&quot;Retrieving initial documents...&quot;) query_embedding = create_embeddings(query) retrieved_docs = vector_store.similarity_search(query_embedding, k=k) # Step 2: Evaluate document relevance print(&quot;Evaluating document relevance...&quot;) relevance_scores = [] for doc in retrieved_docs: score = evaluate_document_relevance(query, doc[&quot;text&quot;]) relevance_scores.append(score) doc[&quot;relevance&quot;] = score print(f&quot;Document scored &#123;score:.2f&#125; relevance&quot;) # Step 3: Determine action based on best relevance score max_score = max(relevance_scores) if relevance_scores else 0 best_doc_idx = relevance_scores.index(max_score) if relevance_scores else -1 # Track sources for attribution sources = [] final_knowledge = &quot;&quot; # Step 4: Execute the appropriate knowledge acquisition strategy if max_score &gt; 0.7: # Case 1: High relevance - Use document directly print(f&quot;High relevance (&#123;max_score:.2f&#125;) - Using document directly&quot;) best_doc = retrieved_docs[best_doc_idx][&quot;text&quot;] final_knowledge = best_doc sources.append(&#123; &quot;title&quot;: &quot;Document&quot;, &quot;url&quot;: &quot;&quot; &#125;) elif max_score &lt; 0.3: # Case 2: Low relevance - Use web search print(f&quot;Low relevance (&#123;max_score:.2f&#125;) - Performing web search&quot;) web_results, web_sources = perform_web_search(query) final_knowledge = refine_knowledge(web_results) sources.extend(web_sources) else: # Case 3: Medium relevance - Combine document with web search print(f&quot;Medium relevance (&#123;max_score:.2f&#125;) - Combining document with web search&quot;) best_doc = retrieved_docs[best_doc_idx][&quot;text&quot;] refined_doc = refine_knowledge(best_doc) # Get web results web_results, web_sources = perform_web_search(query) refined_web = refine_knowledge(web_results) # Combine knowledge final_knowledge = f&quot;From document:\\n&#123;refined_doc&#125;\\n\\nFrom web search:\\n&#123;refined_web&#125;&quot; # Add sources sources.append(&#123; &quot;title&quot;: &quot;Document&quot;, &quot;url&quot;: &quot;&quot; &#125;) sources.extend(web_sources) # Step 5: Generate final response print(&quot;Generating final response...&quot;) response = generate_response(query, final_knowledge, sources) # Return comprehensive results return &#123; &quot;query&quot;: query, &quot;response&quot;: response, &quot;retrieved_docs&quot;: retrieved_docs, &quot;relevance_scores&quot;: relevance_scores, &quot;max_relevance&quot;: max_score, &quot;final_knowledge&quot;: final_knowledge, &quot;sources&quot;: sources &#125; 2.4 è¾“å…¥éƒ¨åˆ†2.4.1 Query Transform Queryæ”¹å†™ å¯èƒ½æ˜¯è§‰å¾—ç”¨æˆ·æçš„é—®é¢˜ä¸å¤Ÿå…·ä½“ï¼Œå¯¼è‡´æœç´¢çš„æ—¶å€™æ‰¾åˆ°å¯¹åº”çš„ä¿¡æ¯ï¼›äº¦æˆ–è€…æ˜¯ç”¨æˆ·çš„é—®é¢˜å¤ªå¤æ‚äº†ï¼ŒåŒ…å«äº†å¾ˆå¤šå±‚çº§çš„é—®é¢˜ï¼›äº¦æˆ–è€…æ˜¯ç”¨æˆ·çš„é—®é¢˜å¤ªç»†è‡´äº†ï¼Œä»¥è‡³åŒ¹é…ä¸åˆ°ç›¸å…³çš„ä¿¡æ¯ï¼Œéœ€è¦å¯¹ä¿¡æ¯step backï¼› 12345678910111213141516171819202122232425262728293031323334353637383940414243############ 1.Query Rewriting # Define the system prompt to guide the AI assistant&#x27;s behaviorsystem_prompt = &quot;You are an AI assistant specialized in improving search queries. Your task is to rewrite user queries to be more specific, detailed, and likely to retrieve relevant information.&quot;# Define the user prompt with the original query to be rewrittenuser_prompt = f&quot;&quot;&quot;Rewrite the following query to make it more specific and detailed. Include relevant terms and concepts that might help in retrieving accurate information.Original query: &#123;original_query&#125;Rewritten query:&quot;&quot;&quot;############ 2. Step-back Prompting# Define the system prompt to guide the AI assistant&#x27;s behaviorsystem_prompt = &quot;You are an AI assistant specialized in search strategies. Your task is to generate broader, more general versions of specific queries to retrieve relevant background information.&quot;# Define the user prompt with the original query to be generalizeduser_prompt = f&quot;&quot;&quot;Generate a broader, more general version of the following query that could help retrieve useful background information.Original query: &#123;original_query&#125;Step-back query:&quot;&quot;&quot;############ 3. Sub-query Decomposition# Define the system prompt to guide the AI assistant&#x27;s behaviorsystem_prompt = &quot;You are an AI assistant specialized in breaking down complex questions. Your task is to decompose complex queries into simpler sub-questions that, when answered together, address the original query.&quot;# Define the user prompt with the original query to be decomposeduser_prompt = f&quot;&quot;&quot;Break down the following complex query into &#123;num_subqueries&#125; simpler sub-queries. Each sub-query should focus on a different aspect of the original question.Original query: &#123;original_query&#125;Generate &#123;num_subqueries&#125; sub-queries, one per line, in this format:1. [First sub-query]2. [Second sub-query]And so on...&quot;&quot;&quot; 2.4.2 HyDE (Hypothetical Document Embedding) æœ¬è´¨ä¸Šè¿˜æ˜¯Queryæ”¹å†™çš„ä¸€ç§ï¼Œå…·ä½“æ“ä½œæ–¹æ³•å¦‚ä¸‹ï¼š æ ¹æ®ç”¨æˆ·çš„é—®é¢˜ï¼Œå‡æƒ³ä¸€ä¸ªdocumentï¼Œè¿™ä¸ªdocumentå¯ä»¥è§£å†³ç”¨æˆ·çš„queryï¼› (è¿™é‡Œä½¿ç”¨çš„è¿˜æ˜¯LLM) ç„¶åä½¿ç”¨è¿™ä¸ªdocumentè¿›è¡Œå‘é‡åŒ–å’Œç›¸ä¼¼åº¦çš„æ¯”è¾ƒï¼Œç»§ç»­åé¢çš„æµç¨‹ï¼› 12345678910# Define the system prompt to instruct the model on how to generate the documentsystem_prompt = f&quot;&quot;&quot;You are an expert document creator. Given a question, generate a detailed document that would directly answer this question.The document should be approximately &#123;desired_length&#125; characters long and provide an in-depth, informative answer to the question. Write as if this document is from an authoritative sourceon the subject. Include specific details, facts, and explanations.Do not mention that this is a hypothetical document - just write the content directly.&quot;&quot;&quot;# Define the user prompt with the queryuser_prompt = f&quot;Question: &#123;query&#125;\\n\\nGenerate a document that fully answers this question:&quot;","categories":[],"tags":[{"name":"Rag","slug":"Rag","permalink":"https://flippy-bird.github.io/tags/Rag/"}]},{"title":"langgraphå®˜æ–¹æ–‡æ¡£å­¦ä¹ ","slug":"langgraphå®˜æ–¹æ–‡æ¡£å­¦ä¹ ","date":"2025-04-08T06:58:33.000Z","updated":"2026-01-16T10:40:28.947Z","comments":true,"path":"2025/04/08/langgraphå®˜æ–¹æ–‡æ¡£å­¦ä¹ /","permalink":"https://flippy-bird.github.io/2025/04/08/langgraph%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"é¡ºåºå¯èƒ½ä¸æŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„é¡ºåºï¼ŒæŒ‰ç…§è‡ªå·±æ„Ÿå…´è¶£çš„æ¨¡å—ï¼Œç„¶åé€šè¿‡demo ä»£ç çš„æ–¹å¼æ¥ç†è§£è¿™ä¸ªæ¨¡å—çš„ç”¨æ³• subgraphåœ¨langgraphé‡Œé¢ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å°†subgraphæ·»åŠ åˆ° æµç¨‹ä¸­ é€šè¿‡å·¥å…·è°ƒç”¨çš„æ–¹å¼å¼•å…¥ (invoke a graph from a node) ä¾‹å¦‚ä¸‹é¢çš„å®˜æ–¹ä¾‹å­ä¸­ï¼Œsubgraphé€šè¿‡ä¸»æµç¨‹ä¸­call_subgraphè¿™ä¸ªtoolså‡½æ•°æ¥è§¦å‘subgraphçš„è°ƒç”¨ 12345678910111213141516171819202122232425262728293031from typing_extensions import TypedDictfrom langgraph.graph.state import StateGraph, STARTclass SubgraphState(TypedDict): bar: str# Subgraphdef subgraph_node_1(state: SubgraphState): return &#123;&quot;bar&quot;: &quot;hi! &quot; + state[&quot;bar&quot;]&#125;subgraph_builder = StateGraph(SubgraphState)subgraph_builder.add_node(subgraph_node_1)subgraph_builder.add_edge(START, &quot;subgraph_node_1&quot;)subgraph = subgraph_builder.compile()# Parent graphclass State(TypedDict): foo: strdef call_subgraph(state: State): # Transform the state to the subgraph state subgraph_output = subgraph.invoke(&#123;&quot;bar&quot;: state[&quot;foo&quot;]&#125;) # Transform response back to the parent state return &#123;&quot;foo&quot;: subgraph_output[&quot;bar&quot;]&#125;builder = StateGraph(State)builder.add_node(&quot;node_1&quot;, call_subgraph)builder.add_edge(START, &quot;node_1&quot;)graph = builder.compile() ç›´æ¥ä»¥å­èŠ‚ç‚¹çš„æ–¹å¼æ·»åŠ åˆ°æµç¨‹ä¸­ 12345678910111213141516171819202122from typing_extensions import TypedDictfrom langgraph.graph.state import StateGraph, STARTclass State(TypedDict): foo: str# Subgraphdef subgraph_node_1(state: State): return &#123;&quot;foo&quot;: &quot;hi! &quot; + state[&quot;foo&quot;]&#125;subgraph_builder = StateGraph(State)subgraph_builder.add_node(subgraph_node_1)subgraph_builder.add_edge(START, &quot;subgraph_node_1&quot;)subgraph = subgraph_builder.compile()# Parent graphbuilder = StateGraph(State)builder.add_node(&quot;node_1&quot;, subgraph) builder.add_edge(START, &quot;node_1&quot;)graph = builder.compile() é€šè¿‡ä¼ å‚ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œå­èŠ‚ç‚¹çš„æ–¹å¼ï¼Œsubgraphå…±äº«ä¸»graphçš„State human in loopå¯å­¦ä¹ èµ„æ–™1.Multi-Agentå…¨é¢çˆ†å‘ï¼ä¸€æ–‡è¯¦è§£å¤šæ™ºèƒ½ä½“æ ¸å¿ƒæ¶æ„åŠLangGraphæ¡†æ¶2.ç ´é™¤AI Agentè‡ªä¸»æ“æ§é£é™©ï¼šä¸‡å­—è§£è¯»LangGraphâ€œäººå·¥å¹²é¢„â€æœºåˆ¶ ï¼Œé™„é›¶åŸºç¡€å®æˆ˜","categories":[],"tags":[{"name":"Agent","slug":"Agent","permalink":"https://flippy-bird.github.io/tags/Agent/"},{"name":"langgraph","slug":"langgraph","permalink":"https://flippy-bird.github.io/tags/langgraph/"}]},{"title":"GraphRAG","slug":"GraphRAG","date":"2025-03-13T02:14:50.000Z","updated":"2026-01-16T10:40:28.946Z","comments":true,"path":"2025/03/13/GraphRAG/","permalink":"https://flippy-bird.github.io/2025/03/13/GraphRAG/","excerpt":"","text":"1. why we need GraphRAG? https://www.microsoft.com/en-us/research/blog/graphrag-unlocking-llm-discovery-on-narrative-private-data/ åŸºæœ¬çš„RAG éš¾ä»¥å»ºç«‹ä¿¡æ¯å…³è”ã€‚å½“å›ç­”æŸä¸ªé—®é¢˜éœ€è¦éå†ä¸åŒä¿¡æ¯ç‰‡æ®µå¹¶é€šè¿‡å…¶å…±äº«å±æ€§æ¥æä¾›æ–°çš„ç»¼åˆè§è§£æ—¶ï¼Œå°±ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚ åŸºæœ¬RAG åœ¨è¢«è¦æ±‚æ•´ä½“ç†è§£å¤§å‹æ•°æ®é›†åˆç”šè‡³å•ä¸ªå¤§å‹æ–‡æ¡£ä¸­çš„æ±‡æ€»è¯­ä¹‰æ¦‚å¿µæ—¶è¡¨ç°ä¸ä½³ã€‚ æˆ‘æƒ³åˆ°çš„ä¸€ä¸ªä¾‹å­æ˜¯ï¼šå‡è®¾æˆ‘æœ‰ä¸€ä¸ªä»‹ç» LLMçš„æ–‡ç« ï¼Œç„¶ååˆ†æ®µå¼ä»‹ç»äº†LLMçš„ä¸€äº›ç‰¹ç‚¹(å‡è®¾æ¯ä¸€æ®µä¸æ˜¾å¼çš„åŒ…å«LLMä¿¡æ¯ï¼Œç”¨å®ƒï¼Œä»–æˆ–è€…å…¶ä»–ä»£è¯æŒ‡ä»£)ï¼Œç„¶åè¿™äº›ä¿¡æ¯è¢«åˆ†åˆ«åˆ†å—ï¼Œç„¶åembeddingï¼Œåœ¨query (é—®LLMçš„ä¼˜ç‚¹ï¼Œ éœ€è¦æ ¹æ®LLMçš„ç‰¹ç‚¹æ¥æ€»ç»“)ï¼Œsearchçš„æ—¶å€™ï¼Œåº”è¯¥å°±ä¸ä¼šæŸ¥åˆ°è¿™äº›ä¿¡æ¯ã€‚ 2. GraphRAGçš„åŸç†2.1 æ„å»ºé˜¶æ®µåœ¨å»ºç«‹ç´¢å¼•(index)è¿™ä¸€æ­¥ï¼Œä¸»è¦æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤è¿›è¡Œï¼š å°†è¾“å…¥è¯­æ–™åº“åˆ†å‰²ä¸ºä¸€ç³»åˆ—çš„æ–‡æœ¬å•å…ƒï¼ˆTextUnitsï¼‰ï¼Œè¿™äº›å•å…ƒä½œä¸ºå¤„ç†ä»¥ä¸‹æ­¥éª¤çš„å¯åˆ†æå•å…ƒï¼Œå¹¶åœ¨æˆ‘ä»¬çš„è¾“å‡ºä¸­æä¾›ç»†ç²’åº¦çš„å¼•ç”¨ã€‚ ä½¿ç”¨ LLM ä»æ–‡æœ¬å•å…ƒä¸­æå–æ‰€æœ‰å®ä½“ã€å…³ç³»å’Œå…³é”®å£°æ˜ã€‚å¹¶ä¸”å¯¹æ¯ä¸ªå®ä½“ï¼Œå…³ç³»ï¼Œæ–‡æœ¬ç”Ÿæˆembeddingå‘é‡ ä½¿ç”¨ Leiden æŠ€æœ¯ å¯¹çŸ¥è¯†å›¾è°±è¿›è¡Œå±‚æ¬¡èšç±»ã€‚ GraphRAGé€šè¿‡è®¡ç®—å®ä½“ä¹‹é—´çš„å…³ç³»ï¼Œå¡«å……å…³ç³»è¡¨ï¼Œå¹¶ç”Ÿæˆå…³äºå®ä½“çš„ç¤¾åŒºæŠ¥å‘Šæ¥æ€»ç»“ä¸åŒå®ä½“ä¹‹é—´çš„å…³ç³»ä¸ä¸Šä¸‹æ–‡ï¼Œè‡ªä¸‹è€Œä¸Šåœ°ç”Ÿæˆæ¯ä¸ªç¤¾åŒºå±‚çº§åŠå…¶ç»„æˆéƒ¨åˆ†çš„æ‘˜è¦ã€‚è¿™æœ‰åŠ©äºå¯¹æ•°æ®é›†çš„æ•´ä½“ç†è§£ã€‚ å…·ä½“çš„ä¾‹å­å¯ä»¥å‚è€ƒè¿™ç¯‡çŸ¥ä¹æ–‡ç« çš„ä¾‹å­: GraphRAGå¿«é€Ÿå…¥é—¨ä¸åŸç†è¯¦è§£ 2.1 æŸ¥è¯¢é˜¶æ®µåœ¨æŸ¥è¯¢è¿™ä¸€æ­¥ï¼Œåˆåˆ†ä¸ºä¸¤ç§æ–¹å¼ï¼š å…¨å±€æœç´¢ï¼Œç”¨äºé€šè¿‡åˆ©ç”¨ç¤¾åŒºå±‚çº§æ‘˜è¦æ¥æ¨ç†æœ‰å…³è¯­æ–™åº“çš„æ•´ä½“é—®é¢˜ã€‚ å±€éƒ¨æœç´¢ï¼Œç”¨äºé€šè¿‡æ‰©å±•åˆ°å…¶é‚»å±…å’Œç›¸å…³æ¦‚å¿µæ¥æ¨ç†ç‰¹å®šå®ä½“çš„æƒ…å†µã€‚ å±€éƒ¨æœç´¢ æœ‰ç‚¹ç±»ä¼¼BM25å…³é”®è¯æœç´¢ï¼Œç„¶åæ‰¾åˆ°ä¸€äº›ç›¸å…³çš„å®ä½“å…³ç³»ä¹‹åï¼Œç„¶åå†åˆ©ç”¨å›¾è°±çš„èŠ‚ç‚¹å…³ç³»å†åœ¨é¢†è¿‘æŸ¥æ‰¾æ›´å¤šä¿¡æ¯ï¼Œç„¶åå†æ±‡æ€» å…¨å±€æœç´¢ æ ¹æ®ç”¨æˆ·çš„é—®é¢˜ï¼Œå…¨å±€æœç´¢ä¼šæœç´¢ç›¸å…³çš„ç¤¾åŒºæŠ¥å‘Š ï¼Œå¹¶ä¸”ç»™æ¯ä¸€ä¸ªç¤¾åŒºæŠ¥å‘Šæ‰“åˆ†(ä½¿ç”¨LLMæ¥è¿›è¡Œ)ï¼Œæ ¹æ®æ‰“åˆ†çš„é«˜ä½ï¼Œç„¶åå°†æœ€ç›¸å…³çš„ç¤¾åŒºæŠ¥å‘Šç»™åˆ°å¤§æ¨¡å‹çš„ä¸Šä¸‹æ–‡ä¸­ï¼› 3. é¡¹ç›®æºç å­¦ä¹  TODO","categories":[{"name":"RAGæ¡†æ¶å­¦ä¹ ","slug":"RAGæ¡†æ¶å­¦ä¹ ","permalink":"https://flippy-bird.github.io/categories/RAG%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/"}],"tags":[{"name":"Rag","slug":"Rag","permalink":"https://flippy-bird.github.io/tags/Rag/"}]},{"title":"shaderä»‹ç»","slug":"shaderä»‹ç»","date":"2023-05-14T09:48:35.000Z","updated":"2026-01-16T10:40:28.946Z","comments":true,"path":"2023/05/14/shaderä»‹ç»/","permalink":"https://flippy-bird.github.io/2023/05/14/shader%E4%BB%8B%E7%BB%8D/","excerpt":"shaderåŸºæœ¬ç”¨æ³•æ€»ç»“","text":"shaderåŸºæœ¬ç”¨æ³•æ€»ç»“ 1. Shader åŸºæœ¬ä»‹ç»é¦–å…ˆéœ€è¦è®¤è¯†åˆ°çš„ä¸€ç‚¹æ˜¯ï¼Œshaderæ˜¯è¿è¡Œåœ¨GPUä¸Šçš„ï¼Œå¤©ç„¶çš„å¹¶è¡Œå¤„ç† æˆ‘ä»¬é€šè¿‡ç¼–å†™ä»£ç (å³shaderï¼‰ï¼Œæ¥â€˜ç‚¹äº®â€™ä¸‹é¢ç”»å¸ƒä¸­çš„æ¯ä¸ªåƒç´ ï¼ å³è¾¹åˆ—å‡ºè¿™ä¹ˆé•¿çš„å…¬å¼ä¸æ˜¯ä¸ºäº†åŠé€€å¤§å®¶ï¼Œå®ƒéƒ½æ˜¯ç”±åŸºæœ¬å›¾å½¢å…¬å¼ç»„åˆè€Œæ¥ï¼ˆåé¢æˆ‘ä¼šç»™å¤§å®¶è¿›è¡Œè®²è§£ï¼‰ï¼Œç†è§£äº†å°±å®¹æ˜“ï¼Œä½†æ˜¯ä¸€ä¸‹å­æ”¾åœ¨è¿™é‡Œå°±å¾ˆéš¾ç†è§£ï¼Œæ‰€ä»¥å¤§å®¶åœ¨å†™shaderå¤åˆæ•ˆæœä»£ç æ—¶ï¼Œä¸€å®šè¦å†™æ³¨é‡Šè¯´æ˜ï¼Œä¸ç„¶åé¢ä¼˜åŒ–ç»´æŠ¤çš„åŒå­¦æ˜¯çœŸçš„éš¾å—ğŸ˜­ 12345678910111213141516171819202122void mainImage( out vec4 fragColor, in vec2 fragCoord )&#123; // create 100x100 cell sheet float c = floor(100.0*(0.5+(fragCoord.x-0.5*iResolution.x)/iResolution.y)); float r = floor(100.0*(1.0-fragCoord.y/iResolution.y)); // paint flower float f = min(max(20.0+20.0*(pow(0.5+0.5*cos(5.0*atan(r-50.5,c-50.5)),0.3))-sqrt((c-50.5)*(c-50.5)+(r-50.5)*(r-50.5)),0.0),1.0); f += min(max(19.0-sqrt((c-50.5)*(c-50.5)+(r-50.5)*(r-50.5)),0.0),1.0); f -= 2.0*min(max(46.0-r,0.0),1.0)*min(max(2.0-abs(4.0-sqrt( pow(abs(r-45.0),2.0)+pow(abs(abs(c-50.5)-6.0),2.0))),0.0),1.0); f -= 2.0*min(max(r-50. 0,0.0),1.0)*min(max(2.0-abs(8.0-sqrt((c-50.5)*(c-50.5)+(r-50.5)*(r-50.5))),0.0),1.0); // colorize vec3 h = (f&lt;1.0) ? mix(vec3(0.44,0.66,0.86),vec3(1),f) : mix(vec3(1), vec3(1,0.85,0.4),f-1.0); // output fragColor = vec4(h,1.0);&#125; 1.1 how to write a shader ? æˆ‘ä»¬åœ¨å“ªå„¿ä½œç”»ï¼Ÿ https://www.shadertoy.com/new VS Code æ’ä»¶shadertoy, ä½¿ç”¨æ–¹æ³•ä¹Ÿæ¯”è¾ƒç®€å• ä¸€äº›åŸºæœ¬çŸ¥è¯†ä»‹ç» ä»å“ªå„¿å¼€å§‹å‘¢ï¼Ÿç”»ä¸€ä¸ªä¸‰è§’å½¢è²Œä¼¼æœ‰ç‚¹éš¾(PSï¼šå›¾å½¢å­¦ä¸­çš„hello worldå°±æ˜¯ç»˜åˆ¶ä¸€ä¸ªä¸‰è§’å½¢ğŸ”¼)ï¼Œé‚£å°±ä»ç‚¹äº®å±å¹•å¼€å§‹å§ ï¼ 123456789101112131415161718192021// shaderå…·æœ‰ä¸€äº›å†…ç½®å‡½æ•°ï¼š// iResolution : ç”»å¸ƒçš„ç²¾åº¦ï¼Œå®½é«˜å‚æ•°// iTime : æ—¶é—´å‚æ•°ï¼Œè®©æ•ˆæœåŠ¨èµ·æ¥// iMouse : é¼ æ ‡æ“ä½œï¼Œäº¤äº’è®¾è®¡// å·¥å…·å‡½æ•° : sin, cos, pow, mod, smoothstep, floorç­‰ void mainImage(out vec4 fragColor, in vec2 fragCoord)&#123; // å°†ç”»å¸ƒå½’ä¸€åŒ–åˆ°0.0åˆ°1.0ä¹‹é—´ vec2 uv = fragCoord.xy / iResolution.xy; // è¾“å‡ºé¢œè‰²ï¼Œå³å¯¹åº”uvä¸‹çš„é¢œè‰²å€¼ // r g b a fragColor = vec4(1.0, 0.0, 0.0, 1.0); // å¯¹åº”å›¾2 // fragColor = vec4(uv.x, 0.0, 0.0, 1.0); // å¯¹åº”å›¾3 // vec3 color = 0.5 + 0.5*cos(iTime+uv.xyx+vec3(0,2,4)); // fragColor = vec4(color, 1.0);&#125; â€‹ å›¾ä¸€ å›¾äºŒ å›¾ä¸‰ 1.2 generative art1.2.1 å½¢çŠ¶ å–„äºä½¿ç”¨step å’Œsmoothstepå‡½æ•° â€‹ step å‡½æ•°ï¼šä¸€èˆ¬ç”¨æ¥ä½œæˆªæ–­å¤„ç† â€‹ smoothstepå‡½æ•°ï¼šä¸€èˆ¬ç”¨æ¥åšå¹³æ»‘å¤„ç†ï¼Œsmoothstepå‡½æ•°å¯ä»¥æ›¿ä»£stepå‡½æ•°ï¼ˆå‚æ•°1ç­‰äºå‚æ•°2ï¼Œæˆ–è€…æ¥è¿‘æ—¶ï¼Œå¯ä»¥ç†è§£ä¸ºstepå‡½æ•°ï¼‰ 123456789101112131415161718192021222324void mainImage( out vec4 fragColor, in vec2 fragCoord )&#123; vec2 uv = fragCoord/iResolution.xy; uv = uv - 0.5; vec3 color = vec3(0.7, 0.4, 0.6); if (uv.x &lt; -.3 &amp;&amp; uv.y &gt;0.1) color = vec3(0.7, 0.0, .0); if (uv.x &gt; 0.2 &amp;&amp; uv.y &lt; -0.4) color = vec3(0.0, 0.0, 0.5); if (uv.x &gt; 0.4 &amp;&amp; uv.y &gt; 0.1) color = vec3(0.0, 0.5, 0.6); float r = 0.01; color *= step(r, abs(uv.x + 0.3)); color *= step(r, abs(uv.x - 0.2)); color *= step(r, abs(uv.x - 0.4)); color *= 1.0 -(1.0 - step(r, abs(uv.x + 0.4))) * (smoothstep(0.1, 0.1, uv.y)); color *= step(r * 2., abs(uv.y - 0.1)); color *= step(r * 2., abs(uv.y - 0.3)); color *= 1.0 - (1.0 - step(r * 2., abs(uv.y + 0.4))) * smoothstep(-0.3, -0.3, uv.x); fragColor = vec4(color,1.0);&#125; â€‹ å‚è€ƒç¤ºæ„å›¾ è¿è¡Œä»£ç å›¾ SDF(ç¬¦å·è·ç¦»åœºï¼‰ è¯¦ç»†å¯å‚è€ƒæ–‡æ¡£Signed Distance Field åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œä½¿ç”¨æœ€é¢‘ç¹çš„å‡½æ•°æ˜¯ length(), å…¶å®ƒå…·æœ‰åŒæ ·åŠŸèƒ½çš„æœ‰sqrt(),distance() è¿™é‡Œä¸»è¦æ˜¯æŒæ¡è·ç¦»åœºè¿™ç§æ€æƒ³ï¼ï¼ï¼ 123456789101112131415161718void mainImage( out vec4 fragColor, in vec2 fragCoord )&#123; vec2 uv = fragCoord.xy / iResolution.xy; // å°†åæ ‡åŸç‚¹ç§»åˆ°ä¸­å¿ƒ uv = uv - 0.5; // ä¿æŒåŸæ¥çš„é•¿å®½æ¯” uv.x *= iResolution.x / iResolution.y; vec3 color = vec3(0.5, 0.5, 0.5); // è®¡ç®—å½“å‰åƒç´ åˆ°åŸç‚¹çš„è·ç¦» float d = length(uv); // è®¾ç½®æ¯”è¾ƒå¯¹è±¡ï¼Œè¿™é‡Œå³åœ†çš„åŠå¾„ float r = 0.3; color *= smoothstep(r, r + 0.01, d); fragColor = vec4(color, 1.0);&#125; å¦‚æœæ²¡æœ‰ä¿æŒé•¿å®½æ¯”çš„è¯ï¼Œå¯èƒ½æ˜¾ç¤ºçš„æ˜¯ä¸€ä¸ªæ¤­åœ†ï¼Œå› ä¸ºå›¾å½¢è¢«æ‹‰ä¼¸äº†ï¼ è¿™é‡Œçš„smoothstepè¿™ä¸€è¡Œå¯ä»¥ç†è§£ä¸ºï¼šå°äºrï¼Œè¿”å›0.0å€¼ï¼Œcolorä¹˜ä»¥0.0ç­‰äº0.0ï¼Œæ˜¾ç¤ºé»‘è‰²ï¼›å¤§äºrï¼Œåˆ™è¿”å›1.0.ä¿æŒcolorå€¼ï¼Œæ—¢ä¿æŒèƒŒæ™¯è‰² â€‹ ç»“æœå›¾ æåæ ‡ â€‹ è¿™ä¸€æ–¹é¢ä¸»è¦ç”¨æ¥ç”Ÿæˆé½¿è½®ï¼ŒèŠ±ç“£ç­‰æ²¿ç€åœ†å‘¨å˜åŒ–çš„å½¢çŠ¶ï¼Œå› ä¸ºæ˜¯ä»¥è§’åº¦ä¸ºè‡ªå˜é‡ï¼Œæ‰€ä»¥atan()å‡½æ•°åŸºæœ¬ä¸Šä¸€å®šä¼šç”¨åˆ°(å½“æˆ‘ä»¬çœ‹åˆ°åˆ«äººçš„shaderé‡Œé¢æœ‰atanå‡½æ•°æ—¶ï¼Œå¯ä»¥å¾€è§’åº¦æ–¹å‘å»æƒ³ä¸€ä¸‹) 12345678910111213141516171819202122232425262728void mainImage( out vec4 fragColor, in vec2 fragCoord )&#123; vec2 uv = fragCoord.xy / iResolution.xy; // å°†åæ ‡åŸç‚¹ç§»åˆ°ä¸­å¿ƒ uv = uv - 0.5; // ä¿æŒåŸæ¥çš„é•¿å®½æ¯” uv.x *= iResolution.x / iResolution.y; vec3 color = vec3(0.5, 0.5, 0.5); // è®¡ç®—å½“å‰åƒç´ åˆ°åŸç‚¹çš„è·ç¦» float d = length(uv); float r = 0.0; // **************** added ************* // è®¾ç½®æ¯”è¾ƒå¯¹è±¡ï¼Œè¿™é‡Œæ·»åŠ è§’åº¦çš„å˜åŒ–é¡¹ r = 0.3 + 0.1 * cos(6.0 * atan(uv.y, uv.x)); // å¯¹åº”ç¬¬äºŒä¸ªå›¾ // r = 0.3 + 0.1 * abs(cos(6.0 * atan(uv.y, uv.x))); // å¯¹åº”ç¬¬ä¸‰ä¸ªå›¾ // r = 0.3 + 0.1 * smoothstep(-.5, 0.4, cos(8.0 * atan(uv.y, uv.x))); // **************** added ************* color *= smoothstep(r, r + 0.01, d); fragColor = vec4(color, 1.0);&#125; â€‹ å›¾ä¸€ å›¾äºŒ å›¾ä¸‰ 1.2.2 å›¾å½¢çš„åŸºæœ¬æ“ä½œä¸»è¦åŒ…æ‹¬å¹³ç§»ï¼Œæ—‹è½¬ï¼Œç¼©æ”¾ æ—‹è½¬çŸ©é˜µ æ³¨æ„ï¼š â€‹ ç¼©æ”¾ï¼Œæ—‹è½¬æ˜¯æœ‰å‚è€ƒç‚¹çš„ï¼Œä¸‹é¢çš„ä¸¤ä¸ªçŸ©é˜µéƒ½æ˜¯é’ˆå¯¹åŸç‚¹è¿›è¡Œè®¡ç®—çš„ï¼Œå¦‚æœä¸åœ¨åŸç‚¹ï¼Œéœ€è¦å…ˆå¹³ç§»åˆ°åŸç‚¹ï¼Œç„¶åè¿›è¡Œæ—‹è½¬ï¼Œç¼©æ”¾æ“ä½œï¼Œç„¶åå†å¹³ç§»åˆ°åŸå…ˆçš„ä½ç½®ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041#define PI 3.14159265359// æ—‹è½¬çŸ©é˜µmat2 rotate2d(float _angle)&#123; return mat2(cos(_angle),-sin(_angle), sin(_angle),cos(_angle));&#125;// ç¼©æ”¾çŸ©é˜µmat2 scale(vec2 _scale)&#123; return mat2(_scale.x,0.0, 0.0,_scale.y);&#125; void mainImage( out vec4 fragColor, in vec2 fragCoord )&#123; vec2 uv = fragCoord.xy / iResolution.xy; // å°†åæ ‡åŸç‚¹ç§»åˆ°ä¸­å¿ƒ uv = uv - 0.5; // ä¿æŒåŸæ¥çš„é•¿å®½æ¯” uv.x *= iResolution.x / iResolution.y; // **************** added ************* // å¹³ç§» uv += (sin(iTime), cos(iTime)) * 0.2; // æ—‹è½¬ // uv *= rotate2d( sin(iTime)*PI ); // ç¼©æ”¾ // uv *= scale( vec2(0.8 + abs(sin(iTime)) * 0.5) ); // **************** added ************* vec3 color = vec3(0.5, 0.5, 0.5); // è®¡ç®—å½“å‰åƒç´ åˆ°åŸç‚¹çš„è·ç¦» float d = length(uv); float r = 0.0; r = 0.3 + 0.1 * smoothstep(-.5, 0.4, cos(8.0 * atan(uv.y, uv.x))); color *= smoothstep(r, r + 0.01, d); fragColor = vec4(color, 1.0);&#125; â€‹ å›¾ä¸€ å›¾äºŒ å›¾ä¸‰ 1.2.3 é‡å¤ï¼Œåˆ†å½¢ é‡å¤ â€‹ å¦‚æœæˆ‘ä»¬ç»˜åˆ¶å¤šä¸ªç›¸åŒçš„å›¾æ¡ˆï¼Œé‚£ä¹ˆå¯ä»¥é‡‡å–ä¸‹é¢çš„æƒ³æ³•ï¼šæˆ‘ä»¬çš„ç”»å¸ƒæ˜¯å½’ä¸€åŒ–åˆ°0.0åˆ°1.0ï¼Œå¦‚æœæˆ‘ä»¬å°†ç”»å¸ƒåˆ’åˆ†è‹¥å¹²ä»½ï¼Œç„¶åå°†æ¯ä¸€éƒ¨åˆ†çš„åæ ‡é‡æ–°æ˜ å°„åˆ°0.0åˆ°1.0ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ä¸€ä¸ªç”»å¸ƒä¸Šç»˜åˆ¶çš„å›¾æ¡ˆå°±ä¼šè¢«åŒæ­¥åˆ°å…¶å®ƒåŒºåŸŸä¸Šï¼Œä»è€Œå®ç°äº†é‡å¤å›¾å½¢çš„ç»˜åˆ¶ã€‚ 123456789101112131415161718192021222324252627void mainImage( out vec4 fragColor, in vec2 fragCoord )&#123; vec2 uv = fragCoord.xy / iResolution.xy; // **************** added ************* // å®ç°é‡å¤éƒ¨åˆ†çš„ä»£ç  uv = uv * 3.0; uv = fract(uv); // **************** added ************* // å°†åæ ‡åŸç‚¹ç§»åˆ°ä¸­å¿ƒ uv = uv - 0.5; // ä¿æŒåŸæ¥çš„é•¿å®½æ¯” uv.x *= iResolution.x / iResolution.y; vec3 color = vec3(0.5, 0.5, 0.5); // è®¡ç®—å½“å‰åƒç´ åˆ°åŸç‚¹çš„è·ç¦» float d = length(uv); float r = 0.0; r = 0.3 + 0.1 * smoothstep(-.5, 0.4, cos(8.0 * atan(uv.y, uv.x))); color *= smoothstep(r, r + 0.01, d); fragColor = vec4(color, 1.0);&#125; åˆ†å½¢ ä¸»è¦ç”¨äºæ¨¡æ‹Ÿæ ‘æœ¨ï¼Œå±±è„‰ï¼Œæ ‘å¶ç­‰ç­‰å…·æœ‰è‡ªç›¸ä¼¼çš„ç‰©ä½“ 12345678910111213141516171819202122 vec2 complex_sqr(vec2 pos)&#123; return vec2(pow(pos.x, 2.0) - pow(pos.y, 2.0), pos.x * pos.y * 2.0);&#125;void mainImage( out vec4 fragColor, in vec2 fragCoord )&#123; vec2 uv = fragCoord/iResolution.xy; vec2 c = vec2(-0.8, cos(iTime) * 0.2); vec2 z = vec2(uv.x * 2.0 - 1.0, uv.y - 0.5) * 2.0; float iterations = 0.0; while (length(z) &lt; 20. &amp;&amp; iterations &lt; 50.) &#123; z = complex_sqr(z) + c; iterations += 1.; &#125; vec3 col = vec3(1. - iterations * 0.02); fragColor = vec4(col,1.0);&#125; 1.1.4 éšæœºâ€‹ é€šè¿‡ä¸Šé¢çš„ä¸€äº›æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€äº›è§„åˆ™çš„å›¾å½¢ï¼Œå¦‚é½¿è½®ï¼ŒèŠ±ç“£ç­‰ç­‰ï¼›è§„åˆ™ä»£è¡¨ç€ä¸€ç§ç¾ï¼Œæ•°å­¦ä¹‹ç¾ï¼Œè€Œæ— åºåˆ™ä»£è¡¨ç€è‡ªç”±ï¼Œæœ‰æ— é™çš„æƒ³è±¡ç©ºé—´ï¼Œæ¯”å¦‚å¤©ä¸Šçš„äº‘æœµï¼Œè·³åŠ¨çš„ç«è‹—ï¼Œæµ·å¹³é¢æº…èµ·çš„æµªèŠ±ç­‰ï¼Œè¿™äº›è‡ªç„¶ä¹‹ç‰©æ— æ³•ç”¨æ•°å­¦å…¬å¼æ¥æŠŠå®ƒä»¬é™åˆ¶åœ¨ä¸€ä¸ªæ–¹ç¨‹å¼ä¹‹ä¸‹ã€‚é‚£åªèƒ½ç”¨é­”æ³•å»æ‰“è´¥é­”æ³•äº†ï¼Œæ˜¯éšæœºå»æ¨¡æ‹Ÿå¤§è‡ªç„¶çš„éšæœºï¼Œnoiseå°±æ˜¯è¿™é—¨è‰ºæœ¯ã€‚ shader noise 1.3 image1.3.1 è´´å›¾è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°†ç°æœ‰çš„å›¾ç‰‡ å¯¼å…¥åˆ° æˆ‘ä»¬çš„ç”»å¸ƒä¸­ï¼Œä½¿ç”¨å‡½æ•°texture2Då³å¯ 12345678910111213// å¯¼å…¥ä½ çš„å›¾ç‰‡ï¼Œä¸‹é¢çš„è·¯å¾„æ˜¯æˆ‘çš„æ–‡ä»¶è·¯å¾„#iChannel0 &#x27;file://pictures/46.jpg&#x27;void main()&#123; vec2 uv = gl_FragCoord.xy / iResolution.xy; // å¯¹ä½ çš„çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œè·å–å¯¹åº”åƒç´ å¤„çš„é¢œè‰² vec4 color = texture2D(iChannel0, uv); // è¾“å‡ºåˆ°å±å¹•ï¼Œå³ä¸ºåŸå›¾ gl_FragColor = color;&#125; â€‹ åŸå›¾ è¿è¡Œä»£ç å›¾ 1.3.2 ç©è½¬å›¾ç‰‡ å›¾ç‰‡è½¬åœº è¯´åˆ°å›¾ç‰‡ï¼Œå¤§å®¶æœ€å…ˆæƒ³åˆ°çš„ç‰¹æ•ˆæ˜¯å•¥ï¼Ÿæˆ‘é¦–å…ˆæƒ³åˆ°çš„æ˜¯å„ç§è½¬åœº https://gl-transitions.com/gallery 12345678910111213141516171819#iChannel0 &#x27;file://pictures/1.png&#x27;#iChannel1 &#x27;file://pictures/46.jpg&#x27;float SQRT_2 = 1.414213562373;float dots = 20.0;vec2 center = vec2(0, 0);vec4 transition(vec2 uv) &#123; bool nextImage = distance(fract(uv * dots), vec2(0.5, 0.5)) &lt; ( fract(iTime * 0.4) / distance(uv, center)); return nextImage ? texture2D(iChannel0, uv) : texture2D(iChannel1, uv);&#125;void main()&#123; vec2 uv = gl_FragCoord.xy / iResolution.xy; vec4 color = vec4(0.0); color = transition(uv); gl_FragColor = color;&#125; åˆ¶ä½œç²¾çµåŠ¨ç”» â€‹ è¿™ä¸€éƒ¨åˆ†æ˜¯ä¸ºäº†è¯´æ˜ï¼Œå¯¹äºä¸€å¹…å›¾ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥åªé€‰æ‹©å…¶ä¸­ä¸€éƒ¨åˆ†è¿›è¡Œé‡‡æ ·ï¼›(ps: æ–‡å­—æ¸²æŸ“çš„ä¸€ç§æ–¹å¼æ˜¯å°†æ‰€æœ‰æ–‡å­—ä¿¡æ¯ç¦»å±æ¸²æŸ“åˆ°ä¸€å¼ çº¹ç†ä¸Šï¼Œä½¿ç”¨æ—¶å»æŸ¥æ‰¾å¯¹åº”çš„éƒ¨åˆ†è¿›è¡Œæ¸²æŸ“ï¼‰ 1234567891011121314151617181920212223242526272829303132#iChannel0 &#x27;file://pictures/1.png&#x27;int col = 5;int row = 4;void main() &#123; vec2 uv = gl_FragCoord.xy / iResolution.xy; vec4 color = vec4(0.0); vec2 fRes = iResolution.xy / vec2(float(col), float(row)); vec2 nRes = iResolution.xy / fRes; uv = uv / nRes; float timeX = iTime * 1.5; float timeY = floor(timeX / float(col)); vec2 offset = vec2 (floor(timeX) / nRes.x, 1. - (floor(timeY) / nRes.y)); uv = fract(uv + offset); color = texture2D(iChannel0, uv); gl_FragColor = color; // è¿›é˜¶ï¼šç¬¬ä¸‰ä¸ªæ˜¯æŠ–éŸ³ä¸Šæ¯”è¾ƒç«çš„ç½‘æ ¼åˆ†å‰²å›¾ç‰‡ï¼Œé…åˆéŸ³ä¹çš„å¡ç‚¹ // æ¥æ˜¾ç¤ºå›¾ç‰‡ï¼Œä»è€Œäº§ç”Ÿæ¯”è¾ƒæœ‰è¶£çš„æ•ˆæœ // æˆ‘ä»¬å¯ä»¥åŸºäºæ­¤çš„æ€æƒ³ æ¥å°†æˆ‘ä»¬çš„ä¼—å¤šå›¾ç‰‡æŒ‰ç…§ä¸åŒæ—¶é—´ // ç»˜åˆ¶åˆ°ç”»å¸ƒä¸Šå½¢æˆåŠ¨ç”»ï¼ï¼ï¼ &#125; â€‹ åŸå›¾ è¿è¡Œä»£ç å›¾ æŠ–éŸ³ç‰¹æ•ˆ 1.3.3 å›¾ç‰‡æ“ä½œ åè½¬å›¾ç‰‡ â€‹ ä¸‹é¢è¿™ä¸ªå›¾ç‰‡çœ‹èµ·æ¥å¥½åƒæœ‰ç‚¹é˜´é—´çš„æ„Ÿè§‰ï¼Œåè½¬æ“ä½œå¯ç”¨äºé€šé“ä¸­é¢œè‰²è¾ƒå°çš„å€¼åè½¬æˆè¾ƒå¤§çš„å€¼ï¼Œç„¶åç”¨äºå¤„ç†ï¼Œæˆ–è€…ç›¸åï¼Œæ˜¯ä¸€ç§æ•°æ®å¤„ç†çš„æ€æƒ³ï¼ˆç±»ä¼¼äºå°†æ•°æ®é‡æ–°æ˜ å°„ï¼Œç±»æ¯”äºç¬›å¡å°”åæ ‡åˆ°æåæ ‡ï¼Œæˆ–è€…ä»æåæ ‡æ˜ å°„åˆ°ç¬›å¡å°”åæ ‡ç³»ï¼‰ï¼Œå¸¸ç”¨çš„é¢œè‰²å¤„ç†è¿˜æœ‰é¢œè‰²ç©ºé—´çš„è½¬æ¢ï¼Œå¦‚RGBé¢œè‰²ç©ºé—´è½¬æ¢åˆ°HSVé¢œè‰²ç©ºé—´ï¼Œéƒ½æ˜¯åˆ©ç”¨äº†è¿™ç§æ€æƒ³ 123456789101112131415// å¯¼å…¥ä½ çš„å›¾ç‰‡ï¼Œä¸‹é¢çš„è·¯å¾„æ˜¯æˆ‘çš„æ–‡ä»¶è·¯å¾„#iChannel0 &#x27;file://pictures/46.jpg&#x27;void main()&#123; vec2 uv = gl_FragCoord.xy / iResolution.xy; // æ³¨æ„è¿™é‡Œï¼Œè¿™é‡Œæˆ‘åªå–rgbé€šé“çš„é¢œè‰²ï¼Œå› ä¸ºaé€šé“ä¸ç”¨åè½¬ vec3 color = texture2D(iChannel0, uv).rgb; // è¿›è¡Œåè½¬çš„æ“ä½œ color = 1.0 - color; gl_FragColor = vec4(color, 1.0);&#125; â€‹ åŸå›¾ æ•ˆæœå›¾ å›¾ç‰‡ç°åº¦åŒ– â€‹ è®°ä½è¿™ä¸ªæ•°å­— 035911ï¼Œ å³0.3ï¼Œ 0.59ï¼Œ 0.11 (å¤§æ¦‚æ˜¯è¿™ä¸ªæ¯”ä¾‹ï¼Œæœ‰çš„æ˜¯0.299, 0.587, 0.114 æˆ–è€…å…¶å®ƒï¼Œéƒ½æ˜¯æŒ‰ç…§è¿™ä¸ªåŸºå‡†è¿›è¡Œç°åº¦åŒ–çš„ï¼ŒPSè½¯ä»¶çš„ç°åº¦å›¾å°±æ˜¯æŒ‰ç…§è¿™ä¸ªæ¯”ä¾‹è¿›è¡Œç°åº¦åŒ–çš„ï¼‰ 12345678910111213141516// å¯¼å…¥ä½ çš„å›¾ç‰‡ï¼Œä¸‹é¢çš„è·¯å¾„æ˜¯æˆ‘çš„æ–‡ä»¶è·¯å¾„#iChannel0 &#x27;file://pictures/46.jpg&#x27;void main()&#123; vec2 uv = gl_FragCoord.xy / iResolution.xy; // æ³¨æ„è¿™é‡Œï¼Œè¿™é‡Œæˆ‘åªå–rgbé€šé“çš„é¢œè‰²ï¼Œå› ä¸ºaé€šé“ä¸ç”¨åè½¬ vec3 color = texture2D(iChannel0, uv).rgb; // è¿›è¡Œç°åº¦çš„å¤„ç† float grey = color.r * 0.3 + color.g * 0.59 + color.b * 0.11; color = vec3(grey); gl_FragColor = vec4(color, 1.0);&#125; â€‹ åŸå›¾ æ•ˆæœå›¾ é¢œè‰²çš„åŠ å‡ä¹˜é™¤ â€‹ è¿™ä¸€å—å¯¹åº”äºAE æˆ–è€…PSä¸­çš„ å åŠ æ–¹å¼ï¼Œæœ‰Add, Substract, Multiply, Average, Differenceç­‰ç­‰ï¼Œå› ä¸ºè¿™ä¸€å—æ²¡æœ‰å‘ç°æ¯”è¾ƒå¥½ç©çš„æ•ˆæœï¼Œæš‚æ—¶ä¸æ·±å…¥ï¼Œä¸€èˆ¬å¸¸ç”¨çš„å°±æ˜¯Addæ–¹å¼å°±å¯ï¼Œå³colorA + colorBçš„æ–¹å¼ã€‚ 1.3.4 å·ç§¯ï¼Œç®—å­ æ¨¡ç³Šæ“ä½œ ä¸»è¦ç”¨åˆ°çš„æ˜¯**é«˜æ–¯æ¨¡ç³Šï¼Œ**å…¶å®ƒçš„è¿˜æœ‰å‡å€¼æ¨¡ç³Šï¼Œå¾„å‘æ¨¡ç³Šç­‰ç­‰ï¼Œå„æœ‰å„çš„ç”¨é€”ï¼ŒæŒ‰ç…§éœ€æ±‚é€‰æ‹©åˆé€‚å³å¯ã€‚ é«˜å“è´¨åå¤„ç†ï¼šåç§å›¾åƒæ¨¡ç³Šç®—æ³•çš„æ€»ç»“ä¸å®ç° è¾¹ç¼˜æ£€æµ‹ â€‹ è¾¹ç¼˜çš„è¡¨ç°å½¢å¼å¦‚ä¸‹å›¾ï¼šé€šå¸¸æ˜¯é€šè¿‡å¯»æ‰¾å›¾åƒçš„æ¢¯åº¦æ¥æ£€æµ‹è¾¹ç•Œï¼Œæœ‰ä¸¤ç§ä»£è¡¨ç®—æ³•ï¼Œsobelç®—å­ï¼ˆåŸºäºä¸€é˜¶å¯¼æ•°çš„ï¼‰å’Œlaplacianç®—å­ï¼ˆåŸºäºäºŒé˜¶å¯¼æ•°ï¼‰ã€‚ sobel ç®—å­ å¯¹äºä¸è¿ç»­çš„å‡½æ•°ï¼Œä¸€é˜¶å¯¼æ•°å¯ä»¥å†™ä½œï¼š æˆ– æ‰€ä»¥æœ‰ï¼š å‡è®¾è¦å¤„ç†çš„å›¾åƒä¸ºIï¼Œåœ¨ä¸¤ä¸ªæ–¹å‘æ±‚å¯¼ï¼š æ°´å¹³å˜åŒ–ï¼š å‚ç›´å˜åŒ–ï¼š ç»“åˆä»¥ä¸Šä¸¤ä¸ªç»“æœæ±‚å‡ºï¼š ç»Ÿè®¡æå¤§å€¼æ‰€åœ¨çš„ä½ç½®ï¼Œå°±æ˜¯å›¾åƒçš„è¾¹ç¼˜ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243#iChannel0 &#x27;file://pictures/pixel.png&#x27;void mainImage( out vec4 fragColor, in vec2 fragCoord )&#123; vec2 uv = fragCoord.xy / iResolution.xy; vec3 col; /*** Sobel kernels ***/ // Note: GLSL&#x27;s mat3 is COLUMN-major -&gt; mat3[col][row] mat3 sobelX = mat3(-1.0, -2.0, -1.0, 0.0, 0.0, 0.0, 1.0, 2.0, 1.0); mat3 sobelY = mat3(-1.0, 0.0, 1.0, -2.0, 0.0, 2.0, -1.0, 0.0, 1.0); float sumX = 0.0; // x-axis change float sumY = 0.0; // y-axis change for(int i = -1; i &lt;= 1; i++) &#123; for(int j = -1; j &lt;= 1; j++) &#123; // texture coordinates should be between 0.0 and 1.0 float x = (fragCoord.x + float(i))/iResolution.x; float y = (fragCoord.y + float(j))/iResolution.y; // Convolve kernels with image sumX += length(texture( iChannel0, vec2(x, y) ).xyz) * float(sobelX[1+i][1+j]); sumY += length(texture( iChannel0, vec2(x, y) ).xyz) * float(sobelY[1+i][1+j]); &#125; &#125; float g = abs(sumX) + abs(sumY); //g = sqrt((sumX*sumX) + (sumY*sumY)); if(g &gt; 1.0) col = vec3(1.0,1.0,1.0); else col = col * 0.0; fragColor.xyz = col;&#125; â€‹ åŸå›¾ è¿è¡Œç®—æ³•å›¾ 2.laplacianç®—å­ å¯¹äºä¸è¿ç»­å‡½æ•°çš„äºŒé˜¶å¯¼æ•°æ˜¯ï¼š å› æ­¤ä½¿ç”¨çš„å·ç§¯æ ¸æ˜¯ï¼š 2. Shader å’Œ AI2.1 ç‰¹æ•ˆç›¸å…³ ç˜¦è„¸ç‰¹æ•ˆï¼Œå¤§çœ¼ç‰¹æ•ˆï¼Œå¤´éƒ¨æ™ƒåŠ¨ç‰¹æ•ˆç­‰ç­‰ â€‹ è¿™é‡Œä¼šä½¿ç”¨AIçš„æ–¹æ³•æå–äººç‰©çš„å…³é”®ç‚¹ï¼Œå¦‚ä¸‹å›¾ä¸­çš„å·¦å³å¤ªé˜³ç©´çš„å…³é”®ç‚¹ï¼Œä¸‹å·´çš„å…³é”®ç‚¹ï¼Œäººä½“å¤´éƒ¨çš„å…³é”®ç‚¹ç­‰ç­‰ï¼Œç„¶åå†åŠ ä¸Šå›¾åƒå¤„ç†çš„æ–¹æ³•ï¼Œå°±ä¼šäº§ç”Ÿå¾ˆå¤šæœ‰è¶£çš„æ•ˆæœï¼ï¼ï¼ èƒŒæ™¯ç‰¹æ•ˆ â€‹ è¿™é‡Œå°±ä¼šç”¨åˆ°AIä¸­çš„äººåƒåˆ†å‰²æŠ€æœ¯ï¼Œå°†äººç‰©æŠ å‡ºæ¥ï¼Œç„¶åèƒŒæ™¯éƒ¨åˆ†å°†å…¶ç°åº¦åŒ–ï¼Œäººç‰©éƒ¨åˆ†ä¿ç•™åŸå§‹çš„é¢œè‰²å³å¯ã€‚ 2.2 DLSS â€‹ DLSS 2.0 - é‡æ–°å®šä¹‰AIæ¸²æŸ“ â€‹ DLSSç®€å•æ¥è¯´å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨ä¼ ç»Ÿçš„å›¾å½¢å­¦æ–¹æ³•æ¸²æŸ“ä¸€å¸§ä½æ¸…æ™°åº¦çš„å›¾ç‰‡ï¼Œç„¶åä½¿ç”¨AIçš„æ–¹æ³•å°†å…¶â€œå¤åŸâ€æˆé«˜åˆ†è¾¨ç‡çš„å›¾ç‰‡ï¼Œå³å›¾ç‰‡çš„é«˜æ¸…ä¿®å¤ã€‚å› ä¸ºåœ¨çœŸå®æ„Ÿæ–¹é¢ï¼Œå…‰çº¿è¿½è¸ªæŠ€æœ¯æ¸²æŸ“çš„çœŸå®æ„Ÿå¾ˆå¥½ï¼Œä½†æ˜¯åœ¨é«˜åˆ†è¾¨ç‡ä¸‹ï¼Œè®¡ç®—é‡çˆ†ç‚¸ï¼›æœ‰äº†DLSSåï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…‰çº¿è¿½è¸ªæŠ€æœ¯æ¸²æŸ“ä½åˆ†è¾¨ç‡çš„å›¾ç‰‡ï¼Œç„¶åä½¿ç”¨AIè¿›è¡Œé«˜æ¸…ä¿®å¤ã€‚ å‚è€ƒèµ„æ–™ æµ…è°ˆç”Ÿæˆè‰ºæœ¯ the book of shaders shadertoy iqå¤§ç¥åšå®¢ https://www.shadertoy.com/view/Ms2SD1","categories":[{"name":"shader","slug":"shader","permalink":"https://flippy-bird.github.io/categories/shader/"}],"tags":[{"name":"shader","slug":"shader","permalink":"https://flippy-bird.github.io/tags/shader/"}]},{"title":"ARçš„å‰ä¸–ä»Šç”Ÿ","slug":"ARçš„å‰ä¸–ä»Šç”Ÿ","date":"2022-09-27T07:58:23.000Z","updated":"2026-01-16T10:41:49.220Z","comments":true,"path":"2022/09/27/ARçš„å‰ä¸–ä»Šç”Ÿ/","permalink":"https://flippy-bird.github.io/2022/09/27/AR%E7%9A%84%E5%89%8D%E4%B8%96%E4%BB%8A%E7%94%9F/","excerpt":"","text":"1.æ¦‚å¿µåŒºåˆ†ä»€ä¹ˆæ˜¯AR&#x2F;VR&#x2F;MR&#x2F;XR? åœ¨å‰æ®µæ—¶é—´ï¼Œå…ƒå®‡å®™å¤§ç«çš„æ—¶å€™ï¼Œä½ åº”è¯¥å¬è¿‡æˆ–è€…è§è¿‡ä¸Šé¢çš„å‡ ä¸ªè¯è¯­ã€‚ä»€ä¹ˆï¼Ÿå…ƒå®‡å®™éƒ½æ²¡æœ‰å¬è¿‡ï¼Œå»ºè®®é£Ÿç”¨ä¸‹é¢çš„èµ„æ–™äº†è§£ä¸€ä¸‹,ä¹Ÿæ˜¯è›®æœ‰æ„æ€çš„ä¸œè¥¿ã€‚ èŠèŠè¿™ä¸ªæœ¬ä¸å­˜åœ¨çš„â€œå…ƒå®‡å®™â€ å•¥ï¼Ÿå…¨æ˜¯æ–‡å­—ï¼Œæ²¡äº‹ï¼Œé‚£å°±çœ‹ä¸ªè§†é¢‘å§ï¼Œä½ ä¹Ÿå¯ä»¥ç®€å•äº†è§£ä¸€ä¸‹è¿™ç¯‡æ–‡ç« çš„ä¸»é¢˜ARæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼ 2021å¹´äº†ï¼ŒARçœ¼é•œå¯ä»¥åšä»€ä¹ˆï¼Ÿ AR å¯¹ç°å®çš„ä¸€ç§å¢å¼ºï¼Œè®¾å¤‡å¯¹ç°å®è¯†åˆ«ï¼ˆå½¢çŠ¶ã€ä½ç½®ã€åŠ¨ä½œã€è¾¹ç¼˜ï¼‰,ä»è€Œå°†è™šæ‹Ÿä¿¡æ¯å åŠ åœ¨ç°å®ä¸­ã€‚ VR ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªè™šæ‹Ÿçš„ä¸–ç•Œï¼Œä¸å¿…è€ƒè™‘ç°å®ä¸–ç•Œï¼Œæ˜¯ä¸€ç§æ²‰æµ¸å¼çš„ä½“éªŒã€‚å¦‚æœå–œæ¬¢çœ‹åŠ¨æ¼«çš„ï¼Œ**åŠ¨æ¼«ã€Šåˆ€å‰‘ç¥åŸŸã€‹é‡Œæè¿°å°±æ˜¯è¿™æ ·ä¸€ä¸ªä¸–ç•Œ(PS: æˆ‘æ„Ÿè§‰è¿™å°±æ˜¯å½“å‰é˜¶æ®µå…ƒå®‡å®™çš„æœ€ç»ˆå½¢æ€)ï¼›åœ¨ç”µå½±ã€Šå¤´å·ç©å®¶ã€‹**ä¸­ï¼Œé‡Œé¢å¡‘é€ çš„ç»¿æ´²ä¹Ÿæ˜¯è¿™æ ·çš„ä¸€ä¸ªè™šæ‹Ÿä¸–ç•Œã€‚ MR è™šæ‹Ÿä¸–ç•Œå’Œç°å®ä¸–ç•Œçš„æ··åˆã€‚ ARã€VRã€MRç»Ÿç§°XRã€‚VRçš„å‘å±•ç›¸è¾ƒäºARçš„å‘å±•ï¼Œæ›´ä¸ºæˆç†Ÿä¸€äº›ï¼Œæœ‰å¾ˆå¤šVRé¢å¯¹ç”¨æˆ·çš„äº§å“ï¼Œä¾‹å¦‚Pico 4ï¼Œè¿™æ®µæ—¶é—´å‘å¸ƒäº†å®ƒçš„æ–°äº§å“ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸»è¦èŠä¸€èŠARç›¸å…³çš„å†…å®¹ã€‚ 2.ARå†å²å‘å±•åŠç°çŠ¶1992å¹´æ³¢éŸ³å…¬å¸ç ”ç©¶å‘˜æå‡ºäº†ARè¿™ä¸ªæ¦‚å¿µï¼Œè‡ªæ­¤ARè¯ç”Ÿäº†ã€‚ 2.1 ARåºå¹•çš„å¼€å¯æŠŠæ—¶é—´æ‹‰å›10å¹´å‰çš„2012å¹´ï¼Œåœ¨ä¸€ä¸ªæ…ˆå–„æ™šå®´ä¸Šï¼Œè°·æ­Œè”åˆåˆ›å§‹äººè°¢å°”ç›–Â·å¸ƒæ—ä¸ºäº†å±•ç¤ºä¸€æŠŠè°·æ­Œçš„æŠ€æœ¯å®åŠ›ï¼Œå°±æŠŠå°šåœ¨åŸå‹é˜¶æ®µçš„è°·æ­Œæ™ºèƒ½çœ¼é•œGoogle Glassæäº†å‡ºæ¥ï¼Œä¼—äººç›´å‘¼â€œå§æ§½â€ï¼Œéšåä¾¿å¼•èµ·äº†å¤§ä¼—çš„å¹¿æ³›è®¨è®ºå’Œå…³æ³¨ã€‚æ­£å½“å¤§å®¶åšç€é’¢é“ä¾ æ¢¦çš„æ—¶å€™ï¼Œä¹Ÿé‡åˆ°äº†è§†é¢‘ä¸­å°ä½•åŒå­¦é‡åˆ°çš„å„ç§ä½¿ç”¨é—®é¢˜ï¼›è™½ç„¶Google Glasssæ›´å¤šæ„ä¹‰ä¸Šåªæ˜¯ä¸€ä¸ªâ€œæˆ´åœ¨è„¸ä¸Šçš„æ‰‹æœºâ€ï¼Œå¾ˆå¤šARé¢†åŸŸæ¶‰åŠçš„æŠ€æœ¯ï¼Œå—é™äºå½“æ—¶çš„æŠ€æœ¯å’Œç®—åŠ›ï¼Œè¯¸å¦‚ç¯å¢ƒæ£€æµ‹ï¼Œç”¨æˆ·äº¤äº’æŠ€æœ¯ç­‰å¹¶ä¸æ¶‰åŠï¼Œä½†æ˜¯å…¶å±•ç°çš„å‰æ™¯è¿˜æ˜¯å€¼å¾—å¤§å®¶æœŸå¾…çš„ã€‚å› æ­¤ï¼Œå¯ä»¥è¯´ï¼ŒGoogle Glassæ‹‰èµ·äº†ARå¿«é€Ÿå‘å±•çš„åºå¹•ã€‚ 2.2 ARçš„æŒç»­å‘å±• ARç•Œçš„ç¬¬ä¸€ä»£é»‘ç§‘æŠ€ è‡ªä»è°·æ­Œå°†Google Glasså¼•å…¥å¤§ä¼—çš„è§†é‡ï¼Œæ—è¾¹çš„å¾®è½¯å¯åä¸ä½äº†ï¼Œè®ºæŠ€æœ¯ï¼Œå’±å¯æ²¡è¾“è¿‡è°ï¼Œå°±ç®—æ‰“ä¸è¿‡ï¼Œé‚£ä¸æ˜¯æœ€åè¿˜å¯ä»¥åŠ å…¥å˜›ã€‚å†µä¸”ï¼Œä½ çš„é‚£ä¸ªGoogle Glassä¹Ÿå¤ªåƒåœ¾äº†å§ï¼Œè¿™ä¹ˆé‡ï¼Œè¿˜è¿™ä¹ˆè´µï¼Œä¹Ÿå°±æ˜¯ä½ æ˜¯ç¬¬ä¸€äººï¼Œå¦åˆ™ä¸ä¼šæœ‰é‚£ä¹ˆå¤šäººä¹°è´¦ï¼Œè®©æˆ‘æ¥æ•™æ•™ä½ æ€ä¹ˆåˆ¶ä½œä¸€ä¸ªå¥½çš„äº§å“å§ï¼Œæ˜¯æ—¶å€™å±•ç°çœŸæ­£çš„æŠ€æœ¯äº†ã€‚äºæ˜¯ï¼Œåœ¨2015å¹´çš„æ—¶å€™ï¼Œå¾®è½¯å‘å¸ƒäº†Hololensï¼Œéœ‡æƒŠäº†ä¸–ç•Œï¼Œå®ƒèƒ½æ£€æµ‹å¤–ç•Œç¯å¢ƒï¼Œå°†è™šæ‹Ÿç‰©ä½“å’Œæ˜¾ç¤ºç¯å¢ƒèåˆï¼Œå¹¶ä¸”å®ƒé€šè¿‡è¿½è¸ªç”¨æˆ·æ‰‹åŠ¿æ¥å®Œæˆäº¤äº’ã€‚HoloLens2 æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ç¬¬ä¸€æ¬¾ç›¸å¯¹æˆç†Ÿçš„ARè®¾å¤‡ï¼Œå®ƒçš„å‡ºç°ï¼Œå¼•é¢†äº†ARçš„æ½®æµï¼Œæˆä¸ºäº†ä¸šç•Œçš„æ ‡æ†å’Œå¯¹æ¯”çš„å¯¹è±¡ã€‚ 2019å¹´ï¼Œå¾®è½¯å‘å¸ƒäº†HoloLens2ï¼Œè§£å†³äº†è§†é‡ç‹­å°çš„é—®é¢˜ï¼Œå¹¶ä¸”å¤§å¹…åº¦æå‡äº†æ‰‹åŠ¿è¿½è¸ªçš„å‡†ç¡®æ€§ã€‚è™½ç„¶HoloLens2 è™½ç„¶ç›¸å¯¹æˆç†Ÿï¼Œä½†æ˜¯æˆæœ¬å±…é«˜ä¸ä¸‹ï¼Œ**å®˜æ–¹æŒ‡å¯¼å»ºè®®é›¶å”®ä»·æ˜¯3500ç¾å…ƒã€‚**å¦å¤–ï¼Œè™½ç„¶å®ƒç›¸å¯¹ä½“ç§¯è¾ƒå°ï¼Œä½†ä»é‡è¾¾500g, å·²çŸ¥iPhone 12é‡152g, è¯·é—®ä½ çš„å¤´ä¸Šæˆ´äº†å‡ å°iPhone 12 ğŸ¤£ ARç•Œçš„ç¬¬ä¸€ä»£é»‘â€æ¦‚å¿µâ€ å‡­å€Ÿç€ä¸‹é¢è¿™â€œä¸€æ¡åœ¨ä½“è‚²é¦†åœ°æ¿è·ƒèµ·çš„å¤§é²¸é±¼â€ï¼ŒMagic Leap æˆåŠŸå¡‘é€ äº†ä¸€ä¸ª AR é»‘ç§‘æŠ€å…¬å¸çš„å½¢è±¡ï¼Œä»¥åŠè¶³å¤Ÿæ¿€åŠ¨äººå¿ƒçš„æœªæ¥â€”â€”ä»ç§»åŠ¨è®¡ç®—è¿ç§»åˆ°ç©ºé—´è®¡ç®—ã€‚è£¸çœ¼ARçš„æ¦‚å¿µå¤ªå…·æœ‰éœ‡æ’¼åŠ›ï¼Œè‡´ä½¿Magic Leapåœ¨è§†é¢‘å‘å¸ƒçš„çŸ­çŸ­ä¸‰ä¸ªæœˆå†…ï¼Œè¿…é€Ÿè·å¾—16äº¿ç¾å…ƒèèµ„ï¼Œæœ€é«˜ä¼°å€¼è¾¾64äº¿ç¾å…ƒã€‚ç„¶è€Œå·§å¦‡éš¾ä¸ºæ— ç±³ä¹‹ç‚Šï¼Œåœ¨å…³é”®æŠ€æœ¯ä¸Šæ²¡æœ‰å–å¾—æ ¸å¿ƒçªç ´çš„Magic Leapåœ¨2017å¹´æ¨å‡ºçš„Magic Leap oneï¼Œå…¶è¡¨ç°ä¸å…¶å¹ç‰›çš„æ•ˆæœå·®å¾—å¤ªç¦»è°±ï¼Œæ¶ˆè´¹è€…çº·çº·ç»™å‡ºäº†å·®è¯„ï¼Œè¿™ä¹Ÿç»™è¿™å®¶å…¬å¸è´´ä¸Šäº†â€œéª—å­â€çš„æ ‡ç­¾ã€‚ åœ¨ä¸Šé¢çš„è§†é¢‘è¢«äººæˆ³ç ´ï¼Œæ˜¯è§†é¢‘åæœŸåˆæˆä¹‹åï¼Œè¿™å®¶å…¬å¸åœ¨ARç•Œæ²¡æœ‰æƒŠèµ·ä»»ä½•æµªèŠ±ï¼Œå°±åœ¨å†™è¿™ç¯‡æ–‡ç¨¿çš„å½“å¤©ï¼Œæˆ‘åœ¨å…¶å®˜ç½‘ä¸Šå‘ç°ï¼ŒMagic Leapå°†å‘å¸ƒMagic Leap 2ï¼Œè¿™å›ä»–èƒ½å¦åŠ›æŒ½ç‹‚æ¾œï¼Œæ‹¯æ•‘è‡ªå·±â€œéª—å­â€çš„å½¢è±¡ï¼Œè¿˜å¾—çœ‹è¿‡ç¡¬çš„äº§å“ï¼ å›½å†…ARçš„å‘å±• å›½å†…çš„ARå…¬å¸ä¸»è¦æœ‰é…·æ´¾çš„Xviewç³»åˆ—ã€äº®äº®è§†é‡ã€å½±ç›®ç§‘æŠ€ç­‰ï¼Œè¦è¯´ç›®å‰æœ€ç«çš„ï¼Œå½“å±Nrealï¼Œ åœ¨ä»Šå¹´çš„8æœˆ23æ—¥ï¼ŒNrealæ¨å‡ºäº†æ–°å“Nreal Airå’ŒNreal Xä¸¤æ¬¾ARçœ¼é•œï¼›å‘å¸ƒé¦–æ—¥ï¼ŒNrealé”€å”®é¢çªç ´äº†1200ä¸‡ã€‚ åœ¨9æœˆ21æ—¥ï¼Œå›½å†…æœ€æ—©æˆç«‹çš„ARä¼ä¸šä¹‹ä¸€äº®äº®è§†é‡å‘å¸ƒäº†ä¸€æ¬¾é‡äº§çš„ARå­—å¹•çœ¼é•œï¼Œä¹Ÿæ˜¯å…¨çƒç¬¬ä¸€æ¬¾é‡é‡å°äº80gçš„åŒç›®æ³¢å¯¼æ— çº¿ä¸€ä½“æœºARçœ¼é•œï¼šå¬è¯­è€…ã€‚ä¸»æ‰“å¬éšœè€…æ²Ÿé€šã€‚ å›½å†…çš„ARäº§ä¸šä¹Ÿåœ¨å¿«é€Ÿå‘å±•ä¸­ï¼Œè‹¹æœè€æ—©å°±è¯´2022å¹´è¦å‘å¸ƒARçœ¼é•œï¼Œä»å¹´å¤´ç­‰åˆ°äº†å¹´å°¾ï¼Œæ¯›éƒ½æ²¡æœ‰ï¼›æˆ–è®¸ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç›®å…‰è½¬å‘å›½å†…ï¼ŒæœŸå¾…å›½å†…çš„å‚å•†èƒ½å¤Ÿå‘å¸ƒä¸€æ¬¾æ”¹å˜ä¸–ç•Œçš„äº§å“ï¼Œå°±åƒå½“æ—¶iphoneçš„å‡ºç°ä¸€æ ·ã€‚ 2.3 ç§»åŠ¨ç«¯ARæ¯”è¾ƒæµè¡Œçš„SDKç›®å‰ç§»åŠ¨ç«¯AR SDKæœ‰å¾ˆå¤šï¼Œä¸‹é¢åˆ—å‡ºä¸€äº›æ¯”è¾ƒæœ‰å½±å“åŠ›çš„SDK è‹¹æœçš„ARKit ï¼š 2017å¹´å‘å¸ƒè‡³ä»Šï¼Œè¢«è®¤ä¸ºæ˜¯æ€§èƒ½æœ€å¼ºï¼Œæœ€å…·å•†ä¸šæ½œåŠ›çš„sdkã€‚ è°·æ­Œçš„ARCore ï¼š åŒæ—¶æ”¯æŒAndroid å’ŒiOS, æ˜¯Androidæ¯”è¾ƒå¸¸ç”¨çš„sdkï¼Œç»¼åˆå®åŠ›æ¯”ä¸ä¸ŠARKit å†å²æ‚ ä¹…çš„ ARToolKitï¼š ç¬¬ä¸€ä¸ªAR SDKï¼Œä½†æ˜¯ç›®å‰å¼€æºç¤¾åŒºä¸æ˜¯å¤ªæ´»è·ƒ å•†ä¸šåŒ–sdk Vuforiaï¼š æ€§èƒ½è¡¨ç°å¾ˆä¸é”™ï¼Œæ”¯æŒAndroidã€iOS 2.4 å‘å±•ç°çŠ¶ç›®å‰ARæŠ€æœ¯è¿˜æœ‰å¾ˆå¤šç—›ç‚¹ï¼Œä¸»è¦é›†ä¸­åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š æ£€æµ‹ç¯å¢ƒçš„è®¡ç®—é‡å¾ˆå¤§ï¼Œå®æ—¶æ€§ä¸å¥½ï¼Œä¾‹å¦‚å½“ä½ æ‹¿ç€è®¾å¤‡å¿«é€Ÿç§»åŠ¨æ—¶ï¼Œè™šæ‹Ÿç‰©ä½“å’Œç°å®ç‰©ä½“çš„èåˆå°±ä¼šå‡ºç°é£˜ç§»çš„ç°è±¡ å› ä¸ºè®¡ç®—é‡å¤§å’Œé¢‘ç¹ä½¿ç”¨æ‘„åƒå¤´ï¼Œè€—ç”µå‘çƒ­ï¼› ç©¿æˆ´å¼AR æ˜¾ç¤ºæŠ€æœ¯ä¸æˆç†Ÿï¼Œå¤§éƒ¨åˆ†è®¾å¤‡åœ¨æ¸…æ™°åº¦ã€è§†é‡ã€ä½“éªŒæ€§ä¸Šéƒ½æœ‰äº›ä¸è¶³ è½¯ä»¶ç”Ÿæ€ä¸æˆç†Ÿ 3.ARé¢†åŸŸçš„å…³é”®æŠ€æœ¯3.1 æ¢çŸ¥ç¯å¢ƒçš„æŠ€æœ¯ï¼ˆè‡ªæˆ‘å®šä½ã€æ£€æµ‹3Dç‰©ä½“ã€ç¯å¢ƒå»ºæ¨¡ï¼‰ æ²¡é”™ï¼Œå¬åˆ°è¿™äº›è¯è¯­ï¼Œå¾ˆè‡ªç„¶æƒ³åˆ°äº†è‡ªåŠ¨é©¾é©¶é‡Œé¢ä¹Ÿä¼šæœ‰è¿™æ ·ä¸€ä¸ªç¯èŠ‚ï¼Œå°±æ˜¯â€ç†è§£â€œç¯å¢ƒçš„æŠ€æœ¯ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œå»ºç«‹ç¯å¢ƒåœ°å›¾éœ€è¦ç»å†ä»¥ä¸‹çš„æµç¨‹ï¼š ç”¨æˆ·æŠµè¾¾ä¸€ä¸ªæ–°åœºæ‰€ï¼Œå¼€å¯æ‘„åƒå¤´ã€‚ è®¾å¤‡æ ¹æ®é™€èºä»ªç­‰ä¼ æ„Ÿå™¨ç¡®å®šè‡ªå·±çš„é«˜åº¦ã€æœå‘ï¼Œå¹¶ä»¥æ­¤ä¸ºç©ºé—´åæ ‡ç³»åŸç‚¹ã€‚ è¯†åˆ«ç”¨æˆ·æ‘„åƒå¤´è¾“å…¥ï¼Œè¿›è¡Œâ€œç‚¹é˜µäº‘â€å»ºæ¨¡ã€‚ ç”¨æˆ·åˆ°å¤„ç§»åŠ¨ï¼Œç›´è‡³æ•´ä¸ªåœ°å›¾è¢«æ‰«æå»ºæ¨¡å®Œæˆã€‚ 3.2 æ˜¾ç¤ºæŠ€æœ¯ARçš„å¦ä¸€ä¸ªå…³é”®æŠ€æœ¯å°±æ˜¯æ˜¾ç¤ºæŠ€æœ¯ï¼Œä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š è§†è§‰å·®æ˜¾ç¤ºæŠ€æœ¯ å…¨æ¯æŠ•å½±æŠ€æœ¯ å…‰å½±æˆåƒæŠ€æœ¯ 3.3 äº¤äº’æŠ€æœ¯ç›®å‰ä¸ºæ­¢ï¼Œé™¤äº†ä¼ ç»Ÿçš„è§¦æ‘¸ï¼ŒæŒ‰é”®ã€è¯­éŸ³ç­‰æŠ€æœ¯ï¼ŒARå¤§è‡´æœ‰3ä¸ªæ–¹å‘çš„è™šæ‹Ÿäº¤äº’æŠ€æœ¯ï¼š åŠ¨ä½œæ•æ‰ï¼š ä¸»è¦æ˜¯æ‰‹éƒ¨åŠ¨æ•æ‰ï¼Œç›®å‰Hololens2åœ¨è¿™ä¸€å—ä¸ŠæŠ€æœ¯ç§¯ç´¯æœ€é›„åšï¼Œä¸éœ€è¦ä»»ä½•å¤–è®¾ï¼Œç›´æ¥é€šè¿‡æ‰‹åŠ¿å°±å¯ä»¥æµç•…æ“æ§è®¾å¤‡ã€‚ çœ¼åŠ¨è¿½è¸ªï¼š ä½¿ç”¨æ‘„åƒå¤´æ•æ‰äººçœ¼æˆ–è„¸éƒ¨çš„å›¾åƒï¼Œç„¶åç”¨ç®—æ³•å®ç°äººè„¸å’Œäººçœ¼çš„æ£€æµ‹ã€å®šä½ä¸è·Ÿè¸ªï¼Œä»è€Œä¼°ç®—ç”¨æˆ·çš„è§†çº¿å˜åŒ–ã€‚ è„‘æœºæ¥å£ï¼š é€šè¿‡è¯†åˆ«å¤§è„‘æ´»åŠ¨ç”µä¿¡å·æ¥æ“æ§è®¾å¤‡ï¼Œé©¬æ–¯å…‹æ——ä¸‹çš„Neuralinkå…¬å¸é€šè¿‡å‘å¤§è„‘æ¤å…¥ååˆ†ä¹‹ä¸€å‘ä¸ç²—ç»†çš„ç¥ç»çº¿ï¼Œæ¥æ£€æµ‹å’Œä¼ è¾“å¤§è„‘çš„ä¿¡å·ã€‚ 4.ç»“è¯­â€‹ 20å¹´å‰ï¼Œå½“äººä»¬ä½¿ç”¨QICQæ‰“ç€å­—ï¼Œå’Œå¤©å—æµ·åŒ—çš„é™Œç”Ÿäººåˆ†äº«å½¼æ­¤çš„æ•…äº‹æ—¶ï¼Œä¸ä¼šæƒ³åˆ°ï¼Œä»Šå¤©æˆ‘ä»¬ä¸€å¼ å›¾ç‰‡ï¼Œä¸€ä¸ªä¸ªè¡¨æƒ…åŒ…ï¼Œä¸€æ®µè§†é¢‘ï¼Œä¾¿å¯ä»¥è½»æ¾åœ°å°†æˆ‘ä»¬çš„æ•…äº‹åˆ†äº«ç»™é™Œç”Ÿäººã€‚20å¹´å‰ï¼Œæˆ‘ä»¬çœåƒä¿­ç”¨æŠ æŠ æœæœè®¡ç®—ç€æˆ‘ä»¬çš„2Gæµé‡ï¼Œå‘ä¸ªæ¶ˆæ¯è¿˜è€è½¬åœˆåœˆï¼Œåˆ°ä»Šå¤©ï¼Œ4Gå·²æ‚„ç„¶å¼€å¯äº†å…¨æ°‘ç›´æ’­æ—¶ä»£ï¼Œè€Œ5Gä¹Ÿå·²åœ¨å…¨é¢å¸ƒå±€ã€‚ â€‹ æˆ–è®¸åƒç”µå½±ã€Šå¤´å·ç©å®¶ã€‹é‡Œé¢çš„å…ƒå®‡å®™åœºæ™¯è¿˜éœ€è¦å¾ˆé•¿ä¸€æ®µè·¯è¦èµ°ï¼Œä½†è‡³å°‘æˆ‘è§‰å¾—ARã€VRæŠ€æœ¯å°†ä¼šåœ¨ä¸ä¹…çš„å°†æ¥å¸¦ç»™æˆ‘ä»¬å…¨æ–°çš„ä½“éªŒï¼Œå°±è®©æˆ‘ä»¬ä¸”èµ°ï¼Œä¸”çœ‹ï¼Œä¸”ä½“éªŒå§ï¼","categories":[],"tags":[{"name":"å…ƒå®‡å®™","slug":"å…ƒå®‡å®™","permalink":"https://flippy-bird.github.io/tags/%E5%85%83%E5%AE%87%E5%AE%99/"},{"name":"AR","slug":"AR","permalink":"https://flippy-bird.github.io/tags/AR/"}]},{"title":"çº¹ç†è´´å›¾é¢„ä¹˜é—®é¢˜","slug":"çº¹ç†è´´å›¾çš„é¢„ä¹˜é—®é¢˜","date":"2021-11-17T14:59:59.000Z","updated":"2026-01-16T10:40:28.948Z","comments":true,"path":"2021/11/17/çº¹ç†è´´å›¾çš„é¢„ä¹˜é—®é¢˜/","permalink":"https://flippy-bird.github.io/2021/11/17/%E7%BA%B9%E7%90%86%E8%B4%B4%E5%9B%BE%E7%9A%84%E9%A2%84%E4%B9%98%E9%97%AE%E9%A2%98/","excerpt":"çº¹ç†è´´å›¾é¢„ä¹˜é—®é¢˜","text":"çº¹ç†è´´å›¾é¢„ä¹˜é—®é¢˜ ç°è±¡åœ¨ä¸€æ¬¡openglçº¹ç†è´´å›¾è´´PNGå›¾ç‰‡çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘é‡åˆ°äº†ä¸‹é¢çš„é—®é¢˜ï¼Œç»“æœå¦‚ä¸‹å›¾ï¼š â€‹ å¯ä»¥å‘ç°ï¼Œè´´å›¾çš„è¾¹ç•Œå­˜åœ¨ä¸€äº›ç™½è‰²çš„ç‚¹ï¼Œéå¸¸å½±å“æœ€åçš„æ•ˆæœã€‚ä¸€å¼€å§‹ï¼Œæˆ‘ä»¥ä¸ºæ˜¯æ²¡æœ‰å¼€mimmapçš„åŸå› ï¼Œå› ä¸ºæˆ‘å‘ç°æˆ‘ä½¿ç”¨çš„è´´å›¾çš„ç²¾åº¦å¾ˆé«˜(2560 * 2560),ä½†æ˜¯å¹¶ä¸æ˜¯ï¼Œæˆ‘å·²ç»å¼€å¯mimmapï¼Œä»ç„¶æœ‰ç™½ç‚¹çš„å­˜åœ¨ã€‚æˆ‘æƒ³äº†å¾ˆä¹…ï¼Œä¸€ç›´ä»¥ä¸ºæ˜¯é”¯é½¿æˆ–è€…å…¶å®ƒåŸå› ï¼Œå„ç§RenderDocï¼Œmatlabå®éªŒï¼Œä»æ²¡æœ‰è§£å†³é—®é¢˜ï¼Œåé¢åœ¨çŸ¿å“¥çš„å¸®åŠ©ä¸‹ï¼Œä¸€ç§’è§£å†³äº†é—®é¢˜ï¼ŒçœŸå¤§ç¥å‘€ã€‚ Solutionå‡ºç°ä¸Šé¢çš„é—®é¢˜ä¸æ˜¯é”¯é½¿çš„é—®é¢˜ï¼Œè€Œæ˜¯alpha blendçš„é—®é¢˜ï¼Œä¸Šé¢é‚£å¼ wolfå›¾åƒçš„ç²¾åº¦æ˜¯2560 * 2560ï¼Œè¿›è¡Œè´´å›¾æ—¶ä¼šè¿›è¡Œç¼©æ”¾ï¼Œè¿™æ—¶ä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ï¼Œå…·ä½“çš„æ–‡ç« è§£é‡Šè§ä¸‹é¢çš„æ–‡ç« è§£é‡Š Alpha Blending: To Pre or Not To Pre [å›¾ç‰‡Alphaé¢„ä¹˜çš„ä½œç”¨] å…·ä½“çš„å¤„ç†ä»£ç  é¢„ä¹˜ä¹‹åé—®é¢˜å°±è§£å†³äº†ï¼Œç»“æœå¦‚ä¸‹ï¼š","categories":[{"name":"OpenGL","slug":"OpenGL","permalink":"https://flippy-bird.github.io/categories/OpenGL/"}],"tags":[{"name":"bug","slug":"bug","permalink":"https://flippy-bird.github.io/tags/bug/"}]},{"title":"æ•°æ®å¯¹é½é—®é¢˜","slug":"æ•°æ®å¯¹é½é—®é¢˜","date":"2021-11-17T14:59:59.000Z","updated":"2026-01-16T10:40:28.946Z","comments":true,"path":"2021/11/17/æ•°æ®å¯¹é½é—®é¢˜/","permalink":"https://flippy-bird.github.io/2021/11/17/%E6%95%B0%E6%8D%AE%E5%AF%B9%E9%BD%90%E9%97%AE%E9%A2%98/","excerpt":"æ•°æ®å¯¹é½é—®é¢˜","text":"æ•°æ®å¯¹é½é—®é¢˜ ç°è±¡æˆ‘åœ¨ä½¿ç”¨OpenGLåŠ è½½ä¸€ä¸ªå›¾ç‰‡æ•°æ®æ—¶,å…¶ä¸­æ•°æ®çš„å®½é«˜ä¸æ˜¯2çš„næ¬¡æ–¹ï¼Œå¯¼è‡´äº†è§£æçš„å‡ºæ¥çš„å›¾ç‰‡å‡ºç°äº†é—®é¢˜ï¼Œå¦‚ä¸‹å›¾ï¼š æˆ‘åŠ è½½çº¹ç†æ•°æ®çš„ä»£ç å¦‚ä¸‹ï¼š Solution åƒæ•°æ®åœ¨å†…å­˜ä¸­å¾ˆå°‘ä»¥ç´§å¯†åŒ…è£…çš„å½¢å¼å­˜åœ¨ï¼Œåœ¨å¾ˆå¤šç¡¬ä»¶å¹³å°ä¸Šï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œå›¾åƒçš„æ¯ä¸€è¡Œåº”è¯¥éƒ½ä»æŸä¸ªç‰¹å®šå¯¹é½åœ°å€å¼€å§‹ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒOpenGLé‡‡ç”¨4ä¸ªå­—èŠ‚çš„å¯¹é½æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€å¼ RGBå›¾åƒï¼ŒåŒ…å«3ä¸ªåˆ†é‡ï¼Œæ¯ä¸ªåˆ†é‡å 1ä¸ªå­—èŠ‚ï¼Œå¦‚æœå›¾åƒå®½åº¦ä¸º199åƒç´ ï¼Œé‚£ä¹ˆæ¯ä¸€è¡Œéœ€è¦çš„å­—èŠ‚æ•°ä¸º597å­—èŠ‚ã€‚ä½†æ˜¯å¦‚æœç¡¬ä»¶çš„ä½“ç³»ç»“æ„æ˜¯ä»¥4å­—èŠ‚æ’åˆ—ï¼Œé‚£ä¹ˆå›¾åƒçš„æ¯ä¸€è¡Œæœ«å°¾éƒ½ä¼šå¡«å……é¢å¤–çš„3ä¸ªç©ºå­—èŠ‚ï¼Œä»è€Œä½¿å¾—æ¯ä¸€è¡Œçš„å†…å­˜åœ°å€åç§»é‡ä¸º4çš„æ•´æ•°å€ã€‚å°½ç®¡è¿™æ ·è¡¨é¢ä¸Šçœ‹èµ·æ¥æ˜¯æµªè´¹äº†å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯è¿™ç§æ’åˆ—èƒ½å¤Ÿè®©å¤§å¤šæ•°CPUæ›´é«˜æ•ˆçš„è·å–æ•°æ®å—ã€‚å¦å¤–è®¸å¤šæœªç»å‹ç¼©çš„å›¾å½¢æ ¼å¼ä¹Ÿéµå¾ªè¿™ç§æƒ¯ä¾‹ï¼Œå¦‚Windowsä¸­çš„.BMPæ–‡ä»¶ã€‚Targa(.TGA)æ˜¯ä»¥1å­—èŠ‚æ’åˆ—çš„ã€‚ åœ¨å‘OpenGLæäº¤å›¾åƒæ•°æ®æˆ–ä»OpenGLä¸­è·å–å›¾åƒæ•°æ®æ—¶ï¼ŒOpenGLéœ€è¦çŸ¥é“å¯¹æ•°æ®ä»¥ä½•ç§æ–¹å¼åŒ…è£…å’Œè§£åŒ…è£…æ“ä½œã€‚é€šè¿‡å‡½æ•°void glPixelStorei (GLenum pname, GLint param)ï¼ŒglPixelStoref (GLenum pname, GLfloat param)å¯ä»¥æ”¹å˜æˆ–è€…æ¢å¤åƒç´ çš„å­˜å‚¨æ–¹å¼ã€‚ä¾‹å¦‚éœ€è¦æ”¹æˆç´§å¯†åŒ…è£…æ–¹å¼(å³åƒç´ è¡Œçš„å¯¹é½æ–¹å¼ï¼Œå¯é€‰1.2.4.8)è°ƒç”¨å‡½æ•°glPixelStorei(GL_UNPACK_ALIGNMENT, 1)ã€‚å…¶å‚æ•°éƒ½æ˜¯ä»¥GL_UNPACK_å’ŒGL_PACK_ä¸ºå‰ç¼€æ–¹å¼æˆå¯¹å‡ºç°ï¼Œå‰ç€è¡¨ç¤ºä»å†…å­˜ä¸­è¯»å–æ•°æ®(å¯¹å‡½æ•°glReadPixelsäº§ç”Ÿå½±å“)ï¼Œåè€…è¡¨ç¤ºå­˜å‚¨æ•°æ®è‡³å†…å­˜ä¸­(å¯¹è°ƒç”¨å‡½æ•°glTexImage2Dç­‰äº§ç”Ÿå½±å“)ã€‚ OpenGL æ•°æ®å¤„ç†(ä¸‹) è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯åœ¨åˆ›å»ºçº¹ç†çš„æ—¶å€™å°†çº¹ç†è®¾ç½®ä¸º1å­—èŠ‚å¯¹é½å³å¯ï¼Œå¦‚ä¸‹ï¼Œå³å¯è§£å†³é—®é¢˜ï¼š 1glPixelStorei(GL_UNPACK_ALIGNMENT, 1) // è¿™é‡Œçš„GL_UNPACK_ALIGNMENTæ˜¯æŒ‡ä¸Šä¼ æ•°æ® å½“æˆ‘ä»¬è¦ä»fboè¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå¯èƒ½ä¹Ÿå­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼ŒåŒç†ï¼Œæˆ‘ä»¬åœ¨è¯»å–çº¹ç†çš„æ—¶å€™è®¾ç½®ä¸‹é¢çš„å‚æ•°å³å¯ 1glPixelStorei(GL_PACK_ALIGNMENT, 1)","categories":[{"name":"OpenGL","slug":"OpenGL","permalink":"https://flippy-bird.github.io/categories/OpenGL/"}],"tags":[{"name":"bug","slug":"bug","permalink":"https://flippy-bird.github.io/tags/bug/"}]},{"title":"èŠ±å±é—®é¢˜(ç²¾åº¦ä¸å¤Ÿå¯¼è‡´)","slug":"èŠ±å±é—®é¢˜(ç²¾åº¦ä¸å¤Ÿå¯¼è‡´)","date":"2021-11-17T14:59:59.000Z","updated":"2026-01-16T10:40:28.948Z","comments":true,"path":"2021/11/17/èŠ±å±é—®é¢˜(ç²¾åº¦ä¸å¤Ÿå¯¼è‡´)/","permalink":"https://flippy-bird.github.io/2021/11/17/%E8%8A%B1%E5%B1%8F%E9%97%AE%E9%A2%98(%E7%B2%BE%E5%BA%A6%E4%B8%8D%E5%A4%9F%E5%AF%BC%E8%87%B4)/","excerpt":"èŠ±å±é—®é¢˜","text":"èŠ±å±é—®é¢˜ ç°è±¡ æˆ‘åœ¨ä½¿ç”¨stbi_imageå»å°†ä¸€ä¸ªå›¾ç‰‡æ•°æ®è½¬åŒ–ä¸ºçº¹ç†å›¾ç‰‡ï¼Œæˆ‘çš„ä»£ç å¦‚ä¸‹ï¼š è¿™é‡Œæˆ‘ä¸€å¼€å§‹å†™çš„æ˜¯char,ç»“æœè¾“å‡ºå›¾ç‰‡çš„æ•°æ®å…¨æ˜¯0ï¼Œå› ä¸ºä½¿ç”¨char,å‘ç”Ÿäº†æ•°æ®çš„ä¸Šæº¢ï¼Œå˜æˆäº†0ï¼› è‡³äºä¸Šé¢çš„é‚£ä¸ªèŠ±å±ç°è±¡ï¼Œæ˜¯ç”±äºç²¾åº¦ä¸å¤Ÿå¯¼è‡´çš„ã€‚ Solutionåˆšå¼€å§‹æ—¶ï¼Œæˆ‘å†™çš„æ˜¯255(ä¸‹å›¾æ ‡è®°å¤„ï¼‰ï¼Œç»“æœå°±å‡ºç°äº†èŠ±å±çš„ç°è±¡ æ”¹æˆ255.0ä¹‹åæ˜¾ç¤ºå°±æ­£å¸¸äº†","categories":[{"name":"OpenGL","slug":"OpenGL","permalink":"https://flippy-bird.github.io/categories/OpenGL/"}],"tags":[{"name":"bug","slug":"bug","permalink":"https://flippy-bird.github.io/tags/bug/"}]},{"title":"RenderDocä½¿ç”¨","slug":"RenderDocä½¿ç”¨","date":"2021-11-17T14:54:16.000Z","updated":"2026-01-16T10:40:28.944Z","comments":true,"path":"2021/11/17/RenderDocä½¿ç”¨/","permalink":"https://flippy-bird.github.io/2021/11/17/RenderDoc%E4%BD%BF%E7%94%A8/","excerpt":"RenderDocä½¿ç”¨","text":"RenderDocä½¿ç”¨ ç»å¯¹è·¯å¾„ä½¿ç”¨RenderDocè°ƒè¯•ç¨‹åºæ—¶ï¼Œç¨‹åºä¸­æ¶‰åŠåˆ°çš„ä¸€äº›ç›¸å¯¹è·¯å¾„ï¼Œå¯èƒ½è¯»å–ä¸åˆ°ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸è¿è¡Œç¨‹åºï¼Œå› æ­¤éœ€è¦æ”¹æˆç»å¯¹è·¯å¾„ï¼Œå¦‚ä¸‹ï¼š åŒ…æ‹¬è¯»å–å›¾ç‰‡æ—¶ï¼Œé‚£äº›è·¯å¾„ä¹Ÿè¦è®¾ç½®ä¸ºç»å¯¹è·¯å¾„ RenderDocè®¾ç½®ç¯å¢ƒå˜é‡ æœ‰äº›ç¨‹åºå¯èƒ½ä¼šéœ€è¦å‘½ä»¤è¡Œçš„å‚æ•°æ‰èƒ½æ‰§è¡Œï¼Œå¹¶ä¸”å¯èƒ½ä¼šä¾èµ–ä¸€äº›åŠ¨æ€åº“ï¼Œå¦‚å›¾ï¼ŒæŒ‰ç…§ä¸Šå›¾è¿›è¡Œè®¾ç½®å³å¯","categories":[{"name":"å·¥å…·ä½¿ç”¨","slug":"å·¥å…·ä½¿ç”¨","permalink":"https://flippy-bird.github.io/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"}],"tags":[{"name":"RenderDoc","slug":"RenderDoc","permalink":"https://flippy-bird.github.io/tags/RenderDoc/"}]},{"title":"é¢œè‰²æ ¼å¼é—®é¢˜","slug":"é¢œè‰²æ ¼å¼é—®é¢˜","date":"2021-11-17T14:49:59.000Z","updated":"2026-01-16T10:40:28.947Z","comments":true,"path":"2021/11/17/é¢œè‰²æ ¼å¼é—®é¢˜/","permalink":"https://flippy-bird.github.io/2021/11/17/%E9%A2%9C%E8%89%B2%E6%A0%BC%E5%BC%8F%E9%97%AE%E9%A2%98/","excerpt":"é¢œè‰²æ ¼å¼é—®é¢˜","text":"é¢œè‰²æ ¼å¼é—®é¢˜ è¿™ä¸ªé—®é¢˜å¯èƒ½ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨æ„çš„é‡ç‚¹æ˜¯ï¼Œå½“å‘ç”Ÿé¢œè‰²é—®é¢˜æ—¶ï¼Œå¯ä»¥åœ¨è¿™ä¸€æ–¹é¢æƒ³ä¸€æƒ³ï¼Œä¼šä¸ä¼šæ˜¯é¢œè‰²çš„é¡ºåºä¸å¯¹å¯¼è‡´çš„ï¼Œæ˜¯RGBAï¼Œè¿˜æ˜¯BRGAï¼Œäº¦æˆ–æ˜¯YUV420ç­‰ç­‰ï¼Œè¿™äº›éƒ½ä¼šå¯¼è‡´æœ€åæ¸²æŸ“å‡ºæ¥çš„é¢œè‰²ä¸å¯¹ï¼Œå°±åƒæˆ‘ä¹‹å‰åœ¨Metalä¸­çš„é‡åˆ°çš„é¢œè‰²é—®é¢˜ï¼Œå¯èƒ½å°±æ˜¯è¿™ä¸ªåŸå› å¯¼è‡´çš„(è§ä¸‹é¢é“¾æ¥) è¾“å‡ºçº¹ç†ä¸ºYUVå’ŒRGB ä¸‹é¢è¿™å¼ å›¾ç‰‡æ˜¯æˆªå–äºOpenGLçš„çº¹ç†é‡‡å–é‚£éƒ¨åˆ†çš„ä»£ç ï¼Œæ³¨æ„å›¾ç‰‡çš„æ ¼å¼ä¸ºjpgï¼Œç„¶åè¯»å–å›¾ç‰‡çš„æ ¼å¼ä¸ºRGB ä½†æ˜¯ä¸‹é¢è¿™å¼ æˆªå›¾ä¸­ï¼Œæˆ‘éœ€è¦åŠ è½½çš„å›¾ç‰‡æ•°æ®çš„æ ¼å¼æ˜¯pngï¼Œæ˜¯4é€šé“çš„ï¼ˆè°ƒè¯•æ—¶å¯ä»¥ä»nrChannelså‚æ•°çœ‹å‡ºï¼‰ï¼Œæ‰€ä»¥æ­£ç¡®çš„æ–¹æ³•å¦‚ä¸‹ï¼š å¦‚æœæ ¼å¼æ²¡æœ‰æ³¨æ„çš„è¯ï¼Œå°±ä¼šå‡ºç°è¯»å–çš„æ•°æ®ä¸æ­£ç¡®çš„æƒ…å†µ","categories":[{"name":"OpenGL","slug":"OpenGL","permalink":"https://flippy-bird.github.io/categories/OpenGL/"}],"tags":[{"name":"OpenGL","slug":"OpenGL","permalink":"https://flippy-bird.github.io/tags/OpenGL/"}]},{"title":"å¯¼å…¥dllé—®é¢˜","slug":"å¯¼å…¥dllé—®é¢˜","date":"2021-11-17T14:46:59.000Z","updated":"2026-01-16T10:40:28.948Z","comments":true,"path":"2021/11/17/å¯¼å…¥dllé—®é¢˜/","permalink":"https://flippy-bird.github.io/2021/11/17/%E5%AF%BC%E5%85%A5dll%E9%97%AE%E9%A2%98/","excerpt":"å¯¼å…¥dllé—®é¢˜","text":"å¯¼å…¥dllé—®é¢˜ é—®é¢˜æˆ‘åœ¨AEä¸­å¯¼å…¥dllæ—¶ï¼Œå¯¼å…¥å¤±è´¥ï¼Œä½†æ˜¯æˆ‘ç¡®å®åŠ è½½äº†æ‰€æœ‰çš„dllåº“ Solutioné—®é¢˜å‡ºåœ¨æˆ‘åŠ è½½çš„dllä¹Ÿæœ‰ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥éœ€è¦æŒ‰ç…§é¡ºåºæ¥åŠ è½½dllåº“å¦‚ä¸‹ å¯¼å…¥ffmpegçš„dllæ—¶ï¼Œåœ¨AEä¸­ä¸€å®šè¦æŒ‰ç…§ä¸Šé¢çš„é¡ºåºè¿›è¡Œå¯¼å…¥ï¼Œå› ä¸ºåé¢çš„åº“ä¼šä¾èµ–å‰é¢çš„åº“ï¼Œæˆ‘ä¹‹å‰åœ¨è¿™é‡Œå¡äº†å¾ˆä¹…ï¼Œæˆ‘å½“æ—¶æƒ³ç€é€ä¸ªå¯¼å…¥ï¼Œç„¶è€Œæˆ‘é€‰æ‹©çš„ç¬¬ä¸€ä¸ªæ˜¯avformat,è¿™ä¸ªåº“ä¼šä¾èµ–avutilï¼Œavcodecï¼Œå› æ­¤ä»£ç è¿è¡Œåˆ°è¿™å„¿çš„æ—¶å€™å°±ä¼šå´©æ‰ã€‚ å…¶å®ƒ1.åœ¨è§£å†³dllç›¸å…³é—®é¢˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨dependsè½¯ä»¶æŸ¥çœ‹åº“ä¾èµ–ï¼Œå¾ˆå¥½ç”¨ 2.å¯ä»¥ä½¿ç”¨vsçš„ä¸€äº›å‘½ä»¤è¡Œå·¥å…·æŸ¥çœ‹dllçš„æ¶æ„ï¼Œ64 or 32","categories":[{"name":"C++","slug":"C","permalink":"https://flippy-bird.github.io/categories/C/"}],"tags":[{"name":"bug","slug":"bug","permalink":"https://flippy-bird.github.io/tags/bug/"}]},{"title":"Metalæ¸²æŸ“åˆ°çº¹ç†","slug":"Metalæ¸²æŸ“åˆ°çº¹ç†","date":"2021-09-04T05:54:42.000Z","updated":"2026-01-16T10:40:28.947Z","comments":true,"path":"2021/09/04/Metalæ¸²æŸ“åˆ°çº¹ç†/","permalink":"https://flippy-bird.github.io/2021/09/04/Metal%E6%B8%B2%E6%9F%93%E5%88%B0%E7%BA%B9%E7%90%86/","excerpt":"æ¸²æŸ“åˆ°çº¹ç†","text":"æ¸²æŸ“åˆ°çº¹ç† æ»¤é•œé“¾ Metal - 5 æ»¤é•œé“¾ï¼ˆæ¸²æŸ“åˆ°çº¹ç†ï¼‰ Metalçš„æ ‡å‡†åæ ‡ç³»NDCã€å¸§ç¼“å­˜åæ ‡ç³»FrameBuffer Coordinate (ä¹Ÿå«Viewport Coorninate)ä»¥åŠçº¹ç†åæ ‡ç³»ï¼ˆTexture Coordinate)çš„åŸç‚¹ä¸ä¸€è‡´ï¼Œè¿˜ä¼šåˆ†åˆ«å¯¹ä»–ä»¬è¿›è¡Œä»‹ç»å’Œè§£æã€‚ åœ¨Metalä¸­è¦æ¸²æŸ“åˆ°çº¹ç†æœ‰å¦‚ä¸‹æ­¥éª¤ï¼š 1.åˆ›å»ºç©ºçº¹ç†123456789101112+ (nullable id&lt;MTLTexture&gt;)createEmptyTexture: (id&lt;MTLDevice&gt;)device WithWidth: (size_t)width withHeight: (size_t)height usage: (MTLTextureUsage)usage &#123; MTLTextureDescriptor *texDescriptor = [MTLTextureDescriptor texture2DDescriptorWithPixelFormat: MTLPixelFormatRGBA8Unorm width: width height: height mipmapped: false]; texDescriptor.usage = usage; id&lt;MTLTexture&gt; texture = [device newTextureWithDescriptor: texDescriptor]; return texture;&#125; usage çº¹ç†çš„ç”¨å¤„ï¼Œæ˜¯ MTLTextureUsage æšä¸¾ï¼Œæœ‰å¦‚ä¸‹æšä¸¾å€¼ï¼š MTLTextureUsageUnknown æœªçŸ¥ç”¨å¤„ï¼ˆè¿è¡Œæ—¶è®¾ç½®ï¼‰ï¼Œä¼šæŸè€—æ€§èƒ½ MTLTextureUsageShaderRead è¯¥çº¹ç†å°†è¢«è¯»å– MTLTextureUsageShaderWrite è¯¥çº¹ç†å°†è¢«å†™å…¥ MTLTextureUsageRenderTarget è¯¥çº¹ç†å°†ä½œä¸ºæ¸²æŸ“ç›®æ ‡ MTLTextureUsagePixelFormatView åœ¨ PixelFormatView è¢«ä½¿ç”¨ï¼ˆæš‚ä¸ä»‹ç»ï¼‰ å›åˆ° demo ä¸­ï¼Œè¿™ä¸ªä¸­é—´ buffer æ˜¯ å½“æ¬¡æ¸²æŸ“çš„æ¸²æŸ“ç›®æ ‡ ï¼Œä¹Ÿå°† ä½œä¸ºä¸‹ä¸€æ¬¡æ¸²æŸ“çš„è¾“å…¥è¢«è¯»å–ï¼ˆé‡‡æ ·ï¼‰ï¼Œå› æ­¤ usage æ˜¯ MTLTextureUsageShaderRead | MTLTextureUsageRenderTargetã€‚ å®Œæ•´è°ƒç”¨ï¼š 1234_grayResultTexutre = [MetalUtils createEmptyTexture: _device WithWidth: CGImageGetWidth(cgImage) withHeight: CGImageGetHeight(cgImage) usage: MTLTextureUsageShaderRead | MTLTextureUsageRenderTarget]; 2.ç©ºçº¹ç†å…³è”åˆ°æ¸²æŸ“ç›®æ ‡ä»¥å¾€ä¸ºäº†è¦å°†æ¸²æŸ“ç»“æœå±•ç¤ºï¼Œæˆ‘ä»¬çš„æ¸²æŸ“ç›®æ ‡æ˜¯ä¸ Layer å…³è”èµ·æ¥çš„ï¼š 1RenderTargetDesc.colorAttachments[0].texture = currentDrawable.texture; ä½†æ˜¯è¿™æ¬¡æˆ‘ä»¬éœ€è¦æ¸²æŸ“åˆ°çº¹ç†ä¸Šï¼Œå› æ­¤è¦æŠŠ æ¸²æŸ“ç›®æ ‡å’Œè¦æ¸²æŸ“åˆ°çš„çº¹ç† å…³è”èµ·æ¥ï¼š 1_grayRenderTargetDesc.colorAttachments[0].texture = _grayResultTexutre; 3.æäº¤æŒ‡ä»¤ï¼Œæ‰§è¡Œæ¸²æŸ“æŒ‡ä»¤æ˜¯è¢« â€è£…â€œ åˆ° Encoder ä¸Šçš„ï¼Œå› æ­¤æ¸²æŸ“è¿‡ç¨‹ä¹Ÿå¤§åŒå°å¼‚ï¼Œä½†æ˜¯ç”±äº ä¸éœ€è¦å±•ç¤ºæ¸²æŸ“ç»“æœï¼ˆå³ä¸éœ€è¦ä¸Šå± swap bufferï¼‰ï¼Œæ‰€ä»¥ä¸éœ€è¦ presentDrawableã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647- (void)render_gray &#123; // å°†æœ¬æ¬¡ Command Encoder å’Œ æ¸²æŸ“çš„ç›®æ ‡ï¼ˆMTLTextureï¼‰å…³è”èµ·æ¥ _grayRenderTargetDesc.colorAttachments[0].texture = _grayResultTexutre; id&lt;MTLCommandBuffer&gt; commandBuffer = [_queue commandBuffer]; commandBuffer.label = @&quot;Gray Command Buffer&quot;; id&lt;MTLRenderCommandEncoder&gt; encoder = [commandBuffer renderCommandEncoderWithDescriptor: _grayRenderTargetDesc]; encoder.label = @&quot;Gray Command Encoder&quot;; [encoder setViewport: (MTLViewport) &#123; .originX = 0, .originY = 0, .width = _sourceTexutre.width, .height = _sourceTexutre.height, .znear = 0, .zfar = 1 &#125;]; [encoder setRenderPipelineState: _grayRenderPipelineState]; [encoder setVertexBytes: grayVertices length: sizeof(grayVertices) atIndex: 0]; [encoder setVertexBytes: texCoor length: sizeof(texCoor) atIndex: 1]; [encoder setFragmentTexture: _sourceTexutre atIndex: 0]; [encoder setFragmentBytes: &amp;_grayIntensity length: sizeof(float) atIndex: 0]; [encoder drawIndexedPrimitives: MTLPrimitiveTypeTriangleStrip indexCount: 6 indexType: MTLIndexTypeUInt32 indexBuffer: _indexBuffer indexBufferOffset: 0]; [encoder endEncoding]; [commandBuffer commit];&#125; æ³¨æ„ï¼ŒCommand Buffer å¹¶ä¸éœ€è¦ presentDrawable:ã€‚","categories":[{"name":"iOSæ–°æ‰‹æ‘","slug":"iOSæ–°æ‰‹æ‘","permalink":"https://flippy-bird.github.io/categories/iOS%E6%96%B0%E6%89%8B%E6%9D%91/"}],"tags":[{"name":"Metal","slug":"Metal","permalink":"https://flippy-bird.github.io/tags/Metal/"}]},{"title":"Metalä¸­åŠ è½½MTLLibrary","slug":"Metalä¸­åŠ è½½MTLLibrary","date":"2021-09-04T05:54:16.000Z","updated":"2026-01-16T10:40:28.949Z","comments":true,"path":"2021/09/04/Metalä¸­åŠ è½½MTLLibrary/","permalink":"https://flippy-bird.github.io/2021/09/04/Metal%E4%B8%AD%E5%8A%A0%E8%BD%BDMTLLibrary/","excerpt":"Metal ä¸­åŠ è½½MTLLibrary","text":"Metal ä¸­åŠ è½½MTLLibrary ä¸€èˆ¬æƒ…å½¢ä¸‹ï¼Œæˆ‘ä»¬åŠ è½½MTLLibraryä¼šä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š 1id&lt;MTLLibrary&gt; defaultLibrary = [self.mtkView.device newDefaultLibrary] ç¡®å®è¿™æ ·æ˜¯æ­£ç¡®çš„ï¼Œæ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æ˜¯å¼€å‘ä¸€ä¸ªé™æ€åº“ï¼Œ.Metal æ–‡ä»¶æ”¾ç½®åœ¨ä½ çš„é™æ€åº“å·¥ç¨‹æ–‡ä»¶ä¸­ï¼Œåœ¨æµ‹è¯•æ—¶ä½¿ç”¨ä¸Šé¢çš„å‡½æ•°å°±ä¼šæ‰¾ä¸åˆ°è¿™ä¸ªMetalæ–‡ä»¶ï¼Œå½“ç„¶ï¼Œä½ æŠŠMetalæ–‡ä»¶å¤åˆ¶åˆ°ä½ çš„å¼€å‘å·¥ç¨‹ä¸­ï¼Œå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯è¿™æ ·çš„è¯ï¼ŒMetalæ–‡ä»¶å°±æš´éœ²å‡ºæ¥äº†ï¼Œè€Œä¸”æˆ‘ä»¬ç»™å…¶ä»–äººæä¾›é™æ€åº“æ—¶ï¼Œä¸å¯èƒ½é¡ºå¸¦è¿˜æŠŠMetalæ–‡ä»¶ç»™ä»–ï¼Œå› æ­¤éœ€è¦æ¢ä¸€ç§æ–¹æ³•åŠ è½½Metalæ–‡ä»¶ åœ¨è‹¹æœçš„å®˜æ–¹è®ºå›ä¸Šï¼Œæä¾›äº†ä¸€ç§æ–¹æ³•ä¸€ç§æ–¹æ³• 123NSError *error = nil;NSString *libPath = [[NSBundle mainBundle] pathForResource:@&quot;MySecretMetalLib&quot; ofType:@&quot;metallib&quot;];id&lt;MTLLibrary&gt; library = [device newLibraryWithFile:libPath error:&amp;error]; å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬æŸ¥çœ‹deviceåˆ›å»ºlibraryçš„æ–¹æ³•æ–‡æ¡£çš„è¯ï¼Œä¹Ÿä¼šæ‰¾åˆ°ä¸‹é¢çš„æ–¹æ³•ï¼Œå³å°†metalæ–‡ä»¶è½¬åŒ–æˆå­—ç¬¦ä¸²ï¼Œç„¶åä¼ å…¥ï¼Œç±»ä¼¼äºOpenGLä¸­ä¼ å…¥shaderæ–‡ä»¶ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š 1id&lt;MTLLibrary&gt; defaultLibrary = [m_metalRendererDevice newLibraryWithSource:shaderSource options: nil error:nil]; å¯¹åº”çš„shaderSourceæ–‡ä»¶ä¸ºï¼š å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ·»åŠ åŒå¼•å·å°†Metalæ–‡ä»¶è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ä¸ªäººè§‰å¾—å¤ªéº»çƒ¦äº†ï¼Œç„¶åå°±å­¦ä¹ äº†åˆ«äººçš„è¿™ç§å­—ç¬¦ä¸²åŒ–å†™æ³•ï¼Œå½“ç„¶å¦‚æœæ˜¯C++çš„è¯ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨R();å½“ç„¶ï¼Œå¼€å§‹çš„æ—¶å€™è¿˜é‡åˆ°äº†å…¶å®ƒé—®é¢˜ï¼Œæ³¨æ„åˆ°ä¸Šé¢å›¾ä¸­çš„çº¢è‰²éƒ¨åˆ†ï¼Œä¸€å¼€å§‹ï¼Œæˆ‘æ²¡æœ‰æ·»åŠ ï¼Œåé¢æ·»åŠ äº†å°±å¯ä»¥æ­£å¸¸è¯»å–Metalæ–‡ä»¶ä¸­åé¢çš„å‡½æ•°äº†ã€‚ å¦å¤–ï¼Œå­—ç¬¦ä¸²åŒ–é‡Œé¢å¥½åƒä¸èƒ½æ·»åŠ å¦‚ä¸‹çš„å¼•ç”¨ï¼ˆä¸å¤ªç¡®å®šï¼Œä½†æ˜¯æˆ‘çš„metalæ–‡ä»¶ç¡®å®æ²¡æœ‰ç¼–è¯‘æˆåŠŸï¼Œå¯èƒ½å’Œmetalæ–‡ä»¶çš„ç¼–è¯‘æ–¹å¼æœ‰å…³ç³»ï¼Œå…ˆè®°å½•åœ¨è¿™å„¿å§ï¼Œåé¢è§£å†³å‘äº†å†å›æ¥å¡«å‘ã€‚ 1#import &quot;ShaderTypes.h&quot; //ç›´æ¥å°†ç»“æ„ä½“å†™è¿›å­—ç¬¦ä¸²é‡Œé¢å°±è¡Œï¼Œ","categories":[{"name":"iOSæ–°æ‰‹æ‘","slug":"iOSæ–°æ‰‹æ‘","permalink":"https://flippy-bird.github.io/categories/iOS%E6%96%B0%E6%89%8B%E6%9D%91/"}],"tags":[{"name":"Metal","slug":"Metal","permalink":"https://flippy-bird.github.io/tags/Metal/"}]},{"title":"è¾“å‡ºçº¹ç†ä¸ºYUVå’ŒRGB","slug":"è¾“å‡ºçº¹ç†ä¸ºYUVå’ŒRGB","date":"2021-09-04T05:53:23.000Z","updated":"2026-01-16T10:40:28.946Z","comments":true,"path":"2021/09/04/è¾“å‡ºçº¹ç†ä¸ºYUVå’ŒRGB/","permalink":"https://flippy-bird.github.io/2021/09/04/%E8%BE%93%E5%87%BA%E7%BA%B9%E7%90%86%E4%B8%BAYUV%E5%92%8CRGB/","excerpt":"è¾“å‡ºçº¹ç†ä¸ºYUV å’ŒRGB","text":"è¾“å‡ºçº¹ç†ä¸ºYUV å’ŒRGB å†™è¿™ç¯‡åšå®¢ï¼Œæ˜¯å› ä¸ºæˆ‘åœ¨ä½¿ç”¨OpenGL ESæ¸²æŸ“ä»è§†é¢‘è·å–çš„çº¹ç†æ—¶(ä½¿ç”¨YUVçš„æ–¹å¼)ï¼Œå‡ºç°äº†é¢œè‰²åå·®çš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»”ç»†çœ‹äº†æˆ‘çš„ä»£ç ï¼Œé‡‡æ ·åæ ‡ï¼Œå‚æ•°è®¾ç½®ç­‰éƒ½æ²¡æœ‰é—®é¢˜ï¼Œç„¶åæˆ‘ä¹Ÿå­¦ä¹ äº†åˆ«äººçš„ç›¸å…³ä»£ç ï¼Œå‘ç°ä½¿ç”¨çš„æ–¹å¼éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤è¢«è¿™ä¸ªé—®é¢˜å¡ä¸»äº†ï¼Œäºæ˜¯åªå¥½æ¢ä¸€ç§æ–¹å¼äº†ï¼Œå› æ­¤å€Ÿé‰´äº†ä¸‹é¢è¿™ç¯‡æ–‡ç« çš„è®¾ç½®æ–¹æ³•ï¼Œå°†è§†é¢‘è¾“å‡ºæ•°æ®ç›´æ¥è®¾ç½®ä¸ºRGBï¼Œè§£å†³äº†é¢œè‰²åå·®çš„é—®é¢˜ AVPlayeråˆä½“éªŒä¹‹è§†é¢‘è§£çº¹ç† 1.YUVçº¹ç†ç”±äºè§†é¢‘çš„ç¼–ç æ ¼å¼åŸºæœ¬éƒ½æ˜¯YUV420ï¼Œç„¶åè‹¹æœçš„demoä»£ç ä¸­é€šè¿‡AVPlayerItemVideoOutputè·å–Y-Pannelå’Œ UV-Pannel ä¸¤å¼ çº¹ç†ï¼Œæœ€ååœ¨Shaderä¸­å¯¹ä¸¤ç§çº¹ç†ç»„åˆå¤„ç†ã€‚ è®¾ç½®AVPlayerItemVideoOutputçš„éƒ¨åˆ†ä»£ç  12NSDictionary *pixBuffAttributes = @&#123;(id)kCVPixelBufferPixelFormatTypeKey: @(kCVPixelFormatType_420YpCbCr8BiPlanarVideoRange)&#125;;self.videoOutput = [[AVPlayerItemVideoOutput alloc] initWithPixelBufferAttributes:pixBuffAttributes]; è¾“å‡ºçº¹ç†çš„éƒ¨åˆ†ä»£ç  123456//Y-PlaneglActiveTexture(GL_TEXTURE0);err = CVOpenGLESTextureCacheCreateTextureFromImage(kCFAllocatorDefault, _videoTextureCache, pixelBuffer, NULL, GL_TEXTURE_2D, GL_RED_EXT, frameWidth, frameHeight, GL_RED_EXT, GL_UNSIGNED_BYTE, 0, &amp;_lumaTexture);//UV-planeglActiveTexture(GL_TEXTURE1);err = CVOpenGLESTextureCacheCreateTextureFromImage(kCFAllocatorDefault, _videoTextureCache, pixelBuffer, NULL, GL_TEXTURE_2D, GL_RG_EXT, frameWidth / 2, frameHeight / 2, GL_RG_EXT, GL_UNSIGNED_BYTE, 1, &amp;_chromaTexture); å…¶ä¸­çš„kCVPixelFormatType_420YpCbCr8BiPlanarVideoRangeæ˜¯CoreVideoä¸­æŒ‡å®šçš„Pixel Format Identifiers ç±»å‹ï¼Œåœ¨OpenGLES2ç¯å¢ƒä¸‹å…¶å¯¹åº”çš„å‚æ•°æ˜¯GL_RED_EXTå’ŒGL_RG_EXTã€‚ 2.RGBçº¹ç†é¦–å…ˆè¦æ˜ç™½ä¸€ç‚¹ï¼Œä¸Šå›¾ä¸­æ˜ç¡®è¯´æ˜ï¼ŒBGRAçš„è¾“å‡ºæ ¼å¼æ˜¯420vçš„ä¸¤å€å¤šå¸¦å®½(More than 2x bandwidth)ï¼Œå¹¶ä¸”åœ¨è¯¥å›¾æ¥æº,WWDCçš„è¿™ä¸ªè§†é¢‘çš„27:00ä½ç½®æ˜ç¡®è¯´æ˜420vçš„è¾“å‡ºæ ¼å¼æ•ˆç‡ä¼šæ˜æ˜¾é«˜äºBGRAçš„è¾“å‡ºæ ¼å¼(It does come across if you can avoid using BGRA and doing your work in YUV, itâ€™s more efficient from bandwidth standpoint),ä½†æ˜¯åè¿‡æ¥ï¼Œå¯¹äºOpenGLæ¥è¯´ï¼Œä¸¤å¼ çº¹ç†çš„æ€§èƒ½åˆä¼šä½äºä¸€å¼ çº¹ç†ã€‚è€Œä¸”ç›´æ¥ä½¿ç”¨ä½¿ç”¨BGRAæ¯•ç«Ÿä¼šæ–¹ä¾¿å¾ˆå¤šï¼Œå› ä¸ºè¾“å‡ºçš„ç›´æ¥å°±æ˜¯ä¸€å¼ çº¹ç†ã€‚ä½†æ˜¯ç°åœ¨æ¯•ç«Ÿéƒ½iOS11æ—¶ä»£äº†ï¼Œæ‰€ä»¥å½±å“å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ è®¾ç½®AVPlayerItemVideoOutputçš„ä»£ç  12NSDictionary *pixBuffAttributes = @&#123;(id)kCVPixelBufferPixelFormatTypeKey: @(kCVPixelFormatType_32BGRA)&#125;;self.videoOutput = [[AVPlayerItemVideoOutput alloc] initWithPixelBufferAttributes:pixBuffAttributes]; è¾“å‡ºçº¹ç†çš„ä»£ç  1CVReturn textureRet = CVOpenGLESTextureCacheCreateTextureFromImage(kCFAllocatorDefault, self.videoTextureCache, pixelBuffer, nil, GL_TEXTURE_2D, GL_RGBA, width, height, GL_BGRA, GL_UNSIGNED_BYTE, 0, &amp;_textureOutput); BGRAå¯¹åº”çš„è¾“å‡ºæ ¼å¼æ˜¯kCVPixelFormatType_32BGRA,å…¶å¯¹åº”çš„ä»Bufferè¯»çº¹ç†çš„å‚æ•°æ˜¯GL_RGBAå’ŒGL_BGRAã€‚ 2021.9.3 åé¢æƒ³äº†ä¸€ä¸‹ï¼Œæˆ‘æ˜¯è¾“å‡ºåˆ°ä¸€ä¸ªCALayerä¸Šçš„ï¼ŒCALayerä¸Šä¹Ÿæœ‰é»˜è®¤çš„é¢œè‰²æ˜¾ç¤ºæ–¹å¼ï¼Œåº”è¯¥æ˜¯è¿™ä¸€é¡¹ä¸åŒ¹é…å¯¼è‡´çš„ï¼Œå› ä¸ºå½“æ—¶çš„bugæ˜¯é¢œè‰²åè“ï¼Œåçº¢(æˆ‘è¯•ç€æ”¹å˜äº†è¾“å‡ºçš„RGBå€¼æ—¶å‡ºç°çš„ç°è±¡)ï¼Œå¯èƒ½æ˜¯è¿™ä¸ªåŸå› ï¼Œå› ä¸ºå½“æ—¶æ²¡æœ‰è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œåé¢å¦‚æœé‡åˆ°ç±»ä¼¼é—®é¢˜ï¼Œè¯•ç€æŸ¥ä¸€ä¸‹æ˜¾ç¤ºLayerçš„æ˜¾ç¤ºæ–¹å¼ã€‚","categories":[{"name":"OpenGL","slug":"OpenGL","permalink":"https://flippy-bird.github.io/categories/OpenGL/"}],"tags":[{"name":"bug","slug":"bug","permalink":"https://flippy-bird.github.io/tags/bug/"}]},{"title":"shader noise","slug":"shader-noise","date":"2021-09-04T05:00:34.000Z","updated":"2026-01-16T10:40:28.946Z","comments":true,"path":"2021/09/04/shader-noise/","permalink":"https://flippy-bird.github.io/2021/09/04/shader-noise/","excerpt":"Noiseå™ªå£°","text":"Noiseå™ªå£° ä»€ä¹ˆæ˜¯å™ªå£°å™ªå£° &#x3D; éšæœº + è¿ç»­ åœ¨å›¾å½¢å­¦ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å™ªå£°å°±æ˜¯ä¸ºäº†æŠŠä¸€äº›éšæœºå˜é‡æ¥å¼•å…¥åˆ°ç¨‹åºä¸­ã€‚ä»ç¨‹åºè§’åº¦æ¥è¯´ï¼Œå™ªå£°å¾ˆå¥½ç†è§£ï¼Œæˆ‘ä»¬å¸Œæœ›ç»™å®šä¸€ä¸ªè¾“å…¥ï¼Œç¨‹åºå¯ä»¥ç»™å‡ºä¸€ä¸ªè¾“å‡ºï¼š 123value_type noise(value_type p) &#123; //ç®€å•ç†è§£ä¸ºç¨‹åºè¯­è¨€ä¸­çš„randomå³å¯ ...&#125; å®ƒçš„è¾“å…¥å’Œè¾“å‡ºç±»å‹çš„ç»´æ•°å¯ä»¥æ˜¯ä¸åŒçš„ç»„åˆï¼Œä¾‹å¦‚è¾“å…¥äºŒç»´è¾“å‡ºä¸€ç»´ï¼Œè¾“å…¥äºŒç»´è¾“å‡ºäºŒç»´ç­‰ã€‚æˆ‘ä»¬ä»Šå¤©å°±æ˜¯æƒ³è®¨è®ºä¸€ä¸‹ä¸Šé¢å‡½æ•°ä¸­çš„å®ç°éƒ¨åˆ†æ˜¯é•¿ä»€ä¹ˆæ ·çš„ã€‚ å™ªå£°çš„åˆ†ç±»æ ¹æ®wikiï¼Œç”±ç¨‹åºäº§ç”Ÿå™ªå£°çš„æ–¹æ³•å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š Perlinå™ªå£°ã€Simplexå™ªå£°å’ŒValueå™ªå£°åœ¨æ€§èƒ½ä¸Šå¤§è‡´æ»¡è¶³ï¼šPerlinå™ªå£°(O(2^n)) &lt; Valueå™ªå£°&lt; Simplexå™ªå£°(O(n^2))ï¼ŒSimplexå™ªå£°æ€§èƒ½æœ€å¥½,æ•ˆæœä¹Ÿæœ€å¥½ã€‚ Perlin Noiseå®ç°æ¦‚æ‹¬æ¥è¯´ï¼ŒPerlinå™ªå£°çš„å®ç°éœ€è¦ä¸‰ä¸ªæ­¥éª¤ï¼š å®šä¹‰ä¸€ä¸ªæ™¶æ ¼ç»“æ„ï¼Œæ¯ä¸ªæ™¶æ ¼çš„é¡¶ç‚¹æœ‰ä¸€ä¸ªâ€œä¼ªéšæœºâ€çš„æ¢¯åº¦å‘é‡ï¼ˆå…¶å®å°±æ˜¯ä¸ªå‘é‡å•¦ï¼‰ã€‚å¯¹äºäºŒç»´çš„Perlinå™ªå£°æ¥è¯´ï¼Œæ™¶æ ¼ç»“æ„å°±æ˜¯ä¸€ä¸ªå¹³é¢ç½‘æ ¼ï¼Œä¸‰ç»´çš„å°±æ˜¯ä¸€ä¸ªç«‹æ–¹ä½“ç½‘æ ¼ã€‚ è¾“å…¥ä¸€ä¸ªç‚¹ï¼ˆäºŒç»´çš„è¯å°±æ˜¯äºŒç»´åæ ‡ï¼Œä¸‰ç»´å°±æ˜¯ä¸‰ç»´åæ ‡ï¼Œnç»´çš„å°±æ˜¯nä¸ªåæ ‡ï¼‰ï¼Œæˆ‘ä»¬æ‰¾åˆ°å’Œå®ƒç›¸é‚»çš„é‚£äº›æ™¶æ ¼é¡¶ç‚¹ï¼ˆäºŒç»´ä¸‹æœ‰4ä¸ªï¼Œä¸‰ç»´ä¸‹æœ‰8ä¸ªï¼Œnç»´ä¸‹æœ‰2çš„næ¬¡æ–¹ä¸ªï¼‰ï¼Œè®¡ç®—è¯¥ç‚¹åˆ°å„ä¸ªæ™¶æ ¼é¡¶ç‚¹çš„è·ç¦»å‘é‡ï¼Œå†åˆ†åˆ«ä¸é¡¶ç‚¹ä¸Šçš„æ¢¯åº¦å‘é‡åšç‚¹ä¹˜ï¼Œå¾—åˆ°2çš„næ¬¡æ–¹ä¸ªç‚¹ä¹˜ç»“æœã€‚ ä½¿ç”¨ç¼“å’Œæ›²çº¿ï¼ˆease curvesï¼‰æ¥è®¡ç®—å®ƒä»¬çš„æƒé‡å’Œã€‚åœ¨åŸå§‹çš„Perlinå™ªå£°å®ç°ä¸­ï¼Œç¼“å’Œæ›²çº¿æ˜¯s(t)&#x3D;3t^2âˆ’2t^3ï¼Œåœ¨2002å¹´çš„è®ºæ–‡6ä¸­ï¼ŒPerlinæ”¹è¿›ä¸ºs(t)&#x3D;6t^5âˆ’15t^4+10t^3ï¼Œè¿™é‡Œç®€å•è§£é‡Šä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨s(t)&#x3D;tï¼Œå³çº¿æ€§æ’å€¼ã€‚ç›´æ¥ä½¿ç”¨çš„çº¿æ€§æ’å€¼çš„è¯ï¼Œå®ƒçš„ä¸€é˜¶å¯¼åœ¨æ™¶æ ¼é¡¶ç‚¹å¤„ï¼ˆå³t &#x3D; 0æˆ–t &#x3D; 1ï¼‰ä¸ä¸º0ï¼Œä¼šé€ æˆæ˜æ˜¾çš„ä¸è¿ç»­æ€§ã€‚s(t)&#x3D;3t^2âˆ’2t^3ï¼Œåœ¨ä¸€é˜¶å¯¼æ»¡è¶³è¿ç»­æ€§ï¼Œs(t)&#x3D;6t^5âˆ’15t^4+10t^3ï¼Œåœ¨äºŒé˜¶å¯¼ä¸Šä»ç„¶æ»¡è¶³è¿ç»­æ€§ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„å›¾æ¥è¡¨ç¤ºä¸Šé¢çš„ç¬¬ä¸€æ­¥å’Œç¬¬äºŒæ­¥ï¼š Perlinå™ªå£°çš„å®ç°ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920vec2 hash22(vec2 p)&#123; p = vec2( dot(p,vec2(127.1,311.7)), dot(p,vec2(269.5,183.3))); return -1.0 + 2.0 * fract(sin(p)*43758.5453123);&#125;float perlin_noise(vec2 p)&#123; vec2 pi = floor(p); vec2 pf = p - pi; vec2 w = pf * pf * (3.0 - 2.0 * pf); return mix(mix(dot(hash22(pi + vec2(0.0, 0.0)), pf - vec2(0.0, 0.0)), dot(hash22(pi + vec2(1.0, 0.0)), pf - vec2(1.0, 0.0)), w.x), mix(dot(hash22(pi + vec2(0.0, 1.0)), pf - vec2(0.0, 1.0)), dot(hash22(pi + vec2(1.0, 1.0)), pf - vec2(1.0, 1.0)), w.x), w.y);&#125; è¿™é‡Œçš„å®ç°å®é™…æ˜¯ç®€åŒ–ç‰ˆçš„ï¼Œæˆ‘ä»¬åœ¨ç®—æ¢¯åº¦çš„æ—¶å€™ç›´æ¥å–éšæœºå€¼ï¼Œè€Œæ²¡æœ‰å½’ä¸€åŒ–åˆ°å•ä½åœ†å†…ã€‚ Value Noiseå®ƒæŠŠåŸæ¥çš„æ¢¯åº¦æ›¿æ¢æˆäº†ä¸€ä¸ªç®€å•çš„ä¼ªéšæœºå€¼ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦è¿›è¡Œç‚¹ä¹˜æ“ä½œï¼Œè€Œç›´æ¥æŠŠæ™¶æ ¼é¡¶ç‚¹å¤„çš„éšæœºå€¼æŒ‰æƒé‡ç›¸åŠ å³å¯ã€‚å¦‚ä¸‹å›¾ï¼Œå³åªéœ€è¦å°†è“è‰²çŸ©å½¢ä¸­å››ä¸ªé¡¶ç‚¹çš„éšæœºå€¼æŒ‰æƒé‡ç›¸åŠ ã€‚ å®ç°å’ŒPerlinå™ªå£°ä¸€æ ·ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ç§åŸºäºæ™¶æ ¼çš„å™ªå£°ï¼Œä¹Ÿéœ€è¦ä¸‰ä¸ªæ­¥éª¤ï¼š å®šä¹‰ä¸€ä¸ªæ™¶æ ¼ç»“æ„ï¼Œæ¯ä¸ªæ™¶æ ¼çš„é¡¶ç‚¹æœ‰ä¸€ä¸ªâ€œä¼ªéšæœºâ€çš„å€¼ï¼ˆValueï¼‰ã€‚å¯¹äºäºŒç»´çš„Valueå™ªå£°æ¥è¯´ï¼Œæ™¶æ ¼ç»“æ„å°±æ˜¯ä¸€ä¸ªå¹³é¢ç½‘æ ¼ï¼Œä¸‰ç»´çš„å°±æ˜¯ä¸€ä¸ªç«‹æ–¹ä½“ç½‘æ ¼ã€‚ è¾“å…¥ä¸€ä¸ªç‚¹ï¼ˆäºŒç»´çš„è¯å°±æ˜¯äºŒç»´åæ ‡ï¼Œä¸‰ç»´å°±æ˜¯ä¸‰ç»´åæ ‡ï¼Œnç»´çš„å°±æ˜¯nä¸ªåæ ‡ï¼‰ï¼Œæˆ‘ä»¬æ‰¾åˆ°å’Œå®ƒç›¸é‚»çš„é‚£äº›æ™¶æ ¼é¡¶ç‚¹ï¼ˆäºŒç»´ä¸‹æœ‰4ä¸ªï¼Œä¸‰ç»´ä¸‹æœ‰8ä¸ªï¼Œnç»´ä¸‹æœ‰2 ä¸ªï¼‰ï¼Œå¾—åˆ°è¿™äº›é¡¶ç‚¹çš„ä¼ªéšæœºå€¼ã€‚ ä½¿ç”¨ç¼“å’Œæ›²çº¿ï¼ˆease curvesï¼‰æ¥è®¡ç®—å®ƒä»¬çš„æƒé‡å’Œã€‚åŒæ ·ï¼Œç¼“å’Œæ›²çº¿å¯ä»¥æ˜¯s(t) &#x3D; 3t^2 - 2t^2,ä¹Ÿå¯ä»¥æ˜¯s(t)&#x3D;6t^5âˆ’15t^4+10t^3ï¼ˆå¦‚æœäºŒé˜¶å¯¼ä¸è¿ç»­å¯¹æ•ˆæœå½±å“è¾ƒå¤§æ—¶ï¼‰ã€‚ Valueå™ªå£°æ¯”Perlinå™ªå£°çš„å®ç°æ›´åŠ ç®€å•ï¼Œå¹¶ä¸”éœ€è¦çš„ä¹˜æ³•å’ŒåŠ æ³•æ“ä½œä¹Ÿæ›´å°‘ï¼Œå®ƒåªéœ€è¦å¾—åˆ°æ™¶æ ¼é¡¶ç‚¹çš„éšæœºå€¼å†æŠŠå®ƒä»¬æŒ‰æƒé‡ç›¸åŠ å³å¯ã€‚ ä¸»è¦ä»£ç 1234567891011float value_noise(vec2 p)&#123; vec2 pi = floor(p); vec2 pf = p - pi; vec2 w = pf * pf * (3.0 - 2.0 * pf); return mix(mix(hash21(pi + vec2(0.0, 0.0)), hash21(pi + vec2(1.0, 0.0)), w.x), mix(hash21(pi + vec2(0.0, 1.0)), hash21(pi + vec2(1.0, 1.0)), w.x), w.y);&#125; Simplex NoiseSimplexå™ªå£°çš„è®¡ç®—å¤æ‚åº¦ä¸ºO(n^2^)ï¼Œä¼˜äºPerlinå™ªå£°çš„O(2n)ã€‚è€Œä¸”åœ¨æ•ˆæœä¸Šï¼ŒSimplexå™ªå£°ä¹Ÿå…‹æœäº†ç»å…¸çš„Perlinå™ªå£°åœ¨æŸäº›è§†è§‰é—®é¢˜ã€‚ å®ç° å’Œperlinå®ç°çš„åŒºåˆ«æ˜¯å°†ä¸Šé¢çš„çŸ©å½¢æ¢æˆäº†ä¸€ä¸ªä¸‰è§’å½¢ï¼Œæ‰€ä»¥ç°åœ¨å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•æ‰¾åˆ°ä¸Šé¢å›¾å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹ï¼Œè§£å†³æ–¹æ¡ˆå¦‚ä¸‹å›¾ï¼š å°†ç­‰è¾¹ä¸‰è§’å½¢å€¾æ–œå³å¯è½¬åŒ–ä¸ºçŸ©å½¢ï¼Œæ‰¾åˆ°é¡¶ç‚¹åï¼Œå†åšé€†å‘æ“ä½œå³å¯ã€‚ ä¸»è¦ä»£ç 1234567891011121314151617float simplex_noise(vec2 p)&#123; const float K1 = 0.366025404; // (sqrt(3)-1)/2; const float K2 = 0.211324865; // (3-sqrt(3))/6; vec2 i = floor(p + (p.x + p.y) * K1); vec2 a = p - (i - (i.x + i.y) * K2); vec2 o = (a.x &lt; a.y) ? vec2(0.0, 1.0) : vec2(1.0, 0.0); vec2 b = a - o + K2; vec2 c = a - 1.0 + 2.0 * K2; vec3 h = max(0.5 - vec3(dot(a, a), dot(b, b), dot(c, c)), 0.0); vec3 n = h * h * h * h * vec3(dot(a, hash22(i)), dot(b, hash22(i + o)), dot(c, hash22(i + 1.0))); return dot(vec3(70.0, 70.0, 70.0), n);&#125; Wavelet Noiseå½“ä½¿ç”¨ä¸€ä¸ª3Då™ªå£°å»ç»˜åˆ¶2Dçº¹ç†è¡¨é¢æ—¶ï¼Œå®¹æ˜“å‡ºç°èµ°æ ·å’Œç»†èŠ‚ä¸¢å¤±çš„æƒ…å½¢ Wavelet Noiseæ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ å®ç° ä¸»è¦ç»è¿‡äº†4ä¸ªæ­¥éª¤ï¼š äº§ç”Ÿä¸€ä¸ªå™ªå£°å›¾R é™é‡‡æ · ä¸Šé‡‡æ · å°†åŸå›¾å‡å»ä¸Šé‡‡æ ·çš„çº¹ç†å›¾å¾—åˆ°ç»“æœå›¾ Worley NoiseWorleyå™ªå£°å±äºä¸€ç§ç»†èƒå™ªå£°ï¼Œå°±æ˜¯å™ªå£°å€¼æ˜¯ç”±éšæœºçš„ç‰¹å¾ç‚¹å‘å¤–æ‰©æ•£ï¼Œæœ€ç»ˆçœ‹èµ·æ¥åƒæ˜¯æœ‰ä¸€ä¸ªä¸ªæ™¶èƒä¸€æ ·çš„æ•ˆæœã€‚ä¹Ÿå«ç½‘æ ¼å™ªå£°ï¼Œæ˜¯åŸºäºè·ç¦»åœº è¿™ç§ç»†èƒå™ªå£°å¯ä»¥åº”ç”¨äºæ¨¡æ‹Ÿçš®é©ï¼Œæ°´é¢ç­‰ç­‰ã€‚ï¼ˆWorleyå™ªå£°æ˜¯Voronoiå™ªå£°çš„æ”¹è¿›ç‰ˆï¼‰ å®ç°æŠŠç©ºé—´åˆ†å‰²æˆç½‘æ ¼ï¼ˆcellsï¼‰ï¼Œæ¯ä¸ªç½‘æ ¼å¯¹åº”ä¸€ä¸ªç‰¹å¾ç‚¹ã€‚å¦å¤–ï¼Œä¸ºé¿å…ç½‘æ ¼äº¤ç•ŒåŒºåŸŸçš„åå·®ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—åƒç´ ç‚¹åˆ°ç›¸é‚»ç½‘æ ¼ä¸­çš„ç‰¹å¾ç‚¹çš„è·ç¦»ã€‚è¿™å°±æ˜¯ Steven Worley çš„è®ºæ–‡ä¸­çš„ä¸»è¦æ€æƒ³ã€‚æœ€åï¼Œæ¯ä¸ªåƒç´ ç‚¹åªéœ€è¦è®¡ç®—åˆ°ä¹ä¸ªç‰¹å¾ç‚¹çš„è·ç¦»ï¼šä»–æ‰€åœ¨çš„ç½‘æ ¼çš„ç‰¹å¾ç‚¹å’Œç›¸é‚»çš„å…«ä¸ªç½‘æ ¼çš„ç‰¹å¾ç‚¹ã€‚ ç¤ºä¾‹ä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940vec2 r(vec2 n)&#123; return vec2(r(n.x*23.62-300.0+n.y*34.35),r(n.x*45.13+256.0+n.y*38.89)); &#125;float Worley2D(vec2 n,float s)&#123; n /= s; float dis = 1.0; for(int x = -1;x&lt;=1;x++) &#123; for(int y = -1;y&lt;=1;y++) &#123; vec2 p = floor(n)+vec2(x,y); p = r(p)+vec2(x,y)-fract(n); dis = min(dis, dot(p, p)); &#125; &#125; return 1.0 - sqrt(dis); &#125;float WorleyFBM(vec2 uv)&#123; float amplitude = 0.5; float gain = 0.5; float lacunarity = 2.0; float value = 0.0; const int STEPS = 4; for(int i = 0; i &lt; STEPS; i++) &#123; value += Worley2D(uv, 2.0) * amplitude; amplitude *= gain; uv *= lacunarity; &#125; return value;&#125; FBMå•ç‹¬ä¸€ä¸ªPerlinå™ªå£°è™½ç„¶ä¹Ÿæœ‰ä¸€å®šç”¨å¤„ï¼Œä½†æ˜¯æ•ˆæœå¾€å¾€å¾ˆæ— è¶£ã€‚å› æ­¤ï¼ŒPerlinæŒ‡å‡ºå¯ä»¥ä½¿ç”¨ä¸åŒçš„å‡½æ•°ç»„åˆæ¥å¾—åˆ°æ›´æœ‰æ„æ€çš„ç»“æœï¼Œè¿™äº›å‡½æ•°ç»„åˆé€šå¸¸å°±æ˜¯æŒ‡é€šè¿‡åˆ†å½¢å åŠ ï¼ˆfractal sumï¼‰ã€‚ fbm åˆ†å½¢å™ªå£° noiseçš„å åŠ å…¬å¼å¦‚ä¸‹ï¼š$$noise(p) + 1&#x2F;2 noise(2P) + 1&#x2F;4 noise(4p) + â€¦$$ 12345678910111213//fbm å åŠ åˆ†å½¢å™ªå£°float noise_sum(vec2 p)&#123; float f = 0.0; p = p * 4.0; f += 1.0000 * noise(p); p = 2.0 * p; f += 0.5000 * noise(p); p = 2.0 * p; f += 0.2500 * noise(p); p = 2.0 * p; f += 0.1250 * noise(p); p = 2.0 * p; f += 0.0625 * noise(p); p = 2.0 * p; return f;&#125; ä¸Šé¢å åŠ äº†5å±‚ï¼Œå¹¶æŠŠåˆå§‹åŒ–é‡‡æ ·è·ç¦»è®¾ç½®ä¸º4ï¼Œè¿™éƒ½æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ã€‚è¿™ç§å™ªå£°å¯ä»¥ç”¨æ¥æ¨¡æ‹ŸçŸ³å¤´ã€å±±è„‰è¿™ç±»ç‰©ä½“ã€‚ å¯¹å™ªå£°è¿”å›å€¼è¿›è¡Œäº†å–ç»å¯¹å€¼æ“ä½œã€‚å®ƒä½¿ç”¨çš„å…¬å¼å¦‚ä¸‹ï¼š $$|noise(p)| + 1&#x2F;2|noise(2p)| + 1&#x2F;4|noise(4p)|+â€¦.$$ å®ƒå¯¹åº”çš„ä»£ç å¦‚ä¸‹ï¼š 123456789101112float noise_sum_abs(vec2 p)&#123; float f = 0.0; p = p * 7.0; f += 1.0000 * abs(noise(p)); p = 2.0 * p; f += 0.5000 * abs(noise(p)); p = 2.0 * p; f += 0.2500 * abs(noise(p)); p = 2.0 * p; f += 0.1250 * abs(noise(p)); p = 2.0 * p; f += 0.0625 * abs(noise(p)); p = 2.0 * p; return f;&#125; ç”±äºè¿›è¡Œäº†ç»å¯¹å€¼æ“ä½œï¼Œå› æ­¤ä¼šåœ¨0å€¼å˜åŒ–å¤„å‡ºç°ä¸è¿ç»­æ€§ï¼Œå½¢æˆä¸€äº›å°–é”çš„æ•ˆæœã€‚é€šè¿‡åˆé€‚çš„é¢œè‰²å åŠ ï¼Œ**æˆ‘ä»¬å¯ä»¥ç”¨è¿™ç§å™ªå£°æ¥æ¨¡æ‹Ÿç«ç„°ã€äº‘æœµè¿™äº›ç‰©ä½“ã€‚**PerlinæŠŠè¿™ä¸ªå…¬å¼ç§°ä¸ºturbulenceï¼ˆæ¹æµï¼Ÿï¼‰ï¼Œå› ä¸ºå®ƒçœ‹èµ·æ¥æŒºåƒçš„ã€‚ åœ¨ä¹‹å‰turbulneceå…¬å¼çš„åŸºç¡€ä¸Šä½¿ç”¨äº†ä¸€ä¸ªå…³äºè¡¨é¢xåˆ†é‡çš„æ­£é€‰å‡½æ•°ï¼š $$sin(x+|noise(p) + 1&#x2F;2|noise(2p)+ 1&#x2F;4|noise(4p)|+â€¦)$$ è¿™ä¸ªå…¬å¼å¯ä»¥è®©è¡¨é¢æ²¿ç€xæ–¹å‘å½¢æˆä¸€ä¸ªæ¡çº¹çŠ¶çš„ç»“æ„ã€‚Perlinä½¿ç”¨è¿™ä¸ªå…¬å¼æ¨¡æ‹Ÿäº†ä¸€äº›å¤§ç†çŸ³æè´¨ã€‚æˆ‘ä»¬çš„ä»£ç å¦‚ä¸‹ï¼š 12345678910111213float noise_sum_abs_sin(vec2 p)&#123; float f = 0.0; p = p * 7.0; f += 1.0000 * abs(noise(p)); p = 2.0 * p; f += 0.5000 * abs(noise(p)); p = 2.0 * p; f += 0.2500 * abs(noise(p)); p = 2.0 * p; f += 0.1250 * abs(noise(p)); p = 2.0 * p; f += 0.0625 * abs(noise(p)); p = 2.0 * p; f = sin(f + p.x/32.0); return f;&#125; å¤šå±‚å åŠ ï¼Œæ¯å±‚noiseæ·»åŠ ä½ç§»å’Œæ—‹è½¬ ä¸­çº§Shaderæ•™ç¨‹07 ç†”å²©Lava é€šè¿‡FBMæ„é€ åŸºæœ¬å½¢æ€ï¼Œåœ¨FBMæ·»åŠ ç‚¹å˜åŒ–ï¼š1.æ¯ä¸€å±‚çš„ç§»åŠ¨é€Ÿåº¦ä¸ä¸€æ · 2.æ¯å±‚çš„æ—‹è½¬ä¸ä¸€æ · ç›¸å…³ä»£ç  1234567891011121314float fbm ( in vec2 _st) &#123; float v = 0.0; float a = 0.5; vec2 shift = vec2(100.0); // Rotate to reduce axial bias mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.50)); for (int i = 0; i &lt; NUM_OCTAVES; ++i) &#123; v += a * noise(_st); _st = rot * _st * 2.0 + shift; //***********************************æ³¨æ„è¿™é‡Œä¹˜ä»¥äº†ä¸€ä¸ªçŸ©é˜µï¼Œå¹¶ä¸”åŠ ä¸Šäº†ä¸€ä¸ªåç§»é‡ a *= 0.5; &#125; return v;&#125; åŸŸç¿˜æ›² [domain warping - 2002] f(p) &#x3D; fbm( p + fbm( p + fbm( p ) ) ) å¯å¹³åŸ”çš„å™ªå£°ç›®å‰å…¬è®¤æ¯”è¾ƒå¥½çš„ä¸€ç§åšæ³•ï¼Œå°±æ˜¯åœ¨2nç»´ä¸Šç”Ÿæˆnç»´å¯å¹³é“ºçš„å™ªå£°ã€‚ è¿™ç§æ–¹æ³•æ˜¯æ€æƒ³æ˜¯ï¼Œç”±äºæˆ‘ä»¬æƒ³è¦æ¯ä¸ªç»´åº¦éƒ½æ˜¯æ— ç¼çš„ï¼Œä¹Ÿå°±æ˜¯å½“è¯¥ç»´åº¦çš„å€¼ä»0å˜æˆ1çš„è¿‡ç¨‹ä¸­ï¼Œ0å’Œ1ä¹‹é—´æ¯”è¾ƒæ˜¯å¹³æ»‘è¿‡æ¸¡çš„ï¼Œè¿™è®©æˆ‘ä»¬æƒ³èµ·äº†â€œåœ†â€ï¼Œç»•åœ†ä¸€å‘¨å°±æ˜¯å¯¹è¯¥ç»´åº¦çš„é‡‡æ ·è¿‡ç¨‹ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯æ— ç¼äº†ã€‚å› æ­¤ï¼Œå¯¹äºäºŒç»´å™ªå£°ä¸­çš„xè½´ï¼Œæˆ‘ä»¬ä¼šåœ¨å››ç»´ç©ºé—´ä¸‹çš„xzå¹³é¢ä¸Šçš„ä¸€ä¸ªåœ†ä¸Šè¿›è¡Œé‡‡æ ·ï¼Œè€ŒäºŒç»´å™ªå£°çš„yè½´ï¼Œåˆ™ä¼šåœ¨å››ç»´ç©ºé—´ä¸‹çš„ywå¹³é¢ä¸Šçš„ä¸€ä¸ªåœ†ä¸Šè¿›è¡Œé‡‡æ ·ã€‚è¿™ä¸ªè½¬åŒ–è¿‡ç¨‹å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ä¸‰è§’å‡½æ•°sinå’Œcoså³å¯æŠŠäºŒç»´é‡‡æ ·åæ ‡è½¬åŒ–åˆ°å•ä½åœ†ä¸Šã€‚åŒæ ·ï¼Œä¸‰ç»´ç©ºé—´çš„ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬ä¼šåœ¨å…­ç»´ç©ºé—´ä¸‹è®¡ç®—ã€‚è¿™ç§æ–¹æ³•ä¸ä»…é€‚ç”¨äºPerlinå™ªå£°ï¼ŒåƒWorleyå™ªå£°è¿™ç§ä¹ŸåŒæ ·æ˜¯é€‚åˆçš„ã€‚ ã€å›¾å½¢å­¦ã€‘è°ˆè°ˆå™ªå£° Curl Noise å›¾å½¢å­¦ä¸­å¸¸è§å™ªå£°ç”Ÿæˆç®—æ³•ç»¼è¿° noise çš„åº”ç”¨ How to Use Perlin Noise in Your Games Perlin noise can be used to blend between two textures, as shown in following. You should use Perlin noise with very high contrast to prevent textures from looking fuzzy. The following code snippet shows how to blend two images using Perlin noise. äº‘ ä½¿ç”¨å™ªéŸ³æ¨¡æ‹Ÿäº‘çš„æ•ˆæœ 2DåŠ¨æ€äº‘å½© ç”Ÿæˆäº‘çš„shadertoyä»£ç å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970const float cloudscale = 1.1;const float speed = 0.03;const float clouddark = 0.5;const float cloudlight = 0.3;const float cloudcover = 0.2;const float cloudalpha = 8.0;const float skytint = 0.5;const vec3 skycolour1 = vec3(0.2, 0.4, 0.6);const vec3 skycolour2 = vec3(0.4, 0.7, 1.0);const mat2 m = mat2( 1.6, 1.2, -1.2, 1.6 );vec2 hash( vec2 p ) &#123; p = vec2(dot(p,vec2(127.1,311.7)), dot(p,vec2(269.5,183.3))); return -1.0 + 2.0*fract(sin(p)*43758.5453123);&#125;float noise( in vec2 p ) &#123; const float K1 = 0.366025404; // (sqrt(3)-1)/2; const float K2 = 0.211324865; // (3-sqrt(3))/6; vec2 i = floor(p + (p.x+p.y)*K1); vec2 a = p - i + (i.x+i.y)*K2; vec2 o = (a.x&gt;a.y) ? vec2(1.0,0.0) : vec2(0.0,1.0); //vec2 of = 0.5 + 0.5*vec2(sign(a.x-a.y), sign(a.y-a.x)); vec2 b = a - o + K2; vec2 c = a - 1.0 + 2.0*K2; vec3 h = max(0.5-vec3(dot(a,a), dot(b,b), dot(c,c) ), 0.0 ); vec3 n = h*h*h*h*vec3( dot(a,hash(i+0.0)), dot(b,hash(i+o)), dot(c,hash(i+1.0))); return dot(n, vec3(70.0)); &#125;float fbm(vec2 n) &#123; float total = 0.0, amplitude = 0.1; for (int i = 0; i &lt; 7; i++) &#123; total += noise(n) * amplitude; n = m * n; amplitude *= 0.4; &#125; return total;&#125;// -----------------------------------------------void mainImage( out vec4 fragColor, in vec2 fragCoord ) &#123; vec2 p = fragCoord.xy / iResolution.xy; vec2 uv = p*vec2(iResolution.x/iResolution.y,1.0); float time = iTime * speed; float q = fbm(uv * cloudscale * 0.5); //ridged noise shape float r = 0.0; //noise shape float f = 0.0; // uv = p*vec2(iResolution.x/iResolution.y,1.0); uv *= cloudscale; uv -= q - time; float weight = 0.7; for (int i=0; i&lt;8; i++)&#123; f += weight*noise( uv ); uv = m*uv + time; weight *= 0.6; &#125; f *= r + f; vec3 skycolour = mix(skycolour2, skycolour1, p.y); vec3 cloudcolour = vec3(1.1, 1.1, 0.9) * clouddark; f = cloudcover + cloudalpha*f; vec3 result = mix(skycolour, clamp(skytint * skycolour + cloudcolour, 0.0, 1.0), clamp(f, 0.0, 1.0)); fragColor = vec4( result, 1.0 );&#125; è¿è¡Œä¸Šè¿°ä»£ç çš„æ•ˆæœå¦‚ä¸‹å›¾ï¼š å±±è„‰ä½¿ç”¨å™ªå£°ä½œä¸ºé«˜åº¦å›¾ æ°´é¢ä½¿ç”¨å™ªå£°çº¹ç†ä½œä¸ºé«˜åº¦å›¾ï¼Œä¸æ–­ä¿®æ”¹æ°´é¢çš„æ³•çº¿æ–¹å‘ï¼Œä½¿ç”¨å’Œæ—¶é—´ç›¸å…³çš„å˜é‡å¯¹å™ªå£°çº¹ç†é‡‡æ ·ï¼Œå¾—åˆ°æ°´æµåŠ¨çš„æ•ˆæœï¼› å…¶å®ƒnoiseçš„å…¶å®ƒåº”ç”¨å¦‚ç”Ÿæˆç»†èƒå½¢æ€ï¼Œçš®é©çº¹ç†ï¼ŒçƒŸé›¾ï¼Œå¤§ç†çŸ³ï¼Œå¸ƒæ–™ï¼Œé“è·¯ç­‰ï¼ŒåŸºæœ¬æ€æƒ³éƒ½æ˜¯åŸºäºå™ªå£°è´´å›¾ï¼Œä½¿ç”¨å™ªå£°å›¾ä½œä¸ºåŸºæœ¬çº¹ç†è¿›è¡Œå¤„ç†ï¼Œå¦‚color mappingï¼Œheight mapping, normal mappingç­‰ noise çš„ç›¸å…³åº“ libnoise å‚è€ƒèµ„æ–™ WebGLè¿›é˜¶â€”â€”èµ°è¿›å›¾å½¢å™ªå£° 2.https://www.shadertoy.com/view/ldscWj 3.ã€å›¾å½¢å­¦ã€‘è°ˆè°ˆå™ªå£° ä½¿ç”¨ç¬”ã€å’Œä»£ç â€ç”Ÿæˆâ€œç«ç„° 5.[ä¸€ç¯‡æ–‡ç« ææ‡‚æŸæ—å™ªå£°ç®—æ³•] 6.å‡ ç§å¸¸è§çš„ç¨‹åºåŒ–å™ªå£°çº¹ç† 7.Unity Shader - Noise å™ªç‚¹å›¾ - å®ç°ç®€å•å±±è„‰ 8.Real-Time Procedural Effects 9.å›¾å½¢å­¦ä¸­å¸¸è§å™ªå£°ç”Ÿæˆç®—æ³•ç»¼è¿° 10.å¦‚ä½•ä½¿ç”¨å™ªå£°ç”Ÿæˆå¤æ‚çš„çº¹ç†ï¼Ÿ","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://flippy-bird.github.io/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"shader","slug":"shader","permalink":"https://flippy-bird.github.io/tags/shader/"}]},{"title":"C++åŸºç¡€","slug":"C-åŸºç¡€","date":"2021-08-22T03:38:59.000Z","updated":"2026-01-16T10:40:28.947Z","comments":true,"path":"2021/08/22/C-åŸºç¡€/","permalink":"https://flippy-bird.github.io/2021/08/22/C-%E5%9F%BA%E7%A1%80/","excerpt":"C++é‚£äº›äº‹","text":"C++é‚£äº›äº‹ consté‚£äº›äº‹constå«ä¹‰å¸¸ç±»å‹æ˜¯æŒ‡ä½¿ç”¨ç±»å‹ä¿®é¥°ç¬¦constè¯´æ˜çš„ç±»å‹ï¼Œå¸¸ç±»å‹çš„å˜é‡æˆ–å¯¹è±¡çš„å€¼æ˜¯ä¸èƒ½è¢«æ›´æ–°çš„ã€‚ constä½œç”¨1.å¯ä»¥å®šä¹‰å¸¸é‡ 2.ç±»å‹æ£€æŸ¥ 3.é˜²æ­¢ä¿®æ”¹ï¼Œèµ·ä¿æŠ¤ä½œç”¨ï¼Œå¢åŠ ç¨‹åºå¥å£®æ€§ 4.å¯ä»¥èŠ‚çœç©ºé—´ï¼Œé¿å…ä¸å¿…è¦çš„å†…å­˜åˆ†é… constå¯¹è±¡é»˜è®¤ä¸ºæ–‡ä»¶å±€éƒ¨å˜é‡ æ³¨æ„ï¼šéconstå˜é‡é»˜è®¤ä¸ºexternã€‚è¦ä½¿constå˜é‡èƒ½å¤Ÿåœ¨å…¶å®ƒæ–‡ä»¶ä¸­è®¿é—®ï¼Œå¿…é¡»åœ¨æ–‡ä»¶ä¸­æ˜¾ç¤ºåœ°æŒ‡å®šå®ƒä¸ºexternã€‚ æœªè¢«constä¿®é¥°çš„å˜é‡åœ¨ä¸åŒæ–‡ä»¶çš„è®¿é—® 12345678910111213// file1.cppint ext //**********************************è¿™é‡Œæ²¡æœ‰extern// file2.cpp#include&lt;iostream&gt;/** * by å…‰åŸ * compile: g++ -o file file2.cpp file1.cpp * execute: ./file */extern int ext;int main()&#123; std::cout&lt;&lt;(ext+10)&lt;&lt;std::endl;&#125; constå¸¸é‡åœ¨ä¸åŒæ–‡ä»¶çš„è®¿é—® 12345678910111213//extern_file1.cppextern const int ext=12; //********************************è¿™é‡ŒåŠ äº†extern//extern_file2.cpp#include&lt;iostream&gt;/** * by å…‰åŸ * compile: g++ -o file const_file2.cpp const_file1.cpp * execute: ./file */extern const int ext;int main()&#123; std::cout&lt;&lt;ext&lt;&lt;std::endl;&#125; *å°ç»“ï¼šå¯ä»¥å‘ç°æœªè¢«constä¿®é¥°çš„å˜é‡ä¸éœ€è¦externæ˜¾å¼å£°æ˜ï¼è€Œconstå¸¸é‡éœ€è¦æ˜¾å¼å£°æ˜externï¼Œå¹¶ä¸”éœ€è¦åšåˆå§‹åŒ–ï¼å› ä¸ºå¸¸é‡åœ¨å®šä¹‰åå°±ä¸èƒ½è¢«ä¿®æ”¹ï¼Œæ‰€ä»¥å®šä¹‰æ—¶å¿…é¡»åˆå§‹åŒ–ã€‚* æŒ‡é’ˆå’Œconstä¸æŒ‡é’ˆç›¸å…³çš„constæœ‰å››ç§ï¼š 1234const char * a; //æŒ‡å‘constå¯¹è±¡çš„æŒ‡é’ˆæˆ–è€…è¯´æŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆã€‚char const * a; //åŒä¸Šchar * const a; //æŒ‡å‘ç±»å‹å¯¹è±¡çš„constæŒ‡é’ˆã€‚æˆ–è€…è¯´å¸¸æŒ‡é’ˆã€constæŒ‡é’ˆã€‚const char * const a; //æŒ‡å‘constå¯¹è±¡çš„constæŒ‡é’ˆã€‚ å°ç»“ï¼šå¦‚æœconstä½äº*çš„å·¦ä¾§ï¼Œåˆ™constå°±æ˜¯ç”¨æ¥ä¿®é¥°æŒ‡é’ˆæ‰€æŒ‡å‘çš„å˜é‡ï¼Œå³æŒ‡é’ˆæŒ‡å‘ä¸ºå¸¸é‡ï¼›å¦‚æœconstä½äº*çš„å³ä¾§ï¼Œconstå°±æ˜¯ä¿®é¥°æŒ‡é’ˆæœ¬èº«ï¼Œå³æŒ‡é’ˆæœ¬èº«æ˜¯å¸¸é‡ã€‚ 1.æŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆ å¦å¤–ä¸€ä¸ªé‡ç‚¹æ˜¯ï¼šå…è®¸æŠŠéconstå¯¹è±¡çš„åœ°å€èµ‹ç»™æŒ‡å‘constå¯¹è±¡çš„æŒ‡é’ˆã€‚ å°†éconstå¯¹è±¡çš„åœ°å€èµ‹ç»™constå¯¹è±¡çš„æŒ‡é’ˆ: 123const int *ptr;int val = 3;ptr = &amp;val; //ok å°ç»“ï¼šå¯¹äºæŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆï¼Œä¸èƒ½é€šè¿‡æŒ‡é’ˆæ¥ä¿®æ”¹å¯¹è±¡çš„å€¼ã€‚ä¹Ÿä¸èƒ½ä½¿ç”¨void*æŒ‡é’ˆä¿å­˜constå¯¹è±¡çš„åœ°å€ï¼Œå¿…é¡»ä½¿ç”¨const void*ç±»å‹çš„æŒ‡é’ˆä¿å­˜constå¯¹è±¡çš„åœ°å€ã€‚å…è®¸æŠŠéconstå¯¹è±¡çš„åœ°å€èµ‹å€¼ç»™constå¯¹è±¡çš„æŒ‡é’ˆï¼Œå¦‚æœè¦ä¿®æ”¹æŒ‡é’ˆæ‰€æŒ‡å‘çš„å¯¹è±¡å€¼ï¼Œå¿…é¡»é€šè¿‡å…¶ä»–æ–¹å¼ä¿®æ”¹ï¼Œä¸èƒ½ç›´æ¥é€šè¿‡å½“å‰æŒ‡é’ˆç›´æ¥ä¿®æ”¹ã€‚ 2.å¸¸æŒ‡é’ˆ **constæŒ‡é’ˆå¿…é¡»è¿›è¡Œåˆå§‹åŒ–ï¼Œ**ä¸”constæŒ‡é’ˆçš„å€¼ä¸èƒ½ä¿®æ”¹ã€‚ 12345678910#include&lt;iostream&gt;using namespace std;int main()&#123; int num=0; int * const ptr=&amp;num; //constæŒ‡é’ˆå¿…é¡»åˆå§‹åŒ–ï¼ä¸”constæŒ‡é’ˆçš„å€¼ä¸èƒ½ä¿®æ”¹ int * t = &amp;num; *t = 1; cout&lt;&lt;*ptr&lt;&lt;endl;&#125; staticé‚£äº›äº‹å½“ä¸ä¸åŒç±»å‹ä¸€èµ·ä½¿ç”¨æ—¶ï¼ŒStaticå…³é”®å­—å…·æœ‰ä¸åŒçš„å«ä¹‰ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨staticå…³é”®å­—ï¼š 1.é™æ€å˜é‡ï¼šå‡½æ•°ä¸­çš„å˜é‡ï¼Œç±»ä¸­çš„å˜é‡ 2.é™æ€ç±»çš„æˆå‘˜ï¼šç±»å¯¹è±¡å’Œç±»ä¸­çš„å‡½æ•° é™æ€å˜é‡ å‡½æ•°ä¸­çš„é™æ€å˜é‡ å½“å˜é‡å£°æ˜ä¸ºstaticæ—¶ï¼Œç©ºé—´å°†åœ¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸå†…åˆ†é…ã€‚å³ä½¿å¤šæ¬¡è°ƒç”¨è¯¥å‡½æ•°ï¼Œé™æ€å˜é‡çš„ç©ºé—´ä¹Ÿåªåˆ†é…ä¸€æ¬¡ï¼Œå‰ä¸€æ¬¡è°ƒç”¨ä¸­çš„å˜é‡å€¼é€šè¿‡ä¸‹ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¼ é€’ã€‚è¿™å¯¹äºåœ¨C &#x2F; C ++æˆ–éœ€è¦å­˜å‚¨å…ˆå‰å‡½æ•°çŠ¶æ€çš„ä»»ä½•å…¶ä»–åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ã€‚ 12345678910111213141516171819202122#include &lt;iostream&gt; #include &lt;string&gt; using namespace std; void demo() &#123; // static variable static int count = 0; cout &lt;&lt; count &lt;&lt; &quot; &quot;; // value is updated and // will be carried to next // function calls count++; &#125; int main() &#123; for (int i=0; i&lt;5; i++) demo(); return 0; &#125; è¾“å‡ºä¸ºï¼š 10 1 2 3 4 ç±»ä¸­çš„é™æ€å˜é‡ ç”±äºå£°æ˜ä¸ºstaticçš„å˜é‡åªè¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼Œå› ä¸ºå®ƒä»¬åœ¨å•ç‹¬çš„é™æ€å­˜å‚¨ä¸­åˆ†é…äº†ç©ºé—´ï¼Œå› æ­¤ç±»ä¸­çš„é™æ€å˜é‡**ç”±å¯¹è±¡å…±äº«ã€‚**å¯¹äºä¸åŒçš„å¯¹è±¡ï¼Œä¸èƒ½æœ‰ç›¸åŒé™æ€å˜é‡çš„å¤šä¸ªå‰¯æœ¬ã€‚ä¹Ÿæ˜¯å› ä¸ºè¿™ä¸ªåŸå› ï¼Œé™æ€å˜é‡ä¸èƒ½ä½¿ç”¨æ„é€ å‡½æ•°åˆå§‹åŒ–ã€‚ ç±»ä¸­çš„é™æ€å˜é‡åº”ç”±ç”¨æˆ·ä½¿ç”¨ç±»å¤–çš„ç±»åå’ŒèŒƒå›´è§£æè¿ç®—ç¬¦æ˜¾å¼åˆå§‹åŒ–ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 12345678910111213141516171819202122#include&lt;iostream&gt; using namespace std; class Apple &#123; public: static int i; Apple() &#123; // Do nothing &#125;; &#125;; int Apple::i = 1; //******************************************åœ¨è¿™é‡Œè¿›è¡Œåˆå§‹åŒ–int main() &#123; Apple obj; // prints value of i cout &lt;&lt; obj.i; &#125; é™æ€æˆå‘˜ ç±»å¯¹è±¡ä¸ºé™æ€ å°±åƒå˜é‡ä¸€æ ·ï¼Œå¯¹è±¡ä¹Ÿåœ¨å£°æ˜ä¸ºstaticæ—¶å…·æœ‰èŒƒå›´ï¼Œç›´åˆ°ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸã€‚ ç±»ä¸­çš„é™æ€å‡½æ•° å°±åƒç±»ä¸­çš„é™æ€æ•°æ®æˆå‘˜æˆ–é™æ€å˜é‡ä¸€æ ·ï¼Œé™æ€æˆå‘˜å‡½æ•°ä¹Ÿä¸ä¾èµ–äºç±»çš„å¯¹è±¡ã€‚***æˆ‘ä»¬è¢«å…è®¸ä½¿ç”¨å¯¹è±¡å’Œâ€™.â€™æ¥è°ƒç”¨é™æ€æˆå‘˜å‡½æ•°ã€‚***ä½†å»ºè®®ä½¿ç”¨ç±»åå’ŒèŒƒå›´è§£æè¿ç®—ç¬¦è°ƒç”¨é™æ€æˆå‘˜ã€‚ å…è®¸é™æ€æˆå‘˜å‡½æ•°ä»…è®¿é—®é™æ€æ•°æ®æˆå‘˜æˆ–å…¶ä»–é™æ€æˆå‘˜å‡½æ•°ï¼Œå®ƒä»¬æ— æ³•è®¿é—®ç±»çš„éé™æ€æ•°æ®æˆå‘˜æˆ–æˆå‘˜å‡½æ•°ã€‚ thisæŒ‡é’ˆé‚£äº›äº‹thisæŒ‡é’ˆçš„ç”¨å¤„ ä¸€ä¸ªå¯¹è±¡çš„thisæŒ‡é’ˆå¹¶ä¸æ˜¯å¯¹è±¡æœ¬èº«çš„ä¸€éƒ¨åˆ†ï¼Œä¸ä¼šå½±å“sizeof(å¯¹è±¡)çš„ç»“æœã€‚ thisä½œç”¨åŸŸæ˜¯åœ¨ç±»å†…éƒ¨ï¼Œå½“åœ¨ç±»çš„éé™æ€æˆå‘˜å‡½æ•°ä¸­è®¿é—®ç±»çš„éé™æ€æˆå‘˜çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å°†å¯¹è±¡æœ¬èº«çš„åœ°å€ä½œä¸ºä¸€ä¸ªéšå«å‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ**å³ä½¿ä½ æ²¡æœ‰å†™ä¸ŠthisæŒ‡é’ˆï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™ä¹Ÿæ˜¯åŠ ä¸Šthisçš„ï¼Œ**å®ƒä½œä¸ºéé™æ€æˆå‘˜å‡½æ•°çš„éšå«å½¢å‚ï¼Œå¯¹å„æˆå‘˜çš„è®¿é—®å‡é€šè¿‡thisè¿›è¡Œã€‚ thisæŒ‡é’ˆçš„ä½¿ç”¨ åœ¨ç±»çš„éé™æ€æˆå‘˜å‡½æ•°ä¸­è¿”å›ç±»å¯¹è±¡æœ¬èº«çš„æ—¶å€™ï¼Œç›´æ¥ä½¿ç”¨ return *thisã€‚ å½“å‚æ•°ä¸æˆå‘˜å˜é‡åç›¸åŒæ—¶ï¼Œå¦‚this-&gt;n &#x3D; n ï¼ˆä¸èƒ½å†™æˆn &#x3D; n)ã€‚ 123456789101112class Person&#123; int get_age() const&#123; //*****************************æ³¨æ„è¿™é‡Œçš„constå’Œæ€»ç»“é‡Œçš„è§£æ return this-&gt;age; &#125; Person&amp; add_age(int a)&#123; age+=a; return *this; &#125; &#125; æ€»ç»“ï¼š thisåœ¨æˆå‘˜å‡½æ•°çš„å¼€å§‹æ‰§è¡Œå‰æ„é€ ï¼Œåœ¨æˆå‘˜çš„æ‰§è¡Œç»“æŸåæ¸…é™¤ã€‚ä¸Šè¿°çš„get_ageå‡½æ•°ä¼šè¢«è§£ææˆget_age(const A * const this),add_ageå‡½æ•°ä¼šè¢«è§£ææˆadd_age(A* const this,int a)ã€‚åœ¨C++ä¸­ç±»å’Œç»“æ„æ˜¯åªæœ‰ä¸€ä¸ªåŒºåˆ«çš„ï¼šç±»çš„æˆå‘˜é»˜è®¤æ˜¯privateï¼Œè€Œç»“æ„æ˜¯publicã€‚thisæ˜¯ç±»çš„æŒ‡é’ˆï¼Œå¦‚æœæ¢æˆç»“æ„ï¼Œé‚£thiså°±æ˜¯ç»“æ„çš„æŒ‡é’ˆäº†ã€‚ inlineé‚£äº›äº‹ç±»ä¸­å†…è”å¤´æ–‡ä»¶ä¸­å£°æ˜æ–¹æ³• 1234567891011121314151617class A&#123;public: void f1(int x); /** * @brief ç±»ä¸­å®šä¹‰äº†çš„å‡½æ•°æ˜¯éšå¼å†…è”å‡½æ•°,å£°æ˜è¦æƒ³æˆä¸ºå†…è”å‡½æ•°ï¼Œå¿…é¡»åœ¨å®ç°å¤„(å®šä¹‰å¤„)åŠ inlineå…³é”®å­—ã€‚ * * @param x * @param y */ void Foo(int x,int y) ///&lt; å®šä¹‰å³éšå¼å†…è”å‡½æ•°ï¼ //***********************è¿™é‡Œ &#123; &#125;; void f1(int x); ///&lt; å£°æ˜åï¼Œè¦æƒ³æˆä¸ºå†…è”å‡½æ•°ï¼Œå¿…é¡»åœ¨å®šä¹‰å¤„åŠ inlineå…³é”®å­—ã€‚ //***********************è¿™é‡Œ &#125;; å®ç°æ–‡ä»¶ä¸­å®šä¹‰å†…è”å‡½æ•°ï¼š inlineè¦èµ·ä½œç”¨,inlineè¦ä¸å‡½æ•°å®šä¹‰æ”¾åœ¨ä¸€èµ·,inlineæ˜¯ä¸€ç§â€œç”¨äºå®ç°çš„å…³é”®å­—,è€Œä¸æ˜¯ç”¨äºå£°æ˜çš„å…³é”®å­—â€ 1234567891011121314151617181920212223242526272829303132333435363738#include &lt;iostream&gt;#include &quot;inline.h&quot;using namespace std;/** * @brief inlineè¦èµ·ä½œç”¨,inlineè¦ä¸å‡½æ•°å®šä¹‰æ”¾åœ¨ä¸€èµ·,inlineæ˜¯ä¸€ç§â€œç”¨äºå®ç°çš„å…³é”®å­—,è€Œä¸æ˜¯ç”¨äºå£°æ˜çš„å…³é”®å­—â€ * * @param x * @param y * * @return */int Foo(int x,int y); // å‡½æ•°å£°æ˜inline int Foo(int x,int y) // å‡½æ•°å®šä¹‰&#123; return x+y;&#125;// å®šä¹‰å¤„åŠ inlineå…³é”®å­—ï¼Œæ¨èè¿™ç§å†™æ³•ï¼inline void A::f1(int x)&#123;&#125;int main()&#123; cout&lt;&lt;Foo(1,2)&lt;&lt;endl;&#125;/** * ç¼–è¯‘å™¨å¯¹ inline å‡½æ•°çš„å¤„ç†æ­¥éª¤ * å°† inline å‡½æ•°ä½“å¤åˆ¶åˆ° inline å‡½æ•°è°ƒç”¨ç‚¹å¤„ï¼› * ä¸ºæ‰€ç”¨ inline å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼› * å°† inline å‡½æ•°çš„çš„è¾“å…¥å‚æ•°å’Œè¿”å›å€¼æ˜ å°„åˆ°è°ƒç”¨æ–¹æ³•çš„å±€éƒ¨å˜é‡ç©ºé—´ä¸­ï¼› * å¦‚æœ inline å‡½æ•°æœ‰å¤šä¸ªè¿”å›ç‚¹ï¼Œå°†å…¶è½¬å˜ä¸º inline å‡½æ•°ä»£ç å—æœ«å°¾çš„åˆ†æ”¯ï¼ˆä½¿ç”¨ GOTOï¼‰ã€‚ */ å†…è”èƒ½æé«˜å‡½æ•°æ•ˆç‡ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å‡½æ•°éƒ½å®šä¹‰æˆå†…è”å‡½æ•°ï¼å†…è”æ˜¯ä»¥ä»£ç è†¨èƒ€(å¤åˆ¶)ä¸ºä»£ä»·ï¼Œä»…ä»…çœå»äº†å‡½æ•°è°ƒç”¨çš„å¼€é”€ï¼Œä»è€Œæé«˜å‡½æ•°çš„æ‰§è¡Œæ•ˆç‡ã€‚ ä»¥ä¸‹æƒ…å†µä¸é€‚åˆç”¨å†…è”ï¼š å¦‚æœå‡½æ•°ä½“å†…çš„ä»£ç æ¯”è¾ƒé•¿ï¼Œä½¿å¾—å†…è”å°†å¯¼è‡´å†…å­˜æ¶ˆè€—ä»£ä»·æ¯”è¾ƒé«˜ã€‚ å¦‚æœå‡½æ•°ä½“å†…å‡ºç°å¾ªç¯ï¼Œé‚£ä¹ˆæ‰§è¡Œå‡½æ•°ä½“å†…ä»£ç çš„æ—¶é—´è¦æ¯”å‡½æ•°è°ƒç”¨çš„å¼€é”€å¤§ã€‚ è™šå‡½æ•°(virtual)å¯ä»¥æ˜¯å†…è”å‡½æ•°å—ï¼Ÿ è™šå‡½æ•°å¯ä»¥æ˜¯å†…è”å‡½æ•°ï¼Œå†…è”æ˜¯å¯ä»¥ä¿®é¥°è™šå‡½æ•°çš„ï¼Œä½†æ˜¯å½“è™šå‡½æ•°è¡¨ç°å¤šæ€æ€§çš„æ—¶å€™ä¸èƒ½å†…è”ã€‚ å†…è”æ˜¯åœ¨ç¼–è¯‘å™¨å»ºè®®ç¼–è¯‘å™¨å†…è”ï¼Œè€Œè™šå‡½æ•°çš„å¤šæ€æ€§åœ¨è¿è¡ŒæœŸï¼Œç¼–è¯‘å™¨æ— æ³•çŸ¥é“è¿è¡ŒæœŸè°ƒç”¨å“ªä¸ªä»£ç ï¼Œå› æ­¤è™šå‡½æ•°è¡¨ç°ä¸ºå¤šæ€æ€§æ—¶ï¼ˆè¿è¡ŒæœŸï¼‰ä¸å¯ä»¥å†…è”ã€‚ inline virtual å”¯ä¸€å¯ä»¥å†…è”çš„æ—¶å€™æ˜¯ï¼šç¼–è¯‘å™¨çŸ¥é“æ‰€è°ƒç”¨çš„å¯¹è±¡æ˜¯å“ªä¸ªç±»ï¼ˆå¦‚ Base::who()ï¼‰ï¼Œè¿™åªæœ‰åœ¨ç¼–è¯‘å™¨å…·æœ‰å®é™…å¯¹è±¡è€Œä¸æ˜¯å¯¹è±¡çš„æŒ‡é’ˆæˆ–å¼•ç”¨æ—¶æ‰ä¼šå‘ç”Ÿã€‚ 12345678910111213141516171819202122232425262728293031323334353637#include &lt;iostream&gt; using namespace std;class Base&#123;public: inline virtual void who() &#123; cout &lt;&lt; &quot;I am Base\\n&quot;; &#125; virtual ~Base() &#123;&#125;&#125;;class Derived : public Base&#123;public: inline void who() // ä¸å†™inlineæ—¶éšå¼å†…è” &#123; cout &lt;&lt; &quot;I am Derived\\n&quot;; &#125;&#125;;int main()&#123; // æ­¤å¤„çš„è™šå‡½æ•° who()ï¼Œæ˜¯é€šè¿‡ç±»ï¼ˆBaseï¼‰çš„å…·ä½“å¯¹è±¡ï¼ˆbï¼‰æ¥è°ƒç”¨çš„ï¼Œç¼–è¯‘æœŸé—´å°±èƒ½ç¡®å®šäº†ï¼Œæ‰€ä»¥å®ƒå¯ä»¥æ˜¯å†…è”çš„ï¼Œä½†æœ€ç»ˆæ˜¯å¦å†…è”å–å†³äºç¼–è¯‘å™¨ã€‚ Base b; b.who(); // æ­¤å¤„çš„è™šå‡½æ•°æ˜¯é€šè¿‡æŒ‡é’ˆè°ƒç”¨çš„ï¼Œå‘ˆç°å¤šæ€æ€§ï¼Œéœ€è¦åœ¨è¿è¡Œæ—¶æœŸé—´æ‰èƒ½ç¡®å®šï¼Œæ‰€ä»¥ä¸èƒ½ä¸ºå†…è”ã€‚ Base *ptr = new Derived(); ptr-&gt;who(); // å› ä¸ºBaseæœ‰è™šææ„å‡½æ•°ï¼ˆvirtual ~Base() &#123;&#125;ï¼‰ï¼Œæ‰€ä»¥ delete æ—¶ï¼Œä¼šå…ˆè°ƒç”¨æ´¾ç”Ÿç±»ï¼ˆDerivedï¼‰ææ„å‡½æ•°ï¼Œå†è°ƒç”¨åŸºç±»ï¼ˆBaseï¼‰ææ„å‡½æ•°ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚ delete ptr; ptr = nullptr; system(&quot;pause&quot;); return 0;&#125; sizeof é‚£äº›äº‹ ç©ºç±»çš„å¤§å°ä¸º1å­—èŠ‚ ä¸€ä¸ªç±»ä¸­ï¼Œè™šå‡½æ•°æœ¬èº«ã€æˆå‘˜å‡½æ•°ï¼ˆåŒ…æ‹¬é™æ€ä¸éé™æ€ï¼‰å’Œé™æ€æ•°æ®æˆå‘˜éƒ½æ˜¯ä¸å ç”¨ç±»å¯¹è±¡çš„å­˜å‚¨ç©ºé—´ã€‚ å¯¹äºåŒ…å«è™šå‡½æ•°çš„ç±»ï¼Œä¸ç®¡æœ‰å¤šå°‘ä¸ªè™šå‡½æ•°ï¼Œåªæœ‰ä¸€ä¸ªè™šæŒ‡é’ˆ,vptrçš„å¤§å°ã€‚ æ™®é€šç»§æ‰¿ï¼Œæ´¾ç”Ÿç±»ç»§æ‰¿äº†æ‰€æœ‰åŸºç±»çš„å‡½æ•°ä¸æˆå‘˜ï¼Œè¦æŒ‰ç…§å­—èŠ‚å¯¹é½æ¥è®¡ç®—å¤§å° è™šå‡½æ•°ç»§æ‰¿ï¼Œä¸ç®¡æ˜¯å•ç»§æ‰¿è¿˜æ˜¯å¤šç»§æ‰¿ï¼Œéƒ½æ˜¯ç»§æ‰¿äº†åŸºç±»çš„vptrã€‚(32ä½æ“ä½œç³»ç»Ÿ4å­—èŠ‚ï¼Œ64ä½æ“ä½œç³»ç»Ÿ 8å­—èŠ‚)ï¼ è™šç»§æ‰¿,ç»§æ‰¿åŸºç±»çš„vptrã€‚ åŸåˆ™1ç©ºç±»çš„å¤§å°ä¸º1å­—èŠ‚ 123456789101112131415/** * @file blackclass.cpp * @brief ç©ºç±»çš„å¤§å°ä¸º1å­—èŠ‚ * @author å…‰åŸ * @version v1 * @date 2019-07-21 */#include&lt;iostream&gt;using namespace std;class A&#123;&#125;;int main()&#123; cout&lt;&lt;sizeof(A)&lt;&lt;endl; return 0;&#125; åŸåˆ™2é™æ€æ•°æ®æˆå‘˜è¢«ç¼–è¯‘å™¨æ”¾åœ¨ç¨‹åºçš„ä¸€ä¸ªglobal data membersä¸­ï¼Œå®ƒæ˜¯ç±»çš„ä¸€ä¸ªæ•°æ®æˆå‘˜ï¼Œä½†ä¸å½±å“ç±»çš„å¤§å°ã€‚ 12345678910111213141516171819202122232425262728/** * @file static.cpp * @brief é™æ€æ•°æ®æˆå‘˜ * é™æ€æ•°æ®æˆå‘˜è¢«ç¼–è¯‘å™¨æ”¾åœ¨ç¨‹åºçš„ä¸€ä¸ªglobal data membersä¸­ï¼Œå®ƒæ˜¯ç±»çš„ä¸€ä¸ªæ•°æ®æˆå‘˜ï¼Œä½†ä¸å½±å“ç±»çš„å¤§å°ã€‚ä¸ç®¡è¿™ä¸ªç±»äº§ç”Ÿäº†å¤šå°‘ä¸ªå®ä¾‹ï¼Œè¿˜æ˜¯æ´¾ç”Ÿäº†å¤šå°‘æ–°çš„ç±»ï¼Œé™æ€æ•°æ®æˆå‘˜åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚é™æ€æ•°æ®æˆå‘˜ï¼Œä¸€æ—¦è¢«å£°æ˜ï¼Œå°±å·²ç»å­˜åœ¨ã€‚ * @author å…‰åŸ * @version v1 * @date 2019-07-21 */#include&lt;iostream&gt;using namespace std;class A&#123; public: char b; virtual void fun() &#123;&#125;; static int c; static int d; static int f;&#125;;int main()&#123; /** * @brief 16 å­—èŠ‚å¯¹é½ã€é™æ€å˜é‡ä¸å½±å“ç±»çš„å¤§å°ã€vptræŒ‡é’ˆ=8 */ cout&lt;&lt;sizeof(A)&lt;&lt;endl; return 0;&#125; åŸåˆ™3å¯¹äºåŒ…å«è™šå‡½æ•°çš„ç±»ï¼Œä¸ç®¡æœ‰å¤šå°‘ä¸ªè™šå‡½æ•°ï¼Œåªæœ‰ä¸€ä¸ªè™šæŒ‡é’ˆ,vptrçš„å¤§å°ã€‚ 1234567891011121314151617181920/** * @file morevir.cpp * @brief å¯¹äºåŒ…å«è™šå‡½æ•°çš„ç±»ï¼Œä¸ç®¡æœ‰å¤šå°‘ä¸ªè™šå‡½æ•°ï¼Œåªæœ‰ä¸€ä¸ªè™šæŒ‡é’ˆ,vptrçš„å¤§å°ã€‚ * @author å…‰åŸ * @version v1 * @date 2019-07-21 */#include&lt;iostream&gt;using namespace std;class A&#123; virtual void fun(); virtual void fun1(); virtual void fun2(); virtual void fun3();&#125;;int main()&#123; cout&lt;&lt;sizeof(A)&lt;&lt;endl; // 8 return 0;&#125; åŸåˆ™4å’Œ51234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859/** * @file geninhe.cpp * @brief 1.æ™®é€šå•ç»§æ‰¿,ç»§æ‰¿å°±æ˜¯åŸºç±»+æ´¾ç”Ÿç±»è‡ªèº«çš„å¤§å°(æ³¨æ„å­—èŠ‚å¯¹é½) * æ³¨æ„ï¼šç±»çš„æ•°æ®æˆå‘˜æŒ‰å…¶å£°æ˜é¡ºåºåŠ å…¥å†…å­˜ï¼Œæ— è®¿é—®æƒé™æ— å…³ï¼Œåªçœ‹å£°æ˜é¡ºåºã€‚ * 2.è™šå•ç»§æ‰¿ï¼Œæ´¾ç”Ÿç±»ç»§æ‰¿åŸºç±»vptr * @author å…‰åŸ * @version v1 * @date 2019-07-21 */#include&lt;iostream&gt;using namespace std;class A&#123; public: char a; int b;&#125;;/** * @brief æ­¤æ—¶BæŒ‰ç…§é¡ºåºï¼š * char a * int b * short a * long b * æ ¹æ®å­—èŠ‚å¯¹é½4+4=8+8+8=24 //************************è¿™é‡Œå­˜åœ¨ç–‘é—®ï¼Œæˆ‘è§‰å¾—æ˜¯16 */class B:A&#123; public: short a; long b;&#125;;class C&#123; A a; char c;&#125;;class A1&#123; virtual void fun()&#123;&#125;&#125;;class C1:public A&#123;&#125;;int main()&#123; cout&lt;&lt;sizeof(A)&lt;&lt;endl; // 8 cout&lt;&lt;sizeof(B)&lt;&lt;endl; // 24 cout&lt;&lt;sizeof(C)&lt;&lt;endl; // 12 /** * @brief å¯¹äºè™šå•å‡½æ•°ç»§æ‰¿ï¼Œæ´¾ç”Ÿç±»ä¹Ÿç»§æ‰¿äº†åŸºç±»çš„vptrï¼Œæ‰€ä»¥æ˜¯8å­—èŠ‚ */ cout&lt;&lt;sizeof(C1)&lt;&lt;endl; // 8 return 0;&#125;C++ åŸåˆ™6è™šç»§æ‰¿ 123456789101112131415161718192021222324252627282930313233/** * @file virnhe.cpp * @brief è™šç»§æ‰¿ * @author å…‰åŸ * @version v1 * @date 2019-07-21 */#include&lt;iostream&gt;using namespace std;class A&#123; virtual void fun() &#123;&#125;&#125;;class B&#123; virtual void fun2() &#123;&#125;&#125;;class C : virtual public A, virtual public B&#123; public: virtual void fun3() &#123;&#125;&#125;;int main()&#123; /** * @brief 8 8 16 æ´¾ç”Ÿç±»è™šç»§æ‰¿å¤šä¸ªè™šå‡½æ•°ï¼Œä¼šç»§æ‰¿æ‰€æœ‰è™šå‡½æ•°çš„vptr */ cout&lt;&lt;sizeof(A)&lt;&lt;&quot; &quot;&lt;&lt;sizeof(B)&lt;&lt;&quot; &quot;&lt;&lt;sizeof(C); return 0;&#125; vptr_vtableé‚£äº›äº‹åŸºç¡€ç†è®ºä¸ºäº†å®ç°è™šå‡½æ•°ï¼ŒC ++ä½¿ç”¨ä¸€ç§ç§°ä¸ºè™šæ‹Ÿè¡¨çš„ç‰¹æ®Šå½¢å¼çš„åæœŸç»‘å®šã€‚è¯¥è™šæ‹Ÿè¡¨æ˜¯ç”¨äºè§£å†³åœ¨åŠ¨æ€&#x2F;åæœŸç»‘å®šæ–¹å¼çš„å‡½æ•°è°ƒç”¨å‡½æ•°çš„æŸ¥æ‰¾è¡¨ã€‚ é¦–å…ˆï¼Œæ¯ä¸ªä½¿ç”¨è™šå‡½æ•°çš„ç±»ï¼ˆæˆ–è€…ä»ä½¿ç”¨è™šå‡½æ•°çš„ç±»æ´¾ç”Ÿï¼‰éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿè¡¨ã€‚è¯¥è¡¨åªæ˜¯ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶è®¾ç½®çš„é™æ€æ•°ç»„ã€‚è™šæ‹Ÿè¡¨åŒ…å«å¯ç”±ç±»çš„å¯¹è±¡è°ƒç”¨çš„æ¯ä¸ªè™šå‡½æ•°çš„ä¸€ä¸ªæ¡ç›®ã€‚æ­¤è¡¨ä¸­çš„æ¯ä¸ªæ¡ç›®åªæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘è¯¥ç±»å¯è®¿é—®çš„æ´¾ç”Ÿå‡½æ•°ã€‚ å…¶æ¬¡ï¼Œç¼–è¯‘å™¨è¿˜ä¼šæ·»åŠ ä¸€ä¸ªéšè—æŒ‡å‘åŸºç±»çš„æŒ‡é’ˆï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºvptrã€‚vptråœ¨åˆ›å»ºç±»å®ä¾‹æ—¶è‡ªåŠ¨è®¾ç½®ï¼Œä»¥ä¾¿æŒ‡å‘è¯¥ç±»çš„è™šæ‹Ÿè¡¨ã€‚ä¸thisæŒ‡é’ˆä¸åŒï¼ŒthisæŒ‡é’ˆå®é™…ä¸Šæ˜¯ç¼–è¯‘å™¨ç”¨æ¥è§£æè‡ªå¼•ç”¨çš„å‡½æ•°å‚æ•°ï¼Œvptræ˜¯ä¸€ä¸ªçœŸæ­£çš„æŒ‡é’ˆã€‚å› æ­¤ï¼Œå®ƒä½¿æ¯ä¸ªç±»å¯¹è±¡çš„åˆ†é…å¤§ä¸€ä¸ªæŒ‡é’ˆçš„å¤§å°ã€‚è¿™ä¹Ÿæ„å‘³ç€vptrç”±æ´¾ç”Ÿç±»ç»§æ‰¿ï¼Œè¿™å¾ˆé‡è¦ã€‚ å®ç°ä¸å†…éƒ¨ç»“æ„ä¸‹é¢æˆ‘ä»¬æ¥çœ‹è‡ªåŠ¨ä¸æ‰‹åŠ¨æ“çºµvptræ¥è·å–åœ°å€ä¸è°ƒç”¨è™šå‡½æ•°ï¼ ä»£ç è°ƒç”¨å›¾ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100/** * @file vptr1.cpp * @brief C++è™šå‡½æ•°vptrå’Œvtable * ç¼–è¯‘ï¼šg++ -g -o vptr vptr1.cpp -std=c++11 * @author å…‰åŸ * @version v1 * @date 2019-07-20 */#include &lt;iostream&gt;#include &lt;stdio.h&gt;using namespace std;/** * @brief å‡½æ•°æŒ‡é’ˆ */typedef void (*Fun)(); //**************************è¿™é‡Œä¸æ˜¯å¾ˆç†è§£/** * @brief åŸºç±» */class Base&#123; public: Base()&#123;&#125;; virtual void fun1() &#123; cout &lt;&lt; &quot;Base::fun1()&quot; &lt;&lt; endl; &#125; virtual void fun2() &#123; cout &lt;&lt; &quot;Base::fun2()&quot; &lt;&lt; endl; &#125; virtual void fun3()&#123;&#125; ~Base()&#123;&#125;;&#125;;/** * @brief æ´¾ç”Ÿç±» */class Derived: public Base&#123; public: Derived()&#123;&#125;; void fun1() &#123; cout &lt;&lt; &quot;Derived::fun1()&quot; &lt;&lt; endl; &#125; void fun2() &#123; cout &lt;&lt; &quot;DerivedClass::fun2()&quot; &lt;&lt; endl; &#125; ~Derived()&#123;&#125;;&#125;;/** * @brief è·å–vptråœ°å€ä¸funcåœ°å€,vptræŒ‡å‘çš„æ˜¯ä¸€å—å†…å­˜ï¼Œè¿™å—å†…å­˜å­˜æ”¾çš„æ˜¯è™šå‡½æ•°åœ°å€ï¼Œè¿™å—å†…å­˜å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„è™šè¡¨ * * @param obj * @param offset * * @return */Fun getAddr(void* obj,unsigned int offset)&#123; cout&lt;&lt;&quot;=======================&quot;&lt;&lt;endl; void* vptr_addr = (void *)*(unsigned long *)obj; //64ä½æ“ä½œç³»ç»Ÿï¼Œå 8å­—èŠ‚ï¼Œé€šè¿‡*(unsigned long *)objå–å‡ºå‰8å­—èŠ‚ï¼Œå³vptræŒ‡é’ˆ printf(&quot;vptr_addr:%p\\n&quot;,vptr_addr); /** * @brief é€šè¿‡vptræŒ‡é’ˆè®¿é—®virtual tableï¼Œå› ä¸ºè™šè¡¨ä¸­æ¯ä¸ªå…ƒç´ (è™šå‡½æ•°æŒ‡é’ˆ)åœ¨64ä½ç¼–è¯‘å™¨ä¸‹æ˜¯8ä¸ªå­—èŠ‚ï¼Œå› æ­¤é€šè¿‡*(unsigned long *)vptr_addrå–å‡ºå‰8å­—èŠ‚ï¼Œ * åé¢åŠ ä¸Šåç§»é‡å°±æ˜¯æ¯ä¸ªå‡½æ•°çš„åœ°å€ï¼ */ void* func_addr = (void *)*((unsigned long *)vptr_addr+offset); printf(&quot;func_addr:%p\\n&quot;,func_addr); return (Fun)func_addr;&#125;int main(void)&#123; Base ptr; Derived d; Base *pt = new Derived(); // åŸºç±»æŒ‡é’ˆæŒ‡å‘æ´¾ç”Ÿç±»å®ä¾‹ Base &amp;pp = ptr; // åŸºç±»å¼•ç”¨æŒ‡å‘åŸºç±»å®ä¾‹ Base &amp;p = d; // åŸºç±»å¼•ç”¨æŒ‡å‘æ´¾ç”Ÿç±»å®ä¾‹ cout&lt;&lt;&quot;åŸºç±»å¯¹è±¡ç›´æ¥è°ƒç”¨&quot;&lt;&lt;endl; ptr.fun1(); cout&lt;&lt;&quot;åŸºç±»å¯¹è±¡è°ƒç”¨åŸºç±»å®ä¾‹&quot;&lt;&lt;endl; pp.fun1(); cout&lt;&lt;&quot;åŸºç±»æŒ‡é’ˆæŒ‡å‘æ´¾ç”Ÿç±»å®ä¾‹å¹¶è°ƒç”¨è™šå‡½æ•°&quot;&lt;&lt;endl; pt-&gt;fun1(); cout&lt;&lt;&quot;åŸºç±»å¼•ç”¨æŒ‡å‘æ´¾ç”Ÿç±»å®ä¾‹å¹¶è°ƒç”¨è™šå‡½æ•°&quot;&lt;&lt;endl; p.fun1(); // æ‰‹åŠ¨æŸ¥æ‰¾vptr å’Œ vtable Fun f1 = getAddr(pt, 0); (*f1)(); Fun f2 = getAddr(pt, 1); (*f2)(); delete pt; return 0;&#125; virtualé‚£äº›äº‹è™šå‡½æ•°ä¸­é»˜è®¤å‚æ•°é»˜è®¤å‚æ•°æ˜¯é™æ€ç»‘å®šçš„ï¼Œè™šå‡½æ•°æ˜¯åŠ¨æ€ç»‘å®šçš„ã€‚ é»˜è®¤å‚æ•°çš„ä½¿ç”¨éœ€è¦çœ‹æŒ‡é’ˆæˆ–è€…å¼•ç”¨æœ¬èº«çš„ç±»å‹ï¼Œè€Œä¸æ˜¯å¯¹è±¡çš„ç±»å‹ã€‚ å¯ä»¥ä¸å¯ä»¥ é™æ€å‡½æ•°å¯ä»¥å£°æ˜ä¸ºè™šå‡½æ•°å—ï¼Ÿ é™æ€å‡½æ•°ä¸å¯ä»¥å£°æ˜ä¸ºè™šå‡½æ•°ï¼ŒåŒæ—¶ä¹Ÿä¸èƒ½è¢«const å’Œ volatileå…³é”®å­—ä¿®é¥° staticæˆå‘˜å‡½æ•°ä¸å±äºä»»ä½•ç±»å¯¹è±¡æˆ–ç±»å®ä¾‹ï¼Œæ‰€ä»¥å³ä½¿ç»™æ­¤å‡½æ•°åŠ ä¸Švirutalä¹Ÿæ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰ è™šå‡½æ•°ä¾é vptrå’Œvtableæ¥å¤„ç†ã€‚vptræ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œåœ¨ç±»çš„æ„é€ å‡½æ•°ä¸­åˆ›å»ºç”Ÿæˆï¼Œå¹¶ä¸”åªèƒ½ç”¨thisæŒ‡é’ˆæ¥è®¿é—®å®ƒï¼Œé™æ€æˆå‘˜å‡½æ•°æ²¡æœ‰thisæŒ‡é’ˆï¼Œæ‰€ä»¥æ— æ³•è®¿é—®vptrã€‚ æ„é€ å‡½æ•°å¯ä»¥ä¸ºè™šå‡½æ•°å—ï¼Ÿ æ„é€ å‡½æ•°ä¸å¯ä»¥å£°æ˜ä¸ºè™šå‡½æ•°ã€‚åŒæ—¶é™¤äº†inline|explicitä¹‹å¤–ï¼Œæ„é€ å‡½æ•°ä¸å…è®¸ä½¿ç”¨å…¶å®ƒä»»ä½•å…³é”®å­—ã€‚ ä¸ºä»€ä¹ˆæ„é€ å‡½æ•°ä¸å¯ä»¥ä¸ºè™šå‡½æ•°ï¼Ÿ ä¸å¯ä»¥ä¹Ÿæ²¡æœ‰å¿…è¦ã€‚ å°½ç®¡è™šå‡½æ•°è¡¨vtableæ˜¯åœ¨ç¼–è¯‘é˜¶æ®µå°±å·²ç»å»ºç«‹çš„ï¼Œä½†æŒ‡å‘è™šå‡½æ•°è¡¨çš„æŒ‡é’ˆvptræ˜¯åœ¨è¿è¡Œé˜¶æ®µå®ä¾‹åŒ–å¯¹è±¡æ—¶æ‰äº§ç”Ÿçš„ã€‚ å¦‚æœç±»å«æœ‰è™šå‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šåœ¨æ„é€ å‡½æ•°ä¸­æ·»åŠ ä»£ç æ¥åˆ›å»ºvptrã€‚ é—®é¢˜æ¥äº†ï¼Œå¦‚æœæ„é€ å‡½æ•°æ˜¯è™šçš„ï¼Œé‚£ä¹ˆå®ƒéœ€è¦vptræ¥è®¿é—®vtableï¼Œå¯è¿™ä¸ªæ—¶å€™vptrè¿˜æ²¡äº§ç”Ÿã€‚ å› æ­¤ï¼Œæ„é€ å‡½æ•°ä¸å¯ä»¥ä¸ºè™šå‡½æ•°ã€‚ æˆ‘ä»¬ä¹‹æ‰€ä»¥ä½¿ç”¨è™šå‡½æ•°ï¼Œæ˜¯å› ä¸ºéœ€è¦åœ¨ä¿¡æ¯ä¸å…¨çš„æƒ…å†µä¸‹è¿›è¡Œå¤šæ€è¿è¡Œã€‚è€Œæ„é€ å‡½æ•°æ˜¯ç”¨æ¥åˆå§‹åŒ–å®ä¾‹çš„ï¼Œå®ä¾‹çš„ç±»å‹å¿…é¡»æ˜¯æ˜ç¡®çš„ã€‚ å› æ­¤ï¼Œæ„é€ å‡½æ•°æ²¡æœ‰å¿…è¦è¢«å£°æ˜ä¸ºè™šå‡½æ•°ã€‚ è™šå‡½æ•°å¯ä»¥ä¸ºç§æœ‰å‡½æ•°å—ï¼Ÿ 123456789101112131415161718192021222324252627282930313233/** * @file virtual_function.cpp * @brief è™šå‡½æ•°å¯ä»¥è¢«ç§æœ‰åŒ–ï¼Œä½†æœ‰ä¸€äº›ç»†èŠ‚éœ€è¦æ³¨æ„ã€‚ * åŸºç±»æŒ‡é’ˆæŒ‡å‘ç»§æ‰¿ç±»å¯¹è±¡ï¼Œåˆ™è°ƒç”¨ç»§æ‰¿ç±»å¯¹è±¡çš„å‡½æ•°ï¼› * int main()å¿…é¡»å£°æ˜ä¸ºBaseç±»çš„å‹å…ƒï¼Œå¦åˆ™ç¼–è¯‘å¤±è´¥ã€‚ ç¼–è¯‘å™¨æŠ¥é”™ï¼š ptræ— æ³•è®¿é—®ç§æœ‰å‡½æ•°ã€‚ * å½“ç„¶ï¼ŒæŠŠåŸºç±»å£°æ˜ä¸ºpublicï¼Œ ç»§æ‰¿ç±»ä¸ºprivateï¼Œè¯¥é—®é¢˜å°±ä¸å­˜åœ¨äº†ã€‚----&gt; è§å¦å¤–ä¸€ä¸ªä¾‹å­ï¼ * @author å…‰åŸ * @version v1 * @date 2019-07-24 */#include&lt;iostream&gt; using namespace std; class Derived; class Base &#123; private: virtual void fun() &#123; cout &lt;&lt; &quot;Base Fun&quot;; &#125; friend int main(); &#125;; class Derived: public Base &#123; public: void fun() &#123; cout &lt;&lt; &quot;Derived Fun&quot;; &#125; &#125;; int main() &#123; Base *ptr = new Derived; ptr-&gt;fun(); return 0; &#125; RTTIä¸dynamic_castRTTIï¼ˆRun-Time Type Identification)ï¼Œé€šè¿‡è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯ç¨‹åºèƒ½å¤Ÿä½¿ç”¨***åŸºç±»çš„æŒ‡é’ˆæˆ–å¼•ç”¨***æ¥æ£€æŸ¥è¿™äº›æŒ‡é’ˆæˆ–å¼•ç”¨æ‰€æŒ‡çš„å¯¹è±¡çš„å®é™…æ´¾ç”Ÿç±»å‹ã€‚ åœ¨é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­ï¼Œæœ‰æ—¶æˆ‘ä»¬éœ€è¦åœ¨è¿è¡Œæ—¶æŸ¥è¯¢ä¸€ä¸ªå¯¹è±¡æ˜¯å¦èƒ½ä½œä¸ºæŸç§å¤šæ€ç±»å‹ä½¿ç”¨ã€‚ä¸Javaçš„instanceofï¼Œä»¥åŠC#çš„asã€isè¿ç®—ç¬¦ç±»ä¼¼ï¼ŒC++æä¾›äº†dynamic_castå‡½æ•°ç”¨äºåŠ¨æ€è½¬å‹ã€‚ç›¸æ¯”Cé£æ ¼çš„å¼ºåˆ¶ç±»å‹è½¬æ¢å’ŒC++ reinterpret_castï¼Œdynamic_castæä¾›äº†ç±»å‹å®‰å…¨æ£€æŸ¥ï¼Œæ˜¯ä¸€ç§åŸºäºèƒ½åŠ›æŸ¥è¯¢(Capability Query)çš„è½¬æ¢ï¼Œæ‰€ä»¥åœ¨å¤šæ€ç±»å‹é—´è¿›è¡Œè½¬æ¢æ›´æå€¡é‡‡ç”¨dynamic_castã€‚ 12345678910111213141516171819202122232425262728293031323334/** * @file rtti.cpp * @brief åœ¨é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­ï¼Œæœ‰æ—¶æˆ‘ä»¬éœ€è¦åœ¨è¿è¡Œæ—¶æŸ¥è¯¢ä¸€ä¸ªå¯¹è±¡æ˜¯å¦èƒ½ä½œä¸ºæŸç§å¤šæ€ç±»å‹ä½¿ç”¨ã€‚ä¸Javaçš„instanceofï¼Œä»¥åŠC#çš„asã€isè¿ç®—ç¬¦ç±»ä¼¼ï¼ŒC++æä¾›äº†dynamic_castå‡½æ•°ç”¨äºåŠ¨æ€è½¬å‹ã€‚ç›¸æ¯”Cé£æ ¼çš„å¼ºåˆ¶ç±»å‹è½¬æ¢å’ŒC++ reinterpret_castï¼Œdynamic_castæä¾›äº†ç±»å‹å®‰å…¨æ£€æŸ¥ï¼Œæ˜¯ä¸€ç§åŸºäºèƒ½åŠ›æŸ¥è¯¢(Capability Query)çš„è½¬æ¢ï¼Œæ‰€ä»¥åœ¨å¤šæ€ç±»å‹é—´è¿›è¡Œè½¬æ¢æ›´æå€¡é‡‡ç”¨dynamic_cast * @author å…‰åŸ * @version v1 * @date 2019-07-24 */// CPP program to illustrate // // Run Time Type Identification #include&lt;iostream&gt;#include&lt;typeinfo&gt;using namespace std; class B &#123; virtual void fun() &#123;&#125; &#125;; class D: public B &#123; &#125;; int main() &#123; B *b = new D; // å‘ä¸Šè½¬å‹ B &amp;obj = *b; D *d = dynamic_cast&lt;D*&gt;(b); // å‘ä¸‹è½¬å‹ if(d != NULL) cout &lt;&lt; &quot;works&quot;&lt;&lt;endl; else cout &lt;&lt; &quot;cannot cast B* to D*&quot;; try &#123; D&amp; dobj = dynamic_cast&lt;D&amp;&gt;(obj); cout &lt;&lt; &quot;works&quot;&lt;&lt;endl; &#125; catch (bad_cast bc) &#123; // ERROR cout&lt;&lt;bc.what()&lt;&lt;endl; &#125; return 0;&#125; 123456789101112131415161718192021222324252627282930313233// åœ¨ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ï¼šè¢«è½¬æ¢å¯¹è±¡objçš„ç±»å‹T1å¿…é¡»æ˜¯å¤šæ€ç±»å‹ï¼Œå³T1å¿…é¡»å…¬æœ‰ç»§æ‰¿è‡ªå…¶å®ƒç±»ï¼Œæˆ–è€…T1æ‹¥æœ‰è™šå‡½æ•°ï¼ˆç»§æ‰¿æˆ–è‡ªå®šä¹‰ï¼‰ã€‚è‹¥T1ä¸ºéå¤šæ€ç±»å‹ï¼Œä½¿ç”¨dynamic_castä¼šæŠ¥ç¼–è¯‘é”™è¯¯ã€‚// Aä¸ºéå¤šæ€ç±»å‹ class A&#123;&#125;;//Bä¸ºå¤šæ€ç±»å‹class B&#123; public: virtual ~B()&#123;&#125;&#125;;//Dä¸ºå¤šæ€ç±»å‹class D: public A&#123;&#125;;//Eä¸ºéå¤šæ€ç±»å‹class E : private A&#123;&#125;;//Fä¸ºå¤šæ€ç±»å‹class F : private B&#123;&#125; volatile é‚£äº›äº‹volatileæé†’ç¼–è¯‘å™¨å®ƒåé¢æ‰€å®šä¹‰çš„å˜é‡éšæ—¶éƒ½æœ‰å¯èƒ½æ”¹å˜ï¼Œå› æ­¤ç¼–è¯‘åçš„ç¨‹åºæ¯æ¬¡éœ€è¦å­˜å‚¨æˆ–è¯»å–è¿™ä¸ªå˜é‡çš„æ—¶å€™ï¼Œéƒ½ä¼šç›´æ¥ä»å˜é‡åœ°å€ä¸­è¯»å–æ•°æ®ã€‚å¦‚æœæ²¡æœ‰volatileå…³é”®å­—ï¼Œåˆ™ç¼–è¯‘å™¨å¯èƒ½ä¼˜åŒ–è¯»å–å’Œå­˜å‚¨ï¼Œå¯èƒ½æš‚æ—¶ä½¿ç”¨å¯„å­˜å™¨ä¸­çš„å€¼ï¼Œå¦‚æœè¿™ä¸ªå˜é‡ç”±åˆ«çš„ç¨‹åºæ›´æ–°äº†çš„è¯ï¼Œå°†å‡ºç°ä¸ä¸€è‡´çš„ç°è±¡ã€‚ volatileä½¿ç”¨ volatile å…³é”®å­—æ˜¯ä¸€ç§ç±»å‹ä¿®é¥°ç¬¦ï¼Œç”¨å®ƒå£°æ˜çš„ç±»å‹å˜é‡è¡¨ç¤ºå¯ä»¥è¢«æŸäº›ç¼–è¯‘å™¨æœªçŸ¥çš„å› ç´ ï¼ˆæ“ä½œç³»ç»Ÿã€ç¡¬ä»¶ã€å…¶å®ƒçº¿ç¨‹ç­‰ï¼‰æ›´æ”¹ã€‚æ‰€ä»¥ä½¿ç”¨volatileå‘Šè¯‰ç¼–è¯‘å™¨ä¸åº”å¯¹è¿™æ ·çš„å¯¹è±¡è¿›è¡Œä¼˜åŒ–ã€‚ volatile å…³é”®å­—å£°æ˜çš„å˜é‡ï¼Œæ¯æ¬¡è®¿é—®æ—¶éƒ½å¿…é¡»ä»å†…å­˜ä¸­å–å‡ºå€¼ï¼ˆæ²¡æœ‰è¢« volatile ä¿®é¥°çš„å˜é‡ï¼Œå¯èƒ½ç”±äºç¼–è¯‘å™¨çš„ä¼˜åŒ–ï¼Œä» CPU å¯„å­˜å™¨ä¸­å–å€¼ï¼‰ const å¯ä»¥æ˜¯ volatile ï¼ˆå¦‚åªè¯»çš„çŠ¶æ€å¯„å­˜å™¨ï¼‰ æŒ‡é’ˆå¯ä»¥æ˜¯ volatile volatileè¢« volatile ä¿®é¥°çš„å˜é‡ï¼Œåœ¨å¯¹å…¶è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œä¼šå¼•å‘ä¸€äº›å¯è§‚æµ‹çš„å‰¯ä½œç”¨ã€‚è€Œè¿™äº›å¯è§‚æµ‹çš„å‰¯ä½œç”¨ï¼Œæ˜¯ç”±ç¨‹åºä¹‹å¤–çš„å› ç´ å†³å®šçš„ã€‚ volatileåº”ç”¨ å¹¶è¡Œè®¾å¤‡çš„ç¡¬ä»¶å¯„å­˜å™¨ï¼ˆå¦‚çŠ¶æ€å¯„å­˜å™¨ï¼‰ã€‚ å‡è®¾è¦å¯¹ä¸€ä¸ªè®¾å¤‡è¿›è¡Œåˆå§‹åŒ–ï¼Œæ­¤è®¾å¤‡çš„æŸä¸€ä¸ªå¯„å­˜å™¨ä¸º0xff800000ã€‚ 123456789int *output = (unsigned int *)0xff800000; //å®šä¹‰ä¸€ä¸ªIOç«¯å£ï¼› int init(void) &#123; int i; for(i=0;i&lt; 10;i++) &#123; *output = i; &#125; &#125; ç»è¿‡ç¼–è¯‘å™¨ä¼˜åŒ–åï¼Œç¼–è¯‘å™¨è®¤ä¸ºå‰é¢å¾ªç¯åŠå¤©éƒ½æ˜¯åºŸè¯ï¼Œå¯¹æœ€åçš„ç»“æœæ¯«æ— å½±å“ï¼Œå› ä¸ºæœ€ç»ˆåªæ˜¯å°†outputè¿™ä¸ªæŒ‡é’ˆèµ‹å€¼ä¸º 9ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨æœ€åç»™ä½ ç¼–è¯‘ç¼–è¯‘çš„ä»£ç ç»“æœç›¸å½“äºï¼š 1234int init(void) &#123; *output = 9; &#125; å¦‚æœä½ å¯¹æ­¤å¤–éƒ¨è®¾å¤‡è¿›è¡Œåˆå§‹åŒ–çš„è¿‡ç¨‹æ˜¯å¿…é¡»æ˜¯åƒä¸Šé¢ä»£ç ä¸€æ ·é¡ºåºçš„å¯¹å…¶èµ‹å€¼ï¼Œæ˜¾ç„¶ä¼˜åŒ–è¿‡ç¨‹å¹¶ä¸èƒ½è¾¾åˆ°ç›®çš„ã€‚åä¹‹å¦‚æœä½ ä¸æ˜¯å¯¹æ­¤ç«¯å£åå¤å†™æ“ä½œï¼Œè€Œæ˜¯åå¤è¯»æ“ä½œï¼Œå…¶ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œç¼–è¯‘å™¨åœ¨ä¼˜åŒ–åï¼Œä¹Ÿè®¸ä½ çš„ä»£ç å¯¹æ­¤åœ°å€çš„è¯»æ“ä½œåªåšäº†ä¸€æ¬¡ã€‚ç„¶è€Œä»ä»£ç è§’åº¦çœ‹æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ã€‚è¿™æ—¶å€™å°±è¯¥ä½¿ç”¨volatileé€šçŸ¥ç¼–è¯‘å™¨è¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªä¸ç¨³å®šçš„ï¼Œåœ¨é‡åˆ°æ­¤å˜é‡æ—¶å€™ä¸è¦ä¼˜åŒ–ã€‚ 2.ä¸€ä¸ªä¸­æ–­æœåŠ¡å­ç¨‹åºä¸­è®¿é—®åˆ°çš„å˜é‡ï¼› 123456789101112131415static int i=0;int main()&#123; while(1) &#123; if(i) dosomething(); &#125;&#125;/* Interrupt service routine */void IRS()&#123; i=1;&#125; ä¸Šé¢ç¤ºä¾‹ç¨‹åºçš„æœ¬æ„æ˜¯äº§ç”Ÿä¸­æ–­æ—¶ï¼Œç”±ä¸­æ–­æœåŠ¡å­ç¨‹åºIRSå“åº”ä¸­æ–­ï¼Œå˜æ›´ç¨‹åºå˜é‡iï¼Œä½¿åœ¨mainå‡½æ•°ä¸­è°ƒç”¨dosomethingå‡½æ•°ï¼Œä½†æ˜¯ï¼Œç”±äºç¼–è¯‘å™¨åˆ¤æ–­åœ¨mainå‡½æ•°é‡Œé¢æ²¡æœ‰ä¿®æ”¹è¿‡iï¼Œå› æ­¤å¯èƒ½åªæ‰§è¡Œä¸€æ¬¡å¯¹ä»iåˆ°æŸå¯„å­˜å™¨çš„è¯»æ“ä½œï¼Œç„¶åæ¯æ¬¡ifåˆ¤æ–­éƒ½åªä½¿ç”¨è¿™ä¸ªå¯„å­˜å™¨é‡Œé¢çš„â€œiå‰¯æœ¬â€ï¼Œå¯¼è‡´dosomethingæ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ã€‚å¦‚æœå°†å˜é‡iåŠ ä¸Švolatileä¿®é¥°ï¼Œåˆ™ç¼–è¯‘å™¨ä¿è¯å¯¹å˜é‡içš„è¯»å†™æ“ä½œéƒ½ä¸ä¼šè¢«ä¼˜åŒ–ï¼Œä»è€Œä¿è¯äº†å˜é‡iè¢«å¤–éƒ¨ç¨‹åºæ›´æ”¹åèƒ½åŠæ—¶åœ¨åŸç¨‹åºä¸­å¾—åˆ°æ„ŸçŸ¥ã€‚ 3.å¤šçº¿ç¨‹åº”ç”¨ä¸­è¢«å¤šä¸ªä»»åŠ¡å…±äº«çš„å˜é‡ã€‚ å½“å¤šä¸ªçº¿ç¨‹å…±äº«æŸä¸€ä¸ªå˜é‡æ—¶ï¼Œè¯¥å˜é‡çš„å€¼ä¼šè¢«æŸä¸€ä¸ªçº¿ç¨‹æ›´æ”¹ï¼Œåº”è¯¥ç”¨ volatile å£°æ˜ã€‚ä½œç”¨æ˜¯é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–æŠŠå˜é‡ä»å†…å­˜è£…å…¥CPUå¯„å­˜å™¨ä¸­ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ›´æ”¹å˜é‡åï¼ŒæœªåŠæ—¶åŒæ­¥åˆ°å…¶å®ƒçº¿ç¨‹ä¸­å¯¼è‡´ç¨‹åºå‡ºé”™ã€‚volatileçš„æ„æ€æ˜¯è®©ç¼–è¯‘å™¨æ¯æ¬¡æ“ä½œè¯¥å˜é‡æ—¶ä¸€å®šè¦ä»å†…å­˜ä¸­çœŸæ­£å–å‡ºï¼Œè€Œä¸æ˜¯ä½¿ç”¨å·²ç»å­˜åœ¨å¯„å­˜å™¨ä¸­çš„å€¼ã€‚ 12345678910111213volatile bool bStop=false; //bStop ä¸ºå…±äº«å…¨å±€å˜é‡ //ç¬¬ä¸€ä¸ªçº¿ç¨‹void threadFunc1()&#123; ... while(!bStop)&#123;...&#125;&#125;//ç¬¬äºŒä¸ªçº¿ç¨‹ç»ˆæ­¢ä¸Šé¢çš„çº¿ç¨‹å¾ªç¯void threadFunc2()&#123; ... bStop = true;&#125; è¦æƒ³é€šè¿‡ç¬¬äºŒä¸ªçº¿ç¨‹ç»ˆæ­¢ç¬¬ä¸€ä¸ªçº¿ç¨‹å¾ªç¯ï¼Œå¦‚æœbStopä¸ä½¿ç”¨volatileå®šä¹‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå¾ªç¯å°†æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œå› ä¸ºbStopå·²ç»è¯»å–åˆ°äº†å¯„å­˜å™¨ä¸­ï¼Œå¯„å­˜å™¨ä¸­bStopçš„å€¼æ°¸è¿œä¸ä¼šå˜æˆFALSEï¼ŒåŠ ä¸Švolatileï¼Œç¨‹åºåœ¨æ‰§è¡Œæ—¶ï¼Œæ¯æ¬¡å‡ä»å†…å­˜ä¸­è¯»å‡ºbStopçš„å€¼ï¼Œå°±ä¸ä¼šæ­»å¾ªç¯äº†ã€‚ æ˜¯å¦äº†è§£volatileçš„åº”ç”¨åœºæ™¯æ˜¯åŒºåˆ†C&#x2F;C++ç¨‹åºå‘˜å’ŒåµŒå…¥å¼å¼€å‘ç¨‹åºå‘˜çš„æœ‰æ•ˆåŠæ³•ï¼ŒæåµŒå…¥å¼çš„å®¶ä¼™ä»¬ç»å¸¸åŒç¡¬ä»¶ã€ä¸­æ–­ã€RTOSç­‰ç­‰æ‰“äº¤é“ï¼Œè¿™äº›éƒ½è¦æ±‚ç”¨åˆ°volatileå˜é‡ï¼Œä¸æ‡‚å¾—volatileå°†ä¼šå¸¦æ¥ç¨‹åºè®¾è®¡çš„ç¾éš¾ã€‚ volatileå¸¸è§é—®é¢˜ä¸‹é¢çš„é—®é¢˜å¯ä»¥çœ‹ä¸€ä¸‹é¢è¯•è€…æ˜¯ä¸æ˜¯ç›´æ­£äº†è§£volatileã€‚ ä¸€ä¸ªå‚æ•°æ—¢å¯ä»¥æ˜¯constè¿˜å¯ä»¥æ˜¯volatileå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ å¯ä»¥ã€‚ä¸€ä¸ªä¾‹å­æ˜¯åªè¯»çš„çŠ¶æ€å¯„å­˜å™¨ã€‚å®ƒæ˜¯volatileå› ä¸ºå®ƒå¯èƒ½è¢«æ„æƒ³ä¸åˆ°åœ°æ”¹å˜ã€‚å®ƒæ˜¯constå› ä¸ºç¨‹åºä¸åº”è¯¥è¯•å›¾å»ä¿®æ”¹å®ƒã€‚ constä¿®é¥°çš„å˜é‡åœ¨ç¨‹åºé‡Œé¢æ˜¯ä¸èƒ½æ”¹å˜çš„ï¼Œä½†æ˜¯å¯ä»¥è¢«ç¨‹åºå¤–çš„ä¸œè¥¿ä¿®æ”¹ï¼Œå°±è±¡ä¸Šé¢è¯´çš„å¤–éƒ¨ç«¯å£çš„å€¼ï¼Œå¦‚æœä»…ä»…ä½¿ç”¨constï¼Œæœ‰å¯èƒ½complierä¼šä¼˜åŒ–æ‰è¿™äº›å˜é‡ï¼ŒåŠ ä¸Švolatileå°±ä¸‡æ— ä¸€å¤±äº†ã€‚ ä¸€ä¸ªæŒ‡é’ˆå¯ä»¥æ˜¯volatileå—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ å¯ä»¥ã€‚å°½ç®¡è¿™å¹¶ä¸å¸¸è§ã€‚ä¸€ä¸ªä¾‹å­æ˜¯å½“ä¸€ä¸ªä¸­æ–­æœåŠ¡å­ç¨‹åºä¿®è¯¥ä¸€ä¸ªæŒ‡å‘ä¸€ä¸ªbufferçš„æŒ‡é’ˆæ—¶ã€‚ ä¸‹é¢çš„å‡½æ•°æœ‰ä»€ä¹ˆé”™è¯¯ï¼Ÿ 1234int square(volatile int *ptr) &#123; return *ptr * *ptr; &#125; è¿™æ®µä»£ç æœ‰ç‚¹å˜æ€ï¼Œå…¶ç›®çš„æ˜¯ç”¨æ¥è¿”å›æŒ‡é’ˆptræŒ‡å‘å€¼çš„å¹³æ–¹ï¼Œä½†æ˜¯ï¼Œç”±äºptræŒ‡å‘ä¸€ä¸ªvolatileå‹å‚æ•°ï¼Œç¼–è¯‘å™¨å°†äº§ç”Ÿç±»ä¼¼ä¸‹é¢çš„ä»£ç ï¼š 1234567int square(volatile int *ptr) &#123; int a,b; a = *ptr; b = *ptr; return a * b; &#125; ç”±äº*ptrçš„å€¼å¯èƒ½è¢«æ„æƒ³ä¸åˆ°åœ°æ”¹å˜ï¼Œå› æ­¤aå’Œbå¯èƒ½æ˜¯ä¸åŒçš„ã€‚ç»“æœï¼Œè¿™æ®µä»£ç å¯èƒ½è¿”å›çš„ä¸æ˜¯ä½ æ‰€æœŸæœ›çš„å¹³æ–¹å€¼ï¼æ­£ç¡®çš„ä»£ç å¦‚ä¸‹ï¼š 12345long square(volatile int *ptr) &#123; int a=*ptr; return a * a; &#125; asserté‚£äº›äº‹ç¬¬ä¸€ä¸ªæ–­è¨€æ¡ˆä¾‹æ–­è¨€ï¼Œæ˜¯å®ï¼Œè€Œéå‡½æ•°ã€‚assert å®çš„åŸå‹å®šä¹‰åœ¨ ï¼ˆCï¼‰ã€ï¼ˆC++ï¼‰ä¸­ï¼Œå…¶ä½œç”¨æ˜¯å¦‚æœå®ƒçš„æ¡ä»¶è¿”å›é”™è¯¯ï¼Œåˆ™ç»ˆæ­¢ç¨‹åºæ‰§è¡Œã€‚å¯ä»¥é€šè¿‡å®šä¹‰ NDEBUG æ¥å…³é—­ assertï¼Œä½†æ˜¯éœ€è¦åœ¨æºä»£ç çš„å¼€å¤´ï¼Œinclude ä¹‹å‰ã€‚ 1void assert(int expression); æ–­è¨€ä¸æ­£å¸¸é”™è¯¯å¤„ç†æ–­è¨€ä¸»è¦ç”¨äºæ£€æŸ¥é€»è¾‘ä¸Šä¸å¯èƒ½çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå®ƒä»¬å¯ç”¨äºæ£€æŸ¥ä»£ç åœ¨å¼€å§‹è¿è¡Œä¹‹å‰æ‰€æœŸæœ›çš„çŠ¶æ€ï¼Œæˆ–è€…åœ¨è¿è¡Œå®Œæˆåæ£€æŸ¥çŠ¶æ€ã€‚ä¸æ­£å¸¸çš„é”™è¯¯å¤„ç†ä¸åŒï¼Œæ–­è¨€é€šå¸¸åœ¨è¿è¡Œæ—¶è¢«ç¦ç”¨ã€‚ å¿½ç•¥æ–­è¨€ï¼š åœ¨ä»£ç å¼€å¤´åŠ ä¸Šï¼š 1#define NDEBUG // åŠ ä¸Šè¿™è¡Œï¼Œåˆ™ assert ä¸å¯ç”¨ extern â€œCâ€é‚£äº›äº‹C++ä¸Cç¼–è¯‘åŒºåˆ«åœ¨C++ä¸­å¸¸åœ¨å¤´æ–‡ä»¶è§åˆ°extern â€œCâ€ä¿®é¥°å‡½æ•°ï¼Œé‚£æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ æ˜¯ç”¨äºC++é“¾æ¥åœ¨Cè¯­è¨€æ¨¡å—ä¸­å®šä¹‰çš„å‡½æ•°ã€‚ C++è™½ç„¶å…¼å®¹Cï¼Œä½†C++æ–‡ä»¶ä¸­å‡½æ•°ç¼–è¯‘åç”Ÿæˆçš„ç¬¦å·ä¸Cè¯­è¨€ç”Ÿæˆçš„ä¸åŒã€‚å› ä¸ºC++æ”¯æŒå‡½æ•°é‡è½½ï¼ŒC++å‡½æ•°ç¼–è¯‘åç”Ÿæˆçš„ç¬¦å·å¸¦æœ‰å‡½æ•°å‚æ•°ç±»å‹çš„ä¿¡æ¯ï¼Œè€ŒCåˆ™æ²¡æœ‰ã€‚ ä¾‹å¦‚int add(int a, int b)å‡½æ•°ç»è¿‡C++ç¼–è¯‘å™¨ç”Ÿæˆ.oæ–‡ä»¶åï¼Œaddä¼šå˜æˆå½¢å¦‚add_int_intä¹‹ç±»çš„, è€ŒCçš„è¯åˆ™ä¼šæ˜¯å½¢å¦‚_add, å°±æ˜¯è¯´ï¼šç›¸åŒçš„å‡½æ•°ï¼Œåœ¨Cå’ŒC++ä¸­ï¼Œç¼–è¯‘åç”Ÿæˆçš„ç¬¦å·ä¸åŒã€‚ è¿™å°±å¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœC++ä¸­ä½¿ç”¨Cè¯­è¨€å®ç°çš„å‡½æ•°ï¼Œåœ¨ç¼–è¯‘é“¾æ¥çš„æ—¶å€™ï¼Œä¼šå‡ºé”™ï¼Œæç¤ºæ‰¾ä¸åˆ°å¯¹åº”çš„ç¬¦å·ã€‚æ­¤æ—¶extern &quot;C&quot;å°±èµ·ä½œç”¨äº†ï¼šå‘Šè¯‰é“¾æ¥å™¨å»å¯»æ‰¾_addè¿™ç±»çš„Cè¯­è¨€ç¬¦å·ï¼Œè€Œä¸æ˜¯ç»è¿‡C++ä¿®é¥°çš„ç¬¦å·ã€‚ C++è°ƒç”¨Cå‡½æ•°C++è°ƒç”¨Cå‡½æ•°çš„ä¾‹å­: å¼•ç”¨Cçš„å¤´æ–‡ä»¶æ—¶ï¼Œéœ€è¦åŠ extern &quot;C&quot; 123456789101112131415161718192021//add.h#ifndef ADD_H#define ADD_Hint add(int x,int y);#endif//add.c#include &quot;add.h&quot;int add(int x,int y) &#123; return x+y;&#125;//add.cpp#include &lt;iostream&gt;#include &quot;add.h&quot;using namespace std;int main() &#123; add(2,3); return 0;&#125; ç¼–è¯‘ï¼š 12//Generate add.o filegcc -c add.c é“¾æ¥ï¼š 1g++ add.cpp add.o -o main æ²¡æœ‰æ·»åŠ extern â€œCâ€ æŠ¥é”™ï¼š 123456789&gt; g++ add.cpp add.o -o main add.oï¼šåœ¨å‡½æ•°â€˜mainâ€™ä¸­ï¼šadd.cpp:(.text+0x0): `main&#x27;è¢«å¤šæ¬¡å®šä¹‰/tmp/ccH65yQF.o:add.cpp:(.text+0x0)ï¼šç¬¬ä¸€æ¬¡åœ¨æ­¤å®šä¹‰/tmp/ccH65yQF.oï¼šåœ¨å‡½æ•°â€˜mainâ€™ä¸­ï¼šadd.cpp:(.text+0xf)ï¼šå¯¹â€˜add(int, int)â€™æœªå®šä¹‰çš„å¼•ç”¨add.oï¼šåœ¨å‡½æ•°â€˜mainâ€™ä¸­ï¼šadd.cpp:(.text+0xf)ï¼šå¯¹â€˜add(int, int)â€™æœªå®šä¹‰çš„å¼•ç”¨collect2: error: ld returned 1 exit status æ·»åŠ extern â€œCâ€åï¼š 123456789#include &lt;iostream&gt;using namespace std;extern &quot;C&quot; &#123; #include &quot;add.h&quot;&#125;int main() &#123; add(2,3); return 0;&#125; ç¼–è¯‘çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„ï¼Œå…ˆé€šè¿‡gccç”Ÿæˆä¸­é—´æ–‡ä»¶add.oã€‚ 1gcc -c add.c ç„¶åç¼–è¯‘ï¼š 1g++ add.cpp add.o -o main Cä¸­è°ƒç”¨C++å‡½æ•°extern &quot;C&quot;åœ¨Cä¸­æ˜¯è¯­æ³•é”™è¯¯ï¼Œéœ€è¦æ”¾åœ¨C++å¤´æ–‡ä»¶ä¸­ã€‚ 123456789101112131415161718192021// add.h#ifndef ADD_H#define ADD_Hextern &quot;C&quot; &#123; //***********************************æ”¾åœ¨C++æ–‡ä»¶ä¸­ int add(int x,int y);&#125;#endif// add.cpp#include &quot;add.h&quot;int add(int x,int y) &#123; return x+y;&#125;// add.cextern int add(int x,int y); //********************************************è¿™é‡ŒåŠ externint main() &#123; add(2,3); return 0;&#125; æ€»ç»“ç»¼ä¸Šï¼Œæ€»ç»“å‡ºä½¿ç”¨æ–¹æ³•ï¼Œåœ¨Cè¯­è¨€çš„å¤´æ–‡ä»¶ä¸­ï¼Œå¯¹å…¶å¤–éƒ¨å‡½æ•°åªèƒ½æŒ‡å®šä¸ºexternç±»å‹ï¼ŒCè¯­è¨€ä¸­ä¸æ”¯æŒextern â€œCâ€å£°æ˜ï¼Œåœ¨.cæ–‡ä»¶ä¸­åŒ…å«äº†extern â€œCâ€æ—¶ä¼šå‡ºç°ç¼–è¯‘è¯­æ³•é”™è¯¯ã€‚æ‰€ä»¥ä½¿ç”¨extern â€œCâ€å…¨éƒ¨éƒ½æ”¾åœ¨äºcppç¨‹åºç›¸å…³æ–‡ä»¶æˆ–å…¶å¤´æ–‡ä»¶ä¸­ã€‚ C++è°ƒç”¨Cå‡½æ•°ï¼š 123456789101112//xx.hextern int add(...)//xx.cint add()&#123;&#125;//xx.cppextern &quot;C&quot; &#123; #include &quot;xx.h&quot;&#125; Cè°ƒç”¨C++å‡½æ•° 12345678910//xx.hextern &quot;C&quot;&#123; int add();&#125;//xx.cppint add()&#123;&#125;//xx.cextern int add(); structé‚£äº›äº‹Cå’ŒC++ä¸­çš„StructåŒºåˆ« struct å’ŒclassåŒºåˆ«æ€»çš„æ¥è¯´ï¼Œstruct æ›´é€‚åˆçœ‹æˆæ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„çš„å®ç°ä½“ï¼Œclass æ›´é€‚åˆçœ‹æˆæ˜¯ä¸€ä¸ªå¯¹è±¡çš„å®ç°ä½“ã€‚ åŒºåˆ«: æœ€æœ¬è´¨çš„ä¸€ä¸ªåŒºåˆ«å°±æ˜¯é»˜è®¤çš„è®¿é—®æ§åˆ¶ é»˜è®¤çš„ç»§æ‰¿è®¿é—®æƒé™ã€‚struct æ˜¯ public çš„ï¼Œclass æ˜¯ private çš„ã€‚ struct ä½œä¸ºæ•°æ®ç»“æ„çš„å®ç°ä½“ï¼Œå®ƒé»˜è®¤çš„æ•°æ®è®¿é—®æ§åˆ¶æ˜¯ public çš„ï¼Œè€Œ class ä½œä¸ºå¯¹è±¡çš„å®ç°ä½“ï¼Œå®ƒé»˜è®¤çš„æˆå‘˜å˜é‡è®¿é—®æ§åˆ¶æ˜¯ private çš„ã€‚ UNIONé‚£äº›äº‹è”åˆï¼ˆunionï¼‰æ˜¯ä¸€ç§èŠ‚çœç©ºé—´çš„ç‰¹æ®Šçš„ç±»ï¼Œä¸€ä¸ª union å¯ä»¥æœ‰å¤šä¸ªæ•°æ®æˆå‘˜ï¼Œä½†æ˜¯åœ¨ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ªæ•°æ®æˆå‘˜å¯ä»¥æœ‰å€¼ã€‚å½“æŸä¸ªæˆå‘˜è¢«èµ‹å€¼åå…¶ä»–æˆå‘˜å˜ä¸ºæœªå®šä¹‰çŠ¶æ€ã€‚è”åˆæœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š é»˜è®¤è®¿é—®æ§åˆ¶ç¬¦ä¸º public å¯ä»¥å«æœ‰æ„é€ å‡½æ•°ã€ææ„å‡½æ•° ä¸èƒ½å«æœ‰å¼•ç”¨ç±»å‹çš„æˆå‘˜ ä¸èƒ½ç»§æ‰¿è‡ªå…¶ä»–ç±»ï¼Œä¸èƒ½ä½œä¸ºåŸºç±» ä¸èƒ½å«æœ‰è™šå‡½æ•° åŒ¿å union åœ¨å®šä¹‰æ‰€åœ¨ä½œç”¨åŸŸå¯ç›´æ¥è®¿é—® union æˆå‘˜ åŒ¿å union ä¸èƒ½åŒ…å« protected æˆå‘˜æˆ– private æˆå‘˜ å…¨å±€åŒ¿åè”åˆå¿…é¡»æ˜¯é™æ€ï¼ˆstaticï¼‰çš„ Cå®ç°C++çš„é¢å‘å¯¹è±¡ç‰¹æ€§C++å®ç°æ¡ˆä¾‹C++ä¸­çš„å¤šæ€:åœ¨C++ä¸­ä¼šç»´æŠ¤ä¸€å¼ è™šå‡½æ•°è¡¨ï¼Œæ ¹æ®èµ‹å€¼å…¼å®¹è§„åˆ™ï¼Œæˆ‘ä»¬çŸ¥é“çˆ¶ç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨æ˜¯å¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡çš„ã€‚ å¦‚æœä¸€ä¸ªçˆ¶ç±»çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨è°ƒç”¨çˆ¶ç±»çš„è™šå‡½æ•°åˆ™è¯¥çˆ¶ç±»çš„æŒ‡é’ˆä¼šåœ¨è‡ªå·±çš„è™šå‡½æ•°è¡¨ä¸­æŸ¥æ‰¾è‡ªå·±çš„å‡½æ•°åœ°å€ï¼Œå¦‚æœè¯¥çˆ¶ç±»å¯¹è±¡çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨æŒ‡å‘çš„æ˜¯å­ç±»çš„å¯¹è±¡ï¼Œè€Œä¸”è¯¥å­ç±»å·²ç»é‡å†™äº†çˆ¶ç±»çš„è™šå‡½æ•°ï¼Œåˆ™è¯¥æŒ‡é’ˆä¼šè°ƒç”¨å­ç±»çš„å·²ç»é‡å†™çš„è™šå‡½æ•°ã€‚ Cå®ç° å°è£… Cè¯­è¨€ä¸­æ˜¯æ²¡æœ‰classç±»è¿™ä¸ªæ¦‚å¿µçš„ï¼Œä½†æ˜¯æœ‰structç»“æ„ä½“ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨structæ¥æ¨¡æ‹Ÿï¼› ä½¿ç”¨å‡½æ•°æŒ‡é’ˆæŠŠå±æ€§ä¸æ–¹æ³•å°è£…åˆ°ç»“æ„ä½“ä¸­ã€‚ 2.ç»§æ‰¿ ç»“æ„ä½“åµŒå¥— 3.å¤šæ€ ç±»ä¸å­ç±»æ–¹æ³•çš„å‡½æ•°æŒ‡é’ˆä¸åŒ åœ¨Cè¯­è¨€çš„ç»“æ„ä½“å†…éƒ¨æ˜¯æ²¡æœ‰æˆå‘˜å‡½æ•°çš„ï¼Œå¦‚æœå®ç°è¿™ä¸ªçˆ¶ç»“æ„ä½“å’Œå­ç»“æ„ä½“å…±æœ‰çš„å‡½æ•°å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨å‡½æ•°æŒ‡é’ˆæ¥æ¨¡æ‹Ÿã€‚ä½†æ˜¯è¿™æ ·å¤„ç†å­˜åœ¨ä¸€ä¸ªç¼ºé™·å°±æ˜¯ï¼šçˆ¶å­å„è‡ªçš„å‡½æ•°æŒ‡é’ˆä¹‹é—´æŒ‡å‘çš„ä¸æ˜¯ç±»ä¼¼C++ä¸­ç»´æŠ¤çš„è™šå‡½æ•°è¡¨è€Œæ˜¯ä¸€å—ç‰©ç†å†…å­˜ï¼Œå¦‚æœæ¨¡æ‹Ÿçš„å‡½æ•°è¿‡å¤šçš„è¯å°±ä¼šä¸å®¹æ˜“ç»´æŠ¤äº†ã€‚ æ¨¡æ‹Ÿå¤šæ€ï¼Œå¿…é¡»ä¿æŒå‡½æ•°æŒ‡é’ˆå˜é‡å¯¹é½(åœ¨å†…å®¹ä¸Šå®Œå…¨ä¸€è‡´ï¼Œè€Œä¸”å˜é‡å¯¹é½ä¸Šä¹Ÿå®Œå…¨ä¸€è‡´)ã€‚å¦åˆ™çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘å­ç±»å¯¹è±¡ï¼Œè¿è¡Œå´©æºƒï¼ explicité‚£äº›äº‹ explicit ä¿®é¥°æ„é€ å‡½æ•°æ—¶ï¼Œå¯ä»¥é˜²æ­¢éšå¼è½¬æ¢å’Œå¤åˆ¶åˆå§‹åŒ– explicit ä¿®é¥°è½¬æ¢å‡½æ•°æ—¶ï¼Œå¯ä»¥é˜²æ­¢éšå¼è½¬æ¢ï¼Œä½†æŒ‰è¯­å¢ƒè½¬æ¢é™¤å¤– 123456789101112131415161718192021222324252627282930313233343536373839404142434445#include &lt;iostream&gt;using namespace std;struct A&#123; A(int) &#123; &#125; operator bool() const &#123; return true; &#125;&#125;;struct B&#123; explicit B(int) &#123;&#125; explicit operator bool() const &#123; return true; &#125;&#125;;void doA(A a) &#123;&#125;void doB(B b) &#123;&#125;int main()&#123; A a1(1); // OKï¼šç›´æ¥åˆå§‹åŒ– A a2 = 1; // OKï¼šå¤åˆ¶åˆå§‹åŒ– A a3&#123; 1 &#125;; // OKï¼šç›´æ¥åˆ—è¡¨åˆå§‹åŒ– A a4 = &#123; 1 &#125;; // OKï¼šå¤åˆ¶åˆ—è¡¨åˆå§‹åŒ– A a5 = (A)1; // OKï¼šå…è®¸ static_cast çš„æ˜¾å¼è½¬æ¢ doA(1); // OKï¼šå…è®¸ä» int åˆ° A çš„éšå¼è½¬æ¢ if (a1); // OKï¼šä½¿ç”¨è½¬æ¢å‡½æ•° A::operator bool() çš„ä» A åˆ° bool çš„éšå¼è½¬æ¢ bool a6(a1); // OKï¼šä½¿ç”¨è½¬æ¢å‡½æ•° A::operator bool() çš„ä» A åˆ° bool çš„éšå¼è½¬æ¢ bool a7 = a1; // OKï¼šä½¿ç”¨è½¬æ¢å‡½æ•° A::operator bool() çš„ä» A åˆ° bool çš„éšå¼è½¬æ¢ bool a8 = static_cast&lt;bool&gt;(a1); // OK ï¼šstatic_cast è¿›è¡Œç›´æ¥åˆå§‹åŒ– B b1(1); // OKï¼šç›´æ¥åˆå§‹åŒ–// B b2 = 1; // é”™è¯¯ï¼šè¢« explicit ä¿®é¥°æ„é€ å‡½æ•°çš„å¯¹è±¡ä¸å¯ä»¥å¤åˆ¶åˆå§‹åŒ– B b3&#123; 1 &#125;; // OKï¼šç›´æ¥åˆ—è¡¨åˆå§‹åŒ–// B b4 = &#123; 1 &#125;; // é”™è¯¯ï¼šè¢« explicit ä¿®é¥°æ„é€ å‡½æ•°çš„å¯¹è±¡ä¸å¯ä»¥å¤åˆ¶åˆ—è¡¨åˆå§‹åŒ– B b5 = (B)1; // OKï¼šå…è®¸ static_cast çš„æ˜¾å¼è½¬æ¢// doB(1); // é”™è¯¯ï¼šè¢« explicit ä¿®é¥°æ„é€ å‡½æ•°çš„å¯¹è±¡ä¸å¯ä»¥ä» int åˆ° B çš„éšå¼è½¬æ¢ if (b1); // OKï¼šè¢« explicit ä¿®é¥°è½¬æ¢å‡½æ•° B::operator bool() çš„å¯¹è±¡å¯ä»¥ä» B åˆ° bool çš„æŒ‰è¯­å¢ƒè½¬æ¢ bool b6(b1); // OKï¼šè¢« explicit ä¿®é¥°è½¬æ¢å‡½æ•° B::operator bool() çš„å¯¹è±¡å¯ä»¥ä» B åˆ° bool çš„æŒ‰è¯­å¢ƒè½¬æ¢// bool b7 = b1; // é”™è¯¯ï¼šè¢« explicit ä¿®é¥°è½¬æ¢å‡½æ•° B::operator bool() çš„å¯¹è±¡ä¸å¯ä»¥éšå¼è½¬æ¢ bool b8 = static_cast&lt;bool&gt;(b1); // OKï¼šstatic_cast è¿›è¡Œç›´æ¥åˆå§‹åŒ– return 0;&#125; friend é‚£äº›äº‹æ¦‚è¿°å‹å…ƒæä¾›äº†ä¸€ç§ æ™®é€šå‡½æ•°æˆ–è€…ç±»æˆå‘˜å‡½æ•° è®¿é—®å¦ä¸€ä¸ªç±»ä¸­çš„ç§æœ‰æˆ–ä¿æŠ¤æˆå‘˜ çš„æœºåˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´æœ‰ä¸¤ç§å½¢å¼çš„å‹å…ƒï¼š å‹å…ƒå‡½æ•°ï¼šæ™®é€šå‡½æ•°å¯¹ä¸€ä¸ªè®¿é—®æŸä¸ªç±»ä¸­çš„ç§æœ‰æˆ–ä¿æŠ¤æˆå‘˜ã€‚ å‹å…ƒç±»ï¼šç±»Aä¸­çš„æˆå‘˜å‡½æ•°è®¿é—®ç±»Bä¸­çš„ç§æœ‰æˆ–ä¿æŠ¤æˆå‘˜ ä¼˜ç‚¹ï¼šæé«˜äº†ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚ ç¼ºç‚¹ï¼šç ´åäº†ç±»çš„å°è£…æ€§å’Œæ•°æ®çš„é€æ˜æ€§ã€‚ æ€»ç»“ï¼š - èƒ½è®¿é—®ç§æœ‰æˆå‘˜ - ç ´åå°è£…æ€§ - å‹å…ƒå…³ç³»ä¸å¯ä¼ é€’ - å‹å…ƒå…³ç³»çš„å•å‘æ€§ - å‹å…ƒå£°æ˜çš„å½¢å¼åŠæ•°é‡ä¸å—é™åˆ¶ å‹å…ƒå‡½æ•°åœ¨ç±»å£°æ˜çš„ä»»ä½•åŒºåŸŸä¸­å£°æ˜ï¼Œè€Œå®šä¹‰åˆ™åœ¨ç±»çš„å¤–éƒ¨ã€‚ 1friend &lt;ç±»å‹&gt;&lt;å‹å…ƒå‡½æ•°å&gt;(&lt;å‚æ•°è¡¨&gt;); æ³¨æ„ï¼Œå‹å…ƒå‡½æ•°åªæ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œå¹¶ä¸æ˜¯è¯¥ç±»çš„ç±»æˆå‘˜å‡½æ•°ï¼Œå®ƒå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨ï¼Œå‹å…ƒå‡½æ•°ä¸­é€šè¿‡å¯¹è±¡åæ¥è®¿é—®è¯¥ç±»çš„ç§æœ‰æˆ–ä¿æŠ¤æˆå‘˜ã€‚ 12345678910111213141516171819202122232425#include &lt;iostream&gt;using namespace std;class A&#123;public: A(int _a):a(_a)&#123;&#125;; friend int geta(A &amp;ca); ///&lt; å‹å…ƒå‡½æ•°private: int a;&#125;;int geta(A &amp;ca) &#123; return ca.a; //*********************************è®¿é—®åˆ°äº†ç§æœ‰å±æ€§&#125;int main()&#123; A a(3); cout&lt;&lt;geta(a)&lt;&lt;endl; return 0;&#125; å‹å…ƒç±»å‹å…ƒç±»çš„å£°æ˜åœ¨è¯¥ç±»çš„å£°æ˜ä¸­ï¼Œè€Œå®ç°åœ¨è¯¥ç±»å¤–ã€‚ 1friend class &lt;å‹å…ƒç±»å&gt;; ç±»Bæ˜¯ç±»Açš„å‹å…ƒï¼Œé‚£ä¹ˆç±»Bå¯ä»¥ç›´æ¥è®¿é—®Açš„ç§æœ‰æˆå‘˜ã€‚ 12345678910111213141516171819202122232425262728#include &lt;iostream&gt;using namespace std;class A&#123;public: A(int _a):a(_a)&#123;&#125;; friend class B;private: int a;&#125;;class B&#123;public: int getb(A ca) &#123; return ca.a; &#125;;&#125;;int main() &#123; A a(3); B b; cout&lt;&lt;b.getb(a)&lt;&lt;endl; return 0;&#125; æ³¨æ„ å‹å…ƒå…³ç³»æ²¡æœ‰ç»§æ‰¿æ€§ å‡å¦‚ç±»Bæ˜¯ç±»Açš„å‹å…ƒï¼Œç±»Cç»§æ‰¿äºç±»Aï¼Œé‚£ä¹ˆå‹å…ƒç±»Bæ˜¯æ²¡åŠæ³•ç›´æ¥è®¿é—®ç±»Cçš„ç§æœ‰æˆ–ä¿æŠ¤æˆå‘˜ã€‚ å‹å…ƒå…³ç³»æ²¡æœ‰ä¼ é€’æ€§ å‡å¦‚ç±»Bæ˜¯ç±»Açš„å‹å…ƒï¼Œç±»Cæ˜¯ç±»Bçš„å‹å…ƒï¼Œé‚£ä¹ˆå‹å…ƒç±»Cæ˜¯æ²¡åŠæ³•ç›´æ¥è®¿é—®ç±»Açš„ç§æœ‰æˆ–ä¿æŠ¤æˆå‘˜ï¼Œä¹Ÿå°±æ˜¯ä¸å­˜åœ¨â€œå‹å…ƒçš„å‹å…ƒâ€è¿™ç§å…³ç³»ã€‚ using é‚£äº›äº‹åŸºæœ¬ä½¿ç”¨å±€éƒ¨ä¸å…¨å±€usingï¼Œå…·ä½“æ“ä½œä¸ä½¿ç”¨è§ä¸‹é¢æ¡ˆä¾‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637#include &lt;iostream&gt;#define isNs1 1//#define isGlobal 2using namespace std;void func() &#123; cout&lt;&lt;&quot;::func&quot;&lt;&lt;endl;&#125;namespace ns1 &#123; void func() &#123; cout&lt;&lt;&quot;ns1::func&quot;&lt;&lt;endl; &#125;&#125;namespace ns2 &#123;#ifdef isNs1 using ns1::func; /// ns1ä¸­çš„å‡½æ•°#elif isGlobal using ::func; /// å…¨å±€ä¸­çš„å‡½æ•°#else void func() &#123; cout&lt;&lt;&quot;other::func&quot;&lt;&lt;endl; &#125;#endif&#125;int main() &#123; /** * è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨c++ä¸­ä½¿ç”¨äº†cmathè€Œä¸æ˜¯math.hå¤´æ–‡ä»¶ */ ns2::func(); // ä¼šæ ¹æ®å½“å‰ç¯å¢ƒå®šä¹‰å®çš„ä¸åŒæ¥è°ƒç”¨ä¸åŒå‘½åç©ºé—´ä¸‹çš„func()å‡½æ•° return 0;&#125; æ”¹å˜è®¿é—®æ€§123456789101112class Base&#123;public: std::size_t size() const &#123; return n; &#125;protected: std::size_t n;&#125;;class Derived : private Base &#123;public: using Base::size;protected: using Base::n;&#125;; ç±»Derivedç§æœ‰ç»§æ‰¿äº†Baseï¼Œå¯¹äºå®ƒæ¥è¯´æˆå‘˜å˜é‡nå’Œæˆå‘˜å‡½æ•°sizeéƒ½æ˜¯ç§æœ‰çš„ï¼Œå¦‚æœä½¿ç”¨äº†usingè¯­å¥ï¼Œå¯ä»¥æ”¹å˜ä»–ä»¬çš„å¯è®¿é—®æ€§ï¼Œå¦‚ä¸Šè¿°ä¾‹å­ä¸­ï¼Œsizeå¯ä»¥æŒ‰publicçš„æƒé™è®¿é—®ï¼Œnå¯ä»¥æŒ‰protectedçš„æƒé™è®¿é—®ã€‚ å‡½æ•°é‡è½½åœ¨ç»§æ‰¿è¿‡ç¨‹ä¸­ï¼Œæ´¾ç”Ÿç±»å¯ä»¥è¦†ç›–é‡è½½å‡½æ•°çš„0ä¸ªæˆ–å¤šä¸ªå®ä¾‹ï¼Œä¸€æ—¦å®šä¹‰äº†ä¸€ä¸ªé‡è½½ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå…¶ä»–çš„é‡è½½ç‰ˆæœ¬éƒ½ä¼šå˜ä¸ºä¸å¯è§ã€‚ å¦‚æœå¯¹äºåŸºç±»çš„é‡è½½å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ´¾ç”Ÿç±»ä¸­ä¿®æ”¹ä¸€ä¸ªï¼Œåˆè¦è®©å…¶ä»–çš„ä¿æŒå¯è§ï¼Œå¿…é¡»è¦é‡è½½æ‰€æœ‰ç‰ˆæœ¬ï¼Œè¿™æ ·ååˆ†çš„ç¹çã€‚ 12345678910111213141516171819202122232425262728#include &lt;iostream&gt;using namespace std;class Base&#123; public: void f()&#123; cout&lt;&lt;&quot;f()&quot;&lt;&lt;endl; &#125; void f(int n)&#123; cout&lt;&lt;&quot;Base::f(int)&quot;&lt;&lt;endl; &#125;&#125;;class Derived : private Base &#123; public: using Base::f; void f(int n)&#123; cout&lt;&lt;&quot;Derived::f(int)&quot;&lt;&lt;endl; &#125;&#125;;int main()&#123; Base b; Derived d; d.f(); d.f(1); return 0;&#125; å¦‚ä¸Šä»£ç ä¸­ï¼Œåœ¨æ´¾ç”Ÿç±»ä¸­ä½¿ç”¨usingå£°æ˜è¯­å¥æŒ‡å®šä¸€ä¸ªåå­—è€Œä¸æŒ‡å®šå½¢å‚åˆ—è¡¨ï¼Œæ‰€ä»¥ä¸€æ¡åŸºç±»æˆå‘˜å‡½æ•°çš„usingå£°æ˜è¯­å¥å°±å¯ä»¥æŠŠè¯¥å‡½æ•°çš„æ‰€æœ‰é‡è½½å®ä¾‹æ·»åŠ åˆ°æ´¾ç”Ÿç±»çš„ä½œç”¨åŸŸä¸­ã€‚æ­¤æ—¶ï¼Œæ´¾ç”Ÿç±»åªéœ€è¦å®šä¹‰å…¶ç‰¹æœ‰çš„å‡½æ•°å°±è¡Œäº†ï¼Œè€Œæ— éœ€ä¸ºç»§æ‰¿è€Œæ¥çš„å…¶ä»–å‡½æ•°é‡æ–°å®šä¹‰ã€‚ å–ä»£typedefCä¸­å¸¸ç”¨typedef A Bè¿™æ ·çš„è¯­æ³•ï¼Œå°†Bå®šä¹‰ä¸ºAç±»å‹ï¼Œä¹Ÿå°±æ˜¯ç»™Aç±»å‹ä¸€ä¸ªåˆ«åB å¯¹åº”typedef A Bï¼Œä½¿ç”¨using B&#x3D;Aå¯ä»¥è¿›è¡ŒåŒæ ·çš„æ“ä½œã€‚ 12typedef vector&lt;int&gt; V1; using V2 = vector&lt;int&gt;; ::é‚£äº›äº‹ å…¨å±€ä½œç”¨åŸŸç¬¦ï¼ˆ::nameï¼‰ï¼šç”¨äºç±»å‹åç§°ï¼ˆç±»ã€ç±»æˆå‘˜ã€æˆå‘˜å‡½æ•°ã€å˜é‡ç­‰ï¼‰å‰ï¼Œè¡¨ç¤ºä½œç”¨åŸŸä¸ºå…¨å±€å‘½åç©ºé—´ ç±»ä½œç”¨åŸŸç¬¦ï¼ˆclass::nameï¼‰ï¼šç”¨äºè¡¨ç¤ºæŒ‡å®šç±»å‹çš„ä½œç”¨åŸŸèŒƒå›´æ˜¯å…·ä½“æŸä¸ªç±»çš„ å‘½åç©ºé—´ä½œç”¨åŸŸç¬¦ï¼ˆnamespace::nameï¼‰:ç”¨äºè¡¨ç¤ºæŒ‡å®šç±»å‹çš„ä½œç”¨åŸŸèŒƒå›´æ˜¯å…·ä½“æŸä¸ªå‘½åç©ºé—´çš„ enumé‚£äº›äº‹ä¼ ç»Ÿè¡Œä¸ºæšä¸¾æœ‰å¦‚ä¸‹é—®é¢˜ï¼š ä½œç”¨åŸŸä¸å—é™,ä¼šå®¹æ˜“å¼•èµ·å‘½åå†²çªã€‚ä¾‹å¦‚ä¸‹é¢æ— æ³•ç¼–è¯‘é€šè¿‡çš„ï¼š 12345678910#include &lt;iostream&gt;using namespace std;enum Color &#123;RED,BLUE&#125;;enum Feeling &#123;EXCITED,BLUE&#125;;int main() &#123; return 0;&#125; ä¼šéšå¼è½¬æ¢ä¸ºint ç”¨æ¥è¡¨å¾æšä¸¾å˜é‡çš„å®é™…ç±»å‹ä¸èƒ½æ˜ç¡®æŒ‡å®šï¼Œä»è€Œæ— æ³•æ”¯æŒæšä¸¾ç±»å‹çš„å‰å‘å£°æ˜ã€‚ ç»å…¸åšæ³•è§£å†³ä½œç”¨åŸŸä¸å—é™å¸¦æ¥çš„å‘½åå†²çªé—®é¢˜çš„ä¸€ä¸ªç®€å•æ–¹æ³•æ˜¯ï¼Œç»™æšä¸¾å˜é‡å‘½åæ—¶åŠ å‰ç¼€ï¼Œå¦‚ä¸Šé¢ä¾‹å­æ”¹æˆ COLOR_BLUE ä»¥åŠ FEELING_BLUEã€‚ ä¸€èˆ¬è¯´æ¥ï¼Œä¸ºäº†ä¸€è‡´æ€§æˆ‘ä»¬ä¼šæŠŠæ‰€æœ‰å¸¸é‡ç»Ÿä¸€åŠ ä¸Šå‰ç¼€ã€‚ä½†æ˜¯è¿™æ ·å®šä¹‰æšä¸¾å˜é‡çš„ä»£ç å°±æ˜¾å¾—ç´¯èµ˜ã€‚C ç¨‹åºä¸­å¯èƒ½ä¸å¾—ä¸è¿™æ ·åšã€‚ä¸è¿‡ C++ ç¨‹åºå‘˜ææ€•éƒ½ä¸å–œæ¬¢è¿™ç§æ–¹æ³•ã€‚æ›¿ä»£æ–¹æ¡ˆæ˜¯å‘½åç©ºé—´: 123456789namespace Color &#123; enum Type &#123; RED=15, YELLOW, BLUE &#125;;&#125;; è¿™æ ·ä¹‹åå°±å¯ä»¥ç”¨ Color::Type c = Color::RED; æ¥å®šä¹‰æ–°çš„æšä¸¾å˜é‡äº†ã€‚å¦‚æœ using namespace Color åï¼Œå‰ç¼€è¿˜å¯ä»¥çœå»ï¼Œä½¿å¾—ä»£ç ç®€åŒ–ã€‚ä¸è¿‡ï¼Œå› ä¸ºå‘½åç©ºé—´æ˜¯å¯ä»¥éšåè¢«æ‰©å……å†…å®¹çš„ï¼Œæ‰€ä»¥å®ƒæä¾›çš„ä½œç”¨åŸŸå°é—­æ€§ä¸é«˜ã€‚åœ¨å¤§é¡¹ç›®ä¸­ï¼Œè¿˜æ˜¯æœ‰å¯èƒ½ä¸åŒäººç»™ä¸åŒçš„ä¸œè¥¿èµ·åŒæ ·çš„æšä¸¾ç±»å‹åã€‚ æ›´â€œæœ‰æ•ˆâ€çš„åŠæ³•æ˜¯ç”¨ä¸€ä¸ªç±»æˆ–ç»“æ„ä½“æ¥é™å®šå…¶ä½œç”¨åŸŸï¼Œä¾‹å¦‚ï¼šå®šä¹‰æ–°å˜é‡çš„æ–¹æ³•å’Œä¸Šé¢å‘½åç©ºé—´çš„ç›¸åŒã€‚ä¸è¿‡è¿™æ ·å°±ä¸ç”¨æ‹…å¿ƒç±»åœ¨åˆ«å¤„è¢«ä¿®æ”¹å†…å®¹ã€‚è¿™é‡Œç”¨ç»“æ„ä½“è€Œéç±»ï¼Œä¸€æ˜¯å› ä¸ºæœ¬èº«å¸Œæœ›è¿™äº›å¸¸é‡å¯ä»¥å…¬å¼€è®¿é—®ï¼ŒäºŒæ˜¯å› ä¸ºå®ƒåªåŒ…å«æ•°æ®æ²¡æœ‰æˆå‘˜å‡½æ•°ã€‚ 123456789struct Color1&#123; enum Type &#123; RED=102, YELLOW, BLUE &#125;;&#125;; C++11çš„æšä¸¾ç±»ä¸Šé¢çš„åšæ³•è§£å†³äº†ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä½†å¯¹äºåä¸¤ä¸ªä»æ— èƒ½ä¸ºåŠ›ã€‚åº†å¹¸çš„æ˜¯ï¼ŒC++11 æ ‡å‡†ä¸­å¼•å…¥äº†â€œæšä¸¾ç±»â€(enum class)ï¼Œå¯ä»¥è¾ƒå¥½åœ°è§£å†³ä¸Šè¿°é—®é¢˜ã€‚ æ–°çš„enumçš„ä½œç”¨åŸŸä¸åœ¨æ˜¯å…¨å±€çš„ ä¸èƒ½éšå¼è½¬æ¢æˆå…¶ä»–ç±»å‹ 123456789101112/** * @brief C++11çš„æšä¸¾ç±» * ä¸‹é¢ç­‰ä»·äºenum class Color2:int */enum class Color2&#123; RED=2, YELLOW, BLUE&#125;;r2 c2 = Color2::RED;cout &lt;&lt; static_cast&lt;int&gt;(c2) &lt;&lt; endl; //å¿…é¡»è½¬ï¼ å¯ä»¥æŒ‡å®šç”¨ç‰¹å®šçš„ç±»å‹æ¥å­˜å‚¨enum 123456789enum class Color3:char; // å‰å‘å£°æ˜// å®šä¹‰enum class Color3:char &#123; RED=&#x27;r&#x27;, BLUE&#125;;char c3 = static_cast&lt;char&gt;(Color3::RED); ç±»ä¸­çš„æšä¸¾ç±»å‹æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›æŸäº›å¸¸é‡åªåœ¨ç±»ä¸­æœ‰æ•ˆã€‚ ç”±äº#define å®šä¹‰çš„å®å¸¸é‡æ˜¯å…¨å±€çš„ï¼Œä¸èƒ½è¾¾åˆ°ç›®çš„ï¼Œäºæ˜¯æƒ³åˆ°å®ç”¨const ä¿®é¥°æ•°æ®æˆå‘˜æ¥å®ç°ã€‚è€Œconst æ•°æ®æˆå‘˜çš„ç¡®æ˜¯å­˜åœ¨çš„ï¼Œä½†å…¶å«ä¹‰å´ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚ const æ•°æ®æˆå‘˜åªåœ¨æŸä¸ªå¯¹è±¡ç”Ÿå­˜æœŸå†…æ˜¯å¸¸é‡ï¼Œè€Œå¯¹äºæ•´ä¸ªç±»è€Œè¨€å´æ˜¯å¯å˜çš„ï¼Œå› ä¸ºç±»å¯ä»¥åˆ›å»ºå¤šä¸ªå¯¹è±¡ï¼Œä¸åŒçš„å¯¹è±¡å…¶ const æ•°æ®æˆå‘˜çš„å€¼å¯ä»¥ä¸åŒã€‚ ä¸èƒ½åœ¨ç±»å£°æ˜ä¸­åˆå§‹åŒ– const æ•°æ®æˆå‘˜ã€‚ä»¥ä¸‹ç”¨æ³•æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºç±»çš„å¯¹è±¡æœªè¢«åˆ›å»ºæ—¶ï¼Œç¼–è¯‘å™¨ä¸çŸ¥é“ SIZE çš„å€¼æ˜¯ä»€ä¹ˆã€‚(c++11æ ‡å‡†å‰) 12345class A &#123; const int SIZE = 100; // é”™è¯¯ï¼Œä¼å›¾åœ¨ç±»å£°æ˜ä¸­åˆå§‹åŒ– const æ•°æ®æˆå‘˜ int array[SIZE]; // é”™è¯¯ï¼ŒæœªçŸ¥çš„ SIZE &#125;; æ­£ç¡®åº”è¯¥åœ¨ç±»çš„æ„é€ å‡½æ•°çš„åˆå§‹åŒ–åˆ—è¡¨ä¸­è¿›è¡Œï¼š 1234567891011class A &#123; A(int size); // æ„é€ å‡½æ•° const int SIZE ; &#125;; A::A(int size) : SIZE(size) // æ„é€ å‡½æ•°çš„å®šä¹‰&#123; &#125; A a(100); // å¯¹è±¡ a çš„ SIZE å€¼ä¸º 100 A b(200); // å¯¹è±¡ b çš„ SIZE å€¼ä¸º 200 æ€æ ·æ‰èƒ½å»ºç«‹åœ¨æ•´ä¸ªç±»ä¸­éƒ½æ’å®šçš„å¸¸é‡å‘¢ï¼Ÿ åˆ«æŒ‡æœ› const æ•°æ®æˆå‘˜äº†ï¼Œåº”è¯¥ç”¨ç±»ä¸­çš„æšä¸¾å¸¸é‡æ¥å®ç°ã€‚ä¾‹å¦‚: 12345678class Person&#123;public: typedef enum &#123; BOY = 0, GIRL &#125;SexType;&#125;;//è®¿é—®çš„æ—¶å€™é€šè¿‡ï¼ŒPerson::BOYæˆ–è€…Person::GIRLæ¥è¿›è¡Œè®¿é—®ã€‚ æšä¸¾å¸¸é‡ä¸ä¼šå ç”¨å¯¹è±¡çš„å­˜å‚¨ç©ºé—´ï¼Œå®ƒä»¬åœ¨ç¼–è¯‘æ—¶è¢«å…¨éƒ¨æ±‚å€¼ã€‚ æšä¸¾å¸¸é‡çš„ç¼ºç‚¹æ˜¯ï¼šå®ƒçš„éšå«æ•°æ®ç±»å‹æ˜¯æ•´æ•°ï¼Œå…¶æœ€å¤§å€¼æœ‰é™ï¼Œä¸”ä¸èƒ½è¡¨ç¤ºæµ®ç‚¹ã€‚ decltypeåŸºæœ¬ä½¿ç”¨decltypeçš„è¯­æ³•æ˜¯ï¼š 1decltype (expression) è¿™é‡Œçš„æ‹¬å·æ˜¯å¿…ä¸å¯å°‘çš„,decltypeçš„ä½œç”¨æ˜¯â€œæŸ¥è¯¢è¡¨è¾¾å¼çš„ç±»å‹â€ï¼Œå› æ­¤ï¼Œä¸Šé¢è¯­å¥çš„æ•ˆæœæ˜¯ï¼Œè¿”å› expression è¡¨è¾¾å¼çš„ç±»å‹ã€‚æ³¨æ„ï¼Œdecltype ä»…ä»…â€œæŸ¥è¯¢â€è¡¨è¾¾å¼çš„ç±»å‹ï¼Œå¹¶ä¸ä¼šå¯¹è¡¨è¾¾å¼è¿›è¡Œâ€œæ±‚å€¼â€ã€‚ æ¨å¯¼å‡ºè¡¨è¾¾å¼ç±»å‹ 12int i = 4;decltype(i) a; //æ¨å¯¼ç»“æœä¸ºintã€‚açš„ç±»å‹ä¸ºintã€‚ ä¸using&#x2F;typedefåˆç”¨ï¼Œç”¨äºå®šä¹‰ç±»å‹ã€‚ 123456789using size_t = decltype(sizeof(0));//sizeof(a)çš„è¿”å›å€¼ä¸ºsize_tç±»å‹using ptrdiff_t = decltype((int*)0 - (int*)0);using nullptr_t = decltype(nullptr);vector&lt;int &gt;vec;typedef decltype(vec.begin()) vectype;for (vectype i = vec.begin; i != vec.end(); i++)&#123;//...&#125; è¿™æ ·å’Œautoä¸€æ ·ï¼Œä¹Ÿæé«˜äº†ä»£ç çš„å¯è¯»æ€§ã€‚ é‡ç”¨åŒ¿åç±»å‹ åœ¨C++ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ä¼šé‡ä¸Šä¸€äº›åŒ¿åç±»å‹ï¼Œå¦‚: 12345struct &#123; int d ; doubel b;&#125;anon_s; è€Œå€ŸåŠ©decltypeï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°ä½¿ç”¨è¿™ä¸ªåŒ¿åçš„ç»“æ„ä½“ï¼š 1decltype(anon_s) as ;//å®šä¹‰äº†ä¸€ä¸ªä¸Šé¢åŒ¿åçš„ç»“æ„ä½“ æ³›å‹ç¼–ç¨‹ä¸­ç»“åˆautoï¼Œç”¨äºè¿½è¸ªå‡½æ•°çš„è¿”å›å€¼ç±»å‹ è¿™ä¹Ÿæ˜¯decltypeæœ€å¤§çš„ç”¨é€”äº†ã€‚ 12345template &lt;typename T&gt;auto multiply(T x, T y)-&gt;decltype(x*y)&#123; return x*y;&#125; åˆ¤åˆ«è§„åˆ™å¯¹äºdecltype(e)è€Œè¨€ï¼Œå…¶åˆ¤åˆ«ç»“æœå—ä»¥ä¸‹æ¡ä»¶çš„å½±å“ï¼š å¦‚æœeæ˜¯ä¸€ä¸ªæ²¡æœ‰å¸¦æ‹¬å·çš„æ ‡è®°ç¬¦è¡¨è¾¾å¼æˆ–è€…ç±»æˆå‘˜è®¿é—®è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆçš„decltypeï¼ˆeï¼‰å°±æ˜¯eæ‰€å‘½åçš„å®ä½“çš„ç±»å‹ã€‚æ­¤å¤–ï¼Œå¦‚æœeæ˜¯ä¸€ä¸ªè¢«é‡è½½çš„å‡½æ•°ï¼Œåˆ™ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚ å¦åˆ™ ï¼Œå‡è®¾eçš„ç±»å‹æ˜¯Tï¼Œå¦‚æœeæ˜¯ä¸€ä¸ªå°†äº¡å€¼ï¼Œé‚£ä¹ˆdecltypeï¼ˆeï¼‰ä¸ºT&amp;&amp; å¦åˆ™ï¼Œå‡è®¾eçš„ç±»å‹æ˜¯Tï¼Œå¦‚æœeæ˜¯ä¸€ä¸ªå·¦å€¼ï¼Œé‚£ä¹ˆdecltypeï¼ˆeï¼‰ä¸ºT&amp;ã€‚ å¦åˆ™ï¼Œå‡è®¾eçš„ç±»å‹æ˜¯Tï¼Œåˆ™decltypeï¼ˆeï¼‰ä¸ºTã€‚ å¼•ç”¨å’ŒæŒ‡é’ˆé‚£äº›äº‹å¼•ç”¨å’ŒæŒ‡é’ˆ å¼•ç”¨å¿…é¡»åˆå§‹åŒ–ï¼Œè€ŒæŒ‡é’ˆå¯ä»¥ä¸åˆå§‹åŒ–ã€‚ å¼•ç”¨ä¸èƒ½ä¸ºç©ºï¼Œè€ŒæŒ‡é’ˆå¯ä»¥ä¸ºç©ºã€‚ ç”±äºå¼•ç”¨ä¸èƒ½ä¸ºç©ºï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨å¼•ç”¨çš„æ—¶å€™ä¸éœ€è¦æµ‹è¯•å…¶åˆæ³•æ€§ï¼Œè€Œåœ¨ä½¿ç”¨æŒ‡é’ˆçš„æ—¶å€™éœ€è¦é¦–å…ˆåˆ¤æ–­æŒ‡é’ˆæ˜¯å¦ä¸ºç©ºæŒ‡é’ˆï¼Œå¦åˆ™å¯èƒ½ä¼šå¼•èµ·ç¨‹åºå´©æºƒã€‚ 1234567891011void test_p(int* p)&#123; if(p != null_ptr) //å¯¹pæ‰€æŒ‡å¯¹è±¡èµ‹å€¼æ—¶éœ€å…ˆåˆ¤æ–­pæ˜¯å¦ä¸ºç©ºæŒ‡é’ˆ *p = 3; return;&#125;void test_r(int&amp; r)&#123; r = 3; //ç”±äºå¼•ç”¨ä¸èƒ½ä¸ºç©ºï¼Œæ‰€ä»¥æ­¤å¤„æ— éœ€åˆ¤æ–­rçš„æœ‰æ•ˆæ€§å°±å¯ä»¥å¯¹rç›´æ¥èµ‹å€¼ return;&#125; å¼•ç”¨ å·¦å€¼å¼•ç”¨ å¸¸è§„å¼•ç”¨ï¼Œä¸€èˆ¬è¡¨ç¤ºå¯¹è±¡çš„èº«ä»½ã€‚ å³å€¼å¼•ç”¨ å³å€¼å¼•ç”¨å°±æ˜¯å¿…é¡»ç»‘å®šåˆ°å³å€¼ï¼ˆä¸€ä¸ªä¸´æ—¶å¯¹è±¡ã€å°†è¦é”€æ¯çš„å¯¹è±¡ï¼‰çš„å¼•ç”¨ï¼Œä¸€èˆ¬è¡¨ç¤ºå¯¹è±¡çš„å€¼ã€‚å³å€¼å¼•ç”¨å¯å®ç°è½¬ç§»è¯­ä¹‰ï¼ˆMove Sementicsï¼‰å’Œç²¾ç¡®ä¼ é€’ï¼ˆPerfect Forwardingï¼‰ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æœ‰ä¸¤ä¸ªæ–¹é¢ï¼š æ¶ˆé™¤ä¸¤ä¸ªå¯¹è±¡äº¤äº’æ—¶ä¸å¿…è¦çš„å¯¹è±¡æ‹·è´ï¼ŒèŠ‚çœè¿ç®—å­˜å‚¨èµ„æºï¼Œæé«˜æ•ˆç‡ã€‚ èƒ½å¤Ÿæ›´ç®€æ´æ˜ç¡®åœ°å®šä¹‰æ³›å‹å‡½æ•°ã€‚ æŒ‡é’ˆä¸å¼•ç”¨çš„æ€§èƒ½å·®è·æŒ‡é’ˆä¸å¼•ç”¨ä¹‹é—´æœ‰æ²¡æœ‰æ€§èƒ½å·®è·å‘¢ï¼Ÿè¿™ç§é—®é¢˜å°±éœ€è¦è¿›å…¥æ±‡ç¼–å±‚é¢å»çœ‹ä¸€ä¸‹ã€‚æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªtest1å‡½æ•°ï¼Œå‚æ•°ä¼ é€’ä½¿ç”¨æŒ‡é’ˆï¼š 12345void test1(int* p)&#123; *p = 3; //æ­¤å¤„åº”è¯¥é¦–å…ˆåˆ¤æ–­pæ˜¯å¦ä¸ºç©ºï¼Œä¸ºäº†æµ‹è¯•çš„éœ€è¦ï¼Œæ­¤å¤„æˆ‘ä»¬æ²¡åŠ ã€‚ return;&#125; è¯¥ä»£ç æ®µå¯¹åº”çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š 1234567891011(gdb) disassemble Dump of assembler code for function test1(int*): 0x0000000000400886 &lt;+0&gt;: push %rbp 0x0000000000400887 &lt;+1&gt;: mov %rsp,%rbp 0x000000000040088a &lt;+4&gt;: mov %rdi,-0x8(%rbp)=&gt; 0x000000000040088e &lt;+8&gt;: mov -0x8(%rbp),%rax 0x0000000000400892 &lt;+12&gt;: movl $0x3,(%rax) 0x0000000000400898 &lt;+18&gt;: nop 0x0000000000400899 &lt;+19&gt;: pop %rbp 0x000000000040089a &lt;+20&gt;: retq End of assembler dump. ä¸Šè¿°ä»£ç 1ã€2è¡Œæ˜¯å‚æ•°è°ƒç”¨ä¿å­˜ç°åœºæ“ä½œï¼›ç¬¬3è¡Œæ˜¯å‚æ•°ä¼ é€’ï¼Œå‡½æ•°è°ƒç”¨ç¬¬ä¸€ä¸ªå‚æ•°ä¸€èˆ¬æ”¾åœ¨rdiå¯„å­˜å™¨ï¼Œæ­¤è¡Œä»£ç æŠŠrdiå¯„å­˜å™¨å€¼ï¼ˆæŒ‡é’ˆpçš„å€¼ï¼‰å†™å…¥æ ˆä¸­ï¼›ç¬¬4è¡Œæ˜¯æŠŠæ ˆä¸­pçš„å€¼å†™å…¥raxå¯„å­˜å™¨ï¼›ç¬¬5è¡Œæ˜¯æŠŠç«‹å³æ•°3å†™å…¥åˆ°raxå¯„å­˜å™¨å€¼æ‰€æŒ‡å‘çš„å†…å­˜ä¸­ï¼Œæ­¤å¤„è¦æ³¨æ„(%rax)ä¸¤è¾¹çš„æ‹¬å·ï¼Œè¿™ä¸ªæ‹¬å·å¹¶å¹¶ä¸æ˜¯å¯æœ‰å¯æ— çš„ï¼Œ(%rax)å’Œ%raxå®Œå…¨æ˜¯ä¸¤ç§æ„ä¹‰ï¼Œ(%rax)ä»£è¡¨raxå¯„å­˜å™¨ä¸­å€¼æ‰€ä»£è¡¨åœ°å€éƒ¨åˆ†çš„å†…å­˜ï¼Œå³ç›¸å½“äºC++ä»£ç ä¸­çš„*pï¼Œè€Œ%raxä»£è¡¨raxå¯„å­˜å™¨ï¼Œç›¸å½“äºC++ä»£ç ä¸­çš„på€¼ï¼Œæ‰€ä»¥æ±‡ç¼–è¿™é‡Œä½¿ç”¨äº†(%rax)è€Œä¸æ˜¯%raxã€‚ æˆ‘ä»¬å†å†™å‡ºå‚æ•°ä¼ é€’ä½¿ç”¨å¼•ç”¨çš„C++ä»£ç æ®µtest2ï¼š 12345void test2(int&amp; r)&#123; r = 3; //èµ‹å€¼å‰æ— éœ€åˆ¤æ–­referenceæ˜¯å¦ä¸ºç©º return;&#125; è¿™æ®µä»£ç å¯¹åº”çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š 1234567891011(gdb) disassemble Dump of assembler code for function test2(int&amp;): 0x000000000040089b &lt;+0&gt;: push %rbp 0x000000000040089c &lt;+1&gt;: mov %rsp,%rbp 0x000000000040089f &lt;+4&gt;: mov %rdi,-0x8(%rbp)=&gt; 0x00000000004008a3 &lt;+8&gt;: mov -0x8(%rbp),%rax 0x00000000004008a7 &lt;+12&gt;: movl $0x3,(%rax) 0x00000000004008ad &lt;+18&gt;: nop 0x00000000004008ae &lt;+19&gt;: pop %rbp 0x00000000004008af &lt;+20&gt;: retq End of assembler dump. æˆ‘ä»¬å‘ç°test2å¯¹åº”çš„æ±‡ç¼–ä»£ç å’Œtest1å¯¹åº”çš„æ±‡ç¼–ä»£ç å®Œå…¨ç›¸åŒï¼Œè¿™è¯´æ˜C++ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ç¨‹åºçš„æ—¶å€™å°†æŒ‡é’ˆå’Œå¼•ç”¨ç¼–è¯‘æˆäº†å®Œå…¨ä¸€æ ·çš„æœºå™¨ç ã€‚**æ‰€ä»¥C++ä¸­çš„å¼•ç”¨åªæ˜¯C++å¯¹æŒ‡é’ˆæ“ä½œçš„ä¸€ä¸ªâ€œè¯­æ³•ç³–â€ï¼Œåœ¨åº•å±‚å®ç°æ—¶C++ç¼–è¯‘å™¨å®ç°è¿™ä¸¤ç§æ“ä½œçš„æ–¹æ³•å®Œå…¨ç›¸åŒã€‚** æ€»ç»“C++ä¸­å¼•å…¥äº†å¼•ç”¨æ“ä½œï¼Œåœ¨å¯¹å¼•ç”¨çš„ä½¿ç”¨åŠ äº†æ›´å¤šé™åˆ¶æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œä¿è¯äº†å¼•ç”¨ä½¿ç”¨çš„å®‰å…¨æ€§å’Œä¾¿æ·æ€§ï¼Œè¿˜å¯ä»¥ä¿æŒä»£ç çš„ä¼˜é›…æ€§ã€‚åœ¨é€‚åˆçš„æƒ…å†µä½¿ç”¨é€‚åˆçš„æ“ä½œï¼Œå¼•ç”¨çš„ä½¿ç”¨å¯ä»¥ä¸€å®šç¨‹åº¦é¿å…â€œæŒ‡é’ˆæ»¡å¤©é£â€çš„æƒ…å†µï¼Œå¯¹äºæå‡ç¨‹åºç¨³å®šæ€§ä¹Ÿæœ‰ä¸€å®šçš„ç§¯ææ„ä¹‰ã€‚æœ€åï¼ŒæŒ‡é’ˆä¸å¼•ç”¨åº•å±‚å®ç°éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸ç”¨æ‹…å¿ƒä¸¤è€…çš„æ€§èƒ½å·®è·ã€‚ å®é‚£äº›äº‹å®ä¸­åŒ…å«ç‰¹æ®Šç¬¦å·åˆ†ä¸ºå‡ ç§ï¼š#ï¼Œ##ï¼Œ\\ 1.å­—ç¬¦ä¸²åŒ–æ“ä½œç¬¦(#)åœ¨ä¸€ä¸ªå®ä¸­çš„å‚æ•°å‰é¢ä½¿ç”¨ä¸€ä¸ª#,é¢„å¤„ç†å™¨ä¼šæŠŠè¿™ä¸ªå‚æ•°è½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œæ¢è¨€ä¹‹å°±æ˜¯ï¼š#æ˜¯â€œå­—ç¬¦ä¸²åŒ–â€çš„æ„æ€ï¼Œå‡ºç°åœ¨å®å®šä¹‰ä¸­çš„#æ˜¯æŠŠè·Ÿåœ¨åé¢çš„å‚æ•°è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ æ³¨æ„ï¼šå…¶åªèƒ½ç”¨äºæœ‰ä¼ å…¥å‚æ•°çš„å®å®šä¹‰ä¸­ï¼Œä¸”å¿…é¡»ç½®äºå®å®šä¹‰ä½“ä¸­çš„å‚æ•°åå‰ã€‚ 1234567891011121314151617181920#define exp(s) printf(&quot;test s is:%s\\n&quot;,s)#define exp1(s) printf(&quot;test s is:%s\\n&quot;,#s)#define exp2(s) #s int main() &#123; exp(&quot;hello&quot;); //**********************************è¿™é‡Œä¼ å…¥çš„æ˜¯å­—ç¬¦ä¸² exp1(hello); //**********************************è¿™é‡Œä¼ å…¥çš„æ˜¯ä¸ªä»€ä¹ˆã€‚ã€‚ã€‚ string str = exp2( bac ); cout&lt;&lt;str&lt;&lt;&quot; &quot;&lt;&lt;str.size()&lt;&lt;endl; /** * å¿½ç•¥ä¼ å…¥å‚æ•°åå‰é¢å’Œåé¢çš„ç©ºæ ¼ã€‚ */ string str1 = exp2( asda bac ); /** * å½“ä¼ å…¥å‚æ•°åé—´å­˜åœ¨ç©ºæ ¼æ—¶ï¼Œç¼–è¯‘å™¨å°†ä¼šè‡ªåŠ¨è¿æ¥å„ä¸ªå­å­—ç¬¦ä¸²ï¼Œ * ç”¨æ¯ä¸ªå­å­—ç¬¦ä¸²ä¹‹é—´ä»¥ä¸€ä¸ªç©ºæ ¼è¿æ¥ï¼Œå¿½ç•¥å‰©ä½™ç©ºæ ¼ã€‚ */ cout&lt;&lt;str1&lt;&lt;&quot; &quot;&lt;&lt;str1.size()&lt;&lt;endl; return 0;&#125; 2.ç¬¦å·è¿æ¥æ“ä½œç¬¦ï¼ˆ##ï¼‰â€œ##â€æ˜¯ä¸€ç§åˆ†éš”è¿æ¥æ–¹å¼ï¼Œå®ƒçš„ä½œç”¨æ˜¯å…ˆåˆ†éš”ï¼Œç„¶åè¿›è¡Œå¼ºåˆ¶è¿æ¥ã€‚å°†å®å®šä¹‰çš„å¤šä¸ªå½¢å‚è½¬æ¢æˆä¸€ä¸ªå®é™…å‚æ•°åã€‚ æ³¨æ„äº‹é¡¹ï¼š å½“ç”¨##è¿æ¥å½¢å‚æ—¶ï¼Œ##å‰åçš„ç©ºæ ¼å¯æœ‰å¯æ— ã€‚ è¿æ¥åçš„å®é™…å‚æ•°åï¼Œå¿…é¡»ä¸ºå®é™…å­˜åœ¨çš„å‚æ•°åæˆ–æ˜¯ç¼–è¯‘å™¨å·²çŸ¥çš„å®å®šä¹‰ã€‚ å¦‚æœ##åçš„å‚æ•°æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå®çš„è¯ï¼Œ##ä¼šé˜»æ­¢è¿™ä¸ªå®çš„å±•å¼€ã€‚ 1234567891011#define expA(s) printf(&quot;å‰ç¼€åŠ ä¸Šåçš„å­—ç¬¦ä¸²ä¸º:%s\\n&quot;,gc_##s) //gc_så¿…é¡»å­˜åœ¨// æ³¨æ„äº‹é¡¹2#define expB(s) printf(&quot;å‰ç¼€åŠ ä¸Šåçš„å­—ç¬¦ä¸²ä¸º:%s\\n&quot;,gc_ ## s) //gc_så¿…é¡»å­˜åœ¨// æ³¨æ„äº‹é¡¹1#define gc_hello1 &quot;I am gc_hello1&quot;int main() &#123; // æ³¨æ„äº‹é¡¹1 const char * gc_hello = &quot;I am gc_hello&quot;; expA(hello); expB(hello1);&#125; 3.ç»­è¡Œæ“ä½œç¬¦(\\)å½“å®šä¹‰çš„å®ä¸èƒ½ç”¨ä¸€è¡Œè¡¨è¾¾å®Œæ•´æ—¶ï¼Œå¯ä»¥ç”¨â€\\â€è¡¨ç¤ºä¸‹ä¸€è¡Œç»§ç»­æ­¤å®çš„å®šä¹‰ã€‚ æ³¨æ„ \\ å‰ç•™ç©ºæ ¼ã€‚ 123456#define MAX(a,b) ((a)&gt;(b) ? (a) \\ :(b)) int main() &#123; int max_val = MAX(3,6); cout&lt;&lt;max_val&lt;&lt;endl;&#125; do {â€¦}while(0)çš„ä½¿ç”¨1.é¿å…è¯­ä¹‰æ›²è§£123#define fun() f1();f2();if(a&gt;0) fun() è¿™ä¸ªå®è¢«å±•å¼€åå°±æ˜¯ï¼š 123if(a&gt;0) f1(); f2(); æœ¬æ„æ˜¯a&gt;0æ‰§è¡Œf1 f2ï¼Œè€Œå®é™…æ˜¯f2æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥å°±é”™è¯¯äº†ã€‚ ä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œåœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œé€šå¸¸å¯ä»¥é‡‡ç”¨{}å—ã€‚ 123456789#define fun() &#123;f1();f2();&#125;if(a&gt;0) fun();// å®å±•å¼€if(a&gt;0)&#123; f1(); f2();&#125;; ä½†æ˜¯ä¼šå‘ç°ä¸Šè¿°å®å±•å¼€åå¤šäº†ä¸€ä¸ªåˆ†å·ï¼Œå®é™…è¯­æ³•ä¸å¤ªå¯¹ã€‚(è™½ç„¶ç¼–è¯‘è¿è¡Œæ²¡é—®é¢˜ï¼Œæ­£å¸¸æ²¡åˆ†å·)ã€‚ 2.é¿å…ç”±å®å¼•èµ·çš„è­¦å‘Šå†…æ ¸ä¸­ç”±äºä¸åŒæ¶æ„çš„é™åˆ¶ï¼Œå¾ˆå¤šæ—¶å€™ä¼šç”¨åˆ°ç©ºå®ï¼Œã€‚åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œè¿™äº›ç©ºå®ä¼šç»™å‡ºwarningï¼Œä¸ºäº†é¿å…è¿™æ ·çš„warningï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨do{â€¦}while(0)æ¥å®šä¹‰ç©ºå®ï¼š 1#define EMPTYMICRO do&#123;&#125;while(0)","categories":[{"name":"C++","slug":"C","permalink":"https://flippy-bird.github.io/categories/C/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://flippy-bird.github.io/tags/C/"}]},{"title":"æ¥è‡ªhexoåšå®¢çš„hello world","slug":"hello-world","date":"2021-01-13T02:14:50.000Z","updated":"2026-01-16T10:41:49.220Z","comments":true,"path":"2021/01/13/hello-world/","permalink":"https://flippy-bird.github.io/2021/01/13/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]}],"categories":[{"name":"æ¨ç†éƒ¨ç½²","slug":"æ¨ç†éƒ¨ç½²","permalink":"https://flippy-bird.github.io/categories/%E6%8E%A8%E7%90%86%E9%83%A8%E7%BD%B2/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://flippy-bird.github.io/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"},{"name":"å·¥å…·ä½¿ç”¨","slug":"å·¥å…·ä½¿ç”¨","permalink":"https://flippy-bird.github.io/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"},{"name":"Agentå¼€æºé¡¹ç›®å­¦ä¹ ","slug":"Agentå¼€æºé¡¹ç›®å­¦ä¹ ","permalink":"https://flippy-bird.github.io/categories/Agent%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0/"},{"name":"RAGæ¡†æ¶å­¦ä¹ ","slug":"RAGæ¡†æ¶å­¦ä¹ ","permalink":"https://flippy-bird.github.io/categories/RAG%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/"},{"name":"shader","slug":"shader","permalink":"https://flippy-bird.github.io/categories/shader/"},{"name":"OpenGL","slug":"OpenGL","permalink":"https://flippy-bird.github.io/categories/OpenGL/"},{"name":"C++","slug":"C","permalink":"https://flippy-bird.github.io/categories/C/"},{"name":"iOSæ–°æ‰‹æ‘","slug":"iOSæ–°æ‰‹æ‘","permalink":"https://flippy-bird.github.io/categories/iOS%E6%96%B0%E6%89%8B%E6%9D%91/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://flippy-bird.github.io/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"inference","slug":"inference","permalink":"https://flippy-bird.github.io/tags/inference/"},{"name":"llm","slug":"llm","permalink":"https://flippy-bird.github.io/tags/llm/"},{"name":"Agent","slug":"Agent","permalink":"https://flippy-bird.github.io/tags/Agent/"},{"name":"åŸºç¡€çŸ¥è¯†","slug":"åŸºç¡€çŸ¥è¯†","permalink":"https://flippy-bird.github.io/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"},{"name":"vibe coding","slug":"vibe-coding","permalink":"https://flippy-bird.github.io/tags/vibe-coding/"},{"name":"LLM","slug":"LLM","permalink":"https://flippy-bird.github.io/tags/LLM/"},{"name":"ç«¯ä¾§","slug":"ç«¯ä¾§","permalink":"https://flippy-bird.github.io/tags/%E7%AB%AF%E4%BE%A7/"},{"name":"plan","slug":"plan","permalink":"https://flippy-bird.github.io/tags/plan/"},{"name":"memory","slug":"memory","permalink":"https://flippy-bird.github.io/tags/memory/"},{"name":"Rag","slug":"Rag","permalink":"https://flippy-bird.github.io/tags/Rag/"},{"name":"MCP","slug":"MCP","permalink":"https://flippy-bird.github.io/tags/MCP/"},{"name":"langgraph","slug":"langgraph","permalink":"https://flippy-bird.github.io/tags/langgraph/"},{"name":"shader","slug":"shader","permalink":"https://flippy-bird.github.io/tags/shader/"},{"name":"å…ƒå®‡å®™","slug":"å…ƒå®‡å®™","permalink":"https://flippy-bird.github.io/tags/%E5%85%83%E5%AE%87%E5%AE%99/"},{"name":"AR","slug":"AR","permalink":"https://flippy-bird.github.io/tags/AR/"},{"name":"bug","slug":"bug","permalink":"https://flippy-bird.github.io/tags/bug/"},{"name":"RenderDoc","slug":"RenderDoc","permalink":"https://flippy-bird.github.io/tags/RenderDoc/"},{"name":"OpenGL","slug":"OpenGL","permalink":"https://flippy-bird.github.io/tags/OpenGL/"},{"name":"Metal","slug":"Metal","permalink":"https://flippy-bird.github.io/tags/Metal/"},{"name":"C++","slug":"C","permalink":"https://flippy-bird.github.io/tags/C/"}]}